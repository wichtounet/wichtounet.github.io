<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang=en> <head><meta charset=utf-8><meta name=viewport content="width=device-width"><title>Using LINQ to query Sharepoint lists | @Blog("Baptiste Wicht")</title><link href=../../../assets/css/all-nocdn.css rel=stylesheet type=text/css><link rel=alternate type=application/rss+xml title=RSS href=../../../rss.xml><link rel=canonical href=http://baptiste-wicht.com/posts/2011/01/using-linq-to-query-sharepoint-lists.html><script type=text/javascript>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2175227-7']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script><meta name=author content="Baptiste Wicht"><meta name=og:title content="Using LINQ to query Sharepoint lists"><meta name=og:url content=http://baptiste-wicht.com/posts/2011/01/using-linq-to-query-sharepoint-lists.html><meta name=og:description content="When I started using Sharepoint 2010 with .NET, I used the Sharepoint 2010 API to query the Sharepoint Lists, but when I come with lookup column with multiple values, it started to be really difficult"><meta name=og:site_name content=@Blog( baptiste wicht><meta name=og:type content=article><link href=../../../favicon.ico rel=icon type=image/x-icon></head><body><div class=social_container> <div class=social_container_gplus> <a target=_blank title="Share on Google+" href="https://plusone.google.com/_/+1/confirm?hl=en&amp;url=http://baptiste-wicht.com/posts/2011/01/using-linq-to-query-sharepoint-lists.html"><img src=../../../assets/img/google_plus.png></a> </div> <div class=social_container_facebook> <a target=_blank title="Share on Facebook" href="http://www.facebook.com/sharer/sharer.php?u=#url"><img src=../../../assets/img/facebook.png></a> </div> <div class=social_container_twitter> <a target=_blank title="Tweet on Twitter" href="http://twitter.com/home?status=#url"><img src=../../../assets/img/twitter.svg></a> </div></div><nav class="navbar navbar-inverse navbar-fixed-top" role=navigation> <div class=container-fluid> <div class=navbar-header> <button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-ex1-collapse> <span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </button> <a class=navbar-brand href=http://baptiste-wicht.com/> <span id=blog-title>@Blog("Baptiste Wicht")</span> </a> </div> <div class="collapse navbar-collapse navbar-ex1-collapse"> <ul class="nav navbar-nav"> <li><a href=../../../stories/about.html>About</a> </li><li><a href=../../../stories/publications.html>Publications</a> </li><li><a href=../../../stories/donate.html>Donate</a> </li><li><a href=../../../stories/contact.html>Contact</a> </li><li><a href=../../../stories/faq.html>FAQ</a> </li><li><a href=../../../stories/legal.html>Legal</a> </li><li><a href=../../../categories/index.html>Tags</a> </li><li><a href=../../../archive.html>Archives</a> </li><li><a href=http://feeds.feedburner.com/BaptisteWicht>RSS</a> </li></ul> <span class="navbar-form pull-left"> <form action=../../../stories/search.html> <input type=text name=q id=tipue_search_input> </form> </span> <ul class="nav navbar-nav navbar-right"> <li> <a target=_blank title="Follow @wichtounet on Twitter" href=https://twitter.com/wichtounet> <img src=../../../assets/img/twitter.svg alt="Follow @wichtounet on Twitter"> </a> </li> <li> <a target=_blank title="Follow +BaptisteWicht on Google+" href=https://plus.google.com/+BaptisteWicht> <img src=../../../assets/img/google_plus.svg alt="Follow +BaptisteWicht on Google+"> </a> </li> </ul> </div> </div></nav><div class=body-container> <div class=left-sidebar> <div class=left-sidebar-widget> <div class=left-sidebar-widget-content> <div class=g-person data-width=275 data-href=//plus.google.com/u/0/103113673902796202116 data-theme=dark data-layout=landscape data-rel=author></div> </div> </div> <div class=left-sidebar-widget> <h3>Related posts</h3> <div class=left-sidebar-widget-content> <ol><li><a href=export-a-sharepoint-2010-site-as-solution-package.html>Export a Sharepoint 2010 site as Solution Package</a></li><li><a href=../../2010/03/nio-2-path-api-java-7.html>NIO.2 : The new Path API in Java 7</a></li><li><a href=../../2009/12/swing-user-interface-jtable.html>Creation of Swing User Interface : Tables (JTable)</a></li><li><a href=../../2013/10/budgetwarrior-0-2-visual-reports-fortune-status-expenses-aggregates.html>budgetwarrior 0.2 - Visual reports, fortune status and expenses aggregates</a></li><li><a href=../06/write-and-read-binary-files-in-c.html>Write and read binary files in C++</a></li></ol> </div> </div> <div class=left-sidebar-widget> <h3>Recent comments</h3> <div class=left-sidebar-widget-content> <div id=recentcomments class=dsq-widget> <script type=text/javascript src="http://blogwichtounet.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=0&amp;avatar_size=28&amp;excerpt_length=50"></script> </div> </div> </div> <div class=left-sidebar-widget> <h3>Blogroll</h3> <div class=left-sidebar-widget-content> <ul> <li><a target=_blank href=http://www.asjava.com/>AsJava.com : Java Tutorial</a></li> <li><a target=_blank href=http://www.mkyong.com/>Mkyong : Java Tutorials</a></li> </ul> </div> </div> </div> <div class=container> <div class=body-content> <div class=row><article class="post-text h-entry hentry postpage" itemscope=itemscope itemtype=http://schema.org/Article> <header> <h1 class="p-name entry-title" itemprop="headline name"><a href=# class=u-url>Using LINQ to query Sharepoint lists</a></h1> <div class=metadata> <p class="byline author vcard"><span class="byline-name fn">Baptiste Wicht</span></p> <p class=dateline><a href=# rel=bookmark><time class="published dt-published" datetime=2011-01-12T12:47:12+01:00 itemprop=datePublished title="Publication date">2011-01-12 12:47</time></a></p> <p class=commentline> <a href=using-linq-to-query-sharepoint-lists.html#disqus_thread data-disqus-identifier=cache/posts/2011/01/using-linq-to-query-sharepoint-lists.html>Comments</a> </p><p class=sourceline><a href=using-linq-to-query-sharepoint-lists.wp id=sourcelink>Source</a></p> </div> </header> <div class="e-content entry-content" itemprop="articleBody text"> <p>When I started using Sharepoint 2010 with .NET, I used the Sharepoint 2010 API to query the Sharepoint Lists, but when I come with lookup column with multiple values, it started to be really difficult to use.</p><p>So I found that I can use LINQ to query Sharepoint lists and for what I saw on the internet, it was really simple to use. LINQ provide a complete API to query data and to update them. More than that, LINQ is also able to do mapping object-relational, what is really helpful in code lisibility.</p><p>In this code, I will take as example a Sharepoint site with two lists :</p><ul> <li>departments : only a Title column</li> <li>projects : Title, year, nbstudents and department, a lookup column to departments with multiple values</li></ul><p>So first of all, you need to create the entities and the data context, but you don't have to do it by hand. There is a tool that make all that for you, SPMetal.</p><p>Open a command line and cd to "C:\Program Files\Common Files\Microsoft Shared\Web Server Extensions\14\bin", and then you can use the following command :</p><pre>SPMetal.exe /web:http://localhost/ /code:C:\Projects.cs</pre><p>You can use the URL of your Sharepoint site and you can change the name of the C# file. This will generate a long file containing the DataContext and the mapping objects. Here is a part of the code I get in this file :</p><pre class="code literal-block"><span class=k>public</span> <span class=k>partial</span> <span class=k>class</span> <span class=nc>ProjectsDataContext</span> <span class=p>:</span> <span class=n>Microsoft</span><span class=p>.</span><span class=n>SharePoint</span><span class=p>.</span><span class=n>Linq</span><span class=p>.</span><span class=n>DataContext</span> <span class=p>{</span>

    <span class=cp>#region Extensibility Method Definitions</span>
    <span class=k>partial</span> <span class=k>void</span> <span class=nf>OnCreated</span><span class=p>();</span>
    <span class=cp>#endregion</span>

    <span class=k>public</span> <span class=nf>ProjectsDataContext</span><span class=p>(</span><span class=kt>string</span> <span class=n>requestUrl</span><span class=p>)</span> <span class=p>:</span> <span class=k>this</span><span class=p>(</span><span class=n>requestUrl</span><span class=p>,</span> <span class=k>true</span><span class=p>)</span> <span class=p>{</span>

    <span class=p>}</span>

    <span class=k>public</span> <span class=nf>ProjectsDataContext</span><span class=p>(</span><span class=kt>string</span> <span class=n>requestUrl</span><span class=p>,</span> <span class=n>Boolean</span> <span class=n>tracking</span><span class=p>)</span> <span class=p>:</span> <span class=k>base</span><span class=p>(</span><span class=n>requestUrl</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=k>this</span><span class=p>.</span><span class=n>OnCreated</span><span class=p>();</span>
        <span class=n>ObjectTrackingEnabled</span> <span class=p>=</span> <span class=n>tracking</span><span class=p>;</span>
    <span class=p>}</span>

<span class=na>    [Microsoft.SharePoint.Linq.ListAttribute(Name="departments")]</span>
    <span class=k>public</span> <span class=n>Microsoft</span><span class=p>.</span><span class=n>SharePoint</span><span class=p>.</span><span class=n>Linq</span><span class=p>.</span><span class=n>EntityList</span><span class=p>&lt;</span><span class=n>item</span><span class=p>&gt;</span> <span class=n>Departments</span> <span class=p>{</span>
        <span class=k>get</span> <span class=p>{</span>
            <span class=k>return</span> <span class=k>this</span><span class=p>.</span><span class=n>GetList</span><span class=p>&lt;</span><span class=n>item</span><span class=p>&gt;(</span><span class=s>"departments"</span><span class=p>);</span>
        <span class=p>}</span>
    <span class=p>}</span>

        <span class=c1>//...</span>
</pre><p>Add this file to your Visual Studio Project. You will have some errors because, you must include the reference to LINQ for Sharepoint. Right click the preferences of your project, choose "Add reference" and add the Microsoft.SharePoint.Linq.dll and now you're ready to use LINQ for Sharepoint in your project. </p><h5>Query Data</h5><p>First, you can query data using LINQ, by example, getting all the projects : </p><pre class="code literal-block"><span class=k>using</span> <span class=p>(</span><span class=n>ProjectsDataContext</span> <span class=n>context</span> <span class=p>=</span> <span class=k>new</span> <span class=n>ProjectsDataContext</span><span class=p>(</span><span class=n>SPContext</span><span class=p>.</span><span class=n>Current</span><span class=p>.</span><span class=n>Web</span><span class=p>.</span><span class=n>Url</span><span class=p>))</span>
<span class=p>{</span>
    <span class=kt>var</span> <span class=n>query</span> <span class=p>=</span> <span class=k>from</span> <span class=n>c</span> <span class=k>in</span> <span class=n>context</span><span class=p>.</span><span class=n>Projects</span> <span class=k>select</span> <span class=n>c</span><span class=p>;</span>

    <span class=k>foreach</span> <span class=p>(</span><span class=kt>var</span> <span class=n>project</span> <span class=k>in</span> <span class=n>query</span><span class=p>)</span>
    <span class=p>{</span>
        <span class=n>console</span><span class=p>.</span><span class=n>writeLine</span><span class=p>(</span><span class=s>"Title : "</span> <span class=p>+</span> <span class=n>project</span><span class=p>.</span><span class=n>Title</span><span class=p>.</span><span class=n>ToString</span><span class=p>());</span>
        <span class=n>console</span><span class=p>.</span><span class=n>writeLine</span><span class=p>(</span><span class=s>"Year: "</span> <span class=p>+</span> <span class=n>project</span><span class=p>.</span><span class=n>Year</span><span class=p>.</span><span class=n>ToString</span><span class=p>());</span>
        <span class=n>console</span><span class=p>.</span><span class=n>writeLine</span><span class=p>(</span><span class=s>"Nb of students : "</span> <span class=p>+</span> <span class=n>project</span><span class=p>.</span><span class=n>Nbstudents</span><span class=p>.</span><span class=n>ToString</span><span class=p>());</span>

        <span class=kt>string</span> <span class=n>str</span> <span class=p>=</span> <span class=s>""</span><span class=p>;</span>

        <span class=kt>int</span> <span class=n>index</span> <span class=p>=</span> <span class=m>0</span><span class=p>;</span>
        <span class=k>foreach</span> <span class=p>(</span><span class=n>Item</span> <span class=n>item</span> <span class=k>in</span> <span class=n>project</span><span class=p>.</span><span class=n>Department</span><span class=p>)</span>
        <span class=p>{</span>
            <span class=n>str</span> <span class=p>+=</span> <span class=n>index</span><span class=p>++</span> <span class=p>&amp;</span><span class=n>gt</span><span class=p>;</span> <span class=m>0</span> <span class=p>?</span> <span class=s>", "</span> <span class=p>+</span> <span class=n>item</span><span class=p>.</span><span class=n>Title</span> <span class=p>:</span> <span class=n>item</span><span class=p>.</span><span class=n>Title</span><span class=p>;</span>
        <span class=p>}</span>

        <span class=n>console</span><span class=p>.</span><span class=n>WriteLine</span><span class=p>(</span><span class=n>str</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>
</pre><p>You can see that it's really simple and a lot easier than the way with Sharepoint API. More than that, the mapping to Object is just great :)</p><h5>Update Data</h5><p>You can also insert data, really easily with LINQ : </p><pre class="code literal-block"><span class=k>using</span> <span class=p>(</span><span class=n>ProjectsDataContext</span> <span class=n>context</span> <span class=p>=</span> <span class=k>new</span> <span class=n>ProjectsDataContext</span><span class=p>(</span><span class=n>SPContext</span><span class=p>.</span><span class=n>Current</span><span class=p>.</span><span class=n>Web</span><span class=p>.</span><span class=n>Url</span><span class=p>))</span>
<span class=p>{</span>
    <span class=n>Item</span> <span class=n>department</span> <span class=p>=</span> <span class=k>new</span> <span class=n>Item</span><span class=p>();</span>
    <span class=n>department</span><span class=p>.</span><span class=n>Title</span> <span class=p>=</span> <span class=s>"New department"</span><span class=p>;</span>

    <span class=n>context</span><span class=p>.</span><span class=n>Departments</span><span class=p>.</span><span class=n>InsertOnSubmit</span><span class=p>(</span><span class=n>department</span><span class=p>);</span>

    <span class=n>context</span><span class=p>.</span><span class=n>SubmitChanges</span><span class=p>();</span>
<span class=p>}</span>
</pre><p>To delete a Data, you can query it and then use DeleteOnSubmit to delete it. To update a data, it's even more simple, you just have to edit the item and then use SubmitChanges() to commit them. </p><p>As you can see, using LINQ allows you to write code simple, readable and all that faster than if you use Sharepoint API. </p><p>I hope this can be useful to someone.</p> </div> <aside class=postpromonav> <nav> <ul itemprop=keywords class=tags> <li><a class="tag p-category" href=../../../categories/sharepoint.html rel=tag>Sharepoint</a></li> <li><a class="tag p-category" href=../../../categories/visual-studio.html rel=tag>Visual Studio</a></li> </ul> <ul class=pager> <li class=previous> <a href=export-a-sharepoint-2010-site-as-solution-package.html rel=prev title="Export a Sharepoint 2010 site as Solution Package">Previous post</a> </li> <li class=next> <a href=../05/now-writing-from-berkeley-california.html rel=next title="Now writing from Berkeley, California">Next post</a> </li> </ul> </nav> </aside> <section class=comments> <h2>Comments</h2> <div id=disqus_thread></div> <script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="http://baptiste-wicht.com/posts/2011/01/using-linq-to-query-sharepoint-lists.html",
        disqus_title="Using LINQ to query Sharepoint lists",
        disqus_identifier="cache/posts/2011/01/using-linq-to-query-sharepoint-lists.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script> <noscript>Please enable JavaScript to view the <a href=//disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript> <a href=//disqus.com class=dsq-brlink rel=nofollow>Comments powered by <span class=logo-disqus>Disqus</span></a> </section></article> <script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script> </div> </div> </div></div><footer> Contents © 2015 <a href=mailto:baptistewicht@gmail.com>Baptiste Wicht</a> - Powered by <a href=http://getnikola.com rel=nofollow>Nikola</a><a rel=license href=http://creativecommons.org/licenses/by/4.0/><img alt="Creative Commons License" style=padding-left:5px;border-width:0 src=../../../assets/img/cc.png></a> <ul class=footer_inline_ul> <li> <a href=using-linq-to-query-sharepoint-lists.wp id=sourcelink>Source</a> </li> </ul></footer> <script src=../../../assets/js/all-nocdn.js></script><script type=text/javascript src=https://apis.google.com/js/platform.js></script></body></html>