<!DOCTYPE html><html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Baptiste Wicht">
    <title>Using LINQ to query Sharepoint lists | @Blog("Baptiste Wicht")</title>
    
            <link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
      <link rel="canonical" href="http://wichtounet.github.io/posts/2011/01/using-linq-to-query-sharepoint-lists.html">
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
            <link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">

    





    
<link rel="stylesheet" type="text/css" href="../../../assets/css/tipuesearch.css">
</head><body><div id="tipue_search_content" style="margin-left: auto; margin-right: auto; padding: 20px;"></div>




<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid"><!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://wichtounet.github.io/">@Blog("Baptiste Wicht")</a>
        </div><!-- /.navbar-header -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                
                <li><a href="../../../stories/about.html">About</a>
                </li><li><a href="../../../stories/publications.html">Publications</a>
                </li><li><a href="../../../stories/donate.html">Donate</a>
                </li><li><a href="../../../stories/faq.html">FAQ</a>
                </li><li><a href="../../../stories/legal.html">Legal</a>
                </li><li><a href="../../../archive.html">Archives</a>
                </li><li><a href="../../../categories/index.html">Tags</a>
                </li><li><a href="../../../rss.xml">RSS</a>

            </li></ul>
                
<span class="navbar-form pull-left">
<input type="text" id="tipue_search_input">
</span>

            <ul class="nav navbar-nav navbar-right">
                
                
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>

<!-- End of Menubar -->

<div class="body-container">

    <!-- Sidebar -->

    <div class="left-sidebar">
        <div class="left-sidebar-widget">
            <h3>Something, something</h3>
            <div class="left-sidebar-widget-content">
                ...dark side...
            </div>
        </div>
        
        <div class="left-sidebar-widget">
            <h3>Tags</h3>
            <div class="left-sidebar-widget-content">
                <div id="tags_container">
                    <canvas width="275" height="250" id="tags_canvas">
                        <p>Anything in here will be replaced on browsers that support the canvas element</p>
                    </canvas>
                </div>
            </div>
        </div>
        
        <div class="left-sidebar-widget">
            <h3>Blogroll</h3>
            <div class="left-sidebar-widget-content">
                <ul>
                    <li><a target="_blank" href="http://www.asjava.com/">AsJava.com : Java Tutorial</a></li>
                    <li><a target="_blank" href="http://www.mkyong.com/">Mkyong : Java Tutorials</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Content -->

    <div class="container">
        <div class="body-content">
            <!--Body content-->
            <div class="row">
                
    <article class="postbox post-text">
    <div class="h-entry" itemscope="itemscope" itemtype="http://schema.org/Article">
    
    <h1 class="p-name" itemprop="headline name">Using LINQ to query Sharepoint lists</h1>

    <hr>
    <small>
        Posted: <time class="published dt-published" datetime="2011-01-12T12:47:12+00:00" itemprop="datePublished">2011-01-12 12:47</time>
        

        
          |  
        More posts about 
    <span itemprop="keywords">
        <a class="tag p-category" href="../../../categories/sharepoint.html"><span class="badge badge-info">Sharepoint</span></a>
        <a class="tag p-category" href="../../../categories/sharepoint-2010.html"><span class="badge badge-info">Sharepoint 2010</span></a>
        <a class="tag p-category" href="../../../categories/visual-studio-2010.html"><span class="badge badge-info">Visual Studio 2010</span></a>
    </span>


    </small>
    <hr>
    <div class="e-content" itemprop="articleBody text">
    <div><p></p><p>When I started using Sharepoint 2010 with .NET, I used the Sharepoint 2010 API to query the Sharepoint Lists, but when I come with lookup column with multiple values, it started to be really difficult to use.</p>
<p>So I found that I can use LINQ to query Sharepoint lists and for what I saw on the internet, it was really simple to use. LINQ provide a complete API to query data and to update them. More than that, LINQ is also able to do mapping object-relational, what is really helpful in code lisibility.</p>
<p>In this code, I will take as example a Sharepoint site with two lists :</p>
<p></p><ul>
    <li>departments : only a Title column</li>
    <li>projects : Title, year, nbstudents and department, a lookup column to departments with multiple values</li>
</ul>
<p>So first of all, you need to create the entities and the data context, but you don't have to do it by hand. There is a tool that make all that for you, SPMetal.</p>
<!--more-->

<p>Open a command line and cd to "C:\Program Files\Common Files\Microsoft Shared\Web Server Extensions\14\bin", and then you can use the following command :</p>
<pre>SPMetal.exe /web:http://localhost/ /code:C:\Projects.cs</pre>

<p>You can use the URL of your Sharepoint site and you can change the name of the C# file. This will generate a long file containing the DataContext and the mapping objects. Here is a part of the code I get in this file :</p>
<p>[csharp][/csharp]public partial class ProjectsDataContext : Microsoft.SharePoint.Linq.DataContext {</p>
<div class="code"><pre><span class="vi">#region</span> <span class="nx">Extensibility</span> <span class="nb">Method</span> <span class="nx">Definitions</span>
<span class="nx">partial</span> <span class="bp">void</span> <span class="nx">OnCreated</span><span class="p">();</span>
<span class="vi">#endregion</span>

<span class="k">public</span> <span class="nf">ProjectsDataContext</span><span class="p">(</span><span class="na">string</span> <span class="nx">requestUrl</span><span class="p">)</span> <span class="p">:</span> <span class="nx">this</span><span class="p">(</span><span class="nx">requestUrl</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>

<span class="k">public</span> <span class="nf">ProjectsDataContext</span><span class="p">(</span><span class="na">string</span> <span class="nx">requestUrl</span><span class="p">,</span> <span class="na">Boolean</span> <span class="nx">tracking</span><span class="p">)</span> <span class="p">:</span> <span class="nx">base</span><span class="p">(</span><span class="nx">requestUrl</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nx">this.OnCreated</span><span class="p">();</span>
    <span class="n">ObjectTrackingEnabled</span> <span class="o">=</span> <span class="nx">tracking</span><span class="p">;</span>
<span class="p">}</span>

<span class="err">[</span><span class="nx">Microsoft.SharePoint.Linq.ListAttribute</span><span class="p">(</span><span class="n">Name</span><span class="o">=</span><span class="s2">"departments"</span><span class="p">)</span><span class="cp">]</span>
public Microsoft.SharePoint.Linq.EntityList<span class="nt">&lt;item&gt;</span> Departments {
    get {
        return this.GetList<span class="nt">&lt;item&gt;</span>("departments");
    }
}

    //...
</pre></div>


<p>[csharp][/csharp]</p>
<p>Add this file to your Visual Studio Project. You will have some errors because, you must include the reference to LINQ for Sharepoint. Right click the preferences of your project, choose "Add reference" and add the Microsoft.SharePoint.Linq.dll and now you're ready to use LINQ for Sharepoint in your project. </p>
<h5>Query Data</h5>

<p>First, you can query data using LINQ, by example, getting all the projects : </p>
<p>[csharp][/csharp]using (ProjectsDataContext context = new ProjectsDataContext(SPContext.Current.Web.Url))</p>
<p>{
    var query = from c in context.Projects select c;</p>
<div class="code"><pre><span class="n">foreach</span> <span class="p">(</span><span class="n">var</span> <span class="n">project</span> <span class="n">in</span> <span class="n">query</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">console</span><span class="p">.</span><span class="n">writeLine</span><span class="p">(</span><span class="s">"Title : "</span> <span class="o">+</span> <span class="n">project</span><span class="p">.</span><span class="n">Title</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
    <span class="n">console</span><span class="p">.</span><span class="n">writeLine</span><span class="p">(</span><span class="s">"Year: "</span> <span class="o">+</span> <span class="n">project</span><span class="p">.</span><span class="n">Year</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>
    <span class="n">console</span><span class="p">.</span><span class="n">writeLine</span><span class="p">(</span><span class="s">"Nb of students : "</span> <span class="o">+</span> <span class="n">project</span><span class="p">.</span><span class="n">Nbstudents</span><span class="p">.</span><span class="n">ToString</span><span class="p">());</span>

    <span class="n">string</span> <span class="n">str</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">foreach</span> <span class="p">(</span><span class="n">Item</span> <span class="n">item</span> <span class="n">in</span> <span class="n">project</span><span class="p">.</span><span class="n">Department</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">str</span> <span class="o">+=</span> <span class="n">index</span><span class="o">++</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">0</span> <span class="o">?</span> <span class="s">", "</span> <span class="o">+</span> <span class="n">item</span><span class="p">.</span><span class="n">Title</span> <span class="o">:</span> <span class="n">item</span><span class="p">.</span><span class="n">Title</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>}[csharp][/csharp]</p>
<p>You can see that it's really simple and a lot easier than the way with Sharepoint API. More than that, the mapping to Object is just great :)</p>
<h5>Update Data</h5>

<p>You can also insert data, really easily with LINQ : </p>
<p>[csharp][/csharp]using (ProjectsDataContext context = new ProjectsDataContext(SPContext.Current.Web.Url))</p>
<p>{
    Item department = new Item();
    department.Title = "New department";</p>
<div class="code"><pre><span class="n">context</span><span class="p">.</span><span class="n">Departments</span><span class="p">.</span><span class="n">InsertOnSubmit</span><span class="p">(</span><span class="n">department</span><span class="p">);</span>

<span class="n">context</span><span class="p">.</span><span class="n">SubmitChanges</span><span class="p">();</span>
</pre></div>


<p>}[csharp][/csharp]</p>
<p>To delete a Data, you can query it and then use DeleteOnSubmit to delete it. To update a data, it's even more simple, you just have to edit the item and then use SubmitChanges() to commit them. </p>
<p>As you can see, using LINQ allows you to write code simple, readable and all that faster than if you use Sharepoint API. </p>
<p>I hope this can be useful to someone. </p></div>
    </div>
    </div>
    
        <ul class="pager">
            <li class="previous">
                <a href="export-a-sharepoint-2010-site-as-solution-package.html" rel="prev">← Previous post</a>
            </li>
            <li class="next">
                <a href="../05/now-writing-from-berkeley-california.html" rel="next">Next post →</a>
            </li>
        </ul>

        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="http://wichtounet.github.io/posts/2011/01/using-linq-to-query-sharepoint-lists.html",
        disqus_title="Using LINQ to query Sharepoint lists",
        disqus_identifier="cache/posts/2011/01/using-linq-to-query-sharepoint-lists.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


    

    </article>

            </div>
            <!--End of body content-->
        </div>
    </div>
</div>

<!-- Footer -->

<footer>
    Contents © 2014         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/4.0/88x31.png"></a>
        <ul class="footer_inline_ul">
            
    <li>
    <a href="using-linq-to-query-sharepoint-lists.wp" id="sourcelink">Source</a>
    </li>

        </ul>
</footer>


            <script src="../../../assets/js/all-nocdn.js" type="text/javascript"></script>

    <script type="text/javascript">
      $(document).ready(function() {
        jQuery.getJSON('/assets/js/tag_cloud_data.json', function(data) {
            var items = [];

            $.each(data, function(key, val) {
                items.push('<li><a href="' + val[1] +'" '+'data-weight="'+val[0]+'"'+'>' + key + '</a></li>');
            });

            $('<div/>', {
                'id': 'tags',
                html: '<ul>' + items.join('') + '</ul>'
            }).appendTo('body');

            if(!$('#tags_canvas').tagcanvas({
                textColour: '#FFFFFF',
                outlineColour: '#ff00ff',
                reverse: true,
                depth: 0.8,
                maxSpeed: 0.05,
                weight: true,
                weightFrom: "data-weight",
                weightSizeMin: 8,
                weightSizeMax: 24
            },'tags')) {
            // something went wrong, hide the canvas container
            $('#tags_container').hide();
            }});});
    </script>

    
<!-- AddThis Smart Layers BEGIN -->
<!-- Go to http://www.addthis.com/get/smart-layers to customize -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5327566b264df4ee"></script>
<script type="text/javascript">
  addthis.layers({
    'theme' : 'dark',
    'share' : {
      'position' : 'right',
      'numPreferredServices' : 5
    }, 
    'follow' : {
      'services' : [
        {'service': 'twitter', 'id': 'wichtounet'},
        {'service': 'google_follow', 'id': '+BaptisteWicht'}
      ]
    }   
  });
</script>
<!-- AddThis Smart Layers END -->


    <script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script>
    

<script type="text/javascript" src="../../../assets/js/tipuesearch_set.js"></script>
<script type="text/javascript" src="../../../assets/js/tipuesearch.js"></script>
<script type="text/javascript">
$(document).ready(function() {
  $('#tipue_search_input').tipuesearch({
      'mode': 'json',
      'contentLocation': '/assets/js/tipuesearch_content.json',
      'showUrl': false
  });
});
</script>


</body></html>