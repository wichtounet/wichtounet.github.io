<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Release of the version 1.2.1 of the Expression Templates Library (ETL) project with faster GPU support and new features.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Expression Templates Library 1.2.1: Faster GPU and new features | Blog blog("Baptiste Wicht");</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://baptiste-wicht.com/posts/2018/01/expression-templates-library-121-faster-gpu-and-new-features.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Baptiste Wicht">
<link rel="prev" href="../../2017/11/advanced-gpu-patterns-optimization-in-etl.html" title="Advanced GPU Patterns Optimization in ETL" type="text/html">
<link rel="next" href="my-thesis-is-available-deep-learning-feature-extraction-for-image-processing.html" title="My thesis is available: Deep Learning Feature Extraction for Image Processing" type="text/html">
<meta property="og:site_name" content='Blog blog("Baptiste Wicht");'>
<meta property="og:title" content="Expression Templates Library 1.2.1: Faster GPU and new features">
<meta property="og:url" content="https://baptiste-wicht.com/posts/2018/01/expression-templates-library-121-faster-gpu-and-new-features.html">
<meta property="og:description" content="Release of the version 1.2.1 of the Expression Templates Library (ETL) project with faster GPU support and new features.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-01-09T11:06:15+01:00">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="C++14">
<meta property="article:tag" content="C++17">
<meta property="article:tag" content="etl">
<meta property="article:tag" content="GPU">
<meta property="article:tag" content="Performance">
<meta property="article:tag" content="projects">
<meta property="article:tag" content="Releases">
<link href="../../../favicon.ico" rel="icon" type="image/x-icon">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-2175227-7', 'auto');
  var metas = document.getElementsByTagName('meta'), tagsList = [];
  for (var i=0; i<metas.length; i++) {
    if (metas[i].getAttribute('property') == 'article:tag') {
      tagsList.push( metas[i].getAttribute('content'));
    }
  }
  ga('set', 'dimension1', tagsList.join('|'));
  ga('send', 'pageview');
</script>
</head>
<body>

<!-- Menubar -->

<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<div class="container-fluid">
<!-- This keeps the margins nice -->
    <div class="row">
        <div class="col-sm-3 col-lg-2">
            <nav class="navbar navbar-inverse navbar-fixed-side"><div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="https://baptiste-wicht.com/">
                        <span id="blog-title">Blog blog("Baptiste Wicht");</span>
                    </a>
                </div>
<!-- /.navbar-header -->

                <div class="collapse navbar-collapse navbar-ex1-collapse">
                    <ul class="nav navbar-nav">
<li>
<a href="../../../stories/about.html">About</a>
                </li>
<li>
<a href="../../../stories/publications.html">Publications</a>
                </li>
<li>
<a href="../../../stories/projects.html">Projects</a>
                </li>
<li>
<a href="../../../categories/index.html">Tags</a>
                </li>
<li>
<a href="../../../archive.html">Archives</a>


                            </li>
<li class="navbar-content">
                                <h3>Related posts</h3>
                            </li>
                            

                            <li><a href="../../2017/10/expression-templates-library-etl-1-2-complete-gpu-support.html">Expression Templates Library (ETL) 1.2 - Complete GPU support</a></li>
<li><a href="../../2017/11/advanced-gpu-patterns-optimization-in-etl.html">Advanced GPU Patterns Optimization in ETL</a></li>
<li><a href="../../2017/08/expression-templates-library-etl-11.html">Expression Templates Library (ETL) 1.1</a></li>
<li><a href="../../2016/09/expression-templates-library-etl-10.html">Expression Templates Library (ETL) 1.0</a></li>
<li><a href="../../2017/05/update-on-expression-templates-library-etl.html">Update on Expression Templates Library (ETL)</a></li>
<li><a href="../../2017/08/dll-blazing-fast-neural-network-library.html">DLL: Blazing Fast Neural Network Library</a></li>


                            <li class="navbar-block">

                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
                                <img src="../../../assets/img/twitter.png" alt="Follow @wichtounet on Twitter"></a>
                        </li>

                    </ul>
</div>
<!-- /.navbar-collapse -->
            </nav>
</div> <!-- col -->
        <div class="col-sm-9 col-lg-10">
            <div id="content"></div>
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Expression Templates Library 1.2.1: Faster GPU and new features</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Baptiste Wicht
            </span></p>
            <p class="dateline">
            <a href="#" rel="bookmark">
            <time class="published dt-published" datetime="2018-01-09T11:06:15+01:00" itemprop="datePublished" title="2018-01-09 11:06">2018-01-09 11:06</time></a>
            </p>
                <p class="commentline">
    
    <a href="expression-templates-library-121-faster-gpu-and-new-features.html#disqus_thread" data-disqus-identifier="cache/posts/2018/01/expression-templates-library-121-faster-gpu-and-new-features.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="expression-templates-library-121-faster-gpu-and-new-features.rst" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>Happy new year to all my dear readers!</p>
<p>It has been a while since I've posted on this blog. I've had to serve three
weeks in the army and then I had two weeks vacation. I've been actively working
on budgetwarrior with a brand new web interface! More on that later ;)</p>
<p>Today, I'm happy to release the version 1.2.1 of my Expression Templates Library
(ETL) project. This is a minor version but with significantly better GPU support
and a few new features and bug fixes so I decided to release it now.</p>
<section id="faster-gpu-support"><h2>Faster GPU support</h2>
<p>Last year, I <a class="reference external" href="https://baptiste-wicht.com/posts/2017/11/advanced-gpu-patterns-optimization-in-etl.html">implemented the support for the detection of advanced GPU patterns in ETL</a>.</p>
<p>This will significantly reduce the number of CUDA kernel calls that are being
launched. For instance, each of the following expressions will be evaluated
using a single GPU kernel:</p>
<div class="code"><pre class="code C++"><a id="rest_code_c9754aa00f6c403789c4432eb5e3be01-1" name="rest_code_c9754aa00f6c403789c4432eb5e3be01-1" href="expression-templates-library-121-faster-gpu-and-new-features.html#rest_code_c9754aa00f6c403789c4432eb5e3be01-1"></a><span class="n">yy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">y</span>
<a id="rest_code_c9754aa00f6c403789c4432eb5e3be01-2" name="rest_code_c9754aa00f6c403789c4432eb5e3be01-2" href="expression-templates-library-121-faster-gpu-and-new-features.html#rest_code_c9754aa00f6c403789c4432eb5e3be01-2"></a><span class="n">yy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span>
<a id="rest_code_c9754aa00f6c403789c4432eb5e3be01-3" name="rest_code_c9754aa00f6c403789c4432eb5e3be01-3" href="expression-templates-library-121-faster-gpu-and-new-features.html#rest_code_c9754aa00f6c403789c4432eb5e3be01-3"></a><span class="n">yy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">1.2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span>
<a id="rest_code_c9754aa00f6c403789c4432eb5e3be01-4" name="rest_code_c9754aa00f6c403789c4432eb5e3be01-4" href="expression-templates-library-121-faster-gpu-and-new-features.html#rest_code_c9754aa00f6c403789c4432eb5e3be01-4"></a><span class="n">yy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span>
<a id="rest_code_c9754aa00f6c403789c4432eb5e3be01-5" name="rest_code_c9754aa00f6c403789c4432eb5e3be01-5" href="expression-templates-library-121-faster-gpu-and-new-features.html#rest_code_c9754aa00f6c403789c4432eb5e3be01-5"></a><span class="n">yy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">1.1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="p">)</span>
</pre></div>
<p>This makes some operation significantly faster.</p>
<p>Moreover, I've reduced a lot the numbers of device synchronization in the
library. Especially, I've removed almost all synchronization from the
etl-gpu-blas sub library. This means that synchronization is mostly only done
when data needs to go back to the CPU. For machine learning, this means at the
end of the epoch to compute the final error. This makes a HUGE difference in
time, I didn't realize before that I was doing way too much synchronization.</p>
<p>With these two changes, I've been able to attain <em>state of the art training performance on GPU</em> with my Deep Learning Library (DLL) project!</p>
<p>Moreover, I've now added for random number generations on the GPU and for
shuffle operations as well.</p>
</section><section id="new-features"><h2>New Features</h2>
<p>I've also added a few new features recently. They were especially added to
support new features in DLL.</p>
<p>Matrices and vectors can now be normalized in order to have zero-mean and
unit-variance distribution. You can also merge matrices together. For now, there
is no GPU support, so this will use CPU anyway. I plan to fix that later.</p>
<p>In addition to bias_batch_mean that I added before, I also added bias_batch_var
now with the variance in place of the mean. This is mainly used for Batch
Normalization in machine learning, but it may have some other usages. The GPU
support has been added as well directly.</p>
<p>And the last feature is the support for embedding and the gradients of
embedding. Again this is totally related to machine learning, but can be very
useful as well. I haven't add the time to develop the GPU version so far, but
this will come as well.</p>
</section><section id="performance"><h2>Performance</h2>
<p>Nothing fancy on the CPU performance side, I only added vectorization for
hyperbolic versions. This makes <em>tanh much faster on CPU</em>.</p>
</section><section id="bug-fixes"><h2>Bug Fixes</h2>
<p>I fixed quite a few bugs in this version, which is one of the main reason
I released it:</p>
<p>1. When using large fast_matrix and aliasing was detected, there was a big chance of stack overflow occurring. This is now fixed by using a dynamic temporary.
1. Some assignables such sub_view did not perform any detection for aliasing. This is now fixed and aliasing is detected everywhere.
1. fast_dyn_matrix can now be correctly used with <em>bool</em>
1. The use of iterators was not always ensuring correct CPU/GPU consistency. This is now correctly handled.
1. The 4D convolution in GPU were not using the correct flipping
1. Fix small compilation bug with sub_matrix and GPU</p>
</section><section id="what-s-next"><h2>What's next ?</h2>
<p>I don't really know what will be in the next release. This should be the release
1.3. One possible idea would be to improve and review the support for sparse
matrix which is more than  poor as of now. But I'm not really motivated to
work on that :P Moreover, I'm now <em>actively</em> working on the next release of
budgetwarrior which will probably still come this month.</p>
<p>I'm also still hesitating in switching to C++17 for the library to make it
faster to compile. And also to clean some parts of the code. I would be able to
remove quite some SFINAE with the new <em>if constexpr</em>, but I'm afraid this will
make the library to difficult to use since it would need at least GCC 7 or clang
3.9.</p>
<section id="download-etl"><h3>Download ETL</h3>
<p>You can download ETL <a class="reference external" href="https://github.com/wichtounet/etl">on Github</a>. If you
only interested in the 1.2.1 version, you can look at the
<a class="reference external" href="https://github.com/wichtounet/etl/releases">Releases pages</a> or clone the tag
1.2.1. There are several branches:</p>
<ul class="simple">
<li><p><em>master</em> Is the eternal development branch, may not always be stable</p></li>
<li><p><em>stable</em> Is a branch always pointing to the last tag, no development here</p></li>
</ul>
<p>For the future release, there always will tags pointing to the corresponding
commits. You can also have access to previous releases on Github or via the
release tags.</p>
<p>The documentation is still a bit sparse. There are a few examples and the Wiki,
but there still is work to be done. If you have questions on how to use or
configure the library, please don't hesitate.</p>
<p>Don't hesitate to comment this post if you have any comment on this library or
any question. You can also open an Issue on Github if you have a problem using
this library or propose a Pull Request if you have any contribution you'd like
to make to the library.</p>
<p>Hope this may be useful to some of you :)</p>
</section></section>
</div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/c%2B%2B.html" rel="tag">C++</a></li>
            <li><a class="tag p-category" href="../../../categories/c%2B%2B14.html" rel="tag">C++14</a></li>
            <li><a class="tag p-category" href="../../../categories/c%2B%2B17.html" rel="tag">C++17</a></li>
            <li><a class="tag p-category" href="../../../categories/etl.html" rel="tag">etl</a></li>
            <li><a class="tag p-category" href="../../../categories/gpu.html" rel="tag">GPU</a></li>
            <li><a class="tag p-category" href="../../../categories/performance.html" rel="tag">Performance</a></li>
            <li><a class="tag p-category" href="../../../categories/projects.html" rel="tag">projects</a></li>
            <li><a class="tag p-category" href="../../../categories/releases.html" rel="tag">Releases</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../../2017/11/advanced-gpu-patterns-optimization-in-etl.html" rel="prev" title="Advanced GPU Patterns Optimization in ETL">Previous post</a>
            </li>
            <li class="next">
                <a href="my-thesis-is-available-deep-learning-feature-extraction-for-image-processing.html" rel="next" title="My thesis is available: Deep Learning Feature Extraction for Image Processing">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
    
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="https://baptiste-wicht.com/posts/2018/01/expression-templates-library-121-faster-gpu-and-new-features.html",
        disqus_title="Expression Templates Library 1.2.1: Faster GPU and new features",
        disqus_identifier="cache/posts/2018/01/expression-templates-library-121-faster-gpu-and-new-features.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div> <!-- col -->
    </div>
<!-- row  -->
</div>
<!-- container-fluid -->

<!-- End of Menubar -->

<!-- Footer -->

<footer>
    Contents © 2023         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         - License: 
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="../../../assets/img/cc.png"></a>
        <ul class="footer_inline_ul">
<li>
    <a href="expression-templates-library-121-faster-gpu-and-new-features.rst" id="sourcelink">Source</a>
    </li>

        </ul></footer><!-- Late loading stuff  --><script src="../../../assets/js/all-nocdn.js"></script><!-- Google platform JS -->
</body>
</html>
