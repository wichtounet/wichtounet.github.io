<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<base href="http://baptiste-wicht.com/posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Continuous Performance Management with CPM for C++ | Blog blog("Baptiste Wicht");</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="http://baptiste-wicht.com/posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2175227-7']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script><meta name="author" content="Baptiste Wicht">
<link rel="prev" href="../05/cpp17-fold-expressions.html" title="C++17 Fold Expressions" type="text/html">
<link rel="next" href="how-i-improved-a-bit-compile-time-of-etl.html" title="How I improved (a bit) compile time of ETL ?" type="text/html">
<meta property="og:site_name" content='Blog blog("Baptiste Wicht");'>
<meta property="og:title" content="Continuous Performance Management with CPM for C++">
<meta property="og:url" content="http://baptiste-wicht.com/posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html">
<meta property="og:description" content="For some time, I have wanted some tool to monitor the performance of some of my projects. There are plenty of tools for Continuous Integration and Sonar is really great for continuous monitoring of co">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2015-06-14T14:02:57+02:00">
<meta property="article:tag" content="Benchmarks">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="Performances">
<meta property="article:tag" content="Sonar">
<meta property="article:tag" content="Tools">
<link href="../../../favicon.ico" rel="icon" type="image/x-icon">
<link rel="publisher" href="https://plus.google.com/+BaptisteWicht">
</head>
<body>

<!-- Menubar -->

<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<div class="container-fluid">
<!-- This keeps the margins nice -->
    <div class="row">
        <div class="col-sm-3 col-lg-2">
            <nav class="navbar navbar-inverse navbar-fixed-side"><div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="http://baptiste-wicht.com/">
                        <span id="blog-title">Blog blog("Baptiste Wicht");</span>
                    </a>
                </div>
<!-- /.navbar-header -->

                <div class="collapse navbar-collapse navbar-ex1-collapse">
                    <ul class="nav navbar-nav">
<li>
<a href="../../../stories/about.html">About</a>
                </li>
<li>
<a href="../../../stories/publications.html">Publications</a>
                </li>
<li>
<a href="../../../stories/projects.html">Projects</a>
                </li>
<li>
<a href="../../../categories/index.html">Tags</a>
                </li>
<li>
<a href="../../../archive.html">Archives</a>
                </li>
<li>
<a href="http://feeds.feedburner.com/BaptisteWicht">RSS</a>



                            </li>
<li class="navbar-content">
                                <h3>Related posts</h3>
                            </li>
                            

                            <li><a href="../../2016/11/zapcc-a-faster-cpp-compiler.html">zapcc - a faster C++ compiler</a></li>
<li><a href="../../2016/01/improve-dll-and-etl-compile-time-further.html">Improve DLL and ETL Compile Time further</a></li>
<li><a href="../../2016/12/zapcc-cpp-compilation-speed-against-gcc-54-and-clang-39.html">zapcc C++ compilation speed against gcc 5.4 and clang 3.9</a></li>
<li><a href="../../2010/09/my-java-benchmarks-on-github.html">My Java Benchmarks on GitHub</a></li>
<li><a href="../../2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html">Compile integer Square Roots at compile-time in C++</a></li>


                            <li class="navbar-block">

                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
                                <img src="../../../assets/img/twitter.png" alt="Follow @wichtounet on Twitter"></a>
                        </li>

                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow +BaptisteWicht on Google+" href="https://plus.google.com/+BaptisteWicht">
                                <img src="../../../assets/img/google_plus.png" alt="Follow +BaptisteWicht on Google+"></a>
                        </li>


                    </ul>
</div>
<!-- /.navbar-collapse -->
            </nav>
</div> <!-- col -->
        <div class="col-sm-9 col-lg-10">
            <div id="content"></div>
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Continuous Performance Management with CPM for C++</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                    Baptiste Wicht
            </span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2015-06-14T14:02:57+02:00" itemprop="datePublished" title="2015-06-14 14:02">2015-06-14 14:02</time></a></p>
                <p class="commentline">
        
    <a href="continuous-performance-management-with-cpm-for-cpp.html#disqus_thread" data-disqus-identifier="cache/posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="continuous-performance-management-with-cpm-for-cpp.rst" id="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>For some time, I have wanted some tool to monitor the performance of some of my projects. There are plenty of tools for Continuous Integration and Sonar is really great for continuous monitoring of code quality, but I haven't found anything satisfying for monitoring performance of C++ code. So I decided to write my own. <a class="reference external" href="https://github.com/wichtounet/cpm">Continous Performance Monitor (CPM)</a> is a simple C++ tool that helps you running benchmarks for your C++ programs and generate web reports based on the results. In this article, I will present this tool. CPM is especially made to benchmark several sub parts of libraries, but it perfectly be used to benchmark a whole program as well.</p>
<p>The idea is to couple it with a Continuous Integration tool (I use Jenkins for instance) and run the benchmarks for every new push in a repository. With that, you can check if you have performance regression for instance or simply see if your changes were really improving the performance as much as you thought.</p>
<p>It is made of two separate parts:</p>
<ol class="arabic simple">
<li>A header-only library that you can use to benchmark your program and that will give you the performance results. It will also generate a JSON report of the collected data.</li>
<li>A program that will generate a web version of the reports with analysis over time, over different compilers or over different configurations.</li>
</ol>
<p>CPM is especially made to benchmark functions that takes input data and which runtime depends on the dimensions of the input data. For each benchmark, CPM will execute it with several different input sizes. There are different ways to define a benchmark:</p>
<ul class="simple">
<li>
<em>two_pass</em>: The benchmark is made of two part, the initialization part is called once for each input size and then the benchmark part is repeated several times for the measure. This is the most general version.</li>
<li>
<em>global</em>: The benchmark will be run with different input sizes but uses global data that will be randomized before each measure</li>
<li>
<em>simple</em>: The benchmark will be run with different input sizes, data will not be randomized</li>
<li>
<em>once</em>: The benchmark will be run with no input size.</li>
</ul>
<p>Note: The randomization of the data can be disabled.</p>
<p>You can run independent benchmarks or you can run sections of benchmarks. A section is used to compared different implementations of the same thing. For instance, I use them to compare different implementation of convolution or to see how ETL compete with other Expression Templates library.</p>
<img alt="/images/cpm_large.png" src="../../../images/cpm_large.png"><div class="section" id="examples">
<h2>Examples</h2>
<p>I've uploaded three generated reports so that you can have look at some results:</p>
<ul class="simple">
<li>Results of the ETL benchmark (one page per benchmark): <a class="reference external" href="http://baptiste-wicht.com/cpm/etl/">Site 1</a> <a class="reference external" href="https://github.com/wichtounet/etl/blob/master/workbench/benchmark.cpp">Source 1</a>
</li>
<li>Results of simple ETL / Blaze / Eigen3 comparison: <a class="reference external" href="http://baptiste-wicht.com/cpm/etl_blaze_eigen/">Site 2</a> <a class="reference external" href="https://github.com/wichtounet/etl_vs_blaze/blob/master/src/simple.cpp">Source 2</a>
</li>
<li>Results of the CPM dummy examples: <a class="reference external" href="http://baptiste-wicht.com/cpm/examples/">Site 3</a> <a class="reference external" href="https://github.com/wichtounet/cpm/blob/master/examples/simple.cpp">Source 3</a>
</li>
</ul>
</div>
<div class="section" id="run-benchmarks">
<h2>Run benchmarks</h2>
<p>There are two ways of running CPM. You can directly use the library to run the benchmarks or you can use the macro facilities to make it easier. I recommend to use the second way since it is easier and I'm gonna try to keep it stable while the library can change. If you want an example of using the library directly, you can take a look at <a class="reference external" href="https://github.com/wichtounet/cpm/blob/master/examples/simple.cpp">this example</a>. In this chapter, I'm gonna focus on the macro-way.</p>
<p>The library is available <a class="reference external" href="https://github.com/wichtounet/cpm">here</a>, you can either include as a submodule of your projects or install it globally to have access to its headers.</p>
<p>The first thing to do is to include the CPM header:</p>
<pre class="code cpp"><a name="rest_code_d6a1d0e3dbbe4daaa3f069d224bed8c9-1"></a><span class="cp">#define CPM_BENCHMARK "Example Benchmarks"</span>
<a name="rest_code_d6a1d0e3dbbe4daaa3f069d224bed8c9-2"></a><span class="cp">#include</span> <span class="cpf">"cpm/cpm.hpp"</span><span class="cp"></span>
</pre>
<p>You have to name your benchmark. This will automatically creates a main and will run all the declared benchmark.</p>
<div class="section" id="define-benchmarks">
<h3>Define benchmarks</h3>
<p>Benchmarks can be defined either in a CPM_BENCH functor or in the global scope with <code>CPM_DIRECT_BENCH</code>.</p>
<ol class="arabic simple">
<li>simple</li>
</ol>
<pre class="code cpp"><a name="rest_code_bdb79bff9e6a4e78925cd590a40ad966-1"></a><span class="n">CPM_DIRECT_BENCH_SIMPLE</span><span class="p">(</span><span class="s">"bench_name"</span><span class="p">,</span> <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d</span><span class="p">){</span> <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="n">_ns</span> <span class="p">);</span> <span class="p">})</span>
</pre>
<p>The first argument is the name of the benchmark and the second argument is the function that will be benchmarked by the system, this function takes the input size as input.</p>
<ol class="arabic simple" start="2">
<li>global</li>
</ol>
<pre class="code cpp"><a name="rest_code_7d951527d7f44647b5abd543d489eb31-1"></a><span class="n">CPM_BENCH</span><span class="p">()</span> <span class="p">{</span>
<a name="rest_code_7d951527d7f44647b5abd543d489eb31-2"></a>    <span class="n">test</span> <span class="n">a</span><span class="p">{</span><span class="mi">3</span><span class="p">};</span>
<a name="rest_code_7d951527d7f44647b5abd543d489eb31-3"></a>    <span class="n">CPM_GLOBAL</span><span class="p">(</span><span class="s">"bench_name"</span><span class="p">,</span> <span class="p">[</span><span class="o">&amp;</span><span class="n">a</span><span class="p">](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d</span><span class="p">){</span> <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">a</span><span class="p">.</span><span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="n">_ns</span> <span class="p">);</span> <span class="p">},</span> <span class="n">a</span><span class="p">);</span>
<a name="rest_code_7d951527d7f44647b5abd543d489eb31-4"></a><span class="p">}</span>
</pre>
<p>The first argument is the name of the benchmark, the second is the function being benchmarked and the following arguments must be references to global data that will be randomized by CPM.</p>
<ol class="arabic simple" start="3">
<li>two_pass</li>
</ol>
<pre class="code cpp"><a name="rest_code_9f9a6caa80dd4250bca90f5d24d98509-1"></a><span class="n">CPM_DIRECT_BENCH_TWO_PASS</span><span class="p">(</span><span class="s">"bench_name"</span><span class="p">,</span>
<a name="rest_code_9f9a6caa80dd4250bca90f5d24d98509-2"></a>    <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d</span><span class="p">){</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">test</span><span class="p">{</span><span class="n">d</span><span class="p">});</span> <span class="p">},</span>
<a name="rest_code_9f9a6caa80dd4250bca90f5d24d98509-3"></a>    <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d</span><span class="p">,</span> <span class="n">test</span><span class="o">&amp;</span> <span class="n">d2</span><span class="p">){</span> <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="n">d2</span><span class="p">.</span><span class="n">d</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1</span><span class="n">_ns</span> <span class="p">);</span> <span class="p">}</span>
<a name="rest_code_9f9a6caa80dd4250bca90f5d24d98509-4"></a><span class="p">)</span>
</pre>
<p>Again, the first argument is the name. The second argument is the initialization functor. This functor must returns a tuple with all the information that will be passed (unpacked) to the third argument (the benchmark functor). Everything that is being returned by the initialization functor will be randomized.</p>
</div>
<div class="section" id="select-the-input-sizes">
<h3>Select the input sizes</h3>
<p>By default, CPM will invoke your benchmarks with values from 10 to 1000000, multiplying it by 10 each step. This can be tuned for each benchmark and section independently. Each benchmark macro has a _P suffix that allows you to set the size policy:</p>
<pre class="code cpp"><a name="rest_code_558a8ceee4254df98716d00280441d61-1"></a><span class="n">CPM_SIMPLE_P</span><span class="p">(</span>
<a name="rest_code_558a8ceee4254df98716d00280441d61-2"></a>    <span class="n">VALUES_POLICY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
<a name="rest_code_558a8ceee4254df98716d00280441d61-3"></a>    <span class="s">"simple_a_n"</span><span class="p">,</span>
<a name="rest_code_558a8ceee4254df98716d00280441d61-4"></a>    <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d</span><span class="p">){</span> <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span><span class="n">_ns</span> <span class="p">);</span> <span class="p">});</span>
</pre>
<p>You can also have several sizes (for multidimensional data structures or algorithms):</p>
<pre class="code cpp"><a name="rest_code_fb8bee0ddd924c609ae9207b49800b67-1"></a><span class="n">CPM_DIRECT_BENCH_TWO_PASS_P</span><span class="p">(</span>
<a name="rest_code_fb8bee0ddd924c609ae9207b49800b67-2"></a>    <span class="n">NARY_POLICY</span><span class="p">(</span><span class="n">VALUES_POLICY</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">),</span> <span class="n">VALUES_POLICY</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">24</span><span class="p">)),</span>
<a name="rest_code_fb8bee0ddd924c609ae9207b49800b67-3"></a>    <span class="s">"convmtx2"</span><span class="p">,</span>
<a name="rest_code_fb8bee0ddd924c609ae9207b49800b67-4"></a>    <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d1</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d2</span><span class="p">){</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">dmat</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span> <span class="n">d1</span><span class="p">),</span> <span class="n">dmat</span><span class="p">((</span><span class="n">d1</span> <span class="o">+</span> <span class="n">d2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">d1</span> <span class="o">+</span> <span class="n">d2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">d2</span> <span class="o">*</span> <span class="n">d2</span><span class="p">));</span> <span class="p">},</span>
<a name="rest_code_fb8bee0ddd924c609ae9207b49800b67-5"></a>    <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="cm">/*d1*/</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d2</span><span class="p">,</span> <span class="n">dmat</span><span class="o">&amp;</span> <span class="n">a</span><span class="p">,</span> <span class="n">dmat</span><span class="o">&amp;</span> <span class="n">b</span><span class="p">){</span> <span class="n">b</span> <span class="o">=</span> <span class="n">etl</span><span class="o">::</span><span class="n">convmtx2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d2</span><span class="p">);</span> <span class="p">}</span>
<a name="rest_code_fb8bee0ddd924c609ae9207b49800b67-6"></a><span class="p">)</span>
</pre>
</div>
<div class="section" id="configure-benchmarks">
<h3>Configure benchmarks</h3>
<p>By default, each benchmark is run 10 times for warmup and then repeated 50 times, but you can define your own values:</p>
<pre class="code cpp"><a name="rest_code_593804d8a3cd4d33b3b85fee942e3392-1"></a><span class="cp">#define CPM_WARMUP 3</span>
<a name="rest_code_593804d8a3cd4d33b3b85fee942e3392-2"></a><span class="cp">#define CPM_REPEAT 10</span>
</pre>
<p>This must be done before the inclusion of the header.</p>
</div>
<div class="section" id="define-sections">
<h3>Define sections</h3>
<p>Sections are simply a group of benchmarks, so instead of putting several benchmarks inside a <code>CPM_BENCH</code>, you can put them inside a <code>CPM_SECTION</code>. For instance:</p>
<pre class="code cpp"><a name="rest_code_d98035b126e4413bb77f650c2040089e-1"></a><span class="n">CPM_SECTION</span><span class="p">(</span><span class="s">"mmul"</span><span class="p">)</span>
<a name="rest_code_d98035b126e4413bb77f650c2040089e-2"></a>    <span class="n">CPM_SIMPLE</span><span class="p">(</span><span class="s">"std"</span><span class="p">,</span> <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d</span><span class="p">){</span> <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span> <span class="o">*</span> <span class="n">d</span><span class="p">)</span> <span class="o">*</span> <span class="mi">9</span><span class="n">_ns</span> <span class="p">);</span> <span class="p">});</span>
<a name="rest_code_d98035b126e4413bb77f650c2040089e-3"></a>    <span class="n">CPM_SIMPLE</span><span class="p">(</span><span class="s">"fast"</span><span class="p">,</span> <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d</span><span class="p">){</span> <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1</span><span class="n">_ns</span> <span class="p">);</span> <span class="p">});</span>
<a name="rest_code_d98035b126e4413bb77f650c2040089e-4"></a>    <span class="n">CPM_SIMPLE</span><span class="p">(</span><span class="s">"common"</span><span class="p">,</span> <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d</span><span class="p">){</span> <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="mi">3</span><span class="n">_ns</span> <span class="p">);</span> <span class="p">});</span>
<a name="rest_code_d98035b126e4413bb77f650c2040089e-5"></a><span class="p">}</span>
<a name="rest_code_d98035b126e4413bb77f650c2040089e-6"></a><span class="n">CPM_SECTION</span><span class="p">(</span><span class="s">"conv"</span><span class="p">)</span>
<a name="rest_code_d98035b126e4413bb77f650c2040089e-7"></a>    <span class="n">CPM_TWO_PASS</span><span class="p">(</span><span class="s">"std"</span><span class="p">,</span>
<a name="rest_code_d98035b126e4413bb77f650c2040089e-8"></a>        <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d</span><span class="p">){</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">test</span><span class="p">{</span><span class="n">d</span><span class="p">});</span> <span class="p">},</span>
<a name="rest_code_d98035b126e4413bb77f650c2040089e-9"></a>        <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d</span><span class="p">,</span> <span class="n">test</span><span class="o">&amp;</span> <span class="n">d2</span><span class="p">){</span> <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="n">d2</span><span class="p">.</span><span class="n">d</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1</span><span class="n">_ns</span> <span class="p">);</span> <span class="p">}</span>
<a name="rest_code_d98035b126e4413bb77f650c2040089e-10"></a>        <span class="p">);</span>
<a name="rest_code_d98035b126e4413bb77f650c2040089e-11"></a>    <span class="n">CPM_TWO_PASS</span><span class="p">(</span><span class="s">"fast"</span><span class="p">,</span>
<a name="rest_code_d98035b126e4413bb77f650c2040089e-12"></a>        <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d</span><span class="p">){</span> <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">test</span><span class="p">{</span><span class="n">d</span><span class="p">});</span> <span class="p">},</span>
<a name="rest_code_d98035b126e4413bb77f650c2040089e-13"></a>        <span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d</span><span class="p">,</span> <span class="n">test</span><span class="o">&amp;</span> <span class="n">d2</span><span class="p">){</span> <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">+</span> <span class="n">d2</span><span class="p">.</span><span class="n">d</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1</span><span class="n">_ns</span> <span class="p">);</span> <span class="p">}</span>
<a name="rest_code_d98035b126e4413bb77f650c2040089e-14"></a>        <span class="p">);</span>
<a name="rest_code_d98035b126e4413bb77f650c2040089e-15"></a><span class="p">}</span>
</pre>
<p>You can also set different warmup and repeat values for each section by using <code>CPM_SECTION_O</code>:</p>
<pre class="code cpp"><a name="rest_code_aa3b88a981034835b06b426cbadae9b4-1"></a><span class="n">CPM_SECTION_O</span><span class="p">(</span><span class="s">"fft"</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">51</span><span class="p">)</span>
<a name="rest_code_aa3b88a981034835b06b426cbadae9b4-2"></a>    <span class="n">test</span> <span class="n">a</span><span class="p">{</span><span class="mi">3</span><span class="p">};</span>
<a name="rest_code_aa3b88a981034835b06b426cbadae9b4-3"></a>    <span class="n">test</span> <span class="n">b</span><span class="p">{</span><span class="mi">5</span><span class="p">};</span>
<a name="rest_code_aa3b88a981034835b06b426cbadae9b4-4"></a>    <span class="n">CPM_GLOBAL</span><span class="p">(</span><span class="s">"std"</span><span class="p">,</span> <span class="p">[</span><span class="o">&amp;</span><span class="n">a</span><span class="p">](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d</span><span class="p">){</span> <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">%</span> <span class="n">a</span><span class="p">.</span><span class="n">d</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1</span><span class="n">_ns</span> <span class="p">);</span> <span class="p">},</span> <span class="n">a</span><span class="p">);</span>
<a name="rest_code_aa3b88a981034835b06b426cbadae9b4-5"></a>    <span class="n">CPM_GLOBAL</span><span class="p">(</span><span class="s">"mkl"</span><span class="p">,</span> <span class="p">[</span><span class="o">&amp;</span><span class="n">b</span><span class="p">](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d</span><span class="p">){</span> <span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="p">(</span><span class="n">d</span> <span class="o">%</span> <span class="n">b</span><span class="p">.</span><span class="n">d</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1</span><span class="n">_ns</span> <span class="p">);</span> <span class="p">},</span> <span class="n">b</span><span class="p">);</span>
<a name="rest_code_aa3b88a981034835b06b426cbadae9b4-6"></a><span class="p">}</span>
</pre>
<p>will be warmup 11 times and run 51 times.</p>
<p>The size policy can also be changed for the complete section (cannot be changed independently for benchmarks inside the section):</p>
<pre class="code cpp"><a name="rest_code_660573b72419403c9953e7f79ddb35a8-1"></a><span class="n">CPM_SECTION_P</span><span class="p">(</span><span class="s">"mmul"</span><span class="p">,</span>
<a name="rest_code_660573b72419403c9953e7f79ddb35a8-2"></a>    <span class="n">NARY_POLICY</span><span class="p">(</span><span class="n">STD_STOP_POLICY</span><span class="p">,</span> <span class="n">VALUES_POLICY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">VALUES_POLICY</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">64</span><span class="p">)))</span>
<a name="rest_code_660573b72419403c9953e7f79ddb35a8-3"></a>    <span class="n">test</span> <span class="n">a</span><span class="p">{</span><span class="mi">3</span><span class="p">};</span>
<a name="rest_code_660573b72419403c9953e7f79ddb35a8-4"></a>    <span class="n">test</span> <span class="n">b</span><span class="p">{</span><span class="mi">5</span><span class="p">};</span>
<a name="rest_code_660573b72419403c9953e7f79ddb35a8-5"></a>    <span class="n">CPM_GLOBAL</span><span class="p">(</span><span class="s">"std"</span><span class="p">,</span> <span class="p">[</span><span class="o">&amp;</span><span class="n">a</span><span class="p">](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d1</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d2</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d3</span><span class="p">){</span> <span class="cm">/* Something */</span> <span class="p">},</span> <span class="n">a</span><span class="p">);</span>
<a name="rest_code_660573b72419403c9953e7f79ddb35a8-6"></a>    <span class="n">CPM_GLOBAL</span><span class="p">(</span><span class="s">"mkl"</span><span class="p">,</span> <span class="p">[</span><span class="o">&amp;</span><span class="n">a</span><span class="p">](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d1</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d2</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d3</span><span class="p">){</span> <span class="cm">/* Something */</span> <span class="p">},</span> <span class="n">a</span><span class="p">);</span>
<a name="rest_code_660573b72419403c9953e7f79ddb35a8-7"></a>    <span class="n">CPM_GLOBAL</span><span class="p">(</span><span class="s">"bla"</span><span class="p">,</span> <span class="p">[</span><span class="o">&amp;</span><span class="n">a</span><span class="p">](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d1</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d2</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="kt">size_t</span> <span class="n">d3</span><span class="p">){</span> <span class="cm">/* Something */</span> <span class="p">},</span> <span class="n">a</span><span class="p">);</span>
<a name="rest_code_660573b72419403c9953e7f79ddb35a8-8"></a><span class="p">}</span>
</pre>
</div>
<div class="section" id="run">
<h3>Run</h3>
<p>Once your benchmarks and sections are defined, you can build you program as a normal C++ main and run it. You can pass several options:</p>
<pre class="code text"><a name="rest_code_e87f5952e6854ea296306272d8170201-1"></a>./debug/bin/full -h
<a name="rest_code_e87f5952e6854ea296306272d8170201-2"></a>Usage:
<a name="rest_code_e87f5952e6854ea296306272d8170201-3"></a>  ./debug/bin/full [OPTION...]
<a name="rest_code_e87f5952e6854ea296306272d8170201-4"></a>
<a name="rest_code_e87f5952e6854ea296306272d8170201-5"></a>  -n, --name arg           Benchmark name
<a name="rest_code_e87f5952e6854ea296306272d8170201-6"></a>  -t, --tag arg            Tag name
<a name="rest_code_e87f5952e6854ea296306272d8170201-7"></a>  -c, --configuration arg  Configuration
<a name="rest_code_e87f5952e6854ea296306272d8170201-8"></a>  -o, --output arg         Output folder
<a name="rest_code_e87f5952e6854ea296306272d8170201-9"></a>  -h, --help               Print help
</pre>
<p>The tag is used to distinguish between runs, I recommend that you use a SCM identifier for the tag. If you want to run your program with different configurations (compiler options for instance), you'll have to set the configuration with the --configuration option.</p>
<p>Here is a possible output:</p>
<pre class="code text"><a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-1"></a> Start CPM benchmarks
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-2"></a>    Results will be automatically saved in /home/wichtounet/dev/cpm/results/10.cpm
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-3"></a>    Each test is warmed-up 10 times
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-4"></a>    Each test is repeated 50 times
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-5"></a>    Time Sun Jun 14 15:33:51 2015
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-6"></a>
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-7"></a>    Tag: 10
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-8"></a>    Configuration:
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-9"></a>    Compiler: clang-3.5.0
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-10"></a>    Operating System: Linux x86_64 3.16.5-gentoo
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-11"></a>
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-12"></a>
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-13"></a> simple_a(10) : mean: 52.5us (52.3us,52.7us) stddev: 675ns min: 48.5us max: 53.3us througput: 190KEs
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-14"></a> simple_a(100) : mean: 50.1us (48us,52.2us) stddev: 7.53us min: 7.61us max: 52.3us througput: 2MEs
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-15"></a> simple_a(1000) : mean: 52.7us (52.7us,52.7us) stddev: 48.7ns min: 52.7us max: 53us througput: 19MEs
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-16"></a> simple_a(10000) : mean: 62.6us (62.6us,62.7us) stddev: 124ns min: 62.6us max: 63.5us througput: 160MEs
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-17"></a> simple_a(100000) : mean: 161us (159us,162us) stddev: 5.41us min: 132us max: 163us througput: 622MEs
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-18"></a> simple_a(1000000) : mean: 1.16ms (1.16ms,1.17ms) stddev: 7.66us min: 1.15ms max: 1.18ms througput: 859MEs
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-19"></a>
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-20"></a>-----------------------------------------
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-21"></a>|            gemm |       std |     mkl |
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-22"></a>-----------------------------------------
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-23"></a>|           10x10 | 51.7189us | 64.64ns |
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-24"></a>|         100x100 | 52.4336us | 63.42ns |
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-25"></a>|       1000x1000 | 56.0097us |  63.2ns |
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-26"></a>|     10000x10000 | 95.6123us | 63.52ns |
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-27"></a>|   100000x100000 | 493.795us | 63.48ns |
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-28"></a>| 1000000x1000000 | 4.46646ms |  63.8ns |
<a name="rest_code_29a38c9a856b4147bdf81b966bf002ad-29"></a>-----------------------------------------
</pre>
<p>The program will give you for each benchmark, the mean duration (with confidence interval), the standard deviation of the samples, the min and max duration and an estimated throughput. The throughput is simply using the size and the mean duration. Each section is directly compared with an array-like output. Once the benchmark is run, a JSON report will be generated inside the output folder.</p>
</div>
</div>
<div class="section" id="continuous-monitoring">
<h2>Continuous Monitoring</h2>
<p>Once you have run the benchmark, you can use the CPM program to generate the web reports. It will generate:</p>
<ul class="simple">
<li>1 performance graph for each benchmark and section</li>
<li>1 graph comparing the performances over time of your benchmark sections if you have run the benchmark several time</li>
<li>1 graph comparing different compiler if you have compiled your program with different compiler</li>
<li>1 graph comparing different configuration if you have run the benchmark with different configuration</li>
<li>1 table summary for each benchmark / section</li>
</ul>
<p>First you have to build and install the CPM program (you can have a look at the <a class="reference external" href="https://github.com/wichtounet/cpm/blob/master/README.rst">Readme</a> for more informations.</p>
<p>Several options are available:</p>
<pre class="code text"><a name="rest_code_b928feeb731648b6b8ff525cdcc87235-1"></a>Usage:
<a name="rest_code_b928feeb731648b6b8ff525cdcc87235-2"></a>  cpm [OPTION...]  results_folder
<a name="rest_code_b928feeb731648b6b8ff525cdcc87235-3"></a>
<a name="rest_code_b928feeb731648b6b8ff525cdcc87235-4"></a>      --time-sizes             Display multiple sizes in the time graphs
<a name="rest_code_b928feeb731648b6b8ff525cdcc87235-5"></a>  -t, --theme arg              Theme name [raw,bootstrap,boostrap-tabs] (default:bootstrap)
<a name="rest_code_b928feeb731648b6b8ff525cdcc87235-6"></a>  -c, --hctheme theme_name     Highcharts Theme name [std,dark_unica] (default:dark_unica)
<a name="rest_code_b928feeb731648b6b8ff525cdcc87235-7"></a>  -o, --output output_folder   Output folder (default:reports)
<a name="rest_code_b928feeb731648b6b8ff525cdcc87235-8"></a>      --input arg              Input results
<a name="rest_code_b928feeb731648b6b8ff525cdcc87235-9"></a>  -s, --sort-by-tag            Sort by tag instaed of time
<a name="rest_code_b928feeb731648b6b8ff525cdcc87235-10"></a>  -p, --pages                  General several HTML pages (one per bench/section)
<a name="rest_code_b928feeb731648b6b8ff525cdcc87235-11"></a>  -d, --disable-time           Disable time graphs
<a name="rest_code_b928feeb731648b6b8ff525cdcc87235-12"></a>      --disable-compiler       Disable compiler graphs
<a name="rest_code_b928feeb731648b6b8ff525cdcc87235-13"></a>      --disable-configuration  Disable configuration graphs
<a name="rest_code_b928feeb731648b6b8ff525cdcc87235-14"></a>      --disable-summary        Disable summary table
<a name="rest_code_b928feeb731648b6b8ff525cdcc87235-15"></a>  -h, --help                   Print help
</pre>
<p>There are 3 themes:</p>
<ul class="simple">
<li>
<em>bootstrap</em>: The default theme, using Bootstrap to make a responsive interface.</li>
<li>
<em>bootstrap-tabs</em>: Similar to the <em>bootstrap</em> theme except that only is displayed at the same time for each benchmark, with tabs.</li>
<li>
<em>raw</em> : A very basic theme, only using Highcharts library for graphs. It is very minimalistic</li>
</ul>
<p>For instance, here are how the reports are generated for the ETL benchmark:</p>
<pre class="code text"><a name="rest_code_5d2fc7c860be48fab3d47090d72523e5-1"></a>cpm -p -s -t bootstrap -c dark_unica -o reports results
</pre>
<p>Here is the graph generated for the "R = A + B + C" benchmark and different compilers:</p>
<img alt="/images/cpm_etl_compiler.png" src="../../../images/cpm_etl_compiler.png"><p>and its summary:</p>
<img alt="/images/cpm_etl_summary.png" src="../../../images/cpm_etl_summary.png"><p>Here is the graph for a 2D convolution with ETL:</p>
<img alt="/images/cpm_etl_section.png" src="../../../images/cpm_etl_section.png"><p>And the graph for different configurations of ETL and the dense matrix matrix multiplication:</p>
<img alt="/images/cpm_etl_configuration.png" src="../../../images/cpm_etl_configuration.png">
</div>
<div class="section" id="conclusion-and-future-work">
<h2>Conclusion and Future Work</h2>
<p>Although CPM is already working, there are several things that could be done to improve it further:</p>
<ul class="simple">
<li>The generated web report could benefit from a global summary.</li>
<li>The throughput evaluation should be evaluated more carefully.</li>
<li>The tool should automatically evaluate the number of times that each tests should be run to have a good result instead of global warmup and repeat constants.</li>
<li>A better bootstrapping procedure should be used to determine the quality of the results and compute the confidence intervals.</li>
<li>The performances of the website with lots of graphs should be improved.</li>
<li>Make CPM more general-purpose to support larger needs.</li>
</ul>
<p>Here it is, I have summed most of the features of the CPM Continuous Performance Analysis tool. I hope that it will be helpful to some of you as well.</p>
<p>If you have other ideas or want to contribute something to the project, you can directly open an issue or a pull request on <a class="reference external" href="https://github.com/wichtounet/cpm">Github</a>. Or contact me via this site or Github.</p>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/benchmarks.html" rel="tag">Benchmarks</a></li>
            <li><a class="tag p-category" href="../../../categories/c%2B%2B.html" rel="tag">C++</a></li>
            <li><a class="tag p-category" href="../../../categories/performances.html" rel="tag">Performances</a></li>
            <li><a class="tag p-category" href="../../../categories/sonar.html" rel="tag">Sonar</a></li>
            <li><a class="tag p-category" href="../../../categories/tools.html" rel="tag">Tools</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../05/cpp17-fold-expressions.html" rel="prev" title="C++17 Fold Expressions">Previous post</a>
            </li>
            <li class="next">
                <a href="how-i-improved-a-bit-compile-time-of-etl.html" rel="next" title="How I improved (a bit) compile time of ETL ?">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="http://baptiste-wicht.com/posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html",
        disqus_title="Continuous Performance Management with CPM for C++",
        disqus_identifier="cache/posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div> <!-- col -->
    </div>
<!-- row  -->
</div>
<!-- container-fluid -->

<!-- End of Menubar -->

<!-- Footer -->

<footer>
    Contents © 2017         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         - License: 
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="../../../assets/img/cc.png"></a>
        <ul class="footer_inline_ul">
<li>
    <a href="continuous-performance-management-with-cpm-for-cpp.rst" id="sourcelink">Source</a>
    </li>

        </ul></footer><!-- Late loading stuff  --><script src="../../../assets/js/all-nocdn.js"></script><!-- Google platform JS -->
</body>
</html>
