<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Simulate static_if with C++11/C++14 | Blog blog("Baptiste Wicht");</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://baptiste-wicht.com/posts/2015/07/simulate-static_if-with-c11c14.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Baptiste Wicht">
<link rel="prev" href="../06/improve-etl-compile-time-with-precompiled-headers.html" title="Improve ETL compile-time with Precompiled Headers" type="text/html">
<link rel="next" href="../11/upgrade-to-nikola-7.html" title="Upgrade to Nikola 7" type="text/html">
<meta property="og:site_name" content='Blog blog("Baptiste Wicht");'>
<meta property="og:title" content="Simulate static_if with C++11/C++14">
<meta property="og:url" content="https://baptiste-wicht.com/posts/2015/07/simulate-static_if-with-c11c14.html">
<meta property="og:description" content="If you are doing a lot of template metaprogramming and other template magic stuff, you are likely to miss a static_if in the language. Unfortunately, it didn't make the cut for C++11 and it seems unli">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2015-07-12T15:23:34+02:00">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="C++11">
<meta property="article:tag" content="C++14">
<link href="../../../favicon.ico" rel="icon" type="image/x-icon">
<link rel="publisher" href="https://plus.google.com/+BaptisteWicht">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-2175227-7', 'auto');
  var metas = document.getElementsByTagName('meta'), tagsList = [];
  for (var i=0; i<metas.length; i++) {
    if (metas[i].getAttribute('property') == 'article:tag') {
      tagsList.push( metas[i].getAttribute('content'));
    }
  }
  ga('set', 'dimension1', tagsList.join('|'));
  ga('send', 'pageview');
</script>
</head>
<body>

<!-- Menubar -->

<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<div class="container-fluid">
<!-- This keeps the margins nice -->
    <div class="row">
        <div class="col-sm-3 col-lg-2">
            <nav class="navbar navbar-inverse navbar-fixed-side"><div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="https://baptiste-wicht.com/">
                        <span id="blog-title">Blog blog("Baptiste Wicht");</span>
                    </a>
                </div>
<!-- /.navbar-header -->

                <div class="collapse navbar-collapse navbar-ex1-collapse">
                    <ul class="nav navbar-nav">
<li>
<a href="../../../stories/about.html">About</a>
                </li>
<li>
<a href="../../../stories/publications.html">Publications</a>
                </li>
<li>
<a href="../../../stories/projects.html">Projects</a>
                </li>
<li>
<a href="../../../categories/index.html">Tags</a>
                </li>
<li>
<a href="../../../archive.html">Archives</a>


                            </li>
<li class="navbar-content">
                                <h3>Related posts</h3>
                            </li>
                            

                            <li><a href="../03/named-optional-template-parameters-compile-time.html">Named Optional Template parameters to configure a class at compile-time</a></li>
<li><a href="../../2016/12/cpp-compiler-benchmark-on-expression-templates-library-etl.html">C++ Compiler benchmark on Expression Templates Library (ETL)</a></li>
<li><a href="../../2017/08/simplify-your-type-traits-with-c++14-variable-templates.html">Simplify your type traits with C++14 variable templates</a></li>
<li><a href="../../2018/02/c++17-migration-of-expression-templates-library-etl.html">C++17 Migration of Expression Templates Library (ETL)</a></li>
<li><a href="../../2016/01/improve-dll-and-etl-compile-time-further.html">Improve DLL and ETL Compile Time further</a></li>
<li><a href="../../2016/02/use-templight-and-templar-to-debug-cpp-templates.html">Use templight and Templar to debug C++ templates</a></li>


                            <li class="navbar-block">

                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
                                <img src="../../../assets/img/twitter.png" alt="Follow @wichtounet on Twitter"></a>
                        </li>

                    </ul>
</div>
<!-- /.navbar-collapse -->
            </nav>
</div> <!-- col -->
        <div class="col-sm-9 col-lg-10">
            <div id="content"></div>
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Simulate static_if with C++11/C++14</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Baptiste Wicht
            </span></p>
            <p class="dateline">
            <a href="#" rel="bookmark">
            <time class="published dt-published" datetime="2015-07-12T15:23:34+02:00" itemprop="datePublished" title="2015-07-12 15:23">2015-07-12 15:23</time></a>
            </p>
                <p class="commentline">
    
    <a href="simulate-static_if-with-c11c14.html#disqus_thread" data-disqus-identifier="cache/posts/2015/07/simulate-static_if-with-c11c14.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="simulate-static_if-with-c11c14.rst" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>If you are doing a lot of template metaprogramming and other template magic stuff, you are likely to miss a <code>static_if</code> in the language. Unfortunately, it didn't make the cut for C++11 and it seems unlikely that it will make it in C++17.</p>
<section id="static-if"><h2>static_if</h2>
<p>As its name indicates, <code>static_if</code> is an if statement but that is done at compile-time. At first, it could seem that the main point is performance, but that is not the case. With recent compilers, if you have an if statement with a compile-time constant, it will never be executed at runtime and only the correct branch will be included in the final executable code. However, even if the compiler knows that a branch will never be executed, it still has to ensure that this branch compiles. This is not the case with <code>static_if</code>. With <code>static_if</code>, only the valid branch is compiled, the other can contains invalid code. The most common reason to use a <code>static_if</code> is inside a template where you perform a test on a template argument and execute code based on this test. <code>static_if</code> has another advantage on standard if. Since only one branch is instantiated, it may save quite a lot of compile-time.</p>
<p>Let's say we have to write a template function that, if the template argument is a string, removes the last character of the string argument, otherwise decrement the argument (I know, stupid example, but simple). With <code>static_if</code>, you can write it like this:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_88752dce15cd471a9483a810ca562e7e-1" name="rest_code_88752dce15cd471a9483a810ca562e7e-1" href="simulate-static_if-with-c11c14.html#rest_code_88752dce15cd471a9483a810ca562e7e-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="rest_code_88752dce15cd471a9483a810ca562e7e-2" name="rest_code_88752dce15cd471a9483a810ca562e7e-2" href="simulate-static_if-with-c11c14.html#rest_code_88752dce15cd471a9483a810ca562e7e-2"></a><span class="kt">void</span><span class="w"> </span><span class="n">decrement_kindof</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">){</span>
<a id="rest_code_88752dce15cd471a9483a810ca562e7e-3" name="rest_code_88752dce15cd471a9483a810ca562e7e-3" href="simulate-static_if-with-c11c14.html#rest_code_88752dce15cd471a9483a810ca562e7e-3"></a><span class="w">    </span><span class="n">static_if</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">){</span>
<a id="rest_code_88752dce15cd471a9483a810ca562e7e-4" name="rest_code_88752dce15cd471a9483a810ca562e7e-4" href="simulate-static_if-with-c11c14.html#rest_code_88752dce15cd471a9483a810ca562e7e-4"></a><span class="w">        </span><span class="n">value</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
<a id="rest_code_88752dce15cd471a9483a810ca562e7e-5" name="rest_code_88752dce15cd471a9483a810ca562e7e-5" href="simulate-static_if-with-c11c14.html#rest_code_88752dce15cd471a9483a810ca562e7e-5"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_88752dce15cd471a9483a810ca562e7e-6" name="rest_code_88752dce15cd471a9483a810ca562e7e-6" href="simulate-static_if-with-c11c14.html#rest_code_88752dce15cd471a9483a810ca562e7e-6"></a><span class="w">        </span><span class="o">--</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_88752dce15cd471a9483a810ca562e7e-7" name="rest_code_88752dce15cd471a9483a810ca562e7e-7" href="simulate-static_if-with-c11c14.html#rest_code_88752dce15cd471a9483a810ca562e7e-7"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_88752dce15cd471a9483a810ca562e7e-8" name="rest_code_88752dce15cd471a9483a810ca562e7e-8" href="simulate-static_if-with-c11c14.html#rest_code_88752dce15cd471a9483a810ca562e7e-8"></a><span class="p">}</span>
</pre></div>
<p>I think it is quite elegant.</p>
</section><section id="the-problem"><h2>The problem</h2>
<p>Some may think, that we could do the same with C++ standard if statement:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_0d3421b065f04399a2e3e05f2c50c464-1" name="rest_code_0d3421b065f04399a2e3e05f2c50c464-1" href="simulate-static_if-with-c11c14.html#rest_code_0d3421b065f04399a2e3e05f2c50c464-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="rest_code_0d3421b065f04399a2e3e05f2c50c464-2" name="rest_code_0d3421b065f04399a2e3e05f2c50c464-2" href="simulate-static_if-with-c11c14.html#rest_code_0d3421b065f04399a2e3e05f2c50c464-2"></a><span class="kt">void</span><span class="w"> </span><span class="n">decrement_kindof</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">){</span>
<a id="rest_code_0d3421b065f04399a2e3e05f2c50c464-3" name="rest_code_0d3421b065f04399a2e3e05f2c50c464-3" href="simulate-static_if-with-c11c14.html#rest_code_0d3421b065f04399a2e3e05f2c50c464-3"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">){</span>
<a id="rest_code_0d3421b065f04399a2e3e05f2c50c464-4" name="rest_code_0d3421b065f04399a2e3e05f2c50c464-4" href="simulate-static_if-with-c11c14.html#rest_code_0d3421b065f04399a2e3e05f2c50c464-4"></a><span class="w">        </span><span class="n">value</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
<a id="rest_code_0d3421b065f04399a2e3e05f2c50c464-5" name="rest_code_0d3421b065f04399a2e3e05f2c50c464-5" href="simulate-static_if-with-c11c14.html#rest_code_0d3421b065f04399a2e3e05f2c50c464-5"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_0d3421b065f04399a2e3e05f2c50c464-6" name="rest_code_0d3421b065f04399a2e3e05f2c50c464-6" href="simulate-static_if-with-c11c14.html#rest_code_0d3421b065f04399a2e3e05f2c50c464-6"></a><span class="w">        </span><span class="o">--</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_0d3421b065f04399a2e3e05f2c50c464-7" name="rest_code_0d3421b065f04399a2e3e05f2c50c464-7" href="simulate-static_if-with-c11c14.html#rest_code_0d3421b065f04399a2e3e05f2c50c464-7"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_0d3421b065f04399a2e3e05f2c50c464-8" name="rest_code_0d3421b065f04399a2e3e05f2c50c464-8" href="simulate-static_if-with-c11c14.html#rest_code_0d3421b065f04399a2e3e05f2c50c464-8"></a><span class="p">}</span>
</pre></div>
<p>However, this won't work. This template cannot be instantiated for <code>std::string</code> since it doesn't have an operator -- and it cannot be instantiated for int since it doesn't have a <code>pop_back()</code> function.</p>
<p>There are two solutions in plain C++: specialization and SFINAE. Let's start with specialization:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_0e8b0602695c4b86b1820fffb42e4a95-1" name="rest_code_0e8b0602695c4b86b1820fffb42e4a95-1" href="simulate-static_if-with-c11c14.html#rest_code_0e8b0602695c4b86b1820fffb42e4a95-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="rest_code_0e8b0602695c4b86b1820fffb42e4a95-2" name="rest_code_0e8b0602695c4b86b1820fffb42e4a95-2" href="simulate-static_if-with-c11c14.html#rest_code_0e8b0602695c4b86b1820fffb42e4a95-2"></a><span class="kt">void</span><span class="w"> </span><span class="n">decrement_kindof</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">){</span>
<a id="rest_code_0e8b0602695c4b86b1820fffb42e4a95-3" name="rest_code_0e8b0602695c4b86b1820fffb42e4a95-3" href="simulate-static_if-with-c11c14.html#rest_code_0e8b0602695c4b86b1820fffb42e4a95-3"></a><span class="w">    </span><span class="o">--</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_0e8b0602695c4b86b1820fffb42e4a95-4" name="rest_code_0e8b0602695c4b86b1820fffb42e4a95-4" href="simulate-static_if-with-c11c14.html#rest_code_0e8b0602695c4b86b1820fffb42e4a95-4"></a><span class="p">}</span>
<a id="rest_code_0e8b0602695c4b86b1820fffb42e4a95-5" name="rest_code_0e8b0602695c4b86b1820fffb42e4a95-5" href="simulate-static_if-with-c11c14.html#rest_code_0e8b0602695c4b86b1820fffb42e4a95-5"></a>
<a id="rest_code_0e8b0602695c4b86b1820fffb42e4a95-6" name="rest_code_0e8b0602695c4b86b1820fffb42e4a95-6" href="simulate-static_if-with-c11c14.html#rest_code_0e8b0602695c4b86b1820fffb42e4a95-6"></a><span class="k">template</span><span class="o">&lt;&gt;</span>
<a id="rest_code_0e8b0602695c4b86b1820fffb42e4a95-7" name="rest_code_0e8b0602695c4b86b1820fffb42e4a95-7" href="simulate-static_if-with-c11c14.html#rest_code_0e8b0602695c4b86b1820fffb42e4a95-7"></a><span class="kt">void</span><span class="w"> </span><span class="n">decrement_kindof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">){</span>
<a id="rest_code_0e8b0602695c4b86b1820fffb42e4a95-8" name="rest_code_0e8b0602695c4b86b1820fffb42e4a95-8" href="simulate-static_if-with-c11c14.html#rest_code_0e8b0602695c4b86b1820fffb42e4a95-8"></a><span class="w">    </span><span class="n">value</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
<a id="rest_code_0e8b0602695c4b86b1820fffb42e4a95-9" name="rest_code_0e8b0602695c4b86b1820fffb42e4a95-9" href="simulate-static_if-with-c11c14.html#rest_code_0e8b0602695c4b86b1820fffb42e4a95-9"></a><span class="p">}</span>
</pre></div>
<p>We do a specialization for <code>std::string</code> case so that in the general case it uses -- and in the <code>std::string</code> case, it uses <code>pop_back()</code>. And the SFINAE version:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_c0d5df853d8b4a3a8635c4e13e15c338-1" name="rest_code_c0d5df853d8b4a3a8635c4e13e15c338-1" href="simulate-static_if-with-c11c14.html#rest_code_c0d5df853d8b4a3a8635c4e13e15c338-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">enable_if_t</span><span class="o">&lt;!</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="o">&gt;</span>
<a id="rest_code_c0d5df853d8b4a3a8635c4e13e15c338-2" name="rest_code_c0d5df853d8b4a3a8635c4e13e15c338-2" href="simulate-static_if-with-c11c14.html#rest_code_c0d5df853d8b4a3a8635c4e13e15c338-2"></a><span class="kt">void</span><span class="w"> </span><span class="n">decrement_kindof</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">){</span>
<a id="rest_code_c0d5df853d8b4a3a8635c4e13e15c338-3" name="rest_code_c0d5df853d8b4a3a8635c4e13e15c338-3" href="simulate-static_if-with-c11c14.html#rest_code_c0d5df853d8b4a3a8635c4e13e15c338-3"></a><span class="w">    </span><span class="o">--</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_c0d5df853d8b4a3a8635c4e13e15c338-4" name="rest_code_c0d5df853d8b4a3a8635c4e13e15c338-4" href="simulate-static_if-with-c11c14.html#rest_code_c0d5df853d8b4a3a8635c4e13e15c338-4"></a><span class="p">}</span>
<a id="rest_code_c0d5df853d8b4a3a8635c4e13e15c338-5" name="rest_code_c0d5df853d8b4a3a8635c4e13e15c338-5" href="simulate-static_if-with-c11c14.html#rest_code_c0d5df853d8b4a3a8635c4e13e15c338-5"></a>
<a id="rest_code_c0d5df853d8b4a3a8635c4e13e15c338-6" name="rest_code_c0d5df853d8b4a3a8635c4e13e15c338-6" href="simulate-static_if-with-c11c14.html#rest_code_c0d5df853d8b4a3a8635c4e13e15c338-6"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">enable_if_t</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="o">&gt;</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">42</span><span class="o">&gt;</span>
<a id="rest_code_c0d5df853d8b4a3a8635c4e13e15c338-7" name="rest_code_c0d5df853d8b4a3a8635c4e13e15c338-7" href="simulate-static_if-with-c11c14.html#rest_code_c0d5df853d8b4a3a8635c4e13e15c338-7"></a><span class="kt">void</span><span class="w"> </span><span class="n">decrement_kindof</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">){</span>
<a id="rest_code_c0d5df853d8b4a3a8635c4e13e15c338-8" name="rest_code_c0d5df853d8b4a3a8635c4e13e15c338-8" href="simulate-static_if-with-c11c14.html#rest_code_c0d5df853d8b4a3a8635c4e13e15c338-8"></a><span class="w">    </span><span class="n">value</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
<a id="rest_code_c0d5df853d8b4a3a8635c4e13e15c338-9" name="rest_code_c0d5df853d8b4a3a8635c4e13e15c338-9" href="simulate-static_if-with-c11c14.html#rest_code_c0d5df853d8b4a3a8635c4e13e15c338-9"></a><span class="p">}</span>
</pre></div>
<p>The first function is enabled when the type is not a <code>std::string</code> and the second function is enabled when the type is a <code>std::string</code>.</p>
<p>Both solutions needs two functions to make it work. In this particular case, specialization is easier since the condition states exactly one type. If the condition was more complex for instance testing that a constant inside the type is equals to some value, we could only do it with SFINAE.</p>
<p>Even if both solutions work, both solutions are more complicated than the static_if version and both solutions are creating more functions than what should be necessary.</p>
</section><section id="one-solution"><h2>One solution</h2>
<p>There is one way to emulate a kind of <code>static_if</code> with C++14 generic lambdas. It is kind of using anonymous template function to emulate what we did with the previous solutions but does it behind the scene. Here the code I'm using for this emulation:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-1" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-1" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">static_if_detail</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-2" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-2" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-2"></a>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-3" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-3" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-3"></a><span class="k">struct</span><span class="w"> </span><span class="nc">identity</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-4" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-4" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-4"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-5" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-5" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-5"></a><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="k">operator</span><span class="p">()(</span><span class="n">T</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-6" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-6" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-7" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-7" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-7"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-8" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-8" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-8"></a><span class="p">};</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-9" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-9" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-9"></a>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-10" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-10" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-10"></a><span class="k">template</span><span class="o">&lt;</span><span class="kt">bool</span><span class="w"> </span><span class="n">Cond</span><span class="o">&gt;</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-11" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-11" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-11"></a><span class="k">struct</span><span class="w"> </span><span class="nc">statement</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-12" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-12" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-12"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">F</span><span class="o">&gt;</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-13" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-13" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-13"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">then</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">F</span><span class="o">&amp;</span><span class="w"> </span><span class="n">f</span><span class="p">){</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-14" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-14" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-14"></a><span class="w">        </span><span class="n">f</span><span class="p">(</span><span class="n">identity</span><span class="p">());</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-15" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-15" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-15"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-16" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-16" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-16"></a>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-17" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-17" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-17"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">F</span><span class="o">&gt;</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-18" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-18" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-18"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">else_</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">F</span><span class="o">&amp;</span><span class="p">){}</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-19" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-19" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-19"></a><span class="p">};</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-20" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-20" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-20"></a>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-21" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-21" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-21"></a><span class="k">template</span><span class="o">&lt;&gt;</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-22" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-22" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-22"></a><span class="k">struct</span><span class="w"> </span><span class="nc">statement</span><span class="o">&lt;</span><span class="nb">false</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-23" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-23" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-23"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">F</span><span class="o">&gt;</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-24" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-24" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-24"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">then</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">F</span><span class="o">&amp;</span><span class="p">){}</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-25" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-25" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-25"></a>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-26" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-26" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-26"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">F</span><span class="o">&gt;</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-27" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-27" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-27"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">else_</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">F</span><span class="o">&amp;</span><span class="w"> </span><span class="n">f</span><span class="p">){</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-28" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-28" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-28"></a><span class="w">        </span><span class="n">f</span><span class="p">(</span><span class="n">identity</span><span class="p">());</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-29" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-29" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-29"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-30" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-30" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-30"></a><span class="p">};</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-31" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-31" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-31"></a>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-32" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-32" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-32"></a><span class="p">}</span><span class="w"> </span><span class="c1">//end of namespace static_if_detail</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-33" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-33" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-33"></a>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-34" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-34" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-34"></a><span class="k">template</span><span class="o">&lt;</span><span class="kt">bool</span><span class="w"> </span><span class="n">Cond</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">F</span><span class="o">&gt;</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-35" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-35" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-35"></a><span class="n">static_if_detail</span><span class="o">::</span><span class="n">statement</span><span class="o">&lt;</span><span class="n">Cond</span><span class="o">&gt;</span><span class="w"> </span><span class="n">static_if</span><span class="p">(</span><span class="n">F</span><span class="w"> </span><span class="k">const</span><span class="o">&amp;</span><span class="w"> </span><span class="n">f</span><span class="p">){</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-36" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-36" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-36"></a><span class="w">    </span><span class="n">static_if_detail</span><span class="o">::</span><span class="n">statement</span><span class="o">&lt;</span><span class="n">Cond</span><span class="o">&gt;</span><span class="w"> </span><span class="n">if_</span><span class="p">;</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-37" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-37" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-37"></a><span class="w">    </span><span class="n">if_</span><span class="p">.</span><span class="n">then</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-38" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-38" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-38"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">if_</span><span class="p">;</span>
<a id="rest_code_d4f7d9e3782340c4906a6482e4e8699f-39" name="rest_code_d4f7d9e3782340c4906a6482e4e8699f-39" href="simulate-static_if-with-c11c14.html#rest_code_d4f7d9e3782340c4906a6482e4e8699f-39"></a><span class="p">}</span>
</pre></div>
<p>Note: I got the idea (and most of the code) from the <a class="reference external" href="http://lists.boost.org/Archives/boost/2014/08/216607.php">Boost Mailing List</a>.</p>
<p>The condition is passed a non-type template parameter and the code for the branch is a passed a generic lambda functor. The <code>static_if</code> function returns a statement structure. We could avoid returning a struct and directly execute, or not, the functor based on the condition, but using a structure allows for the <code>else_</code> part which may be practical. The structure <code>statement</code> is specialized on the condition. If the condition is true, the right part will execute the functor while the false part will not execute anything. The specialization when the condition is false willl do the contrary. A special point here is the use of the identity function. The function is passed to the lambda. The user can then use this function to make non-dependent type dependent. This is necessary if we want to call functions on non-dependent types and these functions may not exist. For instance, you may want to call a function on <code>this</code>, which is not a dependent type.</p>
<p>Here is how the code will look using this solution:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_de7268d54b35440db6c0b3334ef135cb-1" name="rest_code_de7268d54b35440db6c0b3334ef135cb-1" href="simulate-static_if-with-c11c14.html#rest_code_de7268d54b35440db6c0b3334ef135cb-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="rest_code_de7268d54b35440db6c0b3334ef135cb-2" name="rest_code_de7268d54b35440db6c0b3334ef135cb-2" href="simulate-static_if-with-c11c14.html#rest_code_de7268d54b35440db6c0b3334ef135cb-2"></a><span class="kt">void</span><span class="w"> </span><span class="n">decrement_kindof</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span><span class="w"> </span><span class="n">value</span><span class="p">){</span>
<a id="rest_code_de7268d54b35440db6c0b3334ef135cb-3" name="rest_code_de7268d54b35440db6c0b3334ef135cb-3" href="simulate-static_if-with-c11c14.html#rest_code_de7268d54b35440db6c0b3334ef135cb-3"></a><span class="w">    </span><span class="n">static_if</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="o">&gt;</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="k">auto</span><span class="w"> </span><span class="n">f</span><span class="p">){</span>
<a id="rest_code_de7268d54b35440db6c0b3334ef135cb-4" name="rest_code_de7268d54b35440db6c0b3334ef135cb-4" href="simulate-static_if-with-c11c14.html#rest_code_de7268d54b35440db6c0b3334ef135cb-4"></a><span class="w">        </span><span class="n">f</span><span class="p">(</span><span class="n">value</span><span class="p">).</span><span class="n">pop_back</span><span class="p">();</span>
<a id="rest_code_de7268d54b35440db6c0b3334ef135cb-5" name="rest_code_de7268d54b35440db6c0b3334ef135cb-5" href="simulate-static_if-with-c11c14.html#rest_code_de7268d54b35440db6c0b3334ef135cb-5"></a><span class="w">    </span><span class="p">}).</span><span class="n">else_</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="k">auto</span><span class="w"> </span><span class="n">f</span><span class="p">){</span>
<a id="rest_code_de7268d54b35440db6c0b3334ef135cb-6" name="rest_code_de7268d54b35440db6c0b3334ef135cb-6" href="simulate-static_if-with-c11c14.html#rest_code_de7268d54b35440db6c0b3334ef135cb-6"></a><span class="w">        </span><span class="o">--</span><span class="n">f</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
<a id="rest_code_de7268d54b35440db6c0b3334ef135cb-7" name="rest_code_de7268d54b35440db6c0b3334ef135cb-7" href="simulate-static_if-with-c11c14.html#rest_code_de7268d54b35440db6c0b3334ef135cb-7"></a><span class="w">    </span><span class="p">});</span>
<a id="rest_code_de7268d54b35440db6c0b3334ef135cb-8" name="rest_code_de7268d54b35440db6c0b3334ef135cb-8" href="simulate-static_if-with-c11c14.html#rest_code_de7268d54b35440db6c0b3334ef135cb-8"></a><span class="p">}</span>
</pre></div>
<p>It is not as elegant as the "real" <code>static_if</code> version, but it is closer than the other solutions.</p>
<p>If you don't use the lazy identity function (f), it still works on g++, but not on clang for some reasons.</p>
</section><section id="conclusion"><h2>Conclusion</h2>
<p>We saw that there are some solutions to emulate <code>static_if</code> in C++ that you may use to make the code easier to read. I'm personally using this trick on branches with few lines of code and when I don't have to use the identity function too much, otherwise it is cleaner to use standard SFINAE functions to do the job. When you only have a if and no else, this trick is even better because that is where it saves the more code.</p>
<p>I hope this can be useful to some of you ;)</p>
<p>You can find my implementation <a class="reference external" href="https://github.com/wichtounet/cpp_utils/blob/master/static_if.hpp">on Github</a>.</p>
</section>
</div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/c%2B%2B.html" rel="tag">C++</a></li>
            <li><a class="tag p-category" href="../../../categories/c%2B%2B11.html" rel="tag">C++11</a></li>
            <li><a class="tag p-category" href="../../../categories/c%2B%2B14.html" rel="tag">C++14</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../06/improve-etl-compile-time-with-precompiled-headers.html" rel="prev" title="Improve ETL compile-time with Precompiled Headers">Previous post</a>
            </li>
            <li class="next">
                <a href="../11/upgrade-to-nikola-7.html" rel="next" title="Upgrade to Nikola 7">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
    
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="https://baptiste-wicht.com/posts/2015/07/simulate-static_if-with-c11c14.html",
        disqus_title="Simulate static_if with C++11/C++14",
        disqus_identifier="cache/posts/2015/07/simulate-static_if-with-c11c14.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div> <!-- col -->
    </div>
<!-- row  -->
</div>
<!-- container-fluid -->

<!-- End of Menubar -->

<!-- Footer -->

<footer>
    Contents © 2023         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         - License: 
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="../../../assets/img/cc.png"></a>
        <ul class="footer_inline_ul">
<li>
    <a href="simulate-static_if-with-c11c14.rst" id="sourcelink">Source</a>
    </li>

        </ul></footer><!-- Late loading stuff  --><script src="../../../assets/js/all-nocdn.js"></script><!-- Google platform JS -->
</body>
</html>
