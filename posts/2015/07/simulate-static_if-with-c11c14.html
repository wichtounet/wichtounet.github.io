<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<base href="http://baptiste-wicht.com/posts/2015/07/simulate-static_if-with-c11c14.html">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Simulate static_if with C++11/C++14 | @Blog("Baptiste Wicht")</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="http://baptiste-wicht.com/posts/2015/07/simulate-static_if-with-c11c14.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2175227-7']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script><meta name="author" content="Baptiste Wicht">
<link rel="prev" href="../06/improve-etl-compile-time-with-precompiled-headers.html" title="Improve ETL compile-time with Precompiled Headers" type="text/html">
<link rel="next" href="../11/upgrade-to-nikola-7.html" title="Upgrade to Nikola 7" type="text/html">
<meta property="og:site_name" content='@Blog("Baptiste Wicht")'>
<meta property="og:title" content="Simulate static_if with C++11/C++14">
<meta property="og:url" content="http://baptiste-wicht.com/posts/2015/07/simulate-static_if-with-c11c14.html">
<meta property="og:description" content="If you are doing a lot of template metaprogramming and other template magic stuff, you are likely to miss a static_if in the language. Unfortunately, it didn't make the cut for C++11 and it seems unli">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2015-07-12T15:23:34+02:00">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="C++11">
<meta property="article:tag" content="C++14">
<link href="../../../favicon.ico" rel="icon" type="image/x-icon">
<link href="../../../assets/css/tx3-tag-cloud.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class="social_container">
    <div class="social_container_gplus">
        <a target="_blank" title="Share on Google+" href="https://plusone.google.com/_/+1/confirm?hl=en&amp;url=http://baptiste-wicht.com/posts/2015/07/simulate-static_if-with-c11c14.html"><img alt="Google Plus Logo" src="../../../assets/img/google_plus.png"></a>
    </div>
    <div class="social_container_twitter">
        <a target="_blank" title="Tweet on Twitter" href="http://twitter.com/home?status=#url"><img alt="Twitter Logo" src="../../../assets/img/twitter.svg"></a>
    </div>
    <div class="social_container_facebook">
        <a target="_blank" title="Share on Facebook" href="http://www.facebook.com/sharer/sharer.php?u=#url"><img alt="Facebook Logo" src="../../../assets/img/facebook.png"></a>
    </div>
</div>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top"><div class="container-fluid">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://baptiste-wicht.com/">
                <span id="blog-title">@Blog("Baptiste Wicht")</span>
            </a>
        </div>
<!-- /.navbar-header -->

        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
<li>
<a href="../../../stories/about.html">About</a>
                </li>
<li>
<a href="../../../stories/publications.html">Publications</a>
                </li>
<li>
<a href="../../../stories/contact.html">Contact</a>
                </li>
<li>
<a href="../../../stories/faq.html">FAQ</a>
                </li>
<li>
<a href="../../../stories/legal.html">Legal</a>
                </li>
<li>
<a href="../../../categories/index.html">Tags</a>
                </li>
<li>
<a href="../../../archive.html">Archives</a>
                </li>
<li>
<a href="http://feeds.feedburner.com/BaptisteWicht">RSS</a>

            </li>
</ul>
<div class="navbar-form pull-left">
                <form action="../../../stories/search.html">
                    <input type="text" name="q" id="tipue_search_input">
</form>
            </div>

            <ul class="nav navbar-nav navbar-right">
<li>
                    <a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
                        <img src="../../../assets/img/twitter.svg" alt="Follow @wichtounet on Twitter"></a>
                </li>
                <li>
                    <a target="_blank" title="Follow +BaptisteWicht on Google+" href="https://plus.google.com/+BaptisteWicht">
                        <img src="../../../assets/img/google_plus.svg" alt="Follow +BaptisteWicht on Google+"></a>
                </li>
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container-fluid -->
</nav><!-- End of Menubar --><div class="body-container">

    <!-- Sidebar -->

    <div class="left-sidebar">
            <div class="left-sidebar-widget">
                <h3>Welcome to my blog</h3>
                <div class="left-sidebar-widget-content">
                    <div class="g-person" data-width="275" data-href="//plus.google.com/u/0/103113673902796202116" data-theme="dark" data-layout="landscape" data-rel="author"></div>
                </div>
            </div>

            <div class="left-sidebar-widget">
                <h3>Related posts</h3>
                <div class="left-sidebar-widget-content">
                    
                    <ol>
<li><a href="../03/named-optional-template-parameters-compile-time.html">Named Optional Template parameters to configure a class at compile-time</a></li>
<li><a href="../../2016/02/use-templight-and-templar-to-debug-cpp-templates.html">Use templight and Templar to debug C++ templates</a></li>
<li><a href="../../2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html">Compile integer Square Roots at compile-time in C++</a></li>
<li><a href="../../2016/01/improve-dll-and-etl-compile-time-further.html">Improve DLL and ETL Compile Time further</a></li>
<li><a href="../05/cpp17-fold-expressions.html">C++17 Fold Expressions</a></li>
</ol>
</div>
            </div>

        <div class="left-sidebar-widget">
            <h3>Recent comments</h3>
            <div class="left-sidebar-widget-content">
                <div id="recentcomments" class="dsq-widget">
                    <script type="text/javascript" src="http://blogwichtounet.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=0&amp;avatar_size=28&amp;excerpt_length=50"></script>
</div>
            </div>
        </div>

        <div class="left-sidebar-widget">
            <h3>Blogroll</h3>
            <div class="left-sidebar-widget-content">
                <ul>
<li><a target="_blank" href="https://isocpp.org/blog">ISO Standard C++ - Blog</a></li>
                    <li><a target="_blank" href="http://meetingcpp.com/index.php/blog.html">Meeting C++ - Blog</a></li>
                </ul>
</div>
        </div>
    </div>


    <!-- Content -->

    <div class="container">
        <div class="body-content">
            <div class="row">
                
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Simulate static_if with C++11/C++14</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                    Baptiste Wicht
            </span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2015-07-12T15:23:34+02:00" itemprop="datePublished" title="2015-07-12 15:23">2015-07-12 15:23</time></a></p>
                <p class="commentline">
        
    <a href="simulate-static_if-with-c11c14.html#disqus_thread" data-disqus-identifier="cache/posts/2015/07/simulate-static_if-with-c11c14.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="simulate-static_if-with-c11c14.rst" id="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>If you are doing a lot of template metaprogramming and other template magic stuff, you are likely to miss a <code>static_if</code> in the language. Unfortunately, it didn't make the cut for C++11 and it seems unlikely that it will make it in C++17.</p>
<div class="section" id="static-if">
<h2>static_if</h2>
<p>As its name indicates, <code>static_if</code> is an if statement but that is done at compile-time. At first, it could seem that the main point is performance, but that is not the case. With recent compilers, if you have an if statement with a compile-time constant, it will never be executed at runtime and only the correct branch will be included in the final executable code. However, even if the compiler knows that a branch will never be executed, it still has to ensure that this branch compiles. This is not the case with <code>static_if</code>. With <code>static_if</code>, only the valid branch is compiled, the other can contains invalid code. The most common reason to use a <code>static_if</code> is inside a template where you perform a test on a template argument and execute code based on this test. <code>static_if</code> has another advantage on standard if. Since only one branch is instantiated, it may save quite a lot of compile-time.</p>
<p>Let's say we have to write a template function that, if the template argument is a string, removes the last character of the string argument, otherwise decrement the argument (I know, stupid example, but simple). With <code>static_if</code>, you can write it like this:</p>
<pre class="code cpp"><a name="rest_code_e272b39115a04be08d5329ddf8267bb2-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<a name="rest_code_e272b39115a04be08d5329ddf8267bb2-2"></a><span class="kt">void</span> <span class="n">decrement_kindof</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">){</span>
<a name="rest_code_e272b39115a04be08d5329ddf8267bb2-3"></a>    <span class="n">static_if</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">){</span>
<a name="rest_code_e272b39115a04be08d5329ddf8267bb2-4"></a>        <span class="n">value</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
<a name="rest_code_e272b39115a04be08d5329ddf8267bb2-5"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a name="rest_code_e272b39115a04be08d5329ddf8267bb2-6"></a>        <span class="o">--</span><span class="n">value</span><span class="p">;</span>
<a name="rest_code_e272b39115a04be08d5329ddf8267bb2-7"></a>    <span class="p">}</span>
<a name="rest_code_e272b39115a04be08d5329ddf8267bb2-8"></a><span class="p">}</span>
</pre>
<p>I think it is quite elegant.</p>
</div>
<div class="section" id="the-problem">
<h2>The problem</h2>
<p>Some may think, that we could do the same with C++ standard if statement:</p>
<pre class="code cpp"><a name="rest_code_326a524374a34e11879a31abe43a24b8-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<a name="rest_code_326a524374a34e11879a31abe43a24b8-2"></a><span class="kt">void</span> <span class="n">decrement_kindof</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">){</span>
<a name="rest_code_326a524374a34e11879a31abe43a24b8-3"></a>    <span class="k">if</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">){</span>
<a name="rest_code_326a524374a34e11879a31abe43a24b8-4"></a>        <span class="n">value</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
<a name="rest_code_326a524374a34e11879a31abe43a24b8-5"></a>    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<a name="rest_code_326a524374a34e11879a31abe43a24b8-6"></a>        <span class="o">--</span><span class="n">value</span><span class="p">;</span>
<a name="rest_code_326a524374a34e11879a31abe43a24b8-7"></a>    <span class="p">}</span>
<a name="rest_code_326a524374a34e11879a31abe43a24b8-8"></a><span class="p">}</span>
</pre>
<p>However, this won't work. This template cannot be instantiated for <code>std::string</code> since it doesn't have an operator -- and it cannot be instantiated for int since it doesn't have a <code>pop_back()</code> function.</p>
<p>There are two solutions in plain C++: specialization and SFINAE. Let's start with specialization:</p>
<pre class="code cpp"><a name="rest_code_949dfef43fa8495c99a2328bd357b2f7-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<a name="rest_code_949dfef43fa8495c99a2328bd357b2f7-2"></a><span class="kt">void</span> <span class="n">decrement_kindof</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">){</span>
<a name="rest_code_949dfef43fa8495c99a2328bd357b2f7-3"></a>    <span class="o">--</span><span class="n">value</span><span class="p">;</span>
<a name="rest_code_949dfef43fa8495c99a2328bd357b2f7-4"></a><span class="p">}</span>
<a name="rest_code_949dfef43fa8495c99a2328bd357b2f7-5"></a>
<a name="rest_code_949dfef43fa8495c99a2328bd357b2f7-6"></a><span class="k">template</span><span class="o">&lt;&gt;</span>
<a name="rest_code_949dfef43fa8495c99a2328bd357b2f7-7"></a><span class="kt">void</span> <span class="n">decrement_kindof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">){</span>
<a name="rest_code_949dfef43fa8495c99a2328bd357b2f7-8"></a>    <span class="n">value</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
<a name="rest_code_949dfef43fa8495c99a2328bd357b2f7-9"></a><span class="p">}</span>
</pre>
<p>We do a specialization for <code>std::string</code> case so that in the general case it uses -- and in the <code>std::string</code> case, it uses <code>pop_back()</code>. And the SFINAE version:</p>
<pre class="code cpp"><a name="rest_code_2f2032af8ed24de9934330a43711c695-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">enable_if_t</span><span class="o">&lt;!</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="o">=</span> <span class="mi">42</span><span class="o">&gt;</span>
<a name="rest_code_2f2032af8ed24de9934330a43711c695-2"></a><span class="kt">void</span> <span class="n">decrement_kindof</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">){</span>
<a name="rest_code_2f2032af8ed24de9934330a43711c695-3"></a>    <span class="o">--</span><span class="n">value</span><span class="p">;</span>
<a name="rest_code_2f2032af8ed24de9934330a43711c695-4"></a><span class="p">}</span>
<a name="rest_code_2f2032af8ed24de9934330a43711c695-5"></a>
<a name="rest_code_2f2032af8ed24de9934330a43711c695-6"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">enable_if_t</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span> <span class="kt">int</span><span class="o">&gt;</span> <span class="o">=</span> <span class="mi">42</span><span class="o">&gt;</span>
<a name="rest_code_2f2032af8ed24de9934330a43711c695-7"></a><span class="kt">void</span> <span class="n">decrement_kindof</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">){</span>
<a name="rest_code_2f2032af8ed24de9934330a43711c695-8"></a>    <span class="n">value</span><span class="p">.</span><span class="n">pop_back</span><span class="p">();</span>
<a name="rest_code_2f2032af8ed24de9934330a43711c695-9"></a><span class="p">}</span>
</pre>
<p>The first function is enabled when the type is not a <code>std::string</code> and the second function is enabled when the type is a <code>std::string</code>.</p>
<p>Both solutions needs two functions to make it work. In this particular case, specialization is easier since the condition states exactly one type. If the condition was more complex for instance testing that a constant inside the type is equals to some value, we could only do it with SFINAE.</p>
<p>Even if both solutions work, both solutions are more complicated than the static_if version and both solutions are creating more functions than what should be necessary.</p>
</div>
<div class="section" id="one-solution">
<h2>One solution</h2>
<p>There is one way to emulate a kind of <code>static_if</code> with C++14 generic lambdas. It is kind of using anonymous template function to emulate what we did with the previous solutions but does it behind the scene. Here the code I'm using for this emulation:</p>
<pre class="code cpp"><a name="rest_code_076451b8edb3425c9542fc2161e07178-1"></a><span class="k">namespace</span> <span class="n">static_if_detail</span> <span class="p">{</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-2"></a>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-3"></a><span class="k">struct</span> <span class="n">identity</span> <span class="p">{</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-4"></a>    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-5"></a>    <span class="n">T</span> <span class="k">operator</span><span class="p">()(</span><span class="n">T</span><span class="o">&amp;&amp;</span> <span class="n">x</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-6"></a>        <span class="k">return</span> <span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-7"></a>    <span class="p">}</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-8"></a><span class="p">};</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-9"></a>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-10"></a><span class="k">template</span><span class="o">&lt;</span><span class="kt">bool</span> <span class="n">Cond</span><span class="o">&gt;</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-11"></a><span class="k">struct</span> <span class="n">statement</span> <span class="p">{</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-12"></a>    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-13"></a>    <span class="kt">void</span> <span class="n">then</span><span class="p">(</span><span class="k">const</span> <span class="n">F</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">){</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-14"></a>        <span class="n">f</span><span class="p">(</span><span class="n">identity</span><span class="p">());</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-15"></a>    <span class="p">}</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-16"></a>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-17"></a>    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-18"></a>    <span class="kt">void</span> <span class="n">else_</span><span class="p">(</span><span class="k">const</span> <span class="n">F</span><span class="o">&amp;</span><span class="p">){}</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-19"></a><span class="p">};</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-20"></a>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-21"></a><span class="k">template</span><span class="o">&lt;&gt;</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-22"></a><span class="k">struct</span> <span class="n">statement</span><span class="o">&lt;</span><span class="nb">false</span><span class="o">&gt;</span> <span class="p">{</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-23"></a>    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-24"></a>    <span class="kt">void</span> <span class="n">then</span><span class="p">(</span><span class="k">const</span> <span class="n">F</span><span class="o">&amp;</span><span class="p">){}</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-25"></a>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-26"></a>    <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-27"></a>    <span class="kt">void</span> <span class="n">else_</span><span class="p">(</span><span class="k">const</span> <span class="n">F</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">){</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-28"></a>        <span class="n">f</span><span class="p">(</span><span class="n">identity</span><span class="p">());</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-29"></a>    <span class="p">}</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-30"></a><span class="p">};</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-31"></a>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-32"></a><span class="p">}</span> <span class="c1">//end of namespace static_if_detail</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-33"></a>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-34"></a><span class="k">template</span><span class="o">&lt;</span><span class="kt">bool</span> <span class="n">Cond</span><span class="p">,</span> <span class="k">typename</span> <span class="n">F</span><span class="o">&gt;</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-35"></a><span class="n">static_if_detail</span><span class="o">::</span><span class="n">statement</span><span class="o">&lt;</span><span class="n">Cond</span><span class="o">&gt;</span> <span class="n">static_if</span><span class="p">(</span><span class="n">F</span> <span class="k">const</span><span class="o">&amp;</span> <span class="n">f</span><span class="p">){</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-36"></a>    <span class="n">static_if_detail</span><span class="o">::</span><span class="n">statement</span><span class="o">&lt;</span><span class="n">Cond</span><span class="o">&gt;</span> <span class="n">if_</span><span class="p">;</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-37"></a>    <span class="n">if_</span><span class="p">.</span><span class="n">then</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-38"></a>    <span class="k">return</span> <span class="n">if_</span><span class="p">;</span>
<a name="rest_code_076451b8edb3425c9542fc2161e07178-39"></a><span class="p">}</span>
</pre>
<p>Note: I got the idea (and most of the code) from the <a class="reference external" href="http://lists.boost.org/Archives/boost/2014/08/216607.php">Boost Mailing List</a>.</p>
<p>The condition is passed a non-type template parameter and the code for the branch is a passed a generic lambda functor. The <code>static_if</code> function returns a statement structure. We could avoid returning a struct and directly execute, or not, the functor based on the condition, but using a structure allows for the <code>else_</code> part which may be practical. The structure <code>statement</code> is specialized on the condition. If the condition is true, the right part will execute the functor while the false part will not execute anything. The specialization when the condition is false willl do the contrary. A special point here is the use of the identity function. The function is passed to the lambda. The user can then use this function to make non-dependent type dependent. This is necessary if we want to call functions on non-dependent types and these functions may not exist. For instance, you may want to call a function on <code>this</code>, which is not a dependent type.</p>
<p>Here is how the code will look using this solution:</p>
<pre class="code cpp"><a name="rest_code_9f255dac5374498492510989e32e993d-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<a name="rest_code_9f255dac5374498492510989e32e993d-2"></a><span class="kt">void</span> <span class="n">decrement_kindof</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;</span> <span class="n">value</span><span class="p">){</span>
<a name="rest_code_9f255dac5374498492510989e32e993d-3"></a>    <span class="n">static_if</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span> <span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="o">&gt;</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="k">auto</span> <span class="n">f</span><span class="p">){</span>
<a name="rest_code_9f255dac5374498492510989e32e993d-4"></a>        <span class="n">f</span><span class="p">(</span><span class="n">value</span><span class="p">).</span><span class="n">pop_back</span><span class="p">();</span>
<a name="rest_code_9f255dac5374498492510989e32e993d-5"></a>    <span class="p">}).</span><span class="n">else_</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="k">auto</span> <span class="n">f</span><span class="p">){</span>
<a name="rest_code_9f255dac5374498492510989e32e993d-6"></a>        <span class="o">--</span><span class="n">f</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
<a name="rest_code_9f255dac5374498492510989e32e993d-7"></a>    <span class="p">});</span>
<a name="rest_code_9f255dac5374498492510989e32e993d-8"></a><span class="p">}</span>
</pre>
<p>It is not as elegant as the "real" <code>static_if</code> version, but it is closer than the other solutions.</p>
<p>If you don't use the lazy identity function (f), it still works on g++, but not on clang for some reasons.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>We saw that there are some solutions to emulate <code>static_if</code> in C++ that you may use to make the code easier to read. I'm personally using this trick on branches with few lines of code and when I don't have to use the identity function too much, otherwise it is cleaner to use standard SFINAE functions to do the job. When you only have a if and no else, this trick is even better because that is where it saves the more code.</p>
<p>I hope this can be useful to some of you ;)</p>
<p>You can find my implementation <a class="reference external" href="https://github.com/wichtounet/cpp_utils/blob/master/static_if.hpp">on Github</a>.</p>
</div>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/c%2B%2B.html" rel="tag">C++</a></li>
            <li><a class="tag p-category" href="../../../categories/c%2B%2B11.html" rel="tag">C++11</a></li>
            <li><a class="tag p-category" href="../../../categories/c%2B%2B14.html" rel="tag">C++14</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../06/improve-etl-compile-time-with-precompiled-headers.html" rel="prev" title="Improve ETL compile-time with Precompiled Headers">Previous post</a>
            </li>
            <li class="next">
                <a href="../11/upgrade-to-nikola-7.html" rel="next" title="Upgrade to Nikola 7">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="http://baptiste-wicht.com/posts/2015/07/simulate-static_if-with-c11c14.html",
        disqus_title="Simulate static_if with C++11/C++14",
        disqus_identifier="cache/posts/2015/07/simulate-static_if-with-c11c14.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        </div>
    </div>
</div>

<!-- Footer -->

<footer>
    Contents © 2016         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="../../../assets/img/cc.png"></a>
        <ul class="footer_inline_ul">
<li>
    <a href="simulate-static_if-with-c11c14.rst" id="sourcelink">Source</a>
    </li>

        </ul></footer><!-- Late loading stuff  --><script src="../../../assets/js/all-nocdn.js"></script><!-- Google platform JS --><script type="text/javascript" src="https://apis.google.com/js/platform.js"></script><script type="text/javascript" src="../../../assets/js/jquery.tx3-tag-cloud.js"></script>
</body>
</html>
