<!DOCTYPE html><html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Baptiste Wicht">
    <title>Java Concurrency : Part 2 - Manipulate Threads | @Blog("Baptiste Wicht")</title>
    
            <link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
      <link rel="canonical" href="http://wichtounet.github.io/posts/2010/05/java-concurrency-part-2-manipulate-threads.html">
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
            <link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">

    





    
</head>
<body>
<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid"><!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://wichtounet.github.io/">@Blog("Baptiste Wicht")</a>
        </div><!-- /.navbar-header -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                
                <li><a href="../../../stories/about.html">About</a>
                </li><li><a href="../../../stories/publications.html">Publications</a>
                </li><li><a href="../../../stories/donate.html">Donate</a>
                </li><li><a href="../../../stories/faq.html">FAQ</a>
                </li><li><a href="../../../stories/legal.html">Legal</a>
                </li><li><a href="../../../archive.html">Archives</a>
                </li><li><a href="../../../categories/index.html">Tags</a>
                </li><li><a href="../../../rss.xml">RSS</a>

            </li></ul>

            <ul class="nav navbar-nav navbar-right">
                
                
                    
    <li>
    <a href="java-concurrency-part-2-manipulate-threads.wp" id="sourcelink">Source</a>
    </li>

            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>

<!-- End of Menubar -->

<div class="container">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
    <article class="postbox post-text">
    <div class="h-entry" itemscope="itemscope" itemtype="http://schema.org/Article">
    
    <h1 class="p-name" itemprop="headline name">Java Concurrency : Part 2 - Manipulate Threads</h1>

    <hr>
    <small>
        Posted: <time class="published dt-published" datetime="2010-05-17T06:33:07+00:00" itemprop="datePublished">2010-05-17 06:33</time>
        

        
          |  
        More posts about 
    <span itemprop="keywords">
        <a class="tag p-category" href="../../../categories/concurrency.html"><span class="badge badge-info">Concurrency</span></a>
        <a class="tag p-category" href="../../../categories/java.html"><span class="badge badge-info">Java</span></a>
        <a class="tag p-category" href="../../../categories/java.html"><span class="badge badge-info">Java</span></a>
        <a class="tag p-category" href="../../../categories/java-concurrency-tutorial.html"><span class="badge badge-info">Java Concurrency Tutorial</span></a>
    </span>


    </small>
    <hr>
    <div class="e-content" itemprop="articleBody text">
    <div><p></p><a href="http://www.baptiste-wicht.com/2010/05/java-concurrency-part-1-threads/">After seeing how to create Threads</a>, we'll see in this article what we can do to <strong>manipulate Threads</strong>.
<p>When we've Threads, we can make several operations on the Threads :</p>
<ul>
    <li>Make the current Thread <strong>sleeping</strong> during x milliseconds</li>
    <li><strong>Wait</strong> for an other thread to complete</li>
    <li>Manage the <strong>priorities</strong> of Threads and pause a thread to give an other thread the opportunity to run</li>
    <li><strong>Interrupt</strong> a thread</li>
</ul>

<p>We'll now see how to do all these things.</p>
<!--more-->

<p>First and easier, we can make a thread sleeping for a certain number of milliseconds. To do that, the Thread class has a method sleep(long millis). But this method is static, so you can only make the current Thread sleeping. You cannot choose the thread you want to make sleeping, your only choice is the current Thread so :</p>
<p>[java]Thread.sleep(1000);[/java]</p>
<p>makes the current Thread sleep during 1000 milliseconds (1 second). But, you have to catch an exception, InterruptedException. This exception occurs if the sleeping thread is interrupted. So you have to do that :</p>
<p>[java]try {
    Thread.sleep(1000);
} catch (InterruptedException e){
    e.printStackTrace();
}[/java]</p>
<p>But this not the good way to manage the InterruptedException. We'll see in one moment, how to deal with this exception. </p>
<p>If you want more precision, you can use the overloaded version of sleep that takes the number of milliseconds plus a certain number of nanoseconds to sleep. The precision of this sleep depends on the system timers and clocks.</p>
<p>For example, if you want to sleep 1000 milliseconds and 1000 nanoseconds (1 microsecond), you can do like that :</p>
<p>[java]try {
    Thread.sleep(1000, 1000);
} catch (InterruptedException e){
    e.printStackTrace();
}[/java]</p>
<p>Here is a little example to test that :</p>
<p>[java]public class SleepThread {
    public static void main(String[] args) {
        System.out.println("Current time millis : " + System.currentTimeMillis());</p>
<div class="code"><pre>    <span class="n">try</span> <span class="p">{</span>
        <span class="n">Thread</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Current time millis : "</span> <span class="o">+</span> <span class="n">System</span><span class="p">.</span><span class="n">currentTimeMillis</span><span class="p">());</span>

    <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Nano time : "</span> <span class="o">+</span> <span class="n">System</span><span class="p">.</span><span class="n">nanoTime</span><span class="p">());</span>

    <span class="n">try</span> <span class="p">{</span>
        <span class="n">Thread</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5000</span><span class="p">);</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Nano time : "</span> <span class="o">+</span> <span class="n">System</span><span class="p">.</span><span class="n">nanoTime</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>


<p>}[/java]</p>
<p>In my computer, this produce this result :</p>
<pre>Current time millis : 1273959308480

Current time millis : 1273959309480

Nano time : 5878165216075

Nano time : 5878166730976</pre>

<p>You can see that the sleep of milliseconds is very precise, but with nanoseconds the result can vary a lot. And of course, the result depends of your computer, your operating system and your configuration.</p>
<p>An other thing, you can do with Threads, is waiting for an other thread to die. For example, you can create five thread to compute sub result and wait for these 5 threads to finish to compute the final results based on the results of the five threads. To do that, you can use the join() method of the Thread class. This method is not static, so you can use it on any thread to wait for it to die. Like sleep() this method throws InterruptedException in the when the thread is interrupted during waiting for an other thread. So to wait on thread2, you just have to do that :</p>
<p>[java]try {
    thread2.join();
} catch (InterruptedException e){
    e.printStackTrace();
}[/java]</p>
<p>That will make the current Thread waiting for thread2 to die. You can also add a timeout in millis, or millis + nanos, with the overloaded versions of join(), join(long millis) and join(long millis, int nanos). Here is little example that shows all that stuff :</p>
<p>[java]public class JoinThread {
    public static void main(String[] args) {
        Thread thread2 = new Thread(new WaitRunnable());
        Thread thread3 = new Thread(new WaitRunnable());</p>
<div class="code"><pre>    <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Current time millis : "</span> <span class="o">+</span> <span class="n">System</span><span class="p">.</span><span class="n">currentTimeMillis</span><span class="p">());</span>

    <span class="n">thread2</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>

    <span class="n">try</span> <span class="p">{</span>
        <span class="n">thread2</span><span class="p">.</span><span class="n">join</span><span class="p">();</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Current time millis : "</span> <span class="o">+</span> <span class="n">System</span><span class="p">.</span><span class="n">currentTimeMillis</span><span class="p">());</span>

    <span class="n">thread3</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>

    <span class="n">try</span> <span class="p">{</span>
        <span class="n">thread3</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Current time millis : "</span> <span class="o">+</span> <span class="n">System</span><span class="p">.</span><span class="n">currentTimeMillis</span><span class="p">());</span>
<span class="p">}</span>

<span class="n">private</span> <span class="k">static</span> <span class="n">class</span> <span class="n">WaitRunnable</span> <span class="n">implements</span> <span class="n">Runnable</span> <span class="p">{</span>
    <span class="err">@</span><span class="n">Override</span>
    <span class="n">public</span> <span class="kt">void</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">try</span> <span class="p">{</span>
            <span class="n">Thread</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
        <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="p">}</span>
</pre></div>


<p>}[/java]</p>
<p>That produce this result on my computer :</p>
<pre>Current time millis : 1274015478535

Current time millis : 1274015483538

Current time millis : 1274015484538</pre>

<p>You can see that the first join() wait 5 seconds for the other thread and when we set a timeout, we wait only 1 seconds and return from join method.</p>
<p>When working with Threads, it's also possible to change the priority of a Thread. In the Java Virtual Machine, the Thread scheduler, use a priority-based scheduling. So if a Thread enter in Runnable state with a higher priority than the running Thread, the new Thread will run and the current running thread will return to Runnable state and waits for its turn. But this behavior is not guaranteed and is completely depending on the virtual machine you are working on. So, do not rely on thread priorities, just use them to improve efficiency of your program.</p>
<p>Normally, the priority range of Threads is an integer from 0 to 10, but some virtual machine have lower or higher ranges. To know the range of priority, you can use constants of the Thread class :</p>
<p>[java]public class ThreadPriorityRange {
    public static void main(String[] args) {
        System.out.println("Minimal priority : " + Thread.MIN_PRIORITY);
        System.out.println("Maximal priority : " + Thread.MAX_PRIORITY);
        System.out.println("Norm priority : " + Thread.NORM_PRIORITY);
         }
}[/java]</p>
<p>On my computer, I've the most current values :</p>
<pre>Minimal priority : 1

Maximal priority : 10

Norm priority</pre>

<p>To set the priority of a Thread, you can use the setPriority(int priority) method of the Thread class. If you enter a value greater than the maximal priority, the maximal value will be used. If you don't specify a priority, the used priority, will be the priority of the current Thread.</p>
<p>An other way to works with priority is the yield() method. This method is static, so this works on the current Thread. The purpose of this method is to make the Thread going to Runnable again and to give the opportunity to other threads to get their turn. But in practice, the behavior of this method is not guaranteed. It can be implemented as a no-op on certain systems. It's not easy to test that in practice, because the results can truly depends on your computer, virtual machine and operating system. It's a good things to not use the priorities of Threads in practice.</p>
<p>The last thing you can do with a Thread, is to interrupt it. In Java, you have no way to force a Thread to stop, if the Thread is not well-done, it can continue its execution infinitely. But you can interrupt a Thread with the interrupt() method. This method interrupt the thread, if the thread is sleeping or joining an other Thread, an InterruptedException is thrown. You have to know that if the thread was sleeping or joining, the interrupted status of the Thread will be cleared. Namely, the method isInterrupted() will return false. A little example to demonstrate that :</p>
<p>[java]public class InterruptThread {
    public static void main(String[] args) {
        Thread thread1 = new Thread(new WaitRunnable());</p>
<div class="code"><pre>    <span class="n">thread1</span><span class="p">.</span><span class="n">start</span><span class="p">();</span>

    <span class="n">try</span> <span class="p">{</span>
        <span class="n">Thread</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1000</span><span class="p">);</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="n">thread1</span><span class="p">.</span><span class="n">interrupt</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">private</span> <span class="k">static</span> <span class="n">class</span> <span class="n">WaitRunnable</span> <span class="n">implements</span> <span class="n">Runnable</span> <span class="p">{</span>
    <span class="err">@</span><span class="n">Override</span>
    <span class="n">public</span> <span class="kt">void</span> <span class="n">run</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Current time millis : "</span> <span class="o">+</span> <span class="n">System</span><span class="p">.</span><span class="n">currentTimeMillis</span><span class="p">());</span>

        <span class="n">try</span> <span class="p">{</span>
            <span class="n">Thread</span><span class="p">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
        <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"The thread has been interrupted"</span><span class="p">);</span>
            <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"The thread is interrupted : "</span> <span class="o">+</span> <span class="n">Thread</span><span class="p">.</span><span class="n">currentThread</span><span class="p">().</span><span class="n">isInterrupted</span><span class="p">());</span>
        <span class="p">}</span>

        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Current time millis : "</span> <span class="o">+</span> <span class="n">System</span><span class="p">.</span><span class="n">currentTimeMillis</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="p">}</span>
</pre></div>


<p>}[/java]</p>
<p>That produce that kind of result :</p>
<pre>Current time millis : 1274017633151

The thread has been interrupted

The thread is interrupted : false

Current time millis : 1274017634151</pre>

<p>You can see that after one second, the second thread is interrupted and that the interrupted status has been set to false. If you are not sleeping, but making a lot of heavy actions, you can test for interrupt like that to make your thread correctly interrupts :</p>
<p>[java]public class InterruptableRunnable implements Runnable {
    @Override
    public void run() {
        while(!Thread.currentThread().isInterrupted()){
            //Heavy operation
        }
    }
}[/java]</p>
<p>Now that you know how to interrupt a thread, you can imagine, that simply catch the InterruptedException is not enough to make your thread "interrupt safe". Imagine that your thread something like that : </p>
<p>[java]public class UglyRunnable implements Runnable {
    @Override
    public void run() {
        while(!Thread.currentThread().isInterrupted()){
            //Heavy operation
            try {
                Thread.sleep(5000);
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
            //Other operation
        }
    }
}[/java]</p>
<p>And now, an other thread want to interrupt your thread while your thread is sleeping. The sleep will be interrupted, but the interrupted status will be cleared so the loop will continue. A solution to make a better thread is to interrupt again the thread after an InterruptedException : </p>
<p>[java]public class BetterRunnable implements Runnable {
    @Override
    public void run() {
        while(!Thread.currentThread().isInterrupted()){
            //Heavy operation
            try {
                Thread.sleep(5000);
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
            }
            //Other operation
        }
    }
}[/java]</p>
<p>With that code, the interrupted status will be restored and the loop will be stopped after interrupt. Depending on your code, you can also add a continue statement after the interrupt() to not make operations after interrupt. In some cases, you'll also needs to make several if statements to test the interrupted status to do or not to do some operations. </p>
<p>So, we've now covered the main operations you can do on threads. I hope you found this article interesting.</p>
<p>You can download the sources of this article here : <a href="../../../wp-content/uploads/2010/05/Part2.tar.gz">Java Concurrency Sources - Part 2</a></p>
<p>In the next article about Java Concurrency, we'll see how to synchronize code to make it Thread-safe.</p></div>
    </div>
    </div>
    
        <ul class="pager">
            <li class="previous">
                <a href="tip-add-resources-dynamically-to-a-classloader.html" rel="prev">← Previous post</a>
            </li>
            <li class="next">
                <a href="evernote-a-very-smart-note-book.html" rel="next">Next post →</a>
            </li>
        </ul>

        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="nikolademo",
            disqus_url="http://wichtounet.github.io/posts/2010/05/java-concurrency-part-2-manipulate-threads.html",
        disqus_title="Java Concurrency : Part 2 - Manipulate Threads",
        disqus_identifier="cache/posts/2010/05/java-concurrency-part-2-manipulate-threads.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


    

    </article>

        </div>
        <!--End of body content-->

        <footer>
            Contents © 2014         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
        </footer>
    </div>
</div>


            <script src="../../../assets/js/all-nocdn.js" type="text/javascript"></script>


    
<!-- Social buttons -->
<div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
<a class="addthis_button_more">Share</a>
<ul><li><a class="addthis_button_facebook"></a>
</li><li><a class="addthis_button_google_plusone_share"></a>
</li><li><a class="addthis_button_linkedin"></a>
</li><li><a class="addthis_button_twitter"></a>
</li></ul>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script>
<!-- End of social buttons -->


    <script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script>
    

</body>
</html>