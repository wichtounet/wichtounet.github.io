<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<base href="http://baptiste-wicht.com/posts/2010/07/osgi-hello-world-services.html">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>OSGi - Simple Hello World with services | @Blog("Baptiste Wicht")</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="http://baptiste-wicht.com/posts/2010/07/osgi-hello-world-services.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2175227-7']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script><meta name="author" content="Baptiste Wicht">
<link rel="prev" href="state-of-the-lambda.html" title="State of the Lambda" type="text/html">
<link rel="next" href="play-framework-template-engine.html" title="Play Framework - The template engine" type="text/html">
<meta property="og:site_name" content='@Blog("Baptiste Wicht")'>
<meta property="og:title" content="OSGi - Simple Hello World with services">
<meta property="og:url" content="http://baptiste-wicht.com/posts/2010/07/osgi-hello-world-services.html">
<meta property="og:description" content="In this post, we'll develop a simple Hello World application with OSGi. We will use Felix as OSGi container. In the next post, we'll continue with this application and use Spring Dynamic Modules to im">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2010-07-16T07:05:48+02:00">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="OSGi">
<link href="../../../favicon.ico" rel="icon" type="image/x-icon">
<link href="../../../assets/css/tx3-tag-cloud.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class="social_container">
    <div class="social_container_gplus">
        <a target="_blank" title="Share on Google+" href="https://plusone.google.com/_/+1/confirm?hl=en&amp;url=http://baptiste-wicht.com/posts/2010/07/osgi-hello-world-services.html"><img alt="Google Plus Logo" src="../../../assets/img/google_plus.png"></a>
    </div>
    <div class="social_container_twitter">
        <a target="_blank" title="Tweet on Twitter" href="http://twitter.com/home?status=#url"><img alt="Twitter Logo" src="../../../assets/img/twitter.svg"></a>
    </div>
    <div class="social_container_facebook">
        <a target="_blank" title="Share on Facebook" href="http://www.facebook.com/sharer/sharer.php?u=#url"><img alt="Facebook Logo" src="../../../assets/img/facebook.png"></a>
    </div>
</div>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="container-fluid">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://baptiste-wicht.com/">
                <span id="blog-title">@Blog("Baptiste Wicht")</span>
            </a>
        </div>
<!-- /.navbar-header -->

        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
<li>
<a href="../../../stories/about.html">About</a>
                </li>
<li>
<a href="../../../stories/publications.html">Publications</a>
                </li>
<li>
<a href="../../../stories/contact.html">Contact</a>
                </li>
<li>
<a href="../../../stories/faq.html">FAQ</a>
                </li>
<li>
<a href="../../../stories/legal.html">Legal</a>
                </li>
<li>
<a href="../../../categories/index.html">Tags</a>
                </li>
<li>
<a href="../../../archive.html">Archives</a>
                </li>
<li>
<a href="http://feeds.feedburner.com/BaptisteWicht">RSS</a>

            </li>
</ul>
<div class="navbar-form pull-left">
                <form action="../../../stories/search.html">
                    <input type="text" name="q" id="tipue_search_input">
</form>
            </div>

            <ul class="nav navbar-nav navbar-right">
<li>
                    <a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
                        <img src="../../../assets/img/twitter.svg" alt="Follow @wichtounet on Twitter"></a>
                </li>
                <li>
                    <a target="_blank" title="Follow +BaptisteWicht on Google+" href="https://plus.google.com/+BaptisteWicht">
                        <img src="../../../assets/img/google_plus.svg" alt="Follow +BaptisteWicht on Google+"></a>
                </li>
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container-fluid -->
</nav><!-- End of Menubar --><div class="body-container">

    <!-- Sidebar -->

    <div class="left-sidebar">
            <div class="left-sidebar-widget">
                <h3>Welcome to my blog</h3>
                <div class="left-sidebar-widget-content">
                    <div class="g-person" data-width="275" data-href="//plus.google.com/u/0/103113673902796202116" data-theme="dark" data-layout="landscape" data-rel="author"></div>
                </div>
            </div>

            <div class="left-sidebar-widget">
                <h3>Related posts</h3>
                <div class="left-sidebar-widget-content">
                    
                    <ol>
<li><a href="osgi-spring-dynamic-modules-hello-world.html">OSGI and Spring Dynamic Modules - Simple Hello World</a></li>
<li><a href="modular-java-book-review.html">Modular Java – Book Review</a></li>
<li><a href="../03/bundle-non-osgi-dependencies-maven.html">Bundle non-OSGi dependencies with Maven</a></li>
<li><a href="../03/osgi-enterprise-4-2-available.html">OSGi 4.2 Entreprise Release is available !</a></li>
<li><a href="../03/jtheque-is-going-to-osgi.html">JTheque is going to OSGi</a></li>
</ol>
</div>
            </div>

        <div class="left-sidebar-widget">
            <h3>Recent comments</h3>
            <div class="left-sidebar-widget-content">
                <div id="recentcomments" class="dsq-widget">
                    <script type="text/javascript" src="http://blogwichtounet.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=0&amp;avatar_size=28&amp;excerpt_length=50"></script>
</div>
            </div>
        </div>

        <div class="left-sidebar-widget">
            <h3>Blogroll</h3>
            <div class="left-sidebar-widget-content">
                <ul>
<li><a target="_blank" href="https://isocpp.org/blog">ISO Standard C++ - Blog</a></li>
                    <li><a target="_blank" href="http://meetingcpp.com/index.php/blog.html">Meeting C++ - Blog</a></li>
                </ul>
</div>
        </div>
    </div>


    <!-- Content -->

    <div class="container">
        <div class="body-content">
            <div class="row">
                
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">OSGi - Simple Hello World with services</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                    Baptiste Wicht
            </span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2010-07-16T07:05:48+02:00" itemprop="datePublished" title="2010-07-16 07:05">2010-07-16 07:05</time></a></p>
                <p class="commentline">
        
    <a href="osgi-hello-world-services.html#disqus_thread" data-disqus-identifier="cache/posts/2010/07/osgi-hello-world-services.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="osgi-hello-world-services.wp" id="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>In this post, we'll develop a simple Hello World application with <strong>OSGi</strong>. We will use <strong>Felix</strong> as <strong>OSGi container</strong>. In the next post, we'll continue with this application and use <strong>Spring Dynamic Modules</strong> to improve it. </p>
<p>To make the development interesting, we will create two bundles :</p>
<ul>
<li>A bundle providing a service of HelloWorld</li>
    <li>A bundle consuming the service to print hello at regular interval time.</li>
</ul>
<!-- TEASER_END --><p>So let's start with the first bundle. What we need first is a very simple service providing a simple print in the console :</p>
<pre class="code literal-block"><span class="kn">package</span> <span class="nn">com.bw.osgi.provider.able</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HelloWorldService</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">hello</span><span class="o">();</span>
<span class="o">}</span>
</pre>


<pre class="code literal-block"><span class="kn">package</span> <span class="nn">com.bw.osgi.provider.impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.bw.osgi.provider.able.HelloWorldService</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorldServiceImpl</span> <span class="kd">implements</span> <span class="n">HelloWorldService</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">hello</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Hello World !"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<p>We cannot make easier. Then, we need to export the Service using an activator : </p>
<pre class="code literal-block"><span class="kn">package</span> <span class="nn">com.bw.osgi.provider</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.osgi.framework.BundleActivator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.framework.BundleContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.framework.ServiceRegistration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.bw.osgi.provider.able.HelloWorldService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.bw.osgi.provider.impl.HelloWorldServiceImpl</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProviderActivator</span> <span class="kd">implements</span> <span class="n">BundleActivator</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">ServiceRegistration</span> <span class="n">registration</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">(</span><span class="n">BundleContext</span> <span class="n">bundleContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">registration</span> <span class="o">=</span> <span class="n">bundleContext</span><span class="o">.</span><span class="na">registerService</span><span class="o">(</span>
                <span class="n">HelloWorldService</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span>
                <span class="k">new</span> <span class="n">HelloWorldServiceImpl</span><span class="o">(),</span>
                <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">(</span><span class="n">BundleContext</span> <span class="n">bundleContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">registration</span><span class="o">.</span><span class="na">unregister</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<p>A lot more code here. For those who aren't confident with OSGi, some explanations. The start method will be called when the module is started and the stop when it's stopped. In the start method, we register our service in the bundle context using the name of the interface as the name of the exported service. The third parameter, null, indicate that we doesn't give any configuration for this service. In the stop method, we just unregister the service. </p>
<p>Now, our first bundle is ready. We can build it. For that we'll use Maven and the maven-bundle-plugin to build the OSGi Bundle directly. Here is the pom.xml file for the project. </p>
<pre class="code literal-block"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>

<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>

    <span class="nt">&lt;groupId&gt;</span>OSGiDmHelloWorldProvider<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>OSGiDmHelloWorldProvider<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.felix<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>org.osgi.core<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.4.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>2.0.2<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;source&gt;</span>1.6<span class="nt">&lt;/source&gt;</span>
                    <span class="nt">&lt;target&gt;</span>1.6<span class="nt">&lt;/target&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>

            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.felix<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-bundle-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;extensions&gt;</span>true<span class="nt">&lt;/extensions&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;instructions&gt;</span>
                        <span class="nt">&lt;Bundle-SymbolicName&gt;</span>OSGiDmHelloWorldProvider<span class="nt">&lt;/Bundle-SymbolicName&gt;</span>
                        <span class="nt">&lt;Export-Package&gt;</span>com.bw.osgi.provider.able<span class="nt">&lt;/Export-Package&gt;</span>
                        <span class="nt">&lt;Bundle-Activator&gt;</span>com.bw.osgi.provider.ProviderActivator<span class="nt">&lt;/Bundle-Activator&gt;</span>
                        <span class="nt">&lt;Bundle-Vendor&gt;</span>Baptiste Wicht<span class="nt">&lt;/Bundle-Vendor&gt;</span>
                    <span class="nt">&lt;/instructions&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span> 
<span class="nt">&lt;/project&gt;</span>
</pre>


<p>And then, use mvn install to build it. </p>
<p>We'll work in a folder called osgi, so we'll copy this new bundle in the osgi folder. </p>
<p>We can already test it in the OSGi container. If you dont' have already Felix, let's download it <a href="http://felix.apache.org/site/downloads.html">here</a>. You have to choose the "Felix Distribution". </p>
<p>Then extract it to the osgi folder we created before. You must now have this folder structure : </p>
<pre>osgi
  - felix 
  - OSGiDmHelloWorldProvider-1.0.jar</pre>

<p>So we can go in the felix folder and launch Felix : </p>
<pre>wichtounet@Linux-Desktop:~/Desktop/osgi/felix$ java -jar bin/felix.jar 
_______________
Welcome to Apache Felix Gogo
g! </pre>

<p>And install our bundle : </p>
<pre>g! install file:../OSGiDmHelloWorldProvider-1.0.jar         
Bundle ID: 5</pre>

<p>The install is good installed, we can try to start it and see its status : </p>
<pre>g! start 5
g! bundle 5
Location             file:../OSGiDmHelloWorldProvider-1.0.jar
State                32
Version              1.0.0
LastModified         1279124741320
Headers              [Tool=Bnd-0.0.357, Bundle-Activator=com.bw.osgi.provider.ProviderActivator, Export-Package=com.bw.osgi.provider.able, Build-Jdk=1.6.0_20, Bundle-Version=1.0.0, Created-By=Apache Maven Bundle Plugin, Bundle-ManifestVersion=2, Manifest-Version=1.0, Bundle-Vendor=Baptiste Wicht, Bnd-LastModified=1279124686551, Bundle-Name=Unnamed - OSGiDmHelloWorldProvider:OSGiDmHelloWorldProvider:bundle:1.0, Built-By=wichtounet, Bundle-SymbolicName=OSGiDmHelloWorldProvider, Import-Package=com.bw.osgi.provider.able,org.osgi.framework;version="1.5"]
BundleContext        org.apache.felix.framework.BundleContextImpl@2353f67e
BundleId             5
SymbolicName         OSGiDmHelloWorldProvider
RegisteredServices   [HelloWorldService]
ServicesInUse        null</pre>

<p>All is fine. Our service is good registered :)</p>
<p>Now we'll try to consume this service in our second bundle. Our consumer class will be very simple : </p>
<pre class="code literal-block"><span class="kn">package</span> <span class="nn">com.bw.osgi.consumer</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.swing.Timer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.event.ActionEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.event.ActionListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.bw.osgi.provider.able.HelloWorldService</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorldConsumer</span> <span class="kd">implements</span> <span class="n">ActionListener</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">HelloWorldService</span> <span class="n">service</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Timer</span> <span class="n">timer</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">HelloWorldConsumer</span><span class="o">(</span><span class="n">HelloWorldService</span> <span class="n">service</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>

        <span class="k">this</span><span class="o">.</span><span class="na">service</span> <span class="o">=</span> <span class="n">service</span><span class="o">;</span>

        <span class="n">timer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Timer</span><span class="o">(</span><span class="mi">1000</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">startTimer</span><span class="o">(){</span>
        <span class="n">timer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stopTimer</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">timer</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">actionPerformed</span><span class="o">(</span><span class="n">ActionEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">service</span><span class="o">.</span><span class="na">hello</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<p>And now, we must create the activator to get the service and then give it to the consumer. That will give use something like this : </p>
<pre class="code literal-block"><span class="kn">package</span> <span class="nn">com.bw.osgi.consumer</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.osgi.framework.BundleActivator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.framework.BundleContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.framework.ServiceReference</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.bw.osgi.provider.able.HelloWorldService</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorldActivator</span> <span class="kd">implements</span> <span class="n">BundleActivator</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">HelloWorldConsumer</span> <span class="n">consumer</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">(</span><span class="n">BundleContext</span> <span class="n">bundleContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">ServiceReference</span> <span class="n">reference</span> <span class="o">=</span> <span class="n">bundleContext</span><span class="o">.</span><span class="na">getServiceReference</span><span class="o">(</span><span class="n">HelloWorldService</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

        <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HelloWorldConsumer</span><span class="o">((</span><span class="n">HelloWorldService</span><span class="o">)</span> <span class="n">bundleContext</span><span class="o">.</span><span class="na">getService</span><span class="o">(</span><span class="n">reference</span><span class="o">));</span>
        <span class="n">consumer</span><span class="o">.</span><span class="na">startTimer</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">(</span><span class="n">BundleContext</span> <span class="n">bundleContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">consumer</span><span class="o">.</span><span class="na">stopTimer</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<p>We get a service reference from the bundle context using the name of the class. After that, we get the service instance from the bundle context. </p>
<p>We create also a little pom.xml file to build the bundle : </p>
<pre class="code literal-block"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>

<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">"http://maven.apache.org/POM/4.0.0"</span>
         <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>OSGiDmHelloWorldConsumer<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>OSGiDmHelloWorldConsumer<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>bundle<span class="nt">&lt;/packaging&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>org.apache.felix<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>org.osgi.core<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.0.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>

        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>OSGiDmHelloWorldProvider<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>OSGiDmHelloWorldProvider<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>2.0.2<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;source&gt;</span>1.6<span class="nt">&lt;/source&gt;</span>
                    <span class="nt">&lt;target&gt;</span>1.6<span class="nt">&lt;/target&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>

            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.felix<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-bundle-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;extensions&gt;</span>true<span class="nt">&lt;/extensions&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;instructions&gt;</span>
                        <span class="nt">&lt;Bundle-SymbolicName&gt;</span>OSGiDmHelloWorldConsumer<span class="nt">&lt;/Bundle-SymbolicName&gt;</span>
                        <span class="nt">&lt;Bundle-Activator&gt;</span>com.bw.osgi.consumer.HelloWorldActivator<span class="nt">&lt;/Bundle-Activator&gt;</span>
                        <span class="nt">&lt;Bundle-Vendor&gt;</span>Baptiste Wicht<span class="nt">&lt;/Bundle-Vendor&gt;</span>
                    <span class="nt">&lt;/instructions&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre>


<p>Then, we use mvn install to create the bundle and we install it in the container : </p>
<pre>g! start 6
g! Hello World !
Hello World !
Hello World !
Hello World !
Hello World !
Hello World !
Hello World !
Hello World !
Hello World !
Hello World !
Hello World !
Hello World !
Hello World !
Hello World !
g! stop 6</pre>

<p>And here we are :) We've created our first application using OSGi. With that technology you can build modules really independant. </p>
<p>In the next post about OSGi, we'll see how to use Spring to make the OSGi development easier and to concentrate our effort on the application not OSGi.  </p>
<p>The sources of the two bundles are available here : </p>
<ul>
<li><a href="../../../wp-content/uploads/2010/07/OSGiDmHelloWorldProvider.tar.gz">OSGiDmHelloWorldProvider sources</a></li>
    <li><a href="../../../wp-content/uploads/2010/07/OSGiDmHelloWorldConsumer.tar.gz">OSGiDmHelloWorldConsumer</a></li>
</ul>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/java.html" rel="tag">Java</a></li>
            <li><a class="tag p-category" href="../../../categories/osgi.html" rel="tag">OSGi</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="state-of-the-lambda.html" rel="prev" title="State of the Lambda">Previous post</a>
            </li>
            <li class="next">
                <a href="play-framework-template-engine.html" rel="next" title="Play Framework - The template engine">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="http://baptiste-wicht.com/posts/2010/07/osgi-hello-world-services.html",
        disqus_title="OSGi - Simple Hello World with services",
        disqus_identifier="cache/posts/2010/07/osgi-hello-world-services.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        </div>
    </div>
</div>

<!-- Footer -->

<footer>
    Contents © 2016         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="../../../assets/img/cc.png"></a>
        <ul class="footer_inline_ul">
<li>
    <a href="osgi-hello-world-services.wp" id="sourcelink">Source</a>
    </li>

        </ul></footer><!-- Late loading stuff  --><script src="../../../assets/js/all-nocdn.js"></script><!-- Google platform JS --><script type="text/javascript" src="https://apis.google.com/js/platform.js"></script><script type="text/javascript" src="../../../assets/js/jquery.tx3-tag-cloud.js"></script>
</body>
</html>
