<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<base href="http://baptiste-wicht.com/posts/2014/05/changing-root-hard-disk-gentoo-lvm-grub2.html">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Changing root hard disk on Gentoo with LVM and Grub2 | @Blog("Baptiste Wicht")</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="http://baptiste-wicht.com/posts/2014/05/changing-root-hard-disk-gentoo-lvm-grub2.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2175227-7']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script><meta name="author" content="Baptiste Wicht">
<link rel="prev" href="ri-vier-rv-2004-rackmount-case-review.html" title="Ri-Vier RV 2004 Rackmount case Review" type="text/html">
<link rel="next" href="budgetwarrior-031-git-versioning-easier-creation.html" title="budgetwarrior 0.3.1 - Git versioning and easier creation" type="text/html">
<meta property="og:site_name" content='@Blog("Baptiste Wicht")'>
<meta property="og:title" content="Changing root hard disk on Gentoo with LVM and Grub2">
<meta property="og:url" content="http://baptiste-wicht.com/posts/2014/05/changing-root-hard-disk-gentoo-lvm-grub2.html">
<meta property="og:description" content="I recently changed my hard disk on one of my servers and I didn't found a simple
and up to date tutorial to do that, so I decided to post here how I did it. 
I do not claim that is the best method, or">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2014-05-06T21:39:57+02:00">
<meta property="article:tag" content="Gentoo">
<meta property="article:tag" content="LVM">
<meta property="article:tag" content="Tips">
<link href="../../../favicon.ico" rel="icon" type="image/x-icon">
</head>
<body>

<!-- Menubar -->

<div class="container-fluid">
<!-- This keeps the margins nice -->
    <div class="row">
        <div class="col-sm-3 col-lg-2">
            <nav class="navbar navbar-inverse navbar-fixed-side"><div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="http://baptiste-wicht.com/">
                        <span id="blog-title">@Blog("Baptiste Wicht")</span>
                    </a>
                </div>
<!-- /.navbar-header -->

                <div class="collapse navbar-collapse navbar-ex1-collapse">
                    <ul class="nav navbar-nav">
<li>
<a href="../../../stories/about.html">About</a>
                </li>
<li>
<a href="../../../stories/publications.html">Publications</a>
                </li>
<li>
<a href="../../../categories/index.html">Tags</a>
                </li>
<li>
<a href="../../../archive.html">Archives</a>
                </li>
<li>
<a href="http://feeds.feedburner.com/BaptisteWicht">RSS</a>



                            </li>
<li class="navbar-content">
                                <h3>Related posts</h3>
                            </li>
                            

                            <li><a href="../../2010/02/hardware-guide-hard-disks.html">Hardware Guide : The Hard Disks</a></li>
<li><a href="../../2013/12/zabbix-low-level-discovery-cores-cpus-hard-disk.html">Zabbix - Low Level Discovery of cores, CPUs and Hard Disk</a></li>
<li><a href="../../2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html">How to speed up RAID (5-6) growing with mdadm ?</a></li>
<li><a href="../../2012/04/switching-gentoo-linux.html">Switching to Gentoo Linux</a></li>
<li><a href="../01/home-server-adventure-step-3.html">Home Server Adventure – Step 3</a></li>


                            <li class="navbar-block">

                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
                                <img src="../../../assets/img/twitter.svg" alt="Follow @wichtounet on Twitter"></a>
                        </li>

                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow +BaptisteWicht on Google+" href="https://plus.google.com/+BaptisteWicht">
                                <img src="../../../assets/img/google_plus.svg" alt="Follow +BaptisteWicht on Google+"></a>
                        </li>


                    </ul>
</div>
<!-- /.navbar-collapse -->
            </nav>
</div> <!-- col -->
        <div class="col-sm-9 col-lg-10">
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Changing root hard disk on Gentoo with LVM and Grub2</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                    Baptiste Wicht
            </span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2014-05-06T21:39:57+02:00" itemprop="datePublished" title="2014-05-06 21:39">2014-05-06 21:39</time></a></p>
                <p class="commentline">
        
    <a href="changing-root-hard-disk-gentoo-lvm-grub2.html#disqus_thread" data-disqus-identifier="cache/posts/2014/05/changing-root-hard-disk-on-gentoo-with-lvm-and-grub2.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="changing-root-hard-disk-gentoo-lvm-grub2.md" id="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>I recently changed my hard disk on one of my servers and I didn't found a simple
and up to date tutorial to do that, so I decided to post here how I did it. </p>
<p>I do not claim that is the best method, or the easiest or the safest method, but
that is the one I used and it worked quite well. You could do it online with LVM, 
but when changing the boot hard disk, I'd rather be safe. Especially because you
need to reinstall Grub on the new hard disk and probably alter its
configuration. But, doing it online directly with LVM should work. </p>
<p>My server is using LVM and Grub2. You will need a Gentoo Live CD (or DVD, or
USB, or any other Linux live installation with the necessary tools). If you do
not use LVM, this guide is not for you. Even if I wrote this guide for Gentoo,
this is also gonna work with another system as long as you use LVM and Grub2,
just use your distribution live cd. </p>
<p>Here I will assume /dev/sda is your old disk and /dev/sdb is your new disk.
I will also assume that you previous VG was vg0. If it is, you'll have to
replace them in the commands. </p>
<p>1. Obviously, shutdown your computer. </p>
<p>2. Install the new hard disk in it. </p>
<p>3. Reboot on the Live CD:</p>
<ul>
<li>Activate LVM: vgchange -a y</li>
<li>Create the LVM partition on the new disk (/dev/sdb) with fdisk. </li>
<li>Create a new PV: pvcreate /dev/sdb1</li>
<li>Create a new VG: vgcreate vg1 /dev/sdb1</li>
<li>Recreate all your LV with lvcreate. In my case, I have /dev/vg0/root and
/dev/vg0/data </li>
</ul>
<p>Now, you'll need to copy your data. Here is an example with my root: </p>
<pre class="code literal-block">mkdir old
mkdir new
mount /dev/vg0/root/ old
mount /dev/vg1/root/ new
cp -ax old/* new
umount old
umount new
</pre>


<p>You have to do that with for LV you have. </p>
<p>4. Shutdown the computer</p>
<p>5. Remove the old hard disk and use the connector of the old hard disk to
connect the new one. </p>
<p>6. Reboot on the Live CD: </p>
<ul>
<li>Activate LVM: vchange -a y</li>
<li>Rename the VG: vgrename vg0 </li>
<li>Chroot in the new hard disk</li>
<li>Install grub on the hard disk: grub2-install /dev/sda</li>
<li>Regenerate the Grub config: grub2-mkconfig -o /boot/grub/grub.cfg</li>
<li>Exit from chroot</li>
</ul>
<p>7. Reboot on Gentoo</p>
<p>8. You now have switched hard disk. </p>
<p>At any point, if something goes wrong, you still have the previous hard disk
completely ready at hand. </p>
<p>I hope this would useful to some Linux users. </p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/gentoo.html" rel="tag">Gentoo</a></li>
            <li><a class="tag p-category" href="../../../categories/lvm.html" rel="tag">LVM</a></li>
            <li><a class="tag p-category" href="../../../categories/tips.html" rel="tag">Tips</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="ri-vier-rv-2004-rackmount-case-review.html" rel="prev" title="Ri-Vier RV 2004 Rackmount case Review">Previous post</a>
            </li>
            <li class="next">
                <a href="budgetwarrior-031-git-versioning-easier-creation.html" rel="next" title="budgetwarrior 0.3.1 - Git versioning and easier creation">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="http://baptiste-wicht.com/posts/2014/05/changing-root-hard-disk-gentoo-lvm-grub2.html",
        disqus_title="Changing root hard disk on Gentoo with LVM and Grub2",
        disqus_identifier="cache/posts/2014/05/changing-root-hard-disk-on-gentoo-with-lvm-and-grub2.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div> <!-- col -->
    </div>
<!-- row  -->
</div>
<!-- container-fluid -->

<!-- End of Menubar -->

<!-- Footer -->

<footer>
    Contents © 2016         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="../../../assets/img/cc.png"></a>
        <ul class="footer_inline_ul">
<li>
    <a href="changing-root-hard-disk-gentoo-lvm-grub2.md" id="sourcelink">Source</a>
    </li>

        </ul></footer><!-- Late loading stuff  --><script src="../../../assets/js/all-nocdn.js"></script>
</body>
</html>
