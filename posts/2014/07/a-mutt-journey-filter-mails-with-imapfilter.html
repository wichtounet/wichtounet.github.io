<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<base href="http://baptiste-wicht.com/posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>A Mutt Journey: Filter mails with imapfilter | @Blog("Baptiste Wicht")</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="http://baptiste-wicht.com/posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2175227-7']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script><meta name="author" content="Baptiste Wicht">
<link rel="prev" href="budgetwarrior-04-enhanced-wish-list-and-aggregate.html" title="budgetwarrior 0.4 - Enhanced wish list and aggregate" type="text/html">
<link rel="next" href="a-mutt-journey-download-mails-with-offlineimap.html" title="A Mutt Journey: Download mails with offlineimap" type="text/html">
<meta property="og:site_name" content='@Blog("Baptiste Wicht")'>
<meta property="og:title" content="A Mutt Journey: Filter mails with imapfilter">
<meta property="og:url" content="http://baptiste-wicht.com/posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html">
<meta property="og:description" content="About a month ago, I decided to switch to Mutt to read my emails. I kept my
GMail account, but I don't use the web interface anymore. It took me a long time
to prepare a complete enviromnent.
Currentl">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2014-07-08T20:58:32+02:00">
<meta property="article:tag" content="Gentoo">
<meta property="article:tag" content="Gmail">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="Mutt">
<link href="../../../favicon.ico" rel="icon" type="image/x-icon">
</head>
<body>

<!-- Menubar -->

<div class="container-fluid">
<!-- This keeps the margins nice -->
    <div class="row">
        <div class="col-sm-3 col-lg-2">
            <nav class="navbar navbar-inverse navbar-fixed-side"><div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="http://baptiste-wicht.com/">
                        <span id="blog-title">@Blog("Baptiste Wicht")</span>
                    </a>
                </div>
<!-- /.navbar-header -->

                <div class="collapse navbar-collapse navbar-ex1-collapse">
                    <ul class="nav navbar-nav">
<li>
                            <div class="g-person" data-width="273px" data-href="//plus.google.com/u/0/103113673902796202116" data-theme="dark" data-layout="landscape" data-rel="author"></div>
                        </li>

                        
                <li>
<a href="../../../stories/about.html">About</a>
                </li>
<li>
<a href="../../../stories/publications.html">Publications</a>
                </li>
<li>
<a href="../../../categories/index.html">Tags</a>
                </li>
<li>
<a href="../../../archive.html">Archives</a>
                </li>
<li>
<a href="http://feeds.feedburner.com/BaptisteWicht">RSS</a>



                            </li>
<li class="navbar-content">
                                <h3>Related posts</h3>
                            </li>
                            

                            <li><a href="a-mutt-journey-download-mails-with-offlineimap.html">A Mutt Journey: Download mails with offlineimap</a></li>
<li><a href="../08/a-mutt-journey-search-mails-with-notmuch.html">A Mutt journey: Search mails with notmuch</a></li>
<li><a href="a-mutt-journey-my-mutt-configuration.html">A Mutt journey: Mutt configuration</a></li>
<li><a href="../../2010/04/drag-and-drop-files-to-gmail.html">Drag and drop files to Gmail</a></li>
<li><a href="../../2012/02/local-optimization-on-three-address-code.html">Local optimization of Three-Address-Code</a></li>


                            <li class="navbar-block">

                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
                                <img src="../../../assets/img/twitter.svg" alt="Follow @wichtounet on Twitter"></a>
                        </li>

                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow +BaptisteWicht on Google+" href="https://plus.google.com/+BaptisteWicht">
                                <img src="../../../assets/img/google_plus.svg" alt="Follow +BaptisteWicht on Google+"></a>
                        </li>


                    </ul>
</div>
<!-- /.navbar-collapse -->
            </nav>
</div> <!-- col -->
        <div class="col-sm-9 col-lg-10">
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">A Mutt Journey: Filter mails with imapfilter</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                    Baptiste Wicht
            </span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2014-07-08T20:58:32+02:00" itemprop="datePublished" title="2014-07-08 20:58">2014-07-08 20:58</time></a></p>
                <p class="commentline">
        
    <a href="a-mutt-journey-filter-mails-with-imapfilter.html#disqus_thread" data-disqus-identifier="cache/posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="a-mutt-journey-filter-mails-with-imapfilter.rst" id="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>About a month ago, I decided to switch to Mutt to read my emails. I kept my
GMail account, but I don't use the web interface anymore. It took me a long time
to prepare a complete enviromnent.</p>
<p>Currently, i'm using:</p>
<ul class="simple">
<li>imapfilter to filter mails</li>
<li>offlineimap to download my mails</li>
<li>notmuch to quickly search all my mails</li>
</ul>
<p>And of course Mutt. To be precise, I use mutt-kz, a fork of mutt with very good
notmuch integration.</p>
<p>I'll try to explain each part of my environment in a series of articles on this
blog. The first one will be about imapfilter.</p>
<p>imapfilter is a mail filtering utility. It connects to a remote server using
IMAP and is then able to move, copy or delete mails around. You can use it for
several tasks:</p>
<ul class="simple">
<li>Delete unwanted mail</li>
<li>Move mails into folders according to rules</li>
</ul>
<p>What is pretty cool is that the configuration is entirely made in Lua. It is
quite easy to write rules and then apply them to several mailboxes as if you
were programming.</p>
<p>Another advantage of imapfilter is that it works at the server level. Therefore,
even if you use your web client from time to time or check your mail on your
phone, the changes will still be viewable.</p>
<p>The configuration is done in the ~/.imapfilter/config.lua file. The
configuration is quite easy, you have to declare an IMAP object as the account.</p>
<pre class="code lua"><a name="rest_code_8747618c9dd040ff931fa28224934102-1"></a><span class="kd">local</span> <span class="n">account</span> <span class="o">=</span> <span class="n">IMAP</span> <span class="p">{</span>
<a name="rest_code_8747618c9dd040ff931fa28224934102-2"></a>    <span class="n">server</span> <span class="o">=</span> <span class="s1">'</span><span class="s">imap_sever'</span><span class="p">,</span>
<a name="rest_code_8747618c9dd040ff931fa28224934102-3"></a>    <span class="n">username</span> <span class="o">=</span> <span class="s1">'</span><span class="s">username'</span><span class="p">,</span>
<a name="rest_code_8747618c9dd040ff931fa28224934102-4"></a>    <span class="n">password</span> <span class="o">=</span> <span class="s1">'</span><span class="s">password'</span><span class="p">,</span>
<a name="rest_code_8747618c9dd040ff931fa28224934102-5"></a>    <span class="n">ssl</span> <span class="o">=</span> <span class="s1">'</span><span class="s">ssl3'</span><span class="p">,</span>
<a name="rest_code_8747618c9dd040ff931fa28224934102-6"></a><span class="p">}</span>
</pre>
<p>As the configuration is in Lua, you can easily get the password from another
file. For instance, here is my account declaration:</p>
<pre class="code lua"><a name="rest_code_de96fe89713d41fcb23d6f05d85dac79-1"></a><span class="kd">local</span> <span class="n">account</span> <span class="o">=</span> <span class="n">IMAP</span> <span class="p">{</span>
<a name="rest_code_de96fe89713d41fcb23d6f05d85dac79-2"></a>    <span class="n">server</span> <span class="o">=</span> <span class="s1">'</span><span class="s">imap.gmail.com'</span><span class="p">,</span>
<a name="rest_code_de96fe89713d41fcb23d6f05d85dac79-3"></a>    <span class="n">username</span> <span class="o">=</span> <span class="s1">'</span><span class="s">baptiste.wicht@gmail.com'</span><span class="p">,</span>
<a name="rest_code_de96fe89713d41fcb23d6f05d85dac79-4"></a>    <span class="n">password</span> <span class="o">=</span> <span class="n">get_imap_password</span><span class="p">(</span><span class="s2">"</span><span class="s">.password.offlineimaprc"</span><span class="p">),</span>
<a name="rest_code_de96fe89713d41fcb23d6f05d85dac79-5"></a>    <span class="n">ssl</span> <span class="o">=</span> <span class="s1">'</span><span class="s">ssl3'</span><span class="p">,</span>
<a name="rest_code_de96fe89713d41fcb23d6f05d85dac79-6"></a><span class="p">}</span>
<a name="rest_code_de96fe89713d41fcb23d6f05d85dac79-7"></a>
<a name="rest_code_de96fe89713d41fcb23d6f05d85dac79-8"></a><span class="c1">-- Utility function to get IMAP password from file</span>
<a name="rest_code_de96fe89713d41fcb23d6f05d85dac79-9"></a><span class="k">function</span> <span class="nf">get_imap_password</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<a name="rest_code_de96fe89713d41fcb23d6f05d85dac79-10"></a>    <span class="kd">local</span> <span class="n">home</span> <span class="o">=</span> <span class="nb">os.getenv</span><span class="p">(</span><span class="s2">"</span><span class="s">HOME"</span><span class="p">)</span>
<a name="rest_code_de96fe89713d41fcb23d6f05d85dac79-11"></a>    <span class="kd">local</span> <span class="n">file</span> <span class="o">=</span> <span class="n">home</span> <span class="o">..</span> <span class="s2">"</span><span class="s">/"</span> <span class="o">..</span> <span class="n">file</span>
<a name="rest_code_de96fe89713d41fcb23d6f05d85dac79-12"></a>    <span class="kd">local</span> <span class="n">str</span> <span class="o">=</span> <span class="nb">io.open</span><span class="p">(</span><span class="n">file</span><span class="p">):</span><span class="n">read</span><span class="p">()</span>
<a name="rest_code_de96fe89713d41fcb23d6f05d85dac79-13"></a>    <span class="k">return</span> <span class="n">str</span><span class="p">;</span>
<a name="rest_code_de96fe89713d41fcb23d6f05d85dac79-14"></a><span class="k">end</span>
</pre>
<p>It gets the password by reading a file in the home directory.</p>
<p>Once, you have the account, you can check the status of a folder with the
check_status() function. For instance:</p>
<pre class="code lua"><a name="rest_code_67e9f454b4e242589ef406f16a3acfa1-1"></a><span class="n">account</span><span class="p">.</span><span class="n">INBOX</span><span class="p">:</span><span class="n">check_status</span><span class="p">()</span>
<a name="rest_code_67e9f454b4e242589ef406f16a3acfa1-2"></a><span class="n">account</span><span class="p">[</span><span class="s1">'</span><span class="s">[Gmail]/Trash'</span><span class="p">]:</span><span class="n">check_status</span><span class="p">()</span>
</pre>
<p>You can run imapfilter simply by launching imapfilter on the command line. Once
imapfilter is run, it will print the status of the folder you choses:</p>
<pre class="literal-block">
38 messages, 0 recent, 6 unseen, in baptiste.wicht@gmail.com@imap.gmail.com/INBOX.
70 messages, 0 recent, 67 unseen, in baptiste.wicht@gmail.com@imap.gmail.com/[Gmail]/Trash.
</pre>
<p>Several functions are important:</p>
<ul class="simple">
<li>select_all() on a folder allows you to get messages from an account to them
perform action on them</li>
<li>contain_subject('subject') on a list of mails allows you to keep only the mails
that contains 'subject' in their subject</li>
<li>contain_from('from') on a list of mails allows you to keep only the mails
that comes from 'from'</li>
<li>contain_to('to') on a list of mails allows you to keep only the mails
that are addressed to 'to'</li>
<li>delete_messages() on a collection of mails deletes all of them</li>
<li>move_messages(folder) on a collection of mails moves all of them to another
folder.</li>
</ul>
<p>You can also mix different IMAP accounts, you don't have to use only one.</p>
<p>For instance, if you would delete all the mail coming from me, you could do:</p>
<pre class="code lua"><a name="rest_code_9522107e49a34c2ba15d43233a510f79-1"></a><span class="n">mails</span> <span class="o">=</span> <span class="n">account</span><span class="p">.</span><span class="n">INBOX</span><span class="p">:</span><span class="n">select_all</span><span class="p">()</span>
<a name="rest_code_9522107e49a34c2ba15d43233a510f79-2"></a><span class="n">filtered</span> <span class="o">=</span> <span class="n">mails</span><span class="p">:</span><span class="n">contains_from</span><span class="p">(</span><span class="s2">"</span><span class="s">baptiste.wicht@gmail.com"</span><span class="p">)</span>
<a name="rest_code_9522107e49a34c2ba15d43233a510f79-3"></a><span class="n">filtered</span><span class="p">:</span><span class="n">delete_messages</span><span class="p">()</span>
</pre>
<p>Or you could move all the mails containing Urgent in the subject line to an IMAP
folder:</p>
<pre class="code lua"><a name="rest_code_814b971c92d14eef9ab84358e0230332-1"></a><span class="n">mails</span> <span class="o">=</span> <span class="n">account</span><span class="p">.</span><span class="n">INBOX</span><span class="p">:</span><span class="n">select_all</span><span class="p">()</span>
<a name="rest_code_814b971c92d14eef9ab84358e0230332-2"></a><span class="n">filtered</span> <span class="o">=</span> <span class="n">mails</span><span class="p">:</span><span class="n">contains_subject</span><span class="p">(</span><span class="s2">"</span><span class="s">Urgent"</span><span class="p">)</span>
<a name="rest_code_814b971c92d14eef9ab84358e0230332-3"></a><span class="n">filtered</span><span class="p">:</span><span class="n">move_messages</span><span class="p">(</span><span class="n">account</span><span class="p">[</span><span class="s2">"</span><span class="s">urgent_mails"</span><span class="p">])</span>
</pre>
<p>If you want some more examples, you can take a look at <a class="reference external" href="https://github.com/wichtounet/dotfiles/blob/master/.imapfilter/config.lua">my imapfilter
configuration</a>.</p>
<p>The best way to start using it is to look at examples, there are plenty of them
in the internet, especially in Github dotfiles repositories.</p>
<p>The reference documentation is available using 'man imapfilter_config', there is
plenty more to see.</p>
<p>For more information, you can also consult the <a class="reference external" href="https://github.com/lefcha/imapfilter">offical site</a>.</p>
<p>That is it for this part of the mutt series. In the next post about mutt, I'll
talk about how I use offlineimap to get my mails.</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/gentoo.html" rel="tag">Gentoo</a></li>
            <li><a class="tag p-category" href="../../../categories/gmail.html" rel="tag">Gmail</a></li>
            <li><a class="tag p-category" href="../../../categories/linux.html" rel="tag">Linux</a></li>
            <li><a class="tag p-category" href="../../../categories/mutt.html" rel="tag">Mutt</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="budgetwarrior-04-enhanced-wish-list-and-aggregate.html" rel="prev" title="budgetwarrior 0.4 - Enhanced wish list and aggregate">Previous post</a>
            </li>
            <li class="next">
                <a href="a-mutt-journey-download-mails-with-offlineimap.html" rel="next" title="A Mutt Journey: Download mails with offlineimap">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="http://baptiste-wicht.com/posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html",
        disqus_title="A Mutt Journey: Filter mails with imapfilter",
        disqus_identifier="cache/posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div> <!-- col -->
    </div>
<!-- row  -->
</div>
<!-- container-fluid -->

<!-- End of Menubar -->

<!-- Footer -->

<footer>
    Contents © 2016         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="../../../assets/img/cc.png"></a>
        <ul class="footer_inline_ul">
<li>
    <a href="a-mutt-journey-filter-mails-with-imapfilter.rst" id="sourcelink">Source</a>
    </li>

        </ul></footer><!-- Late loading stuff  --><script src="../../../assets/js/all-nocdn.js"></script><!-- Google platform JS --><script type="text/javascript" src="https://apis.google.com/js/platform.js"></script>
</body>
</html>
