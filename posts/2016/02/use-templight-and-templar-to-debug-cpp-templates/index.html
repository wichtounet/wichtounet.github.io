<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Use templight and Templar to debug C++ templates | Blog blog("Baptiste Wicht");</title>
<link href="../../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../../rss.xml">
<link rel="canonical" href="https://baptiste-wicht.com/posts/2016/02/use-templight-and-templar-to-debug-cpp-templates/">
<!--[if lt IE 9]><script src="../../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Baptiste Wicht">
<link rel="prev" href="../../01/improve-dll-and-etl-compile-time-further/" title="Improve DLL and ETL Compile Time further" type="text/html">
<link rel="next" href="../../04/simplify-deep-learning-library-usage-on-linux-and-windows/" title="Simplify Deep Learning Library usage on Linux and Windows!" type="text/html">
<meta property="og:site_name" content='Blog blog("Baptiste Wicht");'>
<meta property="og:title" content="Use templight and Templar to debug C++ templates">
<meta property="og:url" content="https://baptiste-wicht.com/posts/2016/02/use-templight-and-templar-to-debug-cpp-templates/">
<meta property="og:description" content="C++ has some very good tools to debug, profile and analyze source files and executables. This all works well for standard runtime program. But, when you are using templates, you sometimes want these t">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2016-02-08T08:11:18+01:00">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="templates">
<meta property="article:tag" content="Tools">
<link href="../../../../favicon.ico" rel="icon" type="image/x-icon">
<link rel="publisher" href="https://plus.google.com/+BaptisteWicht">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-2175227-7', 'auto');
  var metas = document.getElementsByTagName('meta'), tagsList = [];
  for (var i=0; i<metas.length; i++) {
    if (metas[i].getAttribute('property') == 'article:tag') {
      tagsList.push( metas[i].getAttribute('content'));
    }
  }
  ga('set', 'dimension1', tagsList.join('|'));
  ga('send', 'pageview');
</script>
</head>
<body>

<!-- Menubar -->

<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<div class="container-fluid">
<!-- This keeps the margins nice -->
    <div class="row">
        <div class="col-sm-3 col-lg-2">
            <nav class="navbar navbar-inverse navbar-fixed-side"><div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="https://baptiste-wicht.com/">
                        <span id="blog-title">Blog blog("Baptiste Wicht");</span>
                    </a>
                </div>
<!-- /.navbar-header -->

                <div class="collapse navbar-collapse navbar-ex1-collapse">
                    <ul class="nav navbar-nav">
<li>
<a href="../../../../stories/about.html">About</a>
                </li>
<li>
<a href="../../../../stories/publications.html">Publications</a>
                </li>
<li>
<a href="../../../../stories/projects.html">Projects</a>
                </li>
<li>
<a href="../../../../categories/index.html">Tags</a>
                </li>
<li>
<a href="../../../../archive.html">Archives</a>
                </li>
<li>
<a href="http://feeds.feedburner.com/BaptisteWicht">RSS</a>



                            </li>
<li class="navbar-content">
                                <h3>Related posts</h3>
                            </li>
                            

                            <li><a href="../../../2015/03/named-optional-template-parameters-compile-time.html">Named Optional Template parameters to configure a class at compile-time</a></li>
<li><a href="../../../2017/08/simplify-your-type-traits-with-c++14-variable-templates.html">Simplify your type traits with C++14 variable templates</a></li>
<li><a href="../../../2015/07/simulate-static_if-with-c11c14.html">Simulate static_if with C++11/C++14</a></li>
<li><a href="../../../2011/11/cpp-templates-complete-guide-book.html">C++ Templates : The Complete Guide - Book Review</a></li>
<li><a href="../../../2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html">Compile integer Square Roots at compile-time in C++</a></li>
<li><a href="../../../2010/07/play-framework-template-engine.html">Play Framework - The template engine</a></li>


                            <li class="navbar-block">

                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
                                <img src="../../../../assets/img/twitter.png" alt="Follow @wichtounet on Twitter"></a>
                        </li>

                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow +BaptisteWicht on Google+" href="https://plus.google.com/+BaptisteWicht">
                                <img src="../../../../assets/img/google_plus.png" alt="Follow +BaptisteWicht on Google+"></a>
                        </li>


                    </ul>
</div>
<!-- /.navbar-collapse -->
            </nav>
</div> <!-- col -->
        <div class="col-sm-9 col-lg-10">
            <div id="content"></div>
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="." class="u-url">Use templight and Templar to debug C++ templates</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Baptiste Wicht
            </span></p>
            <p class="dateline">
            <a href="." rel="bookmark">
            <time class="published dt-published" datetime="2016-02-08T08:11:18+01:00" itemprop="datePublished" title="2016-02-08 08:11">2016-02-08 08:11</time></a>
            </p>
                <p class="commentline">
    
    <a href="#disqus_thread" data-disqus-identifier="cache/posts/2016/02/use-templight-and-templar-to-debug-cpp-templates.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="index.rst" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>C++ has some very good tools to debug, profile and analyze source files and executables. This all works well for standard runtime program. But, when you are using templates, you sometimes want these tools to act at compile-time. And at this point the support is much more scarce.</p>
<p><a class="reference external" href="https://github.com/mikael-s-persson/templight">templight</a> and <a class="reference external" href="https://github.com/schulmar/Templar">Templar</a> and two tools that are trying to fix this issue.</p>
<p>From the templight site:</p>
<blockquote>
<p>Templight is a Clang-based tool to profile the time and memory consumption of template instantiations and to perform interactive debugging sessions to gain introspection into the template instantiation process.</p>
</blockquote>
<p>and Templar is a visualization tool for the traces generated by templight.</p>
<section id="installation"><h2>Installation</h2>
<p>Unfortunately, the templight installation is not user-friendly at all. You need to clone the complete LLVM/Clang tree and add templight inside it before compiling the complete clang toolchain. But that is the case for all clang-based tools... You also need to patch clang but that may not be necessary in the future. The complete instructions are available <a class="reference external" href="https://github.com/mikael-s-persson/templight#getting-and-compiling-templight">here</a>.</p>
<p>The installation of Templar is much more convenient:</p>
<div class="code"><pre class="code bash"><a id="rest_code_28bbe608b202477e805bd2660c8d260d-1" name="rest_code_28bbe608b202477e805bd2660c8d260d-1" href="#rest_code_28bbe608b202477e805bd2660c8d260d-1"></a>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/schulmar/Templar.git
<a id="rest_code_28bbe608b202477e805bd2660c8d260d-2" name="rest_code_28bbe608b202477e805bd2660c8d260d-2" href="#rest_code_28bbe608b202477e805bd2660c8d260d-2"></a><span class="nb">cd</span><span class="w"> </span>Templar
<a id="rest_code_28bbe608b202477e805bd2660c8d260d-3" name="rest_code_28bbe608b202477e805bd2660c8d260d-3" href="#rest_code_28bbe608b202477e805bd2660c8d260d-3"></a>git<span class="w"> </span>checkout<span class="w"> </span>feature/templight2
<a id="rest_code_28bbe608b202477e805bd2660c8d260d-4" name="rest_code_28bbe608b202477e805bd2660c8d260d-4" href="#rest_code_28bbe608b202477e805bd2660c8d260d-4"></a>qmake<span class="w"> </span>.
<a id="rest_code_28bbe608b202477e805bd2660c8d260d-5" name="rest_code_28bbe608b202477e805bd2660c8d260d-5" href="#rest_code_28bbe608b202477e805bd2660c8d260d-5"></a>make
<a id="rest_code_28bbe608b202477e805bd2660c8d260d-6" name="rest_code_28bbe608b202477e805bd2660c8d260d-6" href="#rest_code_28bbe608b202477e805bd2660c8d260d-6"></a>sudo<span class="w"> </span>make<span class="w"> </span>install
</pre></div>
<p>The branch feature/templight2 has much more features than the master and should support both Qt4 and Qt5, but I have only tested it on Qt4.</p>
</section><section id="example"><h2>Example</h2>
<p>Let's use the class Fibonacci function as an example:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-1" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-1" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-2" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-2" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-2"></a>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-3" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-3" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-3"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">N</span><span class="o">&gt;</span>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-4" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-4" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-4"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Fibonacci</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-5" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-5" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-5"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Fibonacci</span><span class="o">&lt;</span><span class="n">N</span><span class="mi">-1</span><span class="o">&gt;::</span><span class="n">value</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">Fibonacci</span><span class="o">&lt;</span><span class="n">N</span><span class="mi">-2</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-6" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-6" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-6"></a><span class="p">};</span>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-7" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-7" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-7"></a>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-8" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-8" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-8"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;&gt;</span>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-9" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-9" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-9"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Fibonacci</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-10" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-10" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-10"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-11" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-11" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-11"></a><span class="p">};</span>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-12" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-12" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-12"></a>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-13" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-13" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-13"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;&gt;</span>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-14" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-14" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-14"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Fibonacci</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-15" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-15" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-15"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-16" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-16" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-16"></a><span class="p">};</span>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-17" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-17" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-17"></a>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-18" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-18" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-18"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(){</span>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-19" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-19" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-19"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"Fibonacci&lt;5&gt;:"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">Fibonacci</span><span class="o">&lt;</span><span class="mi">5</span><span class="o">&gt;::</span><span class="n">value</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-20" name="rest_code_01d392daf97c4ec39f9af56a6dbd19d9-20" href="#rest_code_01d392daf97c4ec39f9af56a6dbd19d9-20"></a><span class="p">}</span>
</pre></div>
<p>Nothing fancy here, we're simply printing the fifth Fibonacci number on the console.</p>
<p>You can compile it with templight++:</p>
<div class="code"><pre class="code bash"><a id="rest_code_b385a39ea3894995a9f4559e0f7513c3-1" name="rest_code_b385a39ea3894995a9f4559e0f7513c3-1" href="#rest_code_b385a39ea3894995a9f4559e0f7513c3-1"></a>templight++<span class="w"> </span>-Xtemplight<span class="w"> </span>-profiler<span class="w"> </span>-Xtemplight<span class="w"> </span>-memory<span class="w"> </span>-Xtemplight<span class="w"> </span>-ignore-system<span class="w"> </span>-std<span class="o">=</span>c++14<span class="w"> </span>main.cpp
</pre></div>
<p>All the templight options starts with -Xtemplight and then you can use any clang++ options. This will generate a <em>a.memory.trace.pbf</em> file in the current directory. You can then run Templar. use File &gt; Open Trace to open the trace file. This should open a window of this sort:</p>
<img alt="/images/templar.png" class="align-center" src="../../../../images/templar.png"><p>The top-left panel contains the source code of the application, automatically
refreshed whenever you move in the template tree. In the top right, there is
the template instantiation graph. In the bottom left, you'll see a list of list
of files to be able to filter them and in the bottom right, you'll see the list
of templates events. You can sort the list of template events by duration which
is really convenient. You can then select Fibonacci&lt;5&gt; by double clicking it in
the list (once sorted, it should be near the top). This should give you a tree
looking something like that:</p>
<img alt="/images/templar_tree.png" class="align-center" src="../../../../images/templar_tree.png"><p>The edgy nodes are template instantiations and the round nodes are template
memoization. We can directly see that each instantiation was only done once. I
think this graph view is really helpful if you need to debug computation done
at compile time. You can see that that not all nodes are displayed, this is
because there is a limit on the displayed depth. Simply click on Fibonacci&lt;3&gt;
and the remaining nodes will be shown.</p>
<p>I have already used this tool to find the most time-consuming templates in ETL
an DLL. This is a great tool to indicate where you should focus on improving
the template compile-time. I have also been able to find some unnecessary
instantiations that could be avoided (either with SFINAE or with refactorings).</p>
<p>templight also contains a fully-fledged debugger for template programs, but I haven't tested it.</p>
</section><section id="conclusion"><h2>Conclusion</h2>
<p>In conclusion, I would say that templight and Templar are really helping with
template debugging and profiling. There is a real lack of tools in this domain
and I hope to see more tools of this kind in the future. I hope this will help
you develop template-heavy programs or template metaprograms.</p>
</section>
</div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../../categories/c%2B%2B/" rel="tag">C++</a></li>
            <li><a class="tag p-category" href="../../../../categories/templates/" rel="tag">templates</a></li>
            <li><a class="tag p-category" href="../../../../categories/tools/" rel="tag">Tools</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../../01/improve-dll-and-etl-compile-time-further/" rel="prev" title="Improve DLL and ETL Compile Time further">Previous post</a>
            </li>
            <li class="next">
                <a href="../../04/simplify-deep-learning-library-usage-on-linux-and-windows/" rel="next" title="Simplify Deep Learning Library usage on Linux and Windows!">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
    
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="https://baptiste-wicht.com/posts/2016/02/use-templight-and-templar-to-debug-cpp-templates/",
        disqus_title="Use templight and Templar to debug C++ templates",
        disqus_identifier="cache/posts/2016/02/use-templight-and-templar-to-debug-cpp-templates.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div> <!-- col -->
    </div>
<!-- row  -->
</div>
<!-- container-fluid -->

<!-- End of Menubar -->

<!-- Footer -->

<footer>
    Contents © 2023         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         - License: 
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="../../../../assets/img/cc.png"></a>
        <ul class="footer_inline_ul">
<li>
    <a href="index.rst" id="sourcelink">Source</a>
    </li>

        </ul></footer><!-- Late loading stuff  --><script src="../../../../assets/js/all-nocdn.js"></script><!-- Google platform JS -->
</body>
</html>
