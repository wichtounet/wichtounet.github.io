<!DOCTYPE html>
<html lang=en><head><link href=favicon.ico rel=icon type=image/x-icon><meta name=viewport content="width=device-width, initial-scale=1.0"><meta charset=utf-8><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=author content="Baptiste Wicht"><title>Compiler Architecture refinements for eddic | @Blog("Baptiste Wicht")</title><link href=../../../assets/css/all-nocdn.css rel=stylesheet type=text/css><link rel=canonical href=http://baptiste-wicht.com/posts/2012/05/compiler-architecture-refinements-eddic.html><link rel=alternate type=application/rss+xml title=RSS href=../../../rss.xml><script type=text/javascript>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2175227-7']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script></head><body><div class=social_container> <div class=social_container_gplus> <a target=_blank title="Share on Google+" href="https://plusone.google.com/_/+1/confirm?hl=en&amp;url=http://baptiste-wicht.com/posts/2012/05/compiler-architecture-refinements-eddic.html"><img src=../../../assets/img/google_plus.png></a> </div> <div class=social_container_facebook> <a target=_blank title="Share on Facebook" href="http://www.facebook.com/sharer/sharer.php?u=#url"><img src=../../../assets/img/facebook.png></a> </div> <div class=social_container_twitter> <a target=_blank title="Tweet on Twitter" href="http://twitter.com/home?status=#url"><img src=../../../assets/img/twitter.svg></a> </div></div><nav class="navbar navbar-inverse navbar-fixed-top" role=navigation> <div class=container-fluid> <div class=navbar-header> <button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-ex1-collapse> <span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </button> <a class=navbar-brand href=http://baptiste-wicht.com/>@Blog("Baptiste Wicht")</a> </div> <div class="collapse navbar-collapse navbar-ex1-collapse"> <ul class="nav navbar-nav"> <li><a href=../../../stories/about.html>About</a> </li><li><a href=../../../stories/publications.html>Publications</a> </li><li><a href=../../../stories/donate.html>Donate</a> </li><li><a href=../../../stories/contact.html>Contact</a> </li><li><a href=../../../stories/faq.html>FAQ</a> </li><li><a href=../../../stories/legal.html>Legal</a> </li><li><a href=../../../categories/index.html>Tags</a> </li><li><a href=../../../archive.html>Archives</a> </li><li><a href=http://feeds.feedburner.com/BaptisteWicht>RSS</a> </li></ul> <span class="navbar-form pull-left"> <form action=../../../stories/search.html> <input type=text name=q id=tipue_search_input> </form> </span> <ul class="nav navbar-nav navbar-right"> <li> <a target=_blank title="Follow @wichtounet on Twitter" href=https://twitter.com/wichtounet> <img src=../../../assets/img/twitter.svg alt="Follow @wichtounet on Twitter"> </a> </li> <li> <a target=_blank title="Follow +BaptisteWicht on Google+" href=https://plus.google.com/+BaptisteWicht> <img src=../../../assets/img/google_plus.svg alt="Follow +BaptisteWicht on Google+"> </a> </li> </ul> </div> </div></nav><div class=body-container> <div class=left-sidebar> <div class=left-sidebar-widget> <div class=left-sidebar-widget-content> <div class=g-person data-width=275 data-href=//plus.google.com/u/0/103113673902796202116 data-theme=dark data-layout=landscape data-rel=author></div> </div> </div> <div class=left-sidebar-widget> <h3>Related posts</h3> <div class=left-sidebar-widget-content> <ol><li><a href=../03/eddic-0-9-1-enhanced-floating-point-support.html>EDDIC 0.9.1 - Enhanced floating point support</a></li><li><a href=../../2011/11/eddi-compiler-0-6-1.html>EDDI Compiler 0.6.1 : Function return types</a></li><li><a href=../../2011/11/eddic-0-5-1-better-assembly-generation-and-faster-parsing.html>eddic 0.5.1 : Better assembly generation and faster parsing</a></li><li><a href=../01/eddic-0-7-compiler-model-optimizations.html>EDDIC 0.7 : New compilation model and optimizations</a></li><li><a href=../11/eddic-compiler-1-1-4-graph-coloring-register-allocation.html>EDDI Compiler 1.1.4 – Graph Coloring Register Allocation</a></li></ol> </div> </div> <div class=left-sidebar-widget> <h3>Recent comments</h3> <div class=left-sidebar-widget-content> <div id=recentcomments class=dsq-widget> <script type=text/javascript src="http://blogwichtounet.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=0&amp;avatar_size=28&amp;excerpt_length=50"></script> </div> </div> </div> <div class=left-sidebar-widget> <h3>Blogroll</h3> <div class=left-sidebar-widget-content> <ul> <li><a target=_blank href=http://www.asjava.com/>AsJava.com : Java Tutorial</a></li> <li><a target=_blank href=http://www.mkyong.com/>Mkyong : Java Tutorials</a></li> </ul> </div> </div> </div> <div class=container> <div class=body-content> <div class=row> <article class="postbox post-text"> <div class=h-entry itemscope=itemscope itemtype=http://schema.org/Article> <h1 class=p-name itemprop="headline name">Compiler Architecture refinements for eddic</h1> <hr> <small> Posted: <time class="published dt-published" datetime=2012-05-07T09:34:30+02:00 itemprop=datePublished>2012-05-07 09:34</time> | More posts about <span itemprop=keywords> <a class="tag p-category" href=../../../categories/assembly.html><span class="badge badge-info">Assembly</span></a> <a class="tag p-category" href=../../../categories/compilers.html><span class="badge badge-info">Compilers</span></a> <a class="tag p-category" href=../../../categories/eddi.html><span class="badge badge-info">EDDI</span></a> <a class="tag p-category" href=../../../categories/intel.html><span class="badge badge-info">Intel</span></a> <a class="tag p-category" href=../../../categories/linux.html><span class="badge badge-info">Linux</span></a> </span> </small> <hr> <div class=e-content itemprop="articleBody text"> <div><p>The next version of eddic will see an <strong>improved compiler architecture</strong>. There are two new main changes in this version:</p><ol> <li>A better separation between the front end and the back end</li> <li>A new intermediate representation to improve and ease code generation</li></ol><h4>Front end and Back End</h4><p>First, the front and back ends have been clearly separated. The general compiler architecture is currently something like that:</p><p><a href=http://www.baptiste-wicht.com/2012/05/compiler-architecture-refinements-eddic/general-architecture/ rel="attachment wp-att-1973"><img class="aligncenter size-full wp-image-1973" title="EDDI Compiler General Architecture" src=../../../wp-content/uploads/2012/05/general-architecture.svg alt="EDDI Compiler General Architecture"></a></p><p>The first part didn't change, but the Compiler was part was clearly separated between front and back ends:</p><p><a href=http://www.baptiste-wicht.com/2012/05/compiler-architecture-refinements-eddic/compiler-architecture/ rel="attachment wp-att-1976"><img class="aligncenter size-full wp-image-1976" title="EDDI Compiler Architecture" src=../../../wp-content/uploads/2012/05/compiler-architecture.svg alt="EDDI Compiler Architecture"></a></p><p>The backend has no information about the source language. It only sees the intermediate representation provided by the front-end, named: Medium-Level Three Address Code (MTAC).</p><p>There are several advantages to this model. The main one is that it is easy to add support for a new programming language to the compiler. Only the front end needs to be changed. The same can be achieved if a new output is necessary, for example output ARM assembly instead of Intel assembly.</p><h4>New intermediate representation</h4><p>In the previous versions of the compiler, the code generators were fairly complex. Indeed, they had to transform the MTAC intermediate representation directly into assembly. This process involves several things:</p><ul> <li>instruction selection</li> <li>register allocation</li> <li>low-level optimization (replace a mov rax, 0 with xor rax, rax for example)</li> <li>handle basic blocks management</li></ul><p>In this version, I decided to change it to a better architecture. This architecture uses a new intermediate representation: Low-Level Three Address Code (LTAC). As its name states, it is a low-level representation, close to assembly. In this representation there are addresses, registers and abstracted instructions. This representation is platform independent (the differences between 32 and 64 bits are moved to the code generators). There are no more basic blocks here, only functions containing statements.</p><p>The next figure presents the structure of the backend:</p><p><a href=http://www.baptiste-wicht.com/2012/05/compiler-architecture-refinements-eddic/backend-architecture/ rel="attachment wp-att-1977"><img class="aligncenter size-full wp-image-1977" title="EDDI Compiler Backend architecture" src=../../../wp-content/uploads/2012/05/backend-architecture.svg alt="EDDI Compiler Backend architecture"></a></p><p>The compiler is responsible for transforming the MTAC Representation in LTAC Representation. It does not do any low-level optimization. The instruction selection is easier as it is platform independent. The peephole optimizer is responsible for the low-levels optimizations. In the 1.0 release, there would be only few things done at this level. In the future, I will try to invest some time to complete it to generate better assembly code. The optimizations are far simpler than the one done in the MTAC optimization engine. Indeed, a peephole optimizer is generally working only in a small window of instructions, like three or four instructions at a time. And finally, the code generators performs the instruction selection process and address resolving. It also has to translate symbolic registers into physical ones.</p><h4>Conclusion</h4><p>I hope that these refinements in the compiler architecture will allow the compiler to produce better code.</p><p>The 1.0 version of the compiler will include another new features:</p><ul> <li>Basic support for custom structures</li> <li>Global optimizations</li> <li>Some bug fixes found with the new set of unit tests</li></ul><p>As always, feel free to comment on the new architecture, the compiler itself, the project or whatever</p></div> </div> </div> <ul class=pager> <li class=previous> <a href=../04/install-valgrind-on-gentoo-linux.html rel=prev>← Previous post</a> </li> <li class=next> <a href=advanced-compiler-design-and-implementation-book-review.html rel=next>Next post →</a> </li> </ul> <div id=disqus_thread></div> <script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="http://baptiste-wicht.com/posts/2012/05/compiler-architecture-refinements-eddic.html",
        disqus_title="Compiler Architecture refinements for eddic",
        disqus_identifier="cache/posts/2012/05/compiler-architecture-refinements-eddic.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script> <noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript> <a href=http://disqus.com class=dsq-brlink rel=nofollow>Comments powered by <span class=logo-disqus>Disqus</span></a> </article> </div> </div> </div></div><footer> Contents © 2014 <a href=mailto:baptistewicht@gmail.com>Baptiste Wicht</a> - Powered by <a href=http://getnikola.com rel=nofollow>Nikola</a><a rel=license href=http://creativecommons.org/licenses/by/4.0/><img alt="Creative Commons License" style=padding-left:5px;border-width:0 src=../../../assets/img/cc.png></a> <ul class=footer_inline_ul> <li> <a href=compiler-architecture-refinements-eddic.wp id=sourcelink>Source</a> </li> </ul></footer> <script src=../../../assets/js/all-nocdn.js type=text/javascript></script><script type=text/javascript src=https://apis.google.com/js/platform.js></script></body></html>