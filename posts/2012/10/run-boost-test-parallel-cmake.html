<!DOCTYPE html><html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="Baptiste Wicht">
    <title>Run your Boost Tests in parallel with CMake | @Blog("Baptiste Wicht")</title>
    
            <link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
      <link rel="canonical" href="http://wichtounet.github.io/posts/2012/10/run-boost-test-parallel-cmake.html">
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
            <link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">

    





    
</head>
<body>
<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid"><!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://wichtounet.github.io/">@Blog("Baptiste Wicht")</a>
        </div><!-- /.navbar-header -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                
                <li><a href="../../../stories/about.html">About</a>
                </li><li><a href="../../../stories/publications.html">Publications</a>
                </li><li><a href="../../../stories/donate.html">Donate</a>
                </li><li><a href="../../../stories/faq.html">FAQ</a>
                </li><li><a href="../../../stories/legal.html">Legal</a>
                </li><li><a href="../../../archive.html">Archives</a>
                </li><li><a href="../../../categories/index.html">Tags</a>
                </li><li><a href="../../../rss.xml">RSS</a>

            </li></ul>

            <ul class="nav navbar-nav navbar-right">
                
                
                    
    <li>
    <a href="run-boost-test-parallel-cmake.wp" id="sourcelink">Source</a>
    </li>

            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>

<!-- End of Menubar -->

<div class="container">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
    <article class="postbox post-text">
    <div class="h-entry" itemscope="itemscope" itemtype="http://schema.org/Article">
    
    <h1 class="p-name" itemprop="headline name">Run your Boost Tests in parallel with CMake</h1>

    <hr>
    <small>
        Posted: <time class="published dt-published" datetime="2012-10-15T08:57:43+00:00" itemprop="datePublished">2012-10-15 08:57</time>
        

        
          |  
        More posts about 
    <span itemprop="keywords">
        <a class="tag p-category" href="../../../categories/boost.html"><span class="badge badge-info">Boost</span></a>
        <a class="tag p-category" href="../../../categories/c.html"><span class="badge badge-info">C++</span></a>
        <a class="tag p-category" href="../../../categories/cmake.html"><span class="badge badge-info">cmake</span></a>
        <a class="tag p-category" href="../../../categories/concurrency.html"><span class="badge badge-info">Concurrency</span></a>
        <a class="tag p-category" href="../../../categories/eddi.html"><span class="badge badge-info">EDDI</span></a>
        <a class="tag p-category" href="../../../categories/performances.html"><span class="badge badge-info">Performances</span></a>
        <a class="tag p-category" href="../../../categories/tests.html"><span class="badge badge-info">Tests</span></a>
    </span>


    </small>
    <hr>
    <div class="e-content" itemprop="articleBody text">
    <div><p></p><p>I was looking for a Test Library to run eddic tests in parallel to replace Boost Test Library. I posted my question on StackOverflow and an awesome solution has been posted. With CMake and a little CMake additional file, it is possible to run the tests written with Boost Test Library in parallel without changing anything in the tests code !</p>
<p>CTest is the test runner that is shipped with CMake. This runner can run tests in parallel using the -j X option (X is the numbers of threads). However, it can only run the tests that are declared in the CMakeLists.txt file. In my case, this means only one (the executable with Boost Test Library). If you have T tests, a solution would be create T executable files. Then, they can be run in parallel by ctest. However, this is not very practical. The solution proposed in this article is better. </p>
<p></p><h3>Integrate Boost Test Library in CMake</h3>
<p>Ryan Pavlik provides a series of CMake modules in its Github repository. One of this module is named BoostTestTargets. It automatically generates the CTest commands to run all the tests that you have. The small drawback is that you to list all the tests. </p>
<p>To start, you have to download these files: </p>
<ul>
    <li><a href="https://github.com/rpavlik/cmake-modules/raw/master/BoostTestTargets.cmake" title="BoostTestTargets.cmake">BoostTestTargets.cmake</a></li>
    <li><a href="https://github.com/rpavlik/cmake-modules/raw/master/GetForceIncludeDefinitions.cmake" title="GetForceIncludeDefinitions.cmake">GetForceIncludeDefinitions.cmake</a></li>
    <li><a href="https://github.com/rpavlik/cmake-modules/raw/master/CopyResourcesToBuildTree.cmake" title="CopyResourcesToBuildTree.cmake">CopyResourcesToBuildTree.cmake</a></li>
    <li><a href="https://github.com/rpavlik/cmake-modules/blob/master/BoostTestTargetsStatic.h" title="BoostTestTargetsStatic.h">BoostTestTargetsStatic.h</a></li>
    <li><a href="https://github.com/rpavlik/cmake-modules/blob/master/BoostTestTargetsDynamic.h" title="BoostTestTargetsDynamic.h">BoostTestTargetsDynamic.h</a></li>
    <li><a href="https://github.com/rpavlik/cmake-modules/blob/master/BoostTestTargetsIncluded.h" title="BoostTestTargetsIncluded.h">BoostTestTargetsIncluded.h</a></li>
</ul>

<p>These files must be placed next to your CMakeLists.txt file. Then, you have to modify your CMakeLists.txt file to enable testing and enable the new module. For example, if you have two test suites and five tests in each:  </p>
<p>[code]INCLUDE(CTest)</p>
<p>ENABLE_TESTING()</p>
<p>file(
    GLOB_RECURSE
    test_files
    test/*
)</p>
<p>include(BoostTestTargets.cmake)</p>
<p>add_boost_test(eddic_boost_test
    SOURCES ${test_files}
    TESTS 
    TestSuiteA/test_1
    TestSuiteA/test_2
    TestSuiteA/test_3
    TestSuiteA/test_4
    TestSuiteA/test_5
    TestSuiteB/test_1
    TestSuiteB/test_2
    TestSuiteB/test_3
    TestSuiteB/test_4
    TestSuiteB/test_5
    )[/code]</p>
<p>All the test files are searched in the test directory and used in the SOURCES variable. Then all the tests are declared. </p>
<p>The main test file has to include a specific header file:</p>
<p>[cpp]#define BOOST_TEST_MODULE eddic_test_suite</p>
<h2>include &lt;BoostTestTargetConfig.h&gt;[/cpp]</h2>
<p>This file will be automatically detected by BoostTestTargets and configured correctly. And that's it !</p>
<p>You can run CMake again in your build directory to use the new test system: </p>
<p>[bash]cmake .[/bash]</p>
<p>If the configuration has been successful, you will see a message indicating that. For example, I see that: </p>
<p>[bash]-- Test 'eddic_boost_test' uses the CMake-configurable form of the boost test framework - congrats! (Including File: /home/wichtounet/dev/eddi/eddic/test/IntegrationTests.cpp)</p>
<p>-- Configuring done</p>
<p>-- Generating done</p>
<p>-- Build files have been written to: /tmp/ramdrive/dev/eddic[/bash]</p>
<h3>Run tests in parallel</h3>

<p>You can then run your tests in parallel with ctest. For instance, with 9 threads: </p>
<p>[bash]ctest -j 8[/bash]</p>
<p>In my case, my tests are completed 6x faster ! This is very valuable when you often run your tests. </p>
<p>For more information on how to integrate your Boost Test Library tests with CMake, you can consult the <a href="https://github.com/rpavlik/cmake-modules/" title="cmake-modules Github repository">The cmake-modules repository</a>. </p></div>
    </div>
    </div>
    
        <ul class="pager">
            <li class="previous">
                <a href="../09/cmake-compile-latex-documents.html" rel="prev">← Previous post</a>
            </li>
            <li class="next">
                <a href="../11/eddic-compiles-with-clang-3-1.html" rel="next">Next post →</a>
            </li>
        </ul>

        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="nikolademo",
            disqus_url="http://wichtounet.github.io/posts/2012/10/run-boost-test-parallel-cmake.html",
        disqus_title="Run your Boost Tests in parallel with CMake",
        disqus_identifier="cache/posts/2012/10/run-boost-test-parallel-cmake.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


    

    </article>

        </div>
        <!--End of body content-->

        <footer>
            Contents © 2014         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
        </footer>
    </div>
</div>


            <script src="../../../assets/js/all-nocdn.js" type="text/javascript"></script>


    
<!-- Social buttons -->
<div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
<a class="addthis_button_more">Share</a>
<ul><li><a class="addthis_button_facebook"></a>
</li><li><a class="addthis_button_google_plusone_share"></a>
</li><li><a class="addthis_button_linkedin"></a>
</li><li><a class="addthis_button_twitter"></a>
</li></ul>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script>
<!-- End of social buttons -->


    <script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script>
    

</body>
</html>