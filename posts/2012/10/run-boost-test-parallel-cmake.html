<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<base href="http://baptiste-wicht.com/posts/2012/10/run-boost-test-parallel-cmake.html">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Run your Boost Tests in parallel with CMake | Blog blog("Baptiste Wicht");</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="http://baptiste-wicht.com/posts/2012/10/run-boost-test-parallel-cmake.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2175227-7']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script><meta name="author" content="Baptiste Wicht">
<link rel="prev" href="../09/cmake-compile-latex-documents.html" title="Use CMake to easily compiles Latex documents into PDF" type="text/html">
<link rel="next" href="../11/eddic-compiles-with-clang-3-1.html" title="eddic compiles with CLang 3.1" type="text/html">
<meta property="og:site_name" content='Blog blog("Baptiste Wicht");'>
<meta property="og:title" content="Run your Boost Tests in parallel with CMake">
<meta property="og:url" content="http://baptiste-wicht.com/posts/2012/10/run-boost-test-parallel-cmake.html">
<meta property="og:description" content="I was looking for a Test Library to run eddic tests in parallel to replace Boost Test Library. I posted my question on StackOverflow and an awesome solution has been posted. With CMake and a little CM">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2012-10-15T08:57:43+02:00">
<meta property="article:tag" content="Boost">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="cmake">
<meta property="article:tag" content="Concurrency">
<meta property="article:tag" content="EDDI">
<meta property="article:tag" content="Performances">
<meta property="article:tag" content="Tests">
<link href="../../../favicon.ico" rel="icon" type="image/x-icon">
<link rel="publisher" href="https://plus.google.com/+BaptisteWicht">
</head>
<body>

<!-- Menubar -->

<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<div class="container-fluid">
<!-- This keeps the margins nice -->
    <div class="row">
        <div class="col-sm-3 col-lg-2">
            <nav class="navbar navbar-inverse navbar-fixed-side"><div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="http://baptiste-wicht.com/">
                        <span id="blog-title">Blog blog("Baptiste Wicht");</span>
                    </a>
                </div>
<!-- /.navbar-header -->

                <div class="collapse navbar-collapse navbar-ex1-collapse">
                    <ul class="nav navbar-nav">
<li>
<a href="../../../stories/about.html">About</a>
                </li>
<li>
<a href="../../../stories/publications.html">Publications</a>
                </li>
<li>
<a href="../../../stories/projects.html">Projects</a>
                </li>
<li>
<a href="../../../categories/index.html">Tags</a>
                </li>
<li>
<a href="../../../archive.html">Archives</a>
                </li>
<li>
<a href="http://feeds.feedburner.com/BaptisteWicht">RSS</a>



                            </li>
<li class="navbar-content">
                                <h3>Related posts</h3>
                            </li>
                            

                            <li><a href="../12/cmake-rerun-last-failed-tests-ctest.html">CMake Testing - Rerun the last failed tests with CTest</a></li>
<li><a href="../09/cmake-compile-latex-documents.html">Use CMake to easily compiles Latex documents into PDF</a></li>
<li><a href="../../2011/11/boost-1-48-0-has-been-released.html">Boost 1.48.0 has been released </a></li>
<li><a href="../11/cmakelatex-1-0-2-nomenclature-filters.html">CMakeLatex 1.0.2 - Support for nomenclature and better filters</a></li>
<li><a href="../../2014/07/catch-powerful-yet-simple-cpp-test-framework.html">Catch: A powerful yet simple C++ test framework</a></li>
<li><a href="../../2014/04/install-use-clang-static-analyzer-cmake.html">Install and Use CLang Static Analyzer on a CMake project</a></li>


                            <li class="navbar-block">

                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
                                <img src="../../../assets/img/twitter.png" alt="Follow @wichtounet on Twitter"></a>
                        </li>

                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow +BaptisteWicht on Google+" href="https://plus.google.com/+BaptisteWicht">
                                <img src="../../../assets/img/google_plus.png" alt="Follow +BaptisteWicht on Google+"></a>
                        </li>


                    </ul>
</div>
<!-- /.navbar-collapse -->
            </nav>
</div> <!-- col -->
        <div class="col-sm-9 col-lg-10">
            <div id="content"></div>
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Run your Boost Tests in parallel with CMake</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                    Baptiste Wicht
            </span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2012-10-15T08:57:43+02:00" itemprop="datePublished" title="2012-10-15 08:57">2012-10-15 08:57</time></a></p>
                <p class="commentline">
        
    <a href="run-boost-test-parallel-cmake.html#disqus_thread" data-disqus-identifier="cache/posts/2012/10/run-boost-test-parallel-cmake.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="run-boost-test-parallel-cmake.wp" id="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>I was looking for a Test Library to run eddic tests in parallel to replace Boost Test Library. I posted my question on StackOverflow and an awesome solution has been posted. With CMake and a little CMake additional file, it is possible to run the tests written with Boost Test Library in parallel without changing anything in the tests code !</p>
<p>CTest is the test runner that is shipped with CMake. This runner can run tests in parallel using the -j X option (X is the numbers of threads). However, it can only run the tests that are declared in the CMakeLists.txt file. In my case, this means only one (the executable with Boost Test Library). If you have T tests, a solution would be create T executable files. Then, they can be run in parallel by ctest. However, this is not very practical. The solution proposed in this article is better. </p>
<h3>Integrate Boost Test Library in CMake</h3>

<p>Ryan Pavlik provides a series of CMake modules in its Github repository. One of this module is named BoostTestTargets. It automatically generates the CTest commands to run all the tests that you have. The small drawback is that you to list all the tests. </p>
<p>To start, you have to download these files: </p>
<ul>
<li><a href="https://github.com/rpavlik/cmake-modules/raw/master/BoostTestTargets.cmake" title="BoostTestTargets.cmake">BoostTestTargets.cmake</a></li>
    <li><a href="https://github.com/rpavlik/cmake-modules/raw/master/GetForceIncludeDefinitions.cmake" title="GetForceIncludeDefinitions.cmake">GetForceIncludeDefinitions.cmake</a></li>
    <li><a href="https://github.com/rpavlik/cmake-modules/raw/master/CopyResourcesToBuildTree.cmake" title="CopyResourcesToBuildTree.cmake">CopyResourcesToBuildTree.cmake</a></li>
    <li><a href="https://github.com/rpavlik/cmake-modules/blob/master/BoostTestTargetsStatic.h" title="BoostTestTargetsStatic.h">BoostTestTargetsStatic.h</a></li>
    <li><a href="https://github.com/rpavlik/cmake-modules/blob/master/BoostTestTargetsDynamic.h" title="BoostTestTargetsDynamic.h">BoostTestTargetsDynamic.h</a></li>
    <li><a href="https://github.com/rpavlik/cmake-modules/blob/master/BoostTestTargetsIncluded.h" title="BoostTestTargetsIncluded.h">BoostTestTargetsIncluded.h</a></li>
</ul>
<p>These files must be placed next to your CMakeLists.txt file. Then, you have to modify your CMakeLists.txt file to enable testing and enable the new module. For example, if you have two test suites and five tests in each:  </p>
<pre class="code literal-block"><span class="nb">INCLUDE</span><span class="p">(</span><span class="s">CTest</span><span class="p">)</span>

<span class="nb">ENABLE_TESTING</span><span class="p">()</span>

<span class="nb">file</span><span class="p">(</span>
    <span class="s">GLOB_RECURSE</span>
    <span class="s">test_files</span>
    <span class="s">test/*</span>
<span class="p">)</span>

<span class="nb">include</span><span class="p">(</span><span class="s">BoostTestTargets.cmake</span><span class="p">)</span>

<span class="nb">add_boost_test</span><span class="p">(</span><span class="s">eddic_boost_test</span>
    <span class="s">SOURCES</span> <span class="o">${</span><span class="nv">test_files</span><span class="o">}</span>
    <span class="s">TESTS</span> 
    <span class="s">TestSuiteA/test_1</span>
    <span class="s">TestSuiteA/test_2</span>
    <span class="s">TestSuiteA/test_3</span>
    <span class="s">TestSuiteA/test_4</span>
    <span class="s">TestSuiteA/test_5</span>
    <span class="s">TestSuiteB/test_1</span>
    <span class="s">TestSuiteB/test_2</span>
    <span class="s">TestSuiteB/test_3</span>
    <span class="s">TestSuiteB/test_4</span>
    <span class="s">TestSuiteB/test_5</span>
    <span class="p">)</span>
</pre>


<p>All the test files are searched in the test directory and used in the SOURCES variable. Then all the tests are declared. </p>
<p>The main test file has to include a specific header file:</p>
<pre class="code literal-block"><span class="cp">#define BOOST_TEST_MODULE eddic_test_suite</span>
<span class="cp">#include</span> <span class="cpf">&lt;BoostTestTargetConfig.h&gt;</span><span class="cp"></span>
</pre>


<p>This file will be automatically detected by BoostTestTargets and configured correctly. And that's it !</p>
<p>You can run CMake again in your build directory to use the new test system: </p>
<p>[bash]cmake .[/bash]</p>
<p>If the configuration has been successful, you will see a message indicating that. For example, I see that: </p>
<pre>-- Test 'eddic_boost_test' uses the CMake-configurable form of the boost test framework - congrats! (Including File: /home/wichtounet/dev/eddi/eddic/test/IntegrationTests.cpp)
-- Configuring done
-- Generating done
-- Build files have been written to: /tmp/ramdrive/dev/eddic</pre>

<h3>Run tests in parallel</h3>

<p>You can then run your tests in parallel with ctest. For instance, with 9 threads: </p>
<pre>ctest -j 8</pre>

<p>In my case, my tests are completed 6x faster ! This is very valuable when you often run your tests. </p>
<p>For more information on how to integrate your Boost Test Library tests with CMake, you can consult the <a href="https://github.com/rpavlik/cmake-modules/" title="cmake-modules Github repository">The cmake-modules repository</a></p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/boost.html" rel="tag">Boost</a></li>
            <li><a class="tag p-category" href="../../../categories/c%2B%2B.html" rel="tag">C++</a></li>
            <li><a class="tag p-category" href="../../../categories/cmake.html" rel="tag">cmake</a></li>
            <li><a class="tag p-category" href="../../../categories/concurrency.html" rel="tag">Concurrency</a></li>
            <li><a class="tag p-category" href="../../../categories/eddi.html" rel="tag">EDDI</a></li>
            <li><a class="tag p-category" href="../../../categories/performances.html" rel="tag">Performances</a></li>
            <li><a class="tag p-category" href="../../../categories/tests.html" rel="tag">Tests</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="../09/cmake-compile-latex-documents.html" rel="prev" title="Use CMake to easily compiles Latex documents into PDF">Previous post</a>
            </li>
            <li class="next">
                <a href="../11/eddic-compiles-with-clang-3-1.html" rel="next" title="eddic compiles with CLang 3.1">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="http://baptiste-wicht.com/posts/2012/10/run-boost-test-parallel-cmake.html",
        disqus_title="Run your Boost Tests in parallel with CMake",
        disqus_identifier="cache/posts/2012/10/run-boost-test-parallel-cmake.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div> <!-- col -->
    </div>
<!-- row  -->
</div>
<!-- container-fluid -->

<!-- End of Menubar -->

<!-- Footer -->

<footer>
    Contents © 2017         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         - License: 
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="../../../assets/img/cc.png"></a>
        <ul class="footer_inline_ul">
<li>
    <a href="run-boost-test-parallel-cmake.wp" id="sourcelink">Source</a>
    </li>

        </ul></footer><!-- Late loading stuff  --><script src="../../../assets/js/all-nocdn.js"></script><!-- Google platform JS -->
</body>
</html>
