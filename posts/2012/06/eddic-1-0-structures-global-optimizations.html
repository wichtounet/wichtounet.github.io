<!DOCTYPE html>
<html lang=en><head><link href=favicon.ico rel=icon type=image/x-icon><meta name=viewport content="width=device-width, initial-scale=1.0"><meta charset=utf-8><meta name=viewport content="width=device-width, initial-scale=1.0"><meta name=author content="Baptiste Wicht"><title>EDDI Compiler 1.0 - Structures and Global Optimizations | @Blog("Baptiste Wicht")</title><link href=../../../assets/css/all-nocdn.css rel=stylesheet type=text/css><link rel=canonical href=http://wichtounet.github.io/posts/2012/06/eddic-1-0-structures-global-optimizations.html><link rel=alternate type=application/rss+xml title=RSS href=../../../rss.xml><script type=text/javascript>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2175227-7']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script></head><body><div class=social_container> <div class=social_container_gplus> <a target=_blank title="Share on Google+" href="https://plusone.google.com/_/+1/confirm?hl=en&amp;url=http://wichtounet.github.io/posts/2012/06/eddic-1-0-structures-global-optimizations.html"><img src=../../../assets/img/google_plus.png></a> </div> <div class=social_container_facebook> <a target=_blank title="Share on Facebook" href="http://www.facebook.com/sharer/sharer.php?u=#url"><img src=../../../assets/img/facebook.png></a> </div> <div class=social_container_twitter> <a target=_blank title="Tweet on Twitter" href="http://twitter.com/home?status=#url"><img src=../../../assets/img/twitter.svg></a> </div></div><nav class="navbar navbar-inverse navbar-fixed-top" role=navigation> <div class=container-fluid> <div class=navbar-header> <button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-ex1-collapse> <span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </button> <a class=navbar-brand href=http://wichtounet.github.io/>@Blog("Baptiste Wicht")</a> </div> <div class="collapse navbar-collapse navbar-ex1-collapse"> <ul class="nav navbar-nav"> <li><a href=../../../stories/about.html>About</a> </li><li><a href=../../../stories/publications.html>Publications</a> </li><li><a href=../../../stories/donate.html>Donate</a> </li><li><a href=../../../stories/contact.html>Contact</a> </li><li><a href=../../../stories/faq.html>FAQ</a> </li><li><a href=../../../stories/legal.html>Legal</a> </li><li><a href=../../../categories/index.html>Tags</a> </li><li><a href=../../../archive.html>Archives</a> </li><li><a href=http://feeds.feedburner.com/BaptisteWicht>RSS</a> </li></ul> <span class="navbar-form pull-left"> <form action=../../../stories/search.html> <input type=text name=q id=tipue_search_input> </form> </span> <ul class="nav navbar-nav navbar-right"> <li> <a target=_blank title="Follow @wichtounet on Twitter" href=https://twitter.com/wichtounewichtounet> <img src=../../../assets/img/twitter.svg alt="Follow @wichtounet on Twitter"> </a> </li> <li> <a target=_blank title="Follow +BaptisteWicht on Google+" href=https://plus.google.com/+BaptisteWicht> <img src=../../../assets/img/google_plus.svg alt="Follow +BaptisteWicht on Google+"> </a> </li> </ul> </div> </div></nav><div class=body-container> <div class=left-sidebar> <div class=left-sidebar-widget> <div class=left-sidebar-widget-content> <div class=g-person data-width=275 data-href=//plus.google.com/u/0/103113673902796202116 data-theme=dark data-layout=landscape data-rel=author></div> </div> </div> <div class=left-sidebar-widget> <h3>Related posts</h3> <div class=left-sidebar-widget-content> <ol><li><a href=eddi-compiler-1-0-1-pointers-better-struct-support.html>EDDI Compiler 1.0.1 - Pointers and better struct support</a></li><li><a href=../07/eddi-compiler-1-0-3-inlining-register-allocation.html>EDDI Compiler 1.0.3 - Inlining and register allocation</a></li><li><a href=../07/eddi-compiler-1-0-2-better-pointer-support-new-optimizations.html>EDDI Compiler 1.0.2 – Better pointer support and Dead-Code Elimination</a></li><li><a href=../02/eddic-0-8-1-do-while-loop-and-better-optimization.html>EDDIC 0.8.1 : do while loop and better optimization </a></li><li><a href=../11/eddic-compiler-1-1-4-graph-coloring-register-allocation.html>EDDI Compiler 1.1.4 – Graph Coloring Register Allocation</a></li></ol> </div> </div> <div class=left-sidebar-widget> <h3>Recent comments</h3> <div class=left-sidebar-widget-content> <div id=recentcomments class=dsq-widget> <script type=text/javascript src="http://blogwichtounet.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=0&amp;avatar_size=28&amp;excerpt_length=50"></script> </div> </div> </div> <div class=left-sidebar-widget> <h3>Blogroll</h3> <div class=left-sidebar-widget-content> <ul> <li><a target=_blank href=http://www.asjava.com/>AsJava.com : Java Tutorial</a></li> <li><a target=_blank href=http://www.mkyong.com/>Mkyong : Java Tutorials</a></li> </ul> </div> </div> </div> <div class=container> <div class=body-content> <div class=row> <article class="postbox post-text"> <div class=h-entry itemscope=itemscope itemtype=http://schema.org/Article> <h1 class=p-name itemprop="headline name">EDDI Compiler 1.0 - Structures and Global Optimizations</h1> <hr> <small> Posted: <time class="published dt-published" datetime=2012-06-04T08:32:46+02:00 itemprop=datePublished>2012-06-04 08:32</time>   |   More posts about <span itemprop=keywords> <a class="tag p-category" href=../../../categories/c.html><span class="badge badge-info">C++</span></a> <a class="tag p-category" href=../../../categories/compilers.html><span class="badge badge-info">Compilers</span></a> <a class="tag p-category" href=../../../categories/eddi.html><span class="badge badge-info">EDDI</span></a> <a class="tag p-category" href=../../../categories/optimization.html><span class="badge badge-info">Optimization</span></a> </span> </small> <hr> <div class=e-content itemprop="articleBody text"> <div><p>I've the pleasure to announce the availability of <strong>version 1.0</strong> of the <strong>EDDI Compiler</strong> (eddic). </p><p>This release adds one big enhancement to the language: <strong>Structures</strong></p><p>Structures are used like in the C programming language: </p><div class=code><pre><span class=k>struct</span> <span class=n>Complex</span> <span class=p>{</span>
    <span class=kt>int</span> <span class=n>imag</span><span class=p>;</span>
    <span class=kt>int</span> <span class=n>real</span><span class=p>;</span>
<span class=p>}</span>

<span class=kt>void</span> <span class=n>main</span><span class=p>(){</span>
    <span class=n>Complex</span> <span class=n>c</span><span class=p>;</span>
    <span class=n>c</span><span class=p>.</span><span class=n>imag</span> <span class=o>=</span> <span class=mi>222</span><span class=p>;</span>
    <span class=n>c</span><span class=p>.</span><span class=n>real</span> <span class=o>=</span> <span class=mi>666</span><span class=p>;</span>

    <span class=n>println</span><span class=p>(</span><span class=n>c</span><span class=p>.</span><span class=n>imag</span><span class=p>);</span>
    <span class=n>println</span><span class=p>(</span><span class=n>c</span><span class=p>.</span><span class=n>real</span><span class=p>);</span>

    <span class=n>c</span><span class=p>.</span><span class=n>imag</span> <span class=o>+=</span> <span class=mi>111</span><span class=p>;</span>
    <span class=n>c</span><span class=p>.</span><span class=n>real</span> <span class=o>+=</span> <span class=mi>222</span><span class=p>;</span>

    <span class=n>println</span><span class=p>(</span><span class=n>c</span><span class=p>.</span><span class=n>imag</span><span class=p>);</span>
    <span class=n>println</span><span class=p>(</span><span class=n>c</span><span class=p>.</span><span class=n>real</span><span class=p>);</span>

    <span class=n>test</span><span class=p>(</span><span class=n>c</span><span class=p>);</span>

    <span class=k>if</span><span class=p>(</span><span class=n>c</span><span class=p>.</span><span class=n>b</span><span class=p>){</span>
        <span class=n>println</span><span class=p>(</span><span class=n>c</span><span class=p>.</span><span class=n>imag</span><span class=p>);</span>
    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
        <span class=n>println</span><span class=p>(</span><span class=n>c</span><span class=p>.</span><span class=n>real</span><span class=p>);</span>
    <span class=p>}</span>
<span class=p>}</span>

<span class=kt>void</span> <span class=n>test</span><span class=p>(</span><span class=n>Complex</span> <span class=n>a</span><span class=p>){</span>
    <span class=n>println</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>imag</span><span class=p>);</span>
    <span class=n>println</span><span class=p>(</span><span class=n>a</span><span class=p>.</span><span class=n>real</span><span class=p>);</span>
<span class=p>}</span>
</pre></div><p>For now on, you can declare structures, use local variables of the struct type and pass them as parameter. But the usage of structure is still limited, there are no way to return a structure from a function and no way to pass a structure by reference. Another limitation is that a member of struct cannot be of a struct type. At least, the last limitation will be addressed in the next version of eddic. </p><p>Another main change is the use of a new low-level Intermediate Representation (LTAC). This change is describe more in details in <a href=http://www.baptiste-wicht.com/2012/05/compiler-architecture-refinements-eddic/ title="Compiler Architecture refinements for eddic" target=_blank>this article</a>. </p><p>The main other change is the use of a data-flow framework for global optimization in the optimization engine. An optimization is global if it takes into account all the basic blocks of the function being optimized. For that, it takes a Control-Flow graph of the function and follow the logical flow of the function to determine what can be optimized. Two old optimization have been transformed from local to global: Constant Propagation and Copy Propagation. They have also been merged for being more efficient, so they are done both in one pass of the flow. I also implemented a new technique: Common Subexpression Elimination. This optimization make sure that no computation is made when the result is still available. The control flow graph is handled with the <em>Boost Graph Library</em>. </p><p>I also fixed a performance issue on the Optimization Engine. Before, the optimization were done for the whole program and if one optimization was successful, all the optimization techniques were tried again on the whole program. Now, there are made one function at a time and restarted only for this function. It should prove faster on problem with a lot of functions. </p><p>In the side of the assembly generation, I changed the way the floats constants are handled. Before, a general purpose register was used to load the constant and then load it in the SSE register. To avoid having to use a GP Register, I used a constant float pool and loaded the float directly from memory to the SSE Register. </p><p>On the compiler side, I added several new unit test and fixed the old tests. They were lots of bugs in the tests itself that made that they were not working at all. The test suite is now much more robust and showed me lots of other bugs. </p><p>I removed the dependency to <em>Boost Chrono</em> by relying on the new std::chrono library. </p><h4>Future work</h4><p>The next version will be the <strong>1.0.1 version</strong>. There will be several changes with this version. </p><p>I will improve the support of structures. I will add the support for struct inside structs and perhaps passing struct by reference (which would also means adding supports for references for other types as well). </p><p>I will also make more improvements to the optimization engine. I will add at least one new data-flow optimization and I will try to make the optimization pass faster. </p><p>Finally, as ever, I will certainly make some refactorings on some parts of the Compiler, but it starts looking good. </p><h4>Download</h4><p>You can find the compiler sources on the Github repository: <a title="eddic on GitHub" href=https://github.com/wichtounet/eddic>https://github.com/wichtounet/eddic</a></p><p>The exact version I refer to is the v1.0 available in the GitHub tags or directly as the release branch.</p></div> </div> </div> <ul class=pager> <li class=previous> <a href=../05/advanced-compiler-design-and-implementation-book-review.html rel=prev>← Previous post</a> </li> <li class=next> <a href=the-site-now-running-wordpress-3-4.html rel=next>Next post →</a> </li> </ul> <div id=disqus_thread></div> <script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="http://wichtounet.github.io/posts/2012/06/eddic-1-0-structures-global-optimizations.html",
        disqus_title="EDDI Compiler 1.0 - Structures and Global Optimizations",
        disqus_identifier="cache/posts/2012/06/eddic-1-0-structures-global-optimizations.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script> <noscript>Please enable JavaScript to view the <a href=http://disqus.com/?ref_noscript rel=nofollow>comments powered by Disqus.</a></noscript> <a href=http://disqus.com class=dsq-brlink rel=nofollow>Comments powered by <span class=logo-disqus>Disqus</span></a> </article> </div> </div> </div></div><footer> Contents © 2014 <a href=mailto:baptistewicht@gmail.com>Baptiste Wicht</a> - Powered by <a href=http://getnikola.com rel=nofollow>Nikola</a><a rel=license href=http://creativecommons.org/licenses/by/4.0/><img alt="Creative Commons License" style=padding-left:5px;border-width:0 src=../../../assets/img/cc.png></a> <ul class=footer_inline_ul> <li> <a href=eddic-1-0-structures-global-optimizations.wp id=sourcelink>Source</a> </li> </ul></footer> <script src=../../../assets/js/all-nocdn.js type=text/javascript></script><script type=text/javascript src=https://apis.google.com/js/platform.js></script></body></html>