<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Long Short Term Memory (LSTM) are now supported in Deep Learning Library (DLL)">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Initial support for Long Short Term Memory (LSTM) in DLL | Blog blog("Baptiste Wicht");</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="https://baptiste-wicht.com/posts/2017/11/initial-support-for-long-short-term-memory-lstm-in-dll.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Baptiste Wicht">
<link rel="prev" href="dll-pretty-printing-and-live-output.html" title="DLL: Pretty printing and live output" type="text/html">
<link rel="next" href="advanced-gpu-patterns-optimization-in-etl.html" title="Advanced GPU Patterns Optimization in ETL" type="text/html">
<meta property="og:site_name" content='Blog blog("Baptiste Wicht");'>
<meta property="og:title" content="Initial support for Long Short Term Memory (LSTM) in DLL">
<meta property="og:url" content="https://baptiste-wicht.com/posts/2017/11/initial-support-for-long-short-term-memory-lstm-in-dll.html">
<meta property="og:description" content="Long Short Term Memory (LSTM) are now supported in Deep Learning Library (DLL)">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-11-24T15:16:37+01:00">
<meta property="article:tag" content="Deep Learning">
<meta property="article:tag" content="dll">
<meta property="article:tag" content="Machine Learning">
<meta property="article:tag" content="projects">
<meta property="article:tag" content="rnn">
<link href="../../../favicon.ico" rel="icon" type="image/x-icon">
<link rel="publisher" href="https://plus.google.com/+BaptisteWicht">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-2175227-7', 'auto');
  var metas = document.getElementsByTagName('meta'), tagsList = [];
  for (var i=0; i<metas.length; i++) {
    if (metas[i].getAttribute('property') == 'article:tag') {
      tagsList.push( metas[i].getAttribute('content'));
    }
  }
  ga('set', 'dimension1', tagsList.join('|'));
  ga('send', 'pageview');
</script>
</head>
<body>

<!-- Menubar -->

<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<div class="container-fluid">
<!-- This keeps the margins nice -->
    <div class="row">
        <div class="col-sm-3 col-lg-2">
            <nav class="navbar navbar-inverse navbar-fixed-side"><div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="https://baptiste-wicht.com/">
                        <span id="blog-title">Blog blog("Baptiste Wicht");</span>
                    </a>
                </div>
<!-- /.navbar-header -->

                <div class="collapse navbar-collapse navbar-ex1-collapse">
                    <ul class="nav navbar-nav">
<li>
<a href="../../../stories/about.html">About</a>
                </li>
<li>
<a href="../../../stories/publications.html">Publications</a>
                </li>
<li>
<a href="../../../stories/projects.html">Projects</a>
                </li>
<li>
<a href="../../../categories/index.html">Tags</a>
                </li>
<li>
<a href="../../../archive.html">Archives</a>
                </li>
<li>
<a href="http://feeds.feedburner.com/BaptisteWicht">RSS</a>



                            </li>
<li class="navbar-content">
                                <h3>Related posts</h3>
                            </li>
                            

                            <li><a href="dll-pretty-printing-and-live-output.html">DLL: Pretty printing and live output</a></li>
<li><a href="initial-support-for-recurrent-neural-network-rnn-in-dll.html">Initial support for Recurrent Neural Network (RNN) in DLL</a></li>
<li><a href="../10/deep-learning-library-10-fast-neural-network-library.html">Deep Learning Library 1.0 - Fast Neural Network Library</a></li>
<li><a href="../07/update-on-deep-learning-library-dll-dropout-batch-normalization-adaptive-learning-rates.html">Update on Deep Learning Library (DLL): Dropout, Batch Normalization, Adaptive Learning Rates, ...</a></li>
<li><a href="../08/compiler-benchmark-gcc-clang-cpp-library-etl.html">Compiler benchmark GCC and Clang on C++ library (ETL)</a></li>
<li><a href="../03/partial-type-erasing-deep-learning-library-dll-improve-compilation-time.html">Partial type erasing in Deep Learning Library (DLL) to improve compilation time</a></li>


                            <li class="navbar-block">

                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
                                <img src="../../../assets/img/twitter.png" alt="Follow @wichtounet on Twitter"></a>
                        </li>

                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow +BaptisteWicht on Google+" href="https://plus.google.com/+BaptisteWicht">
                                <img src="../../../assets/img/google_plus.png" alt="Follow +BaptisteWicht on Google+"></a>
                        </li>


                    </ul>
</div>
<!-- /.navbar-collapse -->
            </nav>
</div> <!-- col -->
        <div class="col-sm-9 col-lg-10">
            <div id="content"></div>
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Initial support for Long Short Term Memory (LSTM) in DLL</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    Baptiste Wicht
            </span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2017-11-24T15:16:37+01:00" itemprop="datePublished" title="2017-11-24 15:16">2017-11-24 15:16</time></a></p>
                <p class="commentline">
        
    <a href="initial-support-for-long-short-term-memory-lstm-in-dll.html#disqus_thread" data-disqus-identifier="cache/posts/2017/11/initial-support-for-long-short-term-memory-lstm-in-dll.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="initial-support-for-long-short-term-memory-lstm-in-dll.rst" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>I'm really happy to announce that I just merged support for</p>
<p>Long Short Term Memory
(LSTM) cells into my Deep Learning Library (DLL) machine learning framework. Two
weeks ago, <a class="reference external" href="https://baptiste-wicht.com/posts/2017/11/initial-support-for-recurrent-neural-network-rnn-in-dll.html">I already merged suport for Recurrent Neural network (RNN)</a>.</p>
<p>It's nothing fancy yet, but forward propagation of LSTM and basic
Backpropagation Through Time (BPTT) are now supported. It was not really
complicated to implemenet the forward pass but the backward pass is much
complicated for an LSTM than for a RNN. It took me quite a long time to figure
out all the gradients formulas and the documentation on that is quite scarce.</p>
<p>For now, still only existing classification loss is supported for RNN and LSTM.
As I said last time, I still plan to add support for sequence-to-sequence loss
in order to be able to train models able to generate characters. However, I don't
know when I'll be able to work on that. Now that I've got the code for LSTM,
I should be able to implement a GRU cell and NAS cell quite easily I believe.</p>
<p>For example, here is a simple LSTM used on MNIST for classification:</p>
<pre class="code cpp"><a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-1"></a><span class="cp">#include</span> <span class="cpf">"dll/neural/dense_layer.hpp"</span><span class="cp"></span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-2"></a><span class="cp">#include</span> <span class="cpf">"dll/neural/lstm_layer.hpp"</span><span class="cp"></span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-3"></a><span class="cp">#include</span> <span class="cpf">"dll/neural/recurrent_last_layer.hpp"</span><span class="cp"></span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-4"></a><span class="cp">#include</span> <span class="cpf">"dll/network.hpp"</span><span class="cp"></span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-5"></a><span class="cp">#include</span> <span class="cpf">"dll/datasets.hpp"</span><span class="cp"></span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-6"></a>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-7"></a><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="cm">/*argc*/</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="cm">/*argv*/</span> <span class="p">[])</span> <span class="p">{</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-8"></a>    <span class="c1">// Load the dataset</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-9"></a>    <span class="k">auto</span> <span class="n">dataset</span> <span class="o">=</span> <span class="n">dll</span><span class="o">::</span><span class="n">make_mnist_dataset_nc</span><span class="p">(</span><span class="n">dll</span><span class="o">::</span><span class="n">batch_size</span><span class="o">&lt;</span><span class="mi">100</span><span class="o">&gt;</span><span class="p">{},</span> <span class="n">dll</span><span class="o">::</span><span class="n">scale_pre</span><span class="o">&lt;</span><span class="mi">255</span><span class="o">&gt;</span><span class="p">{});</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-10"></a>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-11"></a>    <span class="k">constexpr</span> <span class="kt">size_t</span> <span class="n">time_steps</span>      <span class="o">=</span> <span class="mi">28</span><span class="p">;</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-12"></a>    <span class="k">constexpr</span> <span class="kt">size_t</span> <span class="n">sequence_length</span> <span class="o">=</span> <span class="mi">28</span><span class="p">;</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-13"></a>    <span class="k">constexpr</span> <span class="kt">size_t</span> <span class="n">hidden_units</span>    <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-14"></a>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-15"></a>    <span class="c1">// Build the network</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-16"></a>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-17"></a>    <span class="k">using</span> <span class="n">network_t</span> <span class="o">=</span> <span class="n">dll</span><span class="o">::</span><span class="n">dyn_network_desc</span><span class="o">&lt;</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-18"></a>        <span class="n">dll</span><span class="o">::</span><span class="n">network_layers</span><span class="o">&lt;</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-19"></a>            <span class="n">dll</span><span class="o">::</span><span class="n">lstm_layer</span><span class="o">&lt;</span><span class="n">time_steps</span><span class="p">,</span> <span class="n">sequence_length</span><span class="p">,</span> <span class="n">hidden_units</span><span class="p">,</span> <span class="n">dll</span><span class="o">::</span><span class="n">last_only</span><span class="o">&gt;</span><span class="p">,</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-20"></a>            <span class="n">dll</span><span class="o">::</span><span class="n">recurrent_last_layer</span><span class="o">&lt;</span><span class="n">time_steps</span><span class="p">,</span> <span class="n">hidden_units</span><span class="o">&gt;</span><span class="p">,</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-21"></a>            <span class="n">dll</span><span class="o">::</span><span class="n">dense_layer</span><span class="o">&lt;</span><span class="n">hidden_units</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">dll</span><span class="o">::</span><span class="n">softmax</span><span class="o">&gt;</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-22"></a>        <span class="o">&gt;</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-23"></a>        <span class="p">,</span> <span class="n">dll</span><span class="o">::</span><span class="n">updater</span><span class="o">&lt;</span><span class="n">dll</span><span class="o">::</span><span class="n">updater_type</span><span class="o">::</span><span class="n">ADAM</span><span class="o">&gt;</span>      <span class="c1">// Adam</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-24"></a>        <span class="p">,</span> <span class="n">dll</span><span class="o">::</span><span class="n">batch_size</span><span class="o">&lt;</span><span class="mi">100</span><span class="o">&gt;</span>                       <span class="c1">// The mini-batch size</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-25"></a>    <span class="o">&gt;::</span><span class="n">network_t</span><span class="p">;</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-26"></a>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-27"></a>    <span class="k">auto</span> <span class="n">net</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">network_t</span><span class="o">&gt;</span><span class="p">();</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-28"></a>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-29"></a>    <span class="c1">// Display the network and dataset</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-30"></a>    <span class="n">net</span><span class="o">-&gt;</span><span class="n">display</span><span class="p">();</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-31"></a>    <span class="n">dataset</span><span class="p">.</span><span class="n">display</span><span class="p">();</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-32"></a>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-33"></a>    <span class="c1">// Train the network for performance sake</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-34"></a>    <span class="n">net</span><span class="o">-&gt;</span><span class="n">fine_tune</span><span class="p">(</span><span class="n">dataset</span><span class="p">.</span><span class="n">train</span><span class="p">(),</span> <span class="mi">50</span><span class="p">);</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-35"></a>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-36"></a>    <span class="c1">// Test the network on test set</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-37"></a>    <span class="n">net</span><span class="o">-&gt;</span><span class="n">evaluate</span><span class="p">(</span><span class="n">dataset</span><span class="p">.</span><span class="n">test</span><span class="p">());</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-38"></a>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-39"></a>    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<a name="rest_code_60b6b02a793f42abadd2c8272fe908e4-40"></a><span class="p">}</span>
</pre>
<p>The network is quite similar to the one used previously with an RNN, just
replace rnn with lstm and that's it. It starts with LSTM layer, followed by
a layer extracting the last time step and finally a dense layer with a softmax
function. The network is trained with Adam for 50 epochs. You can change the
activation function , the initializer for the weights and the biases and number
of steps for BPTT truncation.</p>
<p>Here is the result I got on my last run:</p>
<pre class="code text"><a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-1"></a>------------------------------------------------------------
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-2"></a>| Index | Layer                | Parameters | Output Shape |
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-3"></a>------------------------------------------------------------
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-4"></a>| 0     | LSTM (TANH) (dyn)    |      51200 | [Bx28x100]   |
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-5"></a>| 1     | RNN(last)            |          0 | [Bx100]      |
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-6"></a>| 2     | Dense(SOFTMAX) (dyn) |       1000 | [Bx10]       |
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-7"></a>------------------------------------------------------------
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-8"></a>              Total Parameters:      52200
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-9"></a>
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-10"></a>--------------------------------------------
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-11"></a>| mnist | Size  | Batches | Augmented Size |
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-12"></a>--------------------------------------------
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-13"></a>| train | 60000 | 600     | 60000          |
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-14"></a>| test  | 10000 | 100     | 10000          |
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-15"></a>--------------------------------------------
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-16"></a>
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-17"></a>Network with 3 layers
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-18"></a>    LSTM(dyn): 28x28 -&gt; TANH -&gt; 28x100
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-19"></a>    RNN(last): 28x100 -&gt; 100
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-20"></a>    Dense(dyn): 100 -&gt; SOFTMAX -&gt; 10
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-21"></a>Total parameters: 52200
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-22"></a>Dataset
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-23"></a>Training: In-Memory Data Generator
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-24"></a>              Size: 60000
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-25"></a>           Batches: 600
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-26"></a>Testing: In-Memory Data Generator
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-27"></a>              Size: 10000
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-28"></a>           Batches: 100
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-29"></a>
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-30"></a>Train the network with "Stochastic Gradient Descent"
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-31"></a>    Updater: ADAM
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-32"></a>       Loss: CATEGORICAL_CROSS_ENTROPY
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-33"></a> Early Stop: Goal(error)
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-34"></a>
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-35"></a>With parameters:
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-36"></a>          epochs=50
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-37"></a>      batch_size=100
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-38"></a>   learning_rate=0.001
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-39"></a>           beta1=0.9
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-40"></a>           beta2=0.999
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-41"></a>
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-42"></a>epoch   0/50 batch  600/ 600 - error: 0.07943 loss: 0.28504 time 20910ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-43"></a>epoch   1/50 batch  600/ 600 - error: 0.06683 loss: 0.24021 time 20889ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-44"></a>epoch   2/50 batch  600/ 600 - error: 0.04828 loss: 0.18233 time 21061ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-45"></a>epoch   3/50 batch  600/ 600 - error: 0.04407 loss: 0.16665 time 20839ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-46"></a>epoch   4/50 batch  600/ 600 - error: 0.03515 loss: 0.13290 time 22108ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-47"></a>epoch   5/50 batch  600/ 600 - error: 0.03207 loss: 0.12019 time 21393ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-48"></a>epoch   6/50 batch  600/ 600 - error: 0.02973 loss: 0.11239 time 28199ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-49"></a>epoch   7/50 batch  600/ 600 - error: 0.02653 loss: 0.10455 time 37039ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-50"></a>epoch   8/50 batch  600/ 600 - error: 0.02482 loss: 0.09657 time 23127ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-51"></a>epoch   9/50 batch  600/ 600 - error: 0.02177 loss: 0.08422 time 41766ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-52"></a>epoch  10/50 batch  600/ 600 - error: 0.02453 loss: 0.09382 time 29765ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-53"></a>epoch  11/50 batch  600/ 600 - error: 0.02575 loss: 0.09796 time 21449ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-54"></a>epoch  12/50 batch  600/ 600 - error: 0.02107 loss: 0.07833 time 42056ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-55"></a>epoch  13/50 batch  600/ 600 - error: 0.01877 loss: 0.07171 time 24673ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-56"></a>epoch  14/50 batch  600/ 600 - error: 0.02095 loss: 0.08481 time 20878ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-57"></a>epoch  15/50 batch  600/ 600 - error: 0.02040 loss: 0.07578 time 41515ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-58"></a>epoch  16/50 batch  600/ 600 - error: 0.01580 loss: 0.06083 time 25705ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-59"></a>epoch  17/50 batch  600/ 600 - error: 0.01945 loss: 0.07046 time 20903ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-60"></a>epoch  18/50 batch  600/ 600 - error: 0.01728 loss: 0.06683 time 41828ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-61"></a>epoch  19/50 batch  600/ 600 - error: 0.01577 loss: 0.05947 time 27810ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-62"></a>epoch  20/50 batch  600/ 600 - error: 0.01528 loss: 0.05883 time 21477ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-63"></a>epoch  21/50 batch  600/ 600 - error: 0.01345 loss: 0.05127 time 44718ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-64"></a>epoch  22/50 batch  600/ 600 - error: 0.01410 loss: 0.05357 time 25174ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-65"></a>epoch  23/50 batch  600/ 600 - error: 0.01268 loss: 0.04765 time 23827ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-66"></a>epoch  24/50 batch  600/ 600 - error: 0.01342 loss: 0.05004 time 47232ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-67"></a>epoch  25/50 batch  600/ 600 - error: 0.01730 loss: 0.06872 time 22532ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-68"></a>epoch  26/50 batch  600/ 600 - error: 0.01337 loss: 0.05016 time 30114ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-69"></a>epoch  27/50 batch  600/ 600 - error: 0.01842 loss: 0.07049 time 40136ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-70"></a>epoch  28/50 batch  600/ 600 - error: 0.01262 loss: 0.04639 time 21793ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-71"></a>epoch  29/50 batch  600/ 600 - error: 0.01403 loss: 0.05292 time 34096ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-72"></a>epoch  30/50 batch  600/ 600 - error: 0.01185 loss: 0.04456 time 35420ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-73"></a>epoch  31/50 batch  600/ 600 - error: 0.01098 loss: 0.04180 time 20909ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-74"></a>epoch  32/50 batch  600/ 600 - error: 0.01337 loss: 0.04687 time 30113ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-75"></a>epoch  33/50 batch  600/ 600 - error: 0.01415 loss: 0.05292 time 37393ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-76"></a>epoch  34/50 batch  600/ 600 - error: 0.00982 loss: 0.03615 time 20962ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-77"></a>epoch  35/50 batch  600/ 600 - error: 0.01178 loss: 0.04830 time 29305ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-78"></a>epoch  36/50 batch  600/ 600 - error: 0.00882 loss: 0.03408 time 38293ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-79"></a>epoch  37/50 batch  600/ 600 - error: 0.01148 loss: 0.04341 time 20841ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-80"></a>epoch  38/50 batch  600/ 600 - error: 0.00960 loss: 0.03701 time 29204ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-81"></a>epoch  39/50 batch  600/ 600 - error: 0.00850 loss: 0.03094 time 39802ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-82"></a>epoch  40/50 batch  600/ 600 - error: 0.01473 loss: 0.05136 time 20831ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-83"></a>epoch  41/50 batch  600/ 600 - error: 0.01007 loss: 0.03579 time 29856ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-84"></a>epoch  42/50 batch  600/ 600 - error: 0.00943 loss: 0.03370 time 38200ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-85"></a>epoch  43/50 batch  600/ 600 - error: 0.01205 loss: 0.04409 time 21162ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-86"></a>epoch  44/50 batch  600/ 600 - error: 0.00980 loss: 0.03674 time 32279ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-87"></a>epoch  45/50 batch  600/ 600 - error: 0.01068 loss: 0.04133 time 38448ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-88"></a>epoch  46/50 batch  600/ 600 - error: 0.00913 loss: 0.03478 time 20797ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-89"></a>epoch  47/50 batch  600/ 600 - error: 0.00985 loss: 0.03759 time 28885ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-90"></a>epoch  48/50 batch  600/ 600 - error: 0.00912 loss: 0.03295 time 41120ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-91"></a>epoch  49/50 batch  600/ 600 - error: 0.00930 loss: 0.03438 time 21282ms
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-92"></a>Restore the best (error) weights from epoch 39
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-93"></a>Training took 1460s
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-94"></a>
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-95"></a>Evaluation Results
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-96"></a>   error: 0.02440
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-97"></a>    loss: 0.11315
<a name="rest_code_c730a39179444fe4a2bf5677ddb7f200-98"></a>evaluation took 1000ms
</pre>
<p>Again, nothing fancy yet, but this example has not been optimized for
performance nor for accuracy.</p>
<p>I also made a few changes to the RNN layer. I added support for biases and
improved the code as well for performance and readability.</p>
<p>All this support is now in the <strong>master</strong> branch of the DLL project if you want
to check it out. You can also check out the example online:
<a class="reference external" href="https://github.com/wichtounet/dll/blob/master/examples/src/mnist_lstm.cpp">mnist_lstm.cpp</a></p>
<p>You can access the project <a class="reference external" href="https://github.com/wichtounet/dll">on Github</a>.</p>
<p>Currently I'm working on the GPU performance again. The performance of some is
still not as good as I want it to be, especially complex operation like used in
Adam and Nadam. Currently, there are many calls to GPU BLAS libraries and
I want to try to extract some more optimized patterns. Once it's done, I'll post
more on that later on the blog.</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/deep-learning.html" rel="tag">Deep Learning</a></li>
            <li><a class="tag p-category" href="../../../categories/dll.html" rel="tag">dll</a></li>
            <li><a class="tag p-category" href="../../../categories/machine-learning.html" rel="tag">Machine Learning</a></li>
            <li><a class="tag p-category" href="../../../categories/projects.html" rel="tag">projects</a></li>
            <li><a class="tag p-category" href="../../../categories/rnn.html" rel="tag">rnn</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="dll-pretty-printing-and-live-output.html" rel="prev" title="DLL: Pretty printing and live output">Previous post</a>
            </li>
            <li class="next">
                <a href="advanced-gpu-patterns-optimization-in-etl.html" rel="next" title="Advanced GPU Patterns Optimization in ETL">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="https://baptiste-wicht.com/posts/2017/11/initial-support-for-long-short-term-memory-lstm-in-dll.html",
        disqus_title="Initial support for Long Short Term Memory (LSTM) in DLL",
        disqus_identifier="cache/posts/2017/11/initial-support-for-long-short-term-memory-lstm-in-dll.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div> <!-- col -->
    </div>
<!-- row  -->
</div>
<!-- container-fluid -->

<!-- End of Menubar -->

<!-- Footer -->

<footer>
    Contents © 2018         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         - License: 
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="../../../assets/img/cc.png"></a>
        <ul class="footer_inline_ul">
<li>
    <a href="initial-support-for-long-short-term-memory-lstm-in-dll.rst" id="sourcelink">Source</a>
    </li>

        </ul></footer><!-- Late loading stuff  --><script src="../../../assets/js/all-nocdn.js"></script><!-- Google platform JS -->
</body>
</html>
