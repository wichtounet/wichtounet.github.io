<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DLL New Features: Embeddings and Merge layers | Blog blog("Baptiste Wicht");</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../../rss.xml">
<link rel="canonical" href="https://baptiste-wicht.com/posts/2017/10/dll-new-features-embeddings-and-merge-layers.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Baptiste Wicht">
<link rel="prev" href="i-successfully-defended-my-phd.html" title="I successfully defended my Ph.D." type="text/html">
<link rel="next" href="../11/initial-support-for-recurrent-neural-network-rnn-in-dll.html" title="Initial support for Recurrent Neural Network (RNN) in DLL" type="text/html">
<meta property="og:site_name" content='Blog blog("Baptiste Wicht");'>
<meta property="og:title" content="DLL New Features: Embeddings and Merge layers">
<meta property="og:url" content="https://baptiste-wicht.com/posts/2017/10/dll-new-features-embeddings-and-merge-layers.html">
<meta property="og:description" content="I've just finished integrating new features into DLL, my deep learning library.
I've added support for an embeddings layer, a group layer and a merge layer.
This is not yet released, but available in ">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-10-17T19:50:40+02:00">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="Deep Learning">
<meta property="article:tag" content="dll">
<meta property="article:tag" content="Machine Learning">
<meta property="article:tag" content="projects">
<link href="../../../favicon.ico" rel="icon" type="image/x-icon">
<link rel="publisher" href="https://plus.google.com/+BaptisteWicht">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-2175227-7', 'auto');
  var metas = document.getElementsByTagName('meta'), tagsList = [];
  for (var i=0; i<metas.length; i++) {
    if (metas[i].getAttribute('property') == 'article:tag') {
      tagsList.push( metas[i].getAttribute('content'));
    }
  }
  ga('set', 'dimension1', tagsList.join('|'));
  ga('send', 'pageview');
</script>
</head>
<body>

<!-- Menubar -->

<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<div class="container-fluid">
<!-- This keeps the margins nice -->
    <div class="row">
        <div class="col-sm-3 col-lg-2">
            <nav class="navbar navbar-inverse navbar-fixed-side"><div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="https://baptiste-wicht.com/">
                        <span id="blog-title">Blog blog("Baptiste Wicht");</span>
                    </a>
                </div>
<!-- /.navbar-header -->

                <div class="collapse navbar-collapse navbar-ex1-collapse">
                    <ul class="nav navbar-nav">
<li>
<a href="../../../stories/about.html">About</a>
                </li>
<li>
<a href="../../../stories/publications.html">Publications</a>
                </li>
<li>
<a href="../../../stories/projects.html">Projects</a>
                </li>
<li>
<a href="../../../categories/index.html">Tags</a>
                </li>
<li>
<a href="../../../archive.html">Archives</a>
                </li>
<li>
<a href="http://feeds.feedburner.com/BaptisteWicht">RSS</a>



                            </li>
<li class="navbar-content">
                                <h3>Related posts</h3>
                            </li>
                            

                            <li><a href="../07/update-on-deep-learning-library-dll-dropout-batch-normalization-adaptive-learning-rates.html">Update on Deep Learning Library (DLL): Dropout, Batch Normalization, Adaptive Learning Rates, ...</a></li>
<li><a href="../08/dll-blazing-fast-neural-network-library.html">DLL: Blazing Fast Neural Network Library</a></li>
<li><a href="deep-learning-library-10-fast-neural-network-library.html">Deep Learning Library 1.0 - Fast Neural Network Library</a></li>
<li><a href="../11/initial-support-for-recurrent-neural-network-rnn-in-dll.html">Initial support for Recurrent Neural Network (RNN) in DLL</a></li>
<li><a href="../../2016/04/simplify-deep-learning-library-usage-on-linux-and-windows.html">Simplify Deep Learning Library usage on Linux and Windows!</a></li>
<li><a href="../01/publications-sudoku-recognition-with-deep-belief-network.html">Publications - Sudoku Recognition with Deep Belief Network</a></li>


                            <li class="navbar-block">

                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
                                <img src="../../../assets/img/twitter.png" alt="Follow @wichtounet on Twitter"></a>
                        </li>

                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow +BaptisteWicht on Google+" href="https://plus.google.com/+BaptisteWicht">
                                <img src="../../../assets/img/google_plus.png" alt="Follow +BaptisteWicht on Google+"></a>
                        </li>


                    </ul>
</div>
<!-- /.navbar-collapse -->
            </nav>
</div> <!-- col -->
        <div class="col-sm-9 col-lg-10">
            <div id="content"></div>
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">DLL New Features: Embeddings and Merge layers</a></h1>

        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                    Baptiste Wicht
            </span></p>
            <p class="dateline"><a href="#" rel="bookmark"><time class="published dt-published" datetime="2017-10-17T19:50:40+02:00" itemprop="datePublished" title="2017-10-17 19:50">2017-10-17 19:50</time></a></p>
                <p class="commentline">
        
    <a href="dll-new-features-embeddings-and-merge-layers.html#disqus_thread" data-disqus-identifier="cache/posts/2017/10/dll-new-features-embeddings-and-merge-layers.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="dll-new-features-embeddings-and-merge-layers.rst" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>I've just finished integrating new features into DLL, my deep learning library.
I've added support for an embeddings layer, a group layer and a merge layer.
This is not yet released, but available in the master branch.</p>
<p>Embeddings are used more and more these days to learn dense representation of
characters or word. An embedding layer in a neural network transform labels into
a vector. It's generally used as the first layer of the network. The embedding
are learned as part of the network.</p>
<p>The merge layer allows to create branches in the network. The input is passed to
each sub layer and then the output of each layer is concatenated to form the
output of the merged layers. This can be very useful to use different
convolutional filter sizes.</p>
<p>The group layer is a simple utility to group layers together. This is mostly to
use with merge layers to form several branches.</p>
<p>I've put together a new example to use these features on text classification.
The dataset is totally synthetic for now, but this can easily be reproduced with
a normal text classification dataset. This kind of model is called a Character
Convolutional Neural Network.</p>
<p>Here is the code for example:</p>
<pre class="code cpp"><a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-1"></a><span class="k">constexpr</span> <span class="kt">size_t</span> <span class="n">embedding</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span> <span class="c1">// The length of the embedding vector</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-2"></a><span class="k">constexpr</span> <span class="kt">size_t</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>    <span class="c1">// The word (or sequence) length</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-3"></a>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-4"></a><span class="k">using</span> <span class="n">embedding_network_t</span> <span class="o">=</span> <span class="n">dll</span><span class="o">::</span><span class="n">dyn_network_desc</span><span class="o">&lt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-5"></a>    <span class="n">dll</span><span class="o">::</span><span class="n">network_layers</span><span class="o">&lt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-6"></a>        <span class="c1">// The embedding layer</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-7"></a>        <span class="n">dll</span><span class="o">::</span><span class="n">embedding_layer</span><span class="o">&lt;</span><span class="mi">26</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">embedding</span><span class="o">&gt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-8"></a>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-9"></a>        <span class="c1">// The convolutional layers</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-10"></a>        <span class="p">,</span> <span class="n">dll</span><span class="o">::</span><span class="n">merge_layer</span><span class="o">&lt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-11"></a>            <span class="mi">0</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-12"></a>            <span class="p">,</span> <span class="n">dll</span><span class="o">::</span><span class="n">group_layer</span><span class="o">&lt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-13"></a>                  <span class="n">dll</span><span class="o">::</span><span class="n">conv_layer</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">embedding</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">embedding</span><span class="o">&gt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-14"></a>                <span class="p">,</span> <span class="n">dll</span><span class="o">::</span><span class="n">mp_2d_layer</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">,</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-15"></a>            <span class="o">&gt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-16"></a>            <span class="p">,</span> <span class="n">dll</span><span class="o">::</span><span class="n">group_layer</span><span class="o">&lt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-17"></a>                  <span class="n">dll</span><span class="o">::</span><span class="n">conv_layer</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">embedding</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">embedding</span><span class="o">&gt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-18"></a>                <span class="p">,</span> <span class="n">dll</span><span class="o">::</span><span class="n">mp_2d_layer</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">,</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-19"></a>            <span class="o">&gt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-20"></a>            <span class="p">,</span> <span class="n">dll</span><span class="o">::</span><span class="n">group_layer</span><span class="o">&lt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-21"></a>                  <span class="n">dll</span><span class="o">::</span><span class="n">conv_layer</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">embedding</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">embedding</span><span class="o">&gt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-22"></a>                <span class="p">,</span> <span class="n">dll</span><span class="o">::</span><span class="n">mp_2d_layer</span><span class="o">&lt;</span><span class="mi">16</span><span class="p">,</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">length</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">&gt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-23"></a>            <span class="o">&gt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-24"></a>        <span class="o">&gt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-25"></a>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-26"></a>        <span class="c1">// The final softmax layer</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-27"></a>        <span class="p">,</span> <span class="n">dll</span><span class="o">::</span><span class="n">dense_layer</span><span class="o">&lt;</span><span class="mi">48</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">dll</span><span class="o">::</span><span class="n">softmax</span><span class="o">&gt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-28"></a>    <span class="o">&gt;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-29"></a>    <span class="p">,</span> <span class="n">dll</span><span class="o">::</span><span class="n">updater</span><span class="o">&lt;</span><span class="n">dll</span><span class="o">::</span><span class="n">updater_type</span><span class="o">::</span><span class="n">NADAM</span><span class="o">&gt;</span>     <span class="c1">// Nesterov Adam (NADAM)</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-30"></a>    <span class="p">,</span> <span class="n">dll</span><span class="o">::</span><span class="n">batch_size</span><span class="o">&lt;</span><span class="mi">50</span><span class="o">&gt;</span>                        <span class="c1">// The mini-batch size</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-31"></a>    <span class="p">,</span> <span class="n">dll</span><span class="o">::</span><span class="n">shuffle</span>                               <span class="c1">// Shuffle before each epoch</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-32"></a><span class="o">&gt;::</span><span class="n">network_t</span><span class="p">;</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-33"></a>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-34"></a><span class="k">auto</span> <span class="n">net</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">embedding_network_t</span><span class="o">&gt;</span><span class="p">();</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-35"></a>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-36"></a><span class="c1">// Display the network and dataset</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-37"></a><span class="n">net</span><span class="o">-&gt;</span><span class="n">display</span><span class="p">();</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-38"></a>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-39"></a><span class="c1">// Train the network for performance sake</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-40"></a><span class="n">net</span><span class="o">-&gt;</span><span class="n">fine_tune</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-41"></a>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-42"></a><span class="c1">// Test the network on train set</span>
<a name="rest_code_1e9b403327ae41bf965ca5eeecda3b39-43"></a><span class="n">net</span><span class="o">-&gt;</span><span class="n">evaluate</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">labels</span><span class="p">);</span>
</pre>
<p>The network starts with an embedding layer. The embedding is then passed to
three convolutional layers with different filter sizes, each followed by
a pooling layer. The outputs of the three layers are merged at the end of the
merge layer. Finally, a softmax layer is used for classification.</p>
<p>This kind of model can be very powerful and is used regularly. These new
features make for a much larger variety of models that can be build with the DLL
library.</p>
<p>The full code with the dataset generation can be found online:
<a class="reference external" href="https://github.com/wichtounet/dll/blob/master/examples/src/char_cnn.cpp">char_cnn.cpp</a></p>
<p>The next feature I want to focus on is recurrent neural networks. I'll probably
try a single RNN layer first and then upgrade to multi-layers and LSTM and maybe
GRU.</p>
</div>
    </div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/c%2B%2B.html" rel="tag">C++</a></li>
            <li><a class="tag p-category" href="../../../categories/deep-learning.html" rel="tag">Deep Learning</a></li>
            <li><a class="tag p-category" href="../../../categories/dll.html" rel="tag">dll</a></li>
            <li><a class="tag p-category" href="../../../categories/machine-learning.html" rel="tag">Machine Learning</a></li>
            <li><a class="tag p-category" href="../../../categories/projects.html" rel="tag">projects</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="i-successfully-defended-my-phd.html" rel="prev" title="I successfully defended my Ph.D.">Previous post</a>
            </li>
            <li class="next">
                <a href="../11/initial-support-for-recurrent-neural-network-rnn-in-dll.html" rel="next" title="Initial support for Recurrent Neural Network (RNN) in DLL">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="https://baptiste-wicht.com/posts/2017/10/dll-new-features-embeddings-and-merge-layers.html",
        disqus_title="DLL New Features: Embeddings and Merge layers",
        disqus_identifier="cache/posts/2017/10/dll-new-features-embeddings-and-merge-layers.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div> <!-- col -->
    </div>
<!-- row  -->
</div>
<!-- container-fluid -->

<!-- End of Menubar -->

<!-- Footer -->

<footer>
    Contents © 2018         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         - License: 
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="../../../assets/img/cc.png"></a>
        <ul class="footer_inline_ul">
<li>
    <a href="dll-new-features-embeddings-and-merge-layers.rst" id="sourcelink">Source</a>
    </li>

        </ul></footer><!-- Late loading stuff  --><script src="../../../assets/js/all-nocdn.js"></script><!-- Google platform JS -->
</body>
</html>
