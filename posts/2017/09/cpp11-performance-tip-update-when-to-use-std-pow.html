<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Test the performance of std::pow in comparison to simple multiplications.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>C++11 Performance tip: Update on when to use std::pow ? | Blog blog("Baptiste Wicht");</title>
<link href="../../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="../../../rss.xml">
<link rel="canonical" href="https://baptiste-wicht.com/posts/2017/09/cpp11-performance-tip-update-when-to-use-std-pow.html">
<!--[if lt IE 9]><script src="../../../assets/js/html5.js"></script><![endif]--><meta name="author" content="Baptiste Wicht">
<link rel="prev" href="how-i-made-deep-learning-library-38-faster-to-compile-optimization-and-cpp17-if-constexpr.html" title="How I made my Deep Learning Library 38% faster to compile (Optimization and C++17 if constexpr)" type="text/html">
<link rel="next" href="../10/expression-templates-library-etl-1-2-complete-gpu-support.html" title="Expression Templates Library (ETL) 1.2 - Complete GPU support" type="text/html">
<meta property="og:site_name" content='Blog blog("Baptiste Wicht");'>
<meta property="og:title" content="C++11 Performance tip: Update on when to use std::pow ?">
<meta property="og:url" content="https://baptiste-wicht.com/posts/2017/09/cpp11-performance-tip-update-when-to-use-std-pow.html">
<meta property="og:description" content="Test the performance of std::pow in comparison to simple multiplications.">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2017-09-22T11:21:07+02:00">
<meta property="article:tag" content="Benchmark">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="C++11">
<meta property="article:tag" content="Performances">
<meta property="article:tag" content="Tip">
<link href="../../../favicon.ico" rel="icon" type="image/x-icon">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-2175227-7', 'auto');
  var metas = document.getElementsByTagName('meta'), tagsList = [];
  for (var i=0; i<metas.length; i++) {
    if (metas[i].getAttribute('property') == 'article:tag') {
      tagsList.push( metas[i].getAttribute('content'));
    }
  }
  ga('set', 'dimension1', tagsList.join('|'));
  ga('send', 'pageview');
</script>
</head>
<body>

<!-- Menubar -->

<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<div class="container-fluid">
<!-- This keeps the margins nice -->
    <div class="row">
        <div class="col-sm-3 col-lg-2">
            <nav class="navbar navbar-inverse navbar-fixed-side"><div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="https://baptiste-wicht.com/">
                        <span id="blog-title">Blog blog("Baptiste Wicht");</span>
                    </a>
                </div>
<!-- /.navbar-header -->

                <div class="collapse navbar-collapse navbar-ex1-collapse">
                    <ul class="nav navbar-nav">
<li>
<a href="../../../stories/about.html">About</a>
                </li>
<li>
<a href="../../../stories/publications.html">Publications</a>
                </li>
<li>
<a href="../../../stories/projects.html">Projects</a>
                </li>
<li>
<a href="../../../categories/index.html">Tags</a>
                </li>
<li>
<a href="../../../archive.html">Archives</a>


                            </li>
<li class="navbar-content">
                                <h3>Related posts</h3>
                            </li>
                            

                            <li><a href="cpp11-performance-tip-when-to-use-std-pow.html">C++11 Performance tip: When to use std::pow ?</a></li>
<li><a href="../05/cpp-containers-benchmark-vector-list-deque-plf-colony.html">C++ Containers Benchmark: vector/list/deque and plf::colony</a></li>
<li><a href="../../2012/11/cpp-benchmark-vector-vs-list.html">C++ benchmark - std::vector VS std::list</a></li>
<li><a href="../../2012/12/cpp-benchmark-vector-list-deque.html">C++ benchmark â€“ std::vector VS std::list VS std::deque</a></li>
<li><a href="../../2012/12/cpp-benchmark-std-list-boost-intrusive-list.html">C++ Benchmark - std::list VS boost::intrusive::list</a></li>
<li><a href="../../2012/11/integer-linear-time-sorting-algorithms.html">Integer Linear Time Sorting Algorithms</a></li>


                            <li class="navbar-block">

                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
                                <img src="../../../assets/img/twitter.png" alt="Follow @wichtounet on Twitter"></a>
                        </li>

                    </ul>
</div>
<!-- /.navbar-collapse -->
            </nav>
</div> <!-- col -->
        <div class="col-sm-9 col-lg-10">
            <div id="content"></div>
            
<article class="post-text h-entry hentry postpage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">C++11 Performance tip: Update on when to use std::pow ?</a></h1>

        <div class="metadata">
            <p class="byline author vcard p-author h-card"><span class="byline-name fn p-name" itemprop="author">
                    Baptiste Wicht
            </span></p>
            <p class="dateline">
            <a href="#" rel="bookmark">
            <time class="published dt-published" datetime="2017-09-22T11:21:07+02:00" itemprop="datePublished" title="2017-09-22 11:21">2017-09-22 11:21</time></a>
            </p>
                <p class="commentline">
    
    <a href="cpp11-performance-tip-update-when-to-use-std-pow.html#disqus_thread" data-disqus-identifier="cache/posts/2017/09/cpp11-performance-tip-update-when-to-use-std-pow.html">Comments</a>


            
        </p>
<p class="sourceline"><a href="cpp11-performance-tip-update-when-to-use-std-pow.rst" class="sourcelink">Source</a></p>

        </div>
        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <p>A few days ago, I published a post comparing the
<a class="reference external" href="https://baptiste-wicht.com/posts/2017/09/cpp11-performance-tip-when-to-use-std-pow.html">performance of std::pow against direct multiplications</a>. When not compiling with -ffast-math, direct multiplication was significantly faster than <code>std::pow</code>, around two orders of magnitude faster when comparing <code>x * x * x</code> and <code>code:std::pow(x, 3)</code>.
One comment that I've got was to test for which <code>n</code> is
<code>code:std::pow(x, n)</code> becoming faster than multiplying in a loop. Since
std::pow is using a special algorithm to perform the computation rather than be
simply loop-based multiplications, there may be a point after which it's more interesting to use the
algorithm rather than a loop. So I decided to do the tests. You can also find
the result in the original article, which I've updated.</p>
<p>First, our pow function:</p>
<div class="code"><pre class="code c++"><a id="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-1" name="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-1" href="cpp11-performance-tip-update-when-to-use-std-pow.html#rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-1"></a><span class="kt">double</span><span class="w"> </span><span class="nf">my_pow</span><span class="p">(</span><span class="kt">double</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">){</span>
<a id="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-2" name="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-2" href="cpp11-performance-tip-update-when-to-use-std-pow.html#rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-2"></a><span class="w">    </span><span class="kt">double</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
<a id="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-3" name="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-3" href="cpp11-performance-tip-update-when-to-use-std-pow.html#rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-3"></a>
<a id="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-4" name="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-4" href="cpp11-performance-tip-update-when-to-use-std-pow.html#rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-4"></a><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span>
<a id="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-5" name="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-5" href="cpp11-performance-tip-update-when-to-use-std-pow.html#rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-5"></a><span class="w">        </span><span class="n">r</span><span class="w"> </span><span class="o">*=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<a id="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-6" name="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-6" href="cpp11-performance-tip-update-when-to-use-std-pow.html#rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-6"></a><span class="w">        </span><span class="o">--</span><span class="n">n</span><span class="p">;</span>
<a id="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-7" name="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-7" href="cpp11-performance-tip-update-when-to-use-std-pow.html#rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-7"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-8" name="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-8" href="cpp11-performance-tip-update-when-to-use-std-pow.html#rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-8"></a>
<a id="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-9" name="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-9" href="cpp11-performance-tip-update-when-to-use-std-pow.html#rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<a id="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-10" name="rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-10" href="cpp11-performance-tip-update-when-to-use-std-pow.html#rest_code_b846fdccb10f4b9f92c87e2b514eaeb7-10"></a><span class="p">}</span>
</pre></div>
<p>And now, let's see the performance. I've compiled my benchmark with GCC 4.9.3
and running on my old Sandy Bridge processor. Here are the results for 1000
calls to each functions:</p>
<div id="graph_std_pow_my_pow_1" style="width: 700px; height: 400px;"></div>
<p>We can see that between <code>n=100</code> and <code>n=110</code>, <code>std::pow(x, n)</code>
starts to be faster than <code>my_pow(x, n)</code>. At this point, you should only
use <code>std::pow(x, n)</code>.  Interestingly too, the time for <code>std::pow(x,
n)</code> is decreasing. Let's see how is the performance with higher range of
<code>n</code>:</p>
<div id="graph_std_pow_my_pow_2" style="width: 700px; height: 400px;"></div>
<p>We can see that the pow function time still remains stable while our loop-based
pow function still increases linearly. At <code>n=1000</code>, <code>std::pow</code> is
one order of magnitude faster than <code>my_pow</code>.</p>
<p>Overall, if you do not care much about extreme accuracy, you may consider using
you own pow function for small-ish (integer) <code>n</code> values. After
<code>n=100</code>, it becomes more interesting to use <code>std::pow</code>.</p>
<p>If you want more results on the subject, you take a look at the
<a class="reference external" href="https://baptiste-wicht.com/posts/2017/09/cpp11-performance-tip-when-to-use-std-pow.html">original article</a>.</p>
<p>If you are interested in the code of this benchmark, it's available online:
<a class="reference external" href="https://github.com/wichtounet/articles/blob/master/src/bench_pow_my_pow.cpp">bench_pow_my_pow.cpp</a></p>
<script type="text/javascript" src="https://www.google.com/jsapi"></script><script type="text/javascript">google.load('visualization', '1.0', {'packages':['corechart']});</script><script type="text/javascript">
function draw_graph_pow_my_pow_1(){
var data = google.visualization.arrayToDataTable([
['n', 'my_pow(x, n)', 'std::pow(x, n)'],
['10',   2,     127],
['20',   17,     123],
['30',   26,     127],
['40',   36,     123],
['50',   43,     123],
['60',   55,     123],
['70',   72,     123],
['80',   85,     123],
['90',   102,    126],
['100',  114,    125],
['110',  131,    115],
['120',  144,    111],
['130',  165,    111],
['140',  173,    108],
['150',  189,    107],
['160',  202,    112],
['170',  219,    106],
['180',  232,    105],
['190',  249,    108],
['200',  261,    105],
]);
var graph = new google.visualization.LineChart(document.getElementById('graph_std_pow_my_pow_1'));
var options = {curveType: "function",title: "std::pow(x, 2) (float)",animation: {duration:1200, easing:"in"},width: 700, height: 400,hAxis: {title:"Number of elements", slantedText:true},vAxis: {viewWindow: {min:0}, title:"us"}};
graph.draw(data, options);
}
function draw_graph_pow_my_pow_2(){
var data = google.visualization.arrayToDataTable([
['n', 'my_pow(x, n)', 'std::pow(x, n)'],
['100',  114,    125],
['200',  261,    105],
['300',  410,    104],
['400',  558,    104],
['500',  708,    104],
['600',  855,    104],
['700',  1002,   104],
['800',  1148,   104],
['900',  1300,   104],
['1000', 1442,   104],
]);
var graph = new google.visualization.LineChart(document.getElementById('graph_std_pow_my_pow_2'));
var options = {curveType: "function",title: "std::pow(x, 2) (float)",animation: {duration:1200, easing:"in"},width: 700, height: 400,hAxis: {title:"Number of elements", slantedText:true},vAxis: {viewWindow: {min:0}, title:"us"}};
graph.draw(data, options);
}
function draw_all(){
draw_graph_pow_my_pow_1();
draw_graph_pow_my_pow_2();
}
google.setOnLoadCallback(draw_all);
</script>
</div>
    <aside class="postpromonav"><nav><ul itemprop="keywords" class="tags">
<li><a class="tag p-category" href="../../../categories/benchmark.html" rel="tag">Benchmark</a></li>
            <li><a class="tag p-category" href="../../../categories/c%2B%2B.html" rel="tag">C++</a></li>
            <li><a class="tag p-category" href="../../../categories/c%2B%2B11.html" rel="tag">C++11</a></li>
            <li><a class="tag p-category" href="../../../categories/performances.html" rel="tag">Performances</a></li>
            <li><a class="tag p-category" href="../../../categories/tip.html" rel="tag">Tip</a></li>
        </ul>
<ul class="pager hidden-print">
<li class="previous">
                <a href="how-i-made-deep-learning-library-38-faster-to-compile-optimization-and-cpp17-if-constexpr.html" rel="prev" title="How I made my Deep Learning Library 38% faster to compile (Optimization and C++17 if constexpr)">Previous post</a>
            </li>
            <li class="next">
                <a href="../10/expression-templates-library-etl-1-2-complete-gpu-support.html" rel="next" title="Expression Templates Library (ETL) 1.2 - Complete GPU support">Next post</a>
            </li>
        </ul></nav></aside><section class="comments hidden-print"><h2>Comments</h2>
        
    
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="blogwichtounet",
            disqus_url="https://baptiste-wicht.com/posts/2017/09/cpp11-performance-tip-update-when-to-use-std-pow.html",
        disqus_title="C++11 Performance tip: Update on when to use std::pow ?",
        disqus_identifier="cache/posts/2017/09/cpp11-performance-tip-update-when-to-use-std-pow.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        </section></article><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div> <!-- col -->
    </div>
<!-- row  -->
</div>
<!-- container-fluid -->

<!-- End of Menubar -->

<!-- Footer -->

<footer>
    Contents Â© 2023         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         - License: 
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="../../../assets/img/cc.png"></a>
        <ul class="footer_inline_ul">
<li>
    <a href="cpp11-performance-tip-update-when-to-use-std-pow.rst" id="sourcelink">Source</a>
    </li>

        </ul></footer><!-- Late loading stuff  --><script src="../../../assets/js/all-nocdn.js"></script><!-- Google platform JS -->
</body>
</html>
