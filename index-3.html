<!DOCTYPE html><html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Website about vtechnologies Java, Spring, OSGi, Hardware,...">
    <meta name="author" content="Baptiste Wicht">
    <title>@Blog("Baptiste Wicht") (old posts, page 3) | @Blog("Baptiste Wicht")</title>
    
            <link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
      <link rel="canonical" href="http://wichtounet.github.io/index-3.html">
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
            <link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">

    
    
    
<link rel="stylesheet" type="text/css" href="assets/css/tipuesearch.css">
</head><body><div id="tipue_search_content" style="margin-left: auto; margin-right: auto; padding: 20px;"></div>




<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid"><!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://wichtounet.github.io/">@Blog("Baptiste Wicht")</a>
        </div><!-- /.navbar-header -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                
                <li><a href="stories/about.html">About</a>
                </li><li><a href="stories/publications.html">Publications</a>
                </li><li><a href="stories/donate.html">Donate</a>
                </li><li><a href="stories/faq.html">FAQ</a>
                </li><li><a href="stories/legal.html">Legal</a>
                </li><li><a href="archive.html">Archives</a>
                </li><li><a href="categories/index.html">Tags</a>
                </li><li><a href="rss.xml">RSS</a>

            </li></ul>
                
<span class="navbar-form pull-left">
<input type="text" id="tipue_search_input">
</span>

            <ul class="nav navbar-nav navbar-right">
                
                
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>

<!-- End of Menubar -->

<div class="body-container">

    <!-- Sidebar -->

    <div class="left-sidebar">
        <div class="left-sidebar-widget">
            <h3>Something, something</h3>
            <div class="left-sidebar-widget-content">
                ...dark side...
            </div>
        </div>
        
        <div class="left-sidebar-widget">
            <h3>Blogroll</h3>
            <div class="left-sidebar-widget-content">
                <ul>
                    <li><a target="_blank" href="http://www.asjava.com/">AsJava.com : Java Tutorial</a></li>
                    <li><a target="_blank" href="http://www.mkyong.com/">Mkyong : Java Tutorials</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Content -->

    <div class="container">
        <div class="body-content">
            <!--Body content-->
            <div class="row">
                
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/04/links-of-the-week-2.html" class="u-url">Links of the Week</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2010-04-12T06:34:18+00:00">2010-04-12 06:34</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><p>Here are some interesting links of this week :</p>
<p></p><ul>
    <li><a href="http://www.codinghorror.com/blog/2010/04/three-monitors-for-every-user.html" target="_blank">Three Monitors for Every User</a> : Jeff Atwood explain how to works with three monitors on the same computers and what that give to the user.</li>
    <li><a href="http://www.ibm.com/developerworks/java/library/j-ce/index.html" target="_blank">Tip: When you can't throw an exception</a> : Elliotte Rusty Harold explore solutions on how to works with exceptions in public APIs</li>
    <li><a href="http://blogs.sun.com/tor/entry/leak_unit_tests" target="_blank">How to Write a Memory Leak Unit Test</a> : Tor Norbye explain how to make unit test to verify for memory leak</li>
    <li><a href="http://agile.dzone.com/news/8-tips-performance-metrics">8 Tips for Performance Metrics</a> by Jurgen Appelo</li>
</ul>
<p>I hope you'll find this links interesting. </p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/04/links-of-the-week-2.html#disqus_thread" data-disqus-identifier="cache/posts/2010/04/links-of-the-week-2.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/04/passed-scjp-exam.html" class="u-url">I just passed the SCJP exam !</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2010-04-08T08:14:03+00:00">2010-04-08 08:14</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><p>Hi, </p>
<p>I'm happy to say that i passed the Sun Certified Java Programmer for Java SE 6.0 this morning :)</p>
<p>I passed the exam with 93%. I'm really happy of my score. </p>
<p>To prepare this exam, i read the <a href="http://www.amazon.com/SCJP-Certified-Programmer-Java-310-065/dp/0071591060/ref=sr_1_2?ie=UTF8&amp;s=books&amp;qid=1270728614&amp;sr=1-2">SCJP Sun Certified Programmer for Java 6 Exam 310-065</a> and exercise the chapters for which I wasn't good enough. </p>
<p>So i started my exam this morning at 8.30 (Switzerland time) and after 2 hours of work, i was happy to see my score and to rest my poor brain. </p>
<p>So now i'm waiting of the certificate sended by post. </p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/04/passed-scjp-exam.html#disqus_thread" data-disqus-identifier="cache/posts/2010/04/passed-scjp-exam.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/04/java-7-more-dynamics.html" class="u-url">Java 7 : More dynamics</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2010-04-07T03:38:02+00:00">2010-04-07 03:38</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><p>Like you know (or perhaps not, nevermind), the Java bytecode doesn't support dynamic method invocation. There are three supported invocations modes : invokestatic, invokespecial, invokeinterface or invokevirtual. These modes allows to call methods with known signature. We talk of strongly typed language. This allows to to make some checks directly at compile time.</p>
<p>On the other side, the dynamic languages use dynamic types. So we can call a method unknown at the compile time, but that's completely impossible with the Java bytecode. The dynamic languages based on the Java Runtime must use Java Reflection to make dynamic invocations.</p>
<p>In Java 7, we'll see a new feature, the JSR 292. This JSR add new method invocation mode : invokedynamic. With that new bytecode keyword, we can call method only known at runtime.</p>
<!--more-->

<p>This JSR only impact the bytecode not the language. But with Java 7 we'll see a new package java.dyn that use this new functionality. That package will improve the performances of Java reflection and mainly the performances of the others languages that run in the JVM. </p>
<p></p><h4>MethodHandle</h4>
<p>The MethodHandle class allows to manipulate a reference to a method. It's like a pointer to a method. With that features, we avoid the heavy process of reflection.</p>
<p>With that class, we can have informations about the method (return type and parameters) and invoke that method with a special invoke() method that can be called with any number of parameters. To create a MethodHandle we use the MethodHandles factory.</p>
<p>Here is an example :</p>
<p>[java]JComboBox combo = new JComboBox();</p>
<p>MethodHandle handle = MethodHandles.lookup().findVirtual(JComboBox.class, "setModel", MethodType.make(void.class, ComboBoxModel.class));</p>
<p>handle.invoke(combo, new CustomComboModel());[/java]</p>
<p>Of course, this example is completely useless but shows the process of invoking a method using Method. There are some differences with Reflection :</p>
<ul>
    <li>The call to invoke() is optimized by the JVM with calling directly the target method like any other call.</li>
    <li>The performances are a lot better, almost the same as a standard call.</li>
    <li>The cheks on the method are made when we create the MethodHandle Object not at all the invoke() calls.</li>
</ul>

<h4>InvokeDynamic</h4>

<p>The second class of this new package is the InvokeDynamic class. This is even more weird than the first one, because this class has no methods. But we can invoke any methods on it.</p>
<p>[java]InvokeDynamic.setModel(new CustomComboModel());</p>
<p>InvokeDynamic.init();</p>
<p>Date today = InvokeDynamic.getDate();</p>
<p>//... You can call any valid method[/java]</p>
<p>All that calls will be compiled with InvokeDynamic. Namely, all that calls will not be checked at compile time but at runtime. </p>
<p>To use that mechanism, we must define a bootstrap mechanism who will do the conversion between the method calls on InvokeDynamic and the really Method (through MethodHandle) to invoke. When we invoke the method, the JVM use that bootstrap method to get the MethodHandle and invoke it.The JVM use a cache for the MethodHandle to improve performances. So, only the first dynamic call will be searched in the bootstrap method.  </p>
<p>To register the bootstrap method, we have to use the <em>Linkage.registerBootstrapMethod(String methodName)</em> method. </p>
<p>Here is a really basic example of a boot strap method. That method only use the name of the called method and return the MethodHandle to the same method in the Utility class with no args. Of course, that kind of bootstrap method must not be used, but that shows the basics of develop that kind of methods. </p>
<p>[java]private static CallSite bootstrap(Class caller, String name, MethodType type) {
    CallSite site = new CallSite(caller, name, MethodType.make(void.class));
    site.setTarget(MethodHandles.lookup().findStatic(Utility.class, name, MethodType.make(void.class)));
    return site;
}[/java]</p>
<p>References of type InvokeDynamic can take any types of objects : </p>
<p>[java]InvokeDynamic dynamicString = "Hello World";</p>
<p>InvokeDynamic dynamicCombo = new JComboBox();</p>
<p>InvokeDynamic dynamicNumber = 1;[/java]</p>
<p>With that, we can dynamically call a method on the target : </p>
<p>[java]dynamicString.aSimpleMethod();[/java]</p>
<p>Here we are. I think we've covered the main features of this new package. </p>
<p>Of course these classes will mostly be used by dynamic languages developers instead of standard programmers but the MethodHandle class can be useful to improve reflection performances in simple programs. I think it's a great new features but that will not be used by everybody.  </p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/04/java-7-more-dynamics.html#disqus_thread" data-disqus-identifier="cache/posts/2010/04/java-7-more-dynamics.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/04/java-links-of-the-week.html" class="u-url">Java Links of the week</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2010-04-04T07:26:33+00:00">2010-04-04 07:26</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><p>I will try to reference my personal best of links about Java, Swing, ... every week at monday.</p>
<p>Here is the most interesting links i found about Java Programming this week :</p>
<p></p><ul>
    <li><a href="http://www.jug-muenster.de/swing-event-departure-board-518/" target="_blank">Swing event departure board</a> : Gerrit of Java User Group Münster has developed an event departure board like those in the airports in Swing. with an amazing style.</li>
    <li><a href="http://mcoj.wordpress.com/2010/03/28/swinging-task-dialog-part-4/" target="_blank">Swinging Task Dialog Part 4</a> : Eugene Ryzhikov announces  the 0.5.0 release of his really interesting Task Dialog library, dedicated to Mac OS support.</li>
    <li><a href="http://java.dzone.com/articles/design-patterns-uncovered-chain-of-responsibility" target="_blank">A clean implementation of Chain of Responsibility</a>, by James Sugrue</li>
    <li><a href="http://www.developers-blog.org/blog/default/2010/03/31/OSGI-Tutorial-How-to-use-ServiceTracker-to-get-Services" target="_blank">Dynamic Usage of ServiceTracker</a> : Rafael Sobek show a way to use ServiceTracker in a dynamic way tracking minutes after minutes for the service.</li>
</ul>
<p>And just for pleasure, my favourite April fools :</p>
<ul>
    <li><a href="http://googleblog.blogspot.com/2010/04/different-kind-of-company-name.html" target="_self">A different kind of company name</a> : Google is now Topeka to honour this town who's itself rename to Google</li>
    <li><a href="http://www.daniweb.com/news/story272314.html#" target="_blank">Linus Torvalds monetizes Linux</a></li>
    <li><a href="http://google-opensource.blogspot.com/2010/03/google-annotations-gallery.html" target="_blank">Google Annotations Gallery</a> : A set of annotations from Google like @Lol, @Hack or @Noop</li>
</ul>

<p>I hope you will find this compilation interesting.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/04/java-links-of-the-week.html#disqus_thread" data-disqus-identifier="cache/posts/2010/04/java-links-of-the-week.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/04/java-7-the-new-java-util-objects-class.html" class="u-url">Java 7 : The new java.util.Objects class</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2010-04-02T06:01:28+00:00">2010-04-02 06:01</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><p>In Java 7, we'll see a new class : <a href="http://download.java.net/jdk7/docs/api/java/util/Objects.html" target="_blank">java.util.Objects</a>. This class contains 9 static methods to work on Objects. I found these methods really useful.</p>
<p>First, two really simple methods to assert non-null objects in getter/setter (or other methods, of course) :</p>
<p></p><ul>
    <li>&lt;T&gt; T <strong>nonNull</strong>(T obj) : If obj is not null, return obj else throw a NullPointerException.</li>
    <li>&lt;T&gt; T <strong>nonNull</strong>(T obj, String message) : If obj is not null return obj else throw a customized NullPointerException with the given message</li>
</ul>
<!--more-->

<p>Some simple examples :</p>
<p>[java]public void setFoo(Foo foo){
    this.foo = Objects.nonNull(foo);
}</p>
<p>public void setBar(Bar bar){
    this.foo = Objects.nonNull(bar, "bar cannot be null");
}[/java]</p>
<p>Although simple, these methods can improve the readability of code and avoid having to write the is-null check ourselves.</p>
<p>Then, we have two methods to compute a toString() value for Object supporting null objects :</p>
<ul>
    <li>String <strong>toString</strong>(Object o) : Return the toString() value of a non-null object otherwise "null".</li>
    <li>String <strong>toString</strong>(Object o, String nullDefault) : Return the toString() value of a non-null object otherwise return nullDefault</li>
</ul>

<p>Again, this is useful for code readibility :</p>
<p>[java]public class Bar {
    private Foo foo;
    private Bar parent;</p>
<div class="code"><pre><span class="err">@</span><span class="n">Override</span>
<span class="n">public</span> <span class="n">String</span> <span class="n">toString</span><span class="p">(){</span>
    <span class="k">return</span> <span class="s">"Bar {foo = "</span> <span class="o">+</span> <span class="n">Objects</span><span class="p">.</span><span class="n">toString</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span> <span class="o">+</span> <span class="s">", parent = "</span> <span class="o">+</span> <span class="n">Objects</span><span class="p">.</span><span class="n">toString</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s">"no parent, orphan"</span><span class="p">)</span> <span class="o">+</span> <span class="s">"}"</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>}</p>
<p>[/java]</p>
<p>I think, it's a lot better than :</p>
<p>[java]public class Bar {
    private Foo foo;
    private Bar parent;</p>
<div class="code"><pre><span class="err">@</span><span class="n">Override</span>
<span class="n">public</span> <span class="n">String</span> <span class="n">toString</span><span class="p">(){</span>
    <span class="k">return</span> <span class="s">"Bar {foo = "</span> <span class="o">+</span> <span class="p">(</span><span class="n">foo</span> <span class="o">==</span> <span class="n">null</span> <span class="o">?</span> <span class="s">"null"</span> <span class="o">:</span> <span class="n">foo</span><span class="p">.</span><span class="n">toString</span><span class="p">())</span> <span class="o">+</span> <span class="s">", parent = "</span> <span class="o">+</span> <span class="p">(</span><span class="n">parent</span> <span class="o">==</span> <span class="n">null</span> <span class="o">?</span> <span class="s">"o parent, orphan"</span> <span class="o">:</span> <span class="n">parent</span><span class="p">.</span><span class="n">toString</span><span class="p">())</span> <span class="o">+</span> <span class="s">"}"</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>}[/java]</p>
<p>Isn't it ?</p>
<p>After that, we also two similar methods for hashing :</p>
<ul>
    <li>int <strong>hash</strong>(Object... values) : Compute a hash code for all the given values</li>
    <li>int <strong>hashCode</strong>(Object o) : If 0 is null return 0 othewise return o.hashCode()</li>
</ul>

<p>If we take again the exemple of the Bar class. If we have to write the hashCode() method without Objects, we could do that :</p>
<p>[java]public class Bar {
    private Foo foo;
    private Bar parent;</p>
<div class="code"><pre><span class="err">@</span><span class="n">Override</span>
<span class="n">public</span> <span class="kt">int</span> <span class="n">hashCode</span><span class="p">(){</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">17</span><span class="p">;</span>

    <span class="n">result</span> <span class="o">=</span> <span class="mi">31</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">foo</span> <span class="o">==</span> <span class="n">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">foo</span><span class="p">.</span><span class="n">hashCode</span><span class="p">());</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">31</span> <span class="o">*</span> <span class="n">result</span> <span class="o">+</span> <span class="p">(</span><span class="n">parent</span> <span class="o">==</span> <span class="n">null</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="n">parent</span><span class="p">.</span><span class="n">hashCode</span><span class="p">());</span>

    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>}[/java]</p>
<p>With Java 7, we only have to do that :</p>
<p>[java]public class Bar {
    private Foo foo;
    private Bar parent;</p>
<div class="code"><pre><span class="err">@</span><span class="n">Override</span>
<span class="n">public</span> <span class="kt">int</span> <span class="n">hashCode</span><span class="p">(){</span>
    <span class="k">return</span> <span class="n">Objects</span><span class="p">.</span><span class="n">hash</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">parent</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>}[/java]</p>
<p>And that's it :)</p>
<p>On the same model, we've also two methods for equality checks :</p>
<ul>
    <li>boolean <strong>equals</strong>(Object a, Object b) : Return true if the two arguments are null or they are both not null and a.equals(b) return true, otherwise false.</li>
    <li>boolean <strong>deepEquals</strong>(Object a, Object b) : Almost the same as the first method except that if both a and b are arrays, the equality is evaluated using Arrays.deepEquals method.</li>
</ul>

<p>Once again, that can really ease the coding of equals() methods :</p>
<p>[java]public class Bar {
    private Foo foo;
    private Bar parent;</p>
<div class="code"><pre><span class="err">@</span><span class="n">Override</span>
<span class="n">public</span> <span class="n">boolean</span> <span class="n">equals</span><span class="p">(</span><span class="n">Object</span> <span class="n">obj</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">obj</span> <span class="o">==</span> <span class="n">this</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">obj</span> <span class="n">instanceof</span> <span class="n">Bar</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Bar</span> <span class="n">other</span> <span class="o">=</span> <span class="p">(</span><span class="n">Bar</span><span class="p">)</span> <span class="n">obj</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">foo</span> <span class="o">!=</span> <span class="n">other</span><span class="p">.</span><span class="n">foo</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">foo</span> <span class="o">==</span> <span class="n">null</span> <span class="o">||</span> <span class="o">!</span><span class="n">foo</span><span class="p">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">foo</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">parent</span> <span class="o">!=</span> <span class="n">other</span><span class="p">.</span><span class="n">parent</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">parent</span> <span class="o">==</span> <span class="n">null</span> <span class="o">||</span> <span class="o">!</span><span class="n">parent</span><span class="p">.</span><span class="n">equals</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">parent</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>}</p>
<p>[/java]</p>
<p>become :</p>
<p>[java]public class Bar {
    private Foo foo;
    private Bar parent;</p>
<div class="code"><pre><span class="err">@</span><span class="n">Override</span>
<span class="n">public</span> <span class="n">boolean</span> <span class="n">equals</span><span class="p">(</span><span class="n">Object</span> <span class="n">obj</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">obj</span> <span class="o">==</span> <span class="n">this</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">obj</span> <span class="n">instanceof</span> <span class="n">Bar</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Bar</span> <span class="n">other</span> <span class="o">=</span> <span class="p">(</span><span class="n">Bar</span><span class="p">)</span> <span class="n">obj</span><span class="p">;</span>

        <span class="k">return</span> <span class="n">Objects</span><span class="p">.</span><span class="n">equals</span><span class="p">(</span><span class="n">foo</span><span class="p">,</span> <span class="n">other</span><span class="p">.</span><span class="n">foo</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">amp</span><span class="p">;</span> <span class="n">Objects</span><span class="p">.</span><span class="n">equals</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="n">other</span><span class="p">.</span><span class="n">parent</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>}</p>
<p>[/java]</p>
<p>Better, no ?</p>
<p>And the last one : &lt;T&gt; int <strong>compare</strong>(T a, T b, Comparator&lt;? super T&gt; c). This method returns 0 if a == b or if both are null otherwise c.compare(a, b). The support of null is delegated to the comparator.</p>
<p>We've covered all the features offered by this new class.</p>
<p>Of course, there is already some methods like that in librairies like Jarkarta Commons or Google Guava, but it's always better when we doesn't have to include a library for that kind of features.</p>
<p>I hope you found this post interesting.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/04/java-7-the-new-java-util-objects-class.html#disqus_thread" data-disqus-identifier="cache/posts/2010/04/java-7-the-new-java-util-objects-class.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/03/nio-2-path-api-java-7.html" class="u-url">NIO.2 : The new Path API in Java 7</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2010-03-31T06:55:52+00:00">2010-03-31 06:55</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><p>In Java 7 we'll see a new API to manipulate file paths. This is part of the NIO.2 API.</p>
<p>Instead of using the class <strong>java.io.File</strong> to manipulate a file of the file system of the computer we will now use the <strong>java.nio.file.Path</strong> class to manipulate a file in any file system (<strong>FileSystem</strong>). This <strong>FileSystem </strong>can use any storage place (<strong>FileStorage</strong>). To support several implementations, this new API is based on factories. With that, you doesn't have to care about the real implementation.</p>
<!--more-->

<p>A little example to start : In Java &lt; 7, you do that :</p>
<p>[java]File file = new File("index.html");[/java]</p>
<p>and with Java 7, you can do that :</p>
<p>[java]Path path = Paths.get("index.html");[/java]</p>
<p>To make the migration easier, the File class has a new method toPath() that allows you to transform File to Path :</p>
<p>[java]Path path = new File("index.html").toPath();[/java]</p>
<p>But, it's only useful for migration purpose, we will not use that normally.</p>
<p>By default, all the Path will refers to files in the basic file system (the file system of the computer), but this new API is totally modular. We could imagine an implementation of FileSystem for data in memory, on the network or a virtual file system.</p>
<p>Like File, a Path can also refer to a not existing file. That's only file path, not the data containing in a file.</p>
<p>If we look at the methods of this new class, we can see that we have almost the same methods than the File class. But there is an important difference. The methods of the Path class throws Exception and that's a really good points. In fact, with the old File methods, we doesn't know anything if there is a problem. Sometimes we know that a problem occured with a simple boolean, but that's all.</p>
<p>Now we can have the cause of the Exception, that's far better. Here is a little example to delete a file using File :</p>
<p>[java]if (!file.delete()){
    //What happens ?
}[/java]</p>
<p>and now using Path :</p>
<p>[java]try {      
    path.delete();    
} catch (IOException e) {
    // We can know the cause and have a good reaction
}[/java]</p>
<p>An other enormous difference is the access to the attributes of the denoted file. In the old style, we have only access to the properties available in all the operating system. Now with views we can access the basic views, existing for all the operating systems and more specific views (DOS and POSIX) for properties available only in certain operating systems.</p>
<p>Here is a little example to get the basic attributes of a Path :</p>
<p>[java]BasicFileAttributeView basicView = path.getFileAttributeView(BasicFileAttributeView.class, LinkOption.NOFOLLOW_LINKS); </p>
<p>//This attribute view is perhaps not available in this system</p>
<p>if (basicView != null) {
    BasicFileAttributes basic = basicView.readAttributes(); //Get the attributes of the view</p>
<div class="code"><pre><span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Path refers to a regular file : "</span> <span class="o">+</span> <span class="n">basic</span><span class="p">.</span><span class="n">isRegularFile</span><span class="p">());</span>
<span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Path refers to a directory : "</span> <span class="o">+</span> <span class="n">basic</span><span class="p">.</span><span class="n">isDirectory</span><span class="p">());</span>
<span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Path refers to a symbolic link : "</span> <span class="o">+</span> <span class="n">basic</span><span class="p">.</span><span class="n">isSymbolicLink</span><span class="p">());</span>
<span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Path refers to a file with a size of : "</span> <span class="o">+</span> <span class="n">basic</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Path refers to a file last created at : "</span> <span class="o">+</span> <span class="n">basic</span><span class="p">.</span><span class="n">creationTime</span><span class="p">());</span>
<span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Path refers to a file last accessed at : "</span> <span class="o">+</span> <span class="n">basic</span><span class="p">.</span><span class="n">lastAccessTime</span><span class="p">());</span>
<span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Path refers to a file last modified at  : "</span> <span class="o">+</span> <span class="n">basic</span><span class="p">.</span><span class="n">lastModifiedTime</span><span class="p">());</span>
</pre></div>


<p>}</p>
<p>[/java]</p>
<p>This methods can return null if the attribute is not supported. We can also do that for the DOS attributes :</p>
<p>[java]DosFileAttributeView dosView = path.getFileAttributeView(DosFileAttributeView.class); </p>
<p>//This attribute view is perhaps not available in this system</p>
<p>if (dosView != null) {
    DosFileAttributes dos = dosView.readAttributes(); //Get the attributes of the view</p>
<div class="code"><pre><span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Path refers to a hidden file : "</span> <span class="o">+</span> <span class="n">dos</span> <span class="p">.</span><span class="n">isHidden</span><span class="p">());</span>
<span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Path refers to a read only file : "</span> <span class="o">+</span> <span class="n">dos</span> <span class="p">.</span><span class="n">isReadOnly</span><span class="p">());</span>
<span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Path refers to a system file: "</span> <span class="o">+</span> <span class="n">dos</span> <span class="p">.</span><span class="n">isSystem</span><span class="p">());</span>
<span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Path refers to an archive file : "</span> <span class="o">+</span> <span class="n">dos</span> <span class="p">.</span><span class="n">isArchive</span><span class="p">());</span>
</pre></div>


<p>}</p>
<p>[/java]</p>
<p>You're really lucky if that works in Unix ;)</p>
<p>All the DOS and POSIX implementations extends the Basic view, so you can access all the basic attributes from an implementation view.</p>
<p>To make easier, there is also static methods in the Attributes class to access the attributes. By example :</p>
<p>[java]BasicFileAttributes basic = Attributes.readBasicFileAttributes(path);[/java]</p>
<p>In the other functionalities, we can note that this new API supports symbolic links (only if the system supports them, of course). Next, the Path class has also flows factories methods like newInputStream() or newByteChannel() to easily create streams to or from the Path. That's also an advantage because the system can choose the good stream implementations to open depending on the system specifications.</p>
<p>An other facility offered by Path, is stream on directories. It seems that you can iterate through a directory with an iterator. That's better than File.listFiles() because not all the File are loaded in memory and that's also a bit clearer in code :</p>
<p>[java]DirectoryStream directory = path.newDirectoryStream(); </p>
<p>try {
    for (Path p : directory) {
        System.out.println(p);
    }
} finally {
    directory.close();
}[/java]</p>
<p>And last, but not least, you can now watch for modifications in a directory with WatchService :</p>
<p>[java]WatchService watcher = path.getFileSystem().newWatchService(); </p>
<p>path.register(watcher,
      StandardWatchEventKind.ENTRY_CREATE,
      StandardWatchEventKind.ENTRY_MODIFY,
      StandardWatchEventKind.ENTRY_DELETE); </p>
<p>while (true) {
    WatchKey watchKey = watcher.take(); </p>
<div class="code"><pre><span class="k">for</span> <span class="p">(</span><span class="n">WatchEvent</span> <span class="n">event</span> <span class="o">:</span> <span class="n">watchKey</span> <span class="p">.</span><span class="n">pollEvents</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">event</span><span class="p">.</span><span class="n">kind</span><span class="p">()</span> <span class="o">+</span> <span class="s">" : "</span> <span class="o">+</span> <span class="n">event</span><span class="p">.</span><span class="n">context</span><span class="p">());</span>
<span class="p">}</span>

<span class="n">watchKey</span> <span class="p">.</span><span class="n">reset</span><span class="p">();</span>
</pre></div>


<p>}[/java]</p>
<p>That will use the services offered by the operating system (Notification, inotify, FSEvents). This is really easier than writing native code to do that, isn't it ?</p>
<p>Here we are. We've covered the main functionalities of the new Path API in Java 7.</p>
<p>I hope you find this article interesting and that helped you discovering the new features of Java 7.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/03/nio-2-path-api-java-7.html#disqus_thread" data-disqus-identifier="cache/posts/2010/03/nio-2-path-api-java-7.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/03/4-reasons-not-using-osmorc-anymore.html" class="u-url">4 reasons i'm not using Osmorc anymore</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2010-03-29T01:54:21+00:00">2010-03-29 01:54</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><p>After had many problems using Osmorc, the Intellij Idea plugin for OSGi support, i decided to no longer use it. Now, i make all manually.</p>
<p>I have several reasons to not be satisfied of this plugin.</p>
<p>First of all, this plugin display all the errors in OSGi configuration (Manifest, Activators and imports) but provide no way to quickly fix the problems by example by adding the imported package in the Import-Package Manifest Headers. Its a little disappointing when we are regular with Intellij Idea usage.</p>
<p>I find it really slow to launch OSGi Instances. Moreover, we cannot really control the osgi instance we launch. I hoped that we could at least manage the OSGi server using basic command line integration, but this is not possible.</p>
<p>When we make the project, all the OSGi modules are compiled and packaged and this could be a long process. During this process, when we have errors, the displayed messages aren't really understandable and there is no explanation on how to solve the problems.</p>
<p>And last but not least, the plugin is very unstable. I had a lot of errors using Osmorc. And i had also problem with the imports in Maven projects. All the imports we marked invalid and sometimes not recognized. Reimporting the maven projects solve occasionally the problems but it always reappears and make the compilation impossible.</p>
<p>I don't solved any of these problems and for that reasons i don't use Osmorc anymore.</p>
<p>I realized that this plugin doesn't offer me a lot of things and i could easily work without it.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/03/4-reasons-not-using-osmorc-anymore.html#disqus_thread" data-disqus-identifier="cache/posts/2010/03/4-reasons-not-using-osmorc-anymore.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/03/osgi-enterprise-4-2-available.html" class="u-url">OSGi 4.2 Entreprise Release is available !</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2010-03-24T01:37:01+00:00">2010-03-24 01:37</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><p>Hi,</p>
<p>Yesterday, at EclipseCon, the OSGi EEG has finished the OSGi 4.2 Entreprise Release and made it publicly available. You can downlad it <a title="OSGi Entreprise Release 4.2" href="http://www.osgi.org/Download/Release4V42" target="_blank">here</a>.</p>
<p>The news includes several new Entreprise use-cases and improves the OSGI programming model. Some JEE technologies has been add to the OSGi specification.</p>
<p>Here is an overview of the main new features :</p>
<p></p><ul>
    <li><strong>Blueprint </strong>: This is a standard based on Spring-DM. Like this last, it adds an IOC container to OSGi. It's reallay more comfortable to develop OSGi bundles with Spring DM and now, that's the standard. I think this a great news for the OSGi developers. With that new features, the developer can use the IOC container without binding the application to a specific container.</li>
    <li><strong>Framework Launching</strong> : If you wanted to embed an OSGi framework in your application, before this release, you needed to choose one implementation and bind your launching to this implementation. Now OSGi provides a a standard way to start an OSGi Framework.</li>
    <li><strong>Remove Services (and Admin) </strong>: Previously Distributed OSGi, this functionality enables your services to be distributed to remote consumers and enables your bundles to consume remote services. Your remote services doesn't need to implement a specific interface, you just have to configure some properties to make your services remote.</li>
    <li><strong>Web Applications</strong> : This is a standard way to deploy war files in an OSGI Framework. In the past, we can already do that with PAX-Web by example, but that was not standard. This adds several Manifest Headers (context path by example) and give a way to the web application to communicate with the others bundles.</li>
    <li><strong>JDBC specification</strong> : Adds a simple DataSourceFactory class to register the drivers and APIs to get these drivers and DataSource. So you don't need anymore to use complicated private packages to make your JDBC Driver work in your OSGi bundle.</li>
    <li><strong>JPA </strong>: Describes a way to use JPA from an OSGi application. That alllows you to update JPA implementation without restarting it and you can have several JPA Providers in the same system. This specification works in pair with the JDBC specification we talked above.</li>
    <li><strong>JNDI</strong> : Simple bridge between the OSGi Service Registry and JNDI. Now you can lookup BundleContext  or OSGi Service with JNDI. And you can also obtain a JNDI Initial context from OSGi. Your JTA Implementation will be discovered and also appeared in the Service Registry.</li>
    <li><strong>JMX</strong> : With this specification you can access to OSGi Framework with JMX. You can install, uninstall, start and stop a bundle and get informations about the installed bundles and services.</li>
</ul>
<p>The main purposes of this Enterprise Release is to make the deploy of OSGi Framework in enterprise environment easier. But these features can of course also be used in not-enterprise environment.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/03/osgi-enterprise-4-2-available.html#disqus_thread" data-disqus-identifier="cache/posts/2010/03/osgi-enterprise-4-2-available.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/03/bundle-non-osgi-dependencies-maven.html" class="u-url">Bundle non-OSGi dependencies with Maven</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2010-03-19T15:41:29+00:00">2010-03-19 15:41</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><p>When we work with OSGi, a problem we always have is how to work with dependencies non OSGi Ready.</p>
<p>This is not a really great problem because there we can work with. There is essentially two solutions :</p>
<p></p><ul>
    <li>Embed the JAR files within the bundle. That is to say putting the JAR file into the bundle JAR and reference it in the Manifest</li>
    <li>Wrap the JAR files with an OSGi Manifest. Namely, transform the JAR into an OSGi bundle.</li>
</ul>
<p>Personnaly, i doesn't like the first solution, because for me, having a jar into a jar sounds really weird and bad and i prefer to have real OSGi Bundle. With wrapping, if i need this library in an other bundle, i doesn't have to do anything.</p>
<!--more-->

<p>But, yes there is a but, wrapping a jar is much complicated than embedding. Because, we much transform the JAR into a real OSGi Bundle. That is to say that we much create a new JAR with a Manifest, importing all the needed packages, exporting all the necessary packages, computing the names and version, ...</p>
<p>If we must do that by hand, that could be really long and hard to do.</p>
<p>We can do that in a simple way using Maven 2 and the maven-bundle-plugin that can generate an OSGi jar embedding the other using the BND tools. With some configurations, we can simply create a totally valid OSGi Bundle. To make several bundles  easily, i created a simple parent pom (i take the first sources from Spring Blog) and all the modules of this parent project will be simple project to wrap a dependency.</p>
<p>Here is the parent pom i use :</p>
<p>[xml]&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p>
<p>&lt;project
        xmlns="http://maven.apache.org/POM/4.0.0"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd"&gt;</p>
<div class="code"><pre><span class="ni">&amp;lt;</span>modelVersion<span class="ni">&amp;gt;</span>4.0.0<span class="ni">&amp;lt;</span>/modelVersion<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>groupId<span class="ni">&amp;gt;</span>org.jtheque<span class="ni">&amp;lt;</span>/groupId<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>artifactId<span class="ni">&amp;gt;</span>jtheque-osgi-wrap<span class="ni">&amp;lt;</span>/artifactId<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>name<span class="ni">&amp;gt;</span>jtheque-osgi-wrap<span class="ni">&amp;lt;</span>/name<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>packaging<span class="ni">&amp;gt;</span>pom<span class="ni">&amp;lt;</span>/packaging<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>version<span class="ni">&amp;gt;</span>1.0<span class="ni">&amp;lt;</span>/version<span class="ni">&amp;gt;</span>

<span class="ni">&amp;lt;</span>modules<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>!-- Modules --<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>/modules<span class="ni">&amp;gt;</span>

<span class="ni">&amp;lt;</span>properties<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>export.packages<span class="ni">&amp;gt;</span><span class="cp">${</span><span class="n">export</span><span class="o">.</span><span class="n">package</span><span class="cp">}</span>*;version=<span class="cp">${</span><span class="n">unpack</span><span class="o">.</span><span class="n">version</span><span class="cp">}</span><span class="ni">&amp;lt;</span>/export.packages<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>import.packages<span class="ni">&amp;gt;</span>*<span class="ni">&amp;lt;</span>/import.packages<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>private.packages<span class="ni">&amp;gt;</span>!*<span class="ni">&amp;lt;</span>/private.packages<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>symbolic.name<span class="ni">&amp;gt;</span><span class="cp">${</span><span class="n">pom</span><span class="o">.</span><span class="n">groupId</span><span class="cp">}</span>.<span class="cp">${</span><span class="n">pom</span><span class="o">.</span><span class="n">artifactId</span><span class="cp">}</span><span class="ni">&amp;lt;</span>/symbolic.name<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>embed-dep<span class="ni">&amp;gt;</span>*;scope=compile;type=!pom;inline=true<span class="ni">&amp;lt;</span>/embed-dep<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>unpack-bundle<span class="ni">&amp;gt;</span>false<span class="ni">&amp;lt;</span>/unpack-bundle<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>/properties<span class="ni">&amp;gt;</span>

<span class="ni">&amp;lt;</span>build<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>directory<span class="ni">&amp;gt;</span><span class="cp">${</span><span class="n">env</span><span class="o">.</span><span class="n">BUILD_HOME</span><span class="cp">}</span>/dependencies/<span class="cp">${</span><span class="n">symbolic</span><span class="o">.</span><span class="n">name</span><span class="cp">}</span><span class="ni">&amp;lt;</span>/directory<span class="ni">&amp;gt;</span>

    <span class="ni">&amp;lt;</span>plugins<span class="ni">&amp;gt;</span>
        <span class="ni">&amp;lt;</span>plugin<span class="ni">&amp;gt;</span>
            <span class="ni">&amp;lt;</span>groupId<span class="ni">&amp;gt;</span>org.apache.felix<span class="ni">&amp;lt;</span>/groupId<span class="ni">&amp;gt;</span>
            <span class="ni">&amp;lt;</span>artifactId<span class="ni">&amp;gt;</span>maven-bundle-plugin<span class="ni">&amp;lt;</span>/artifactId<span class="ni">&amp;gt;</span>
            <span class="ni">&amp;lt;</span>version<span class="ni">&amp;gt;</span>1.2.0<span class="ni">&amp;lt;</span>/version<span class="ni">&amp;gt;</span>
            <span class="ni">&amp;lt;</span>configuration<span class="ni">&amp;gt;</span>
                <span class="ni">&amp;lt;</span>unpackBundle<span class="ni">&amp;gt;</span><span class="cp">${</span><span class="n">unpack</span><span class="o">.</span><span class="n">bundle</span><span class="cp">}</span><span class="ni">&amp;lt;</span>/unpackBundle<span class="ni">&amp;gt;</span>
                <span class="ni">&amp;lt;</span>instructions<span class="ni">&amp;gt;</span>
                    <span class="ni">&amp;lt;</span>Bundle-Name<span class="ni">&amp;gt;</span><span class="cp">${</span><span class="n">artifactId</span><span class="cp">}</span><span class="ni">&amp;lt;</span>/Bundle-Name<span class="ni">&amp;gt;</span>
                    <span class="ni">&amp;lt;</span>Bundle-SymbolicName<span class="ni">&amp;gt;</span><span class="cp">${</span><span class="n">symbolic</span><span class="o">.</span><span class="n">name</span><span class="cp">}</span><span class="ni">&amp;lt;</span>/Bundle-SymbolicName<span class="ni">&amp;gt;</span>
                    <span class="ni">&amp;lt;</span>Bundle-Description<span class="ni">&amp;gt;</span><span class="cp">${</span><span class="n">pom</span><span class="o">.</span><span class="n">name</span><span class="cp">}</span><span class="ni">&amp;lt;</span>/Bundle-Description<span class="ni">&amp;gt;</span>
                    <span class="ni">&amp;lt;</span>Import-Package<span class="ni">&amp;gt;</span><span class="cp">${</span><span class="n">import</span><span class="o">.</span><span class="n">packages</span><span class="cp">}</span><span class="ni">&amp;lt;</span>/Import-Package<span class="ni">&amp;gt;</span>
                    <span class="ni">&amp;lt;</span>Private-Package<span class="ni">&amp;gt;</span><span class="cp">${</span><span class="n">private</span><span class="o">.</span><span class="n">packages</span><span class="cp">}</span><span class="ni">&amp;lt;</span>/Private-Package<span class="ni">&amp;gt;</span>
                    <span class="ni">&amp;lt;</span>Include-Resource<span class="ni">&amp;gt;</span><span class="cp">${</span><span class="n">include</span><span class="o">.</span><span class="n">resources</span><span class="cp">}</span><span class="ni">&amp;lt;</span>/Include-Resource<span class="ni">&amp;gt;</span>
                    <span class="ni">&amp;lt;</span>Embed-Dependency<span class="ni">&amp;gt;</span><span class="cp">${</span><span class="n">embed</span><span class="o">-</span><span class="n">dep</span><span class="cp">}</span><span class="ni">&amp;lt;</span>/Embed-Dependency<span class="ni">&amp;gt;</span>
                    <span class="ni">&amp;lt;</span>_exportcontents<span class="ni">&amp;gt;</span><span class="cp">${</span><span class="n">export</span><span class="o">.</span><span class="n">packages</span><span class="cp">}</span><span class="ni">&amp;lt;</span>/_exportcontents<span class="ni">&amp;gt;</span>
                <span class="ni">&amp;lt;</span>/instructions<span class="ni">&amp;gt;</span>
            <span class="ni">&amp;lt;</span>/configuration<span class="ni">&amp;gt;</span>
            <span class="ni">&amp;lt;</span>extensions<span class="ni">&amp;gt;</span>true<span class="ni">&amp;lt;</span>/extensions<span class="ni">&amp;gt;</span>
        <span class="ni">&amp;lt;</span>/plugin<span class="ni">&amp;gt;</span>
    <span class="ni">&amp;lt;</span>/plugins<span class="ni">&amp;gt;</span>
<span class="ni">&amp;lt;</span>/build<span class="ni">&amp;gt;</span>
</pre></div>


<p>&lt;/project&gt;[/xml]</p>
<p>That really simple, we use some properties to generify the process to have really simple modules. </p>
<p>Here is an example to wrap the substance look and feel library : </p>
<p>[xml]&lt;?xml version="1.0" encoding="UTF-8"?&gt;</p>
<p>&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;</p>
<div class="code"><pre><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">modelVersion</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="mf">4.0.0</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">modelVersion</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
<span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">groupId</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">org</span><span class="p">.</span><span class="n">substance</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">groupId</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
<span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">packaging</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">bundle</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">packaging</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
<span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">artifactId</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">org</span><span class="p">.</span><span class="n">jtheque</span><span class="p">.</span><span class="n">substance</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">artifactId</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
<span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">name</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">apple</span><span class="o">-</span><span class="n">extensions</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">name</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
<span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">version</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="mf">6.0.0</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">version</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>

<span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">parent</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
    <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">artifactId</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">jtheque</span><span class="o">-</span><span class="n">osgi</span><span class="o">-</span><span class="n">wrap</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">artifactId</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
    <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">groupId</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">org</span><span class="p">.</span><span class="n">jtheque</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">groupId</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
    <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">version</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="mf">1.0</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">version</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
<span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">parent</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>

<span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">properties</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
    <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">unpack</span><span class="p">.</span><span class="n">version</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="mf">6.0.0</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">unpack</span><span class="p">.</span><span class="n">version</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
    <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">export</span><span class="p">.</span><span class="n">package</span><span class="o">/&amp;</span><span class="n">gt</span><span class="p">;</span>
<span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">properties</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>

<span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">dependencies</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
    <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">dependency</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
        <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">groupId</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">org</span><span class="p">.</span><span class="n">substance</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">groupId</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
        <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">artifactId</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">substance</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">artifactId</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
        <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">version</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="mf">6.0</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">version</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
    <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">dependency</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
<span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">/</span><span class="n">dependencies</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span>
</pre></div>


<p>&lt;/project&gt;[/xml]</p>
<p>Like you can see, that's really simple and that generates a great OSGi Bundle. Here i didnt' specify any export package. Doing that all the packages are exported except the ones containing impl or internal. </p>
<p>Thats it :)</p>
<p>I hope that this post will be useful to some of you. </p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/03/bundle-non-osgi-dependencies-maven.html#disqus_thread" data-disqus-identifier="cache/posts/2010/03/bundle-non-osgi-dependencies-maven.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/03/mock-objects-easymock.html" class="u-url">Mock objects with EasyMock</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2010-03-18T06:53:54+00:00">2010-03-18 06:53</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><h4>1. Introduction</h4>
The mock objects allows to make unit tests on objects depending on other objects. We will replace this dependencies with mock objects. With that, we can by example verify than the method xyzzy() has been called 5 times and returned 33. That can be practical in a several cases. By exampe, if the object to mock is slow or undeterministic (depending on time, or why not on the weather). This objects are really difficult to test because we can make a lot of tests but we could never find the special cases. Test cases with mock objects enable us to test this cases.
<!--more-->

<p>There is several tools to make mock objects. In this article, we will use EasyMock 2.5.2 with JUnit 4.7.</p>
<p>Here is the interface to test :</p>
<p>[java]public interface ISimpleDao {
    void save(String title);
    void remove(String title) throws NotExistingException;
    int count();
    void debug();
    boolean isValid(String title);
    void insert(String title);
}[/java]</p>
<p>And here is our class to test :</p>
<p>[java]public class SimpleService {
    private ISimpleDao dao;</p>
<div class="code"><pre><span class="n">public</span> <span class="kt">void</span> <span class="nf">setDao</span><span class="p">(</span><span class="n">ISimpleDao</span> <span class="n">dao</span><span class="p">){</span>
    <span class="n">this</span><span class="p">.</span><span class="n">dao</span> <span class="o">=</span> <span class="n">dao</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">public</span> <span class="kt">void</span> <span class="nf">insert</span><span class="p">(</span><span class="n">String</span> <span class="n">title</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="n">dao</span><span class="p">.</span><span class="n">isValid</span><span class="p">(</span><span class="n">title</span><span class="p">)){</span>
        <span class="n">dao</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">title</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="p">(</span><span class="n">String</span><span class="p">...</span> <span class="n">titles</span><span class="p">){</span>
    <span class="k">for</span><span class="p">(</span><span class="n">String</span> <span class="n">title</span> <span class="o">:</span> <span class="n">titles</span><span class="p">){</span>
        <span class="n">dao</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="n">title</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">public</span> <span class="n">boolean</span> <span class="nf">remove</span><span class="p">(</span><span class="n">String</span> <span class="n">title</span><span class="p">){</span>
    <span class="n">try</span> <span class="p">{</span>
        <span class="n">dao</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="n">title</span><span class="p">);</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">NotExistingException</span> <span class="n">e</span><span class="p">){</span>
        <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">public</span> <span class="kt">int</span> <span class="nf">size</span><span class="p">(){</span>
    <span class="k">return</span> <span class="n">dao</span><span class="p">.</span><span class="n">count</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">public</span> <span class="kt">void</span> <span class="nf">debug</span><span class="p">(){</span>
    <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"Debug informations of SimpleService"</span><span class="p">);</span>
    <span class="n">dao</span><span class="p">.</span><span class="n">debug</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>


<p>[/java]</p>
<p>Our mock will implement the ISimpleDao interface and we will give it to SimpleService who's the class to test. This example is really simplistic, but it will be enough to cover the main features of EasyMock.</p>
<!--nextpage-->

<h4>2. Verify a behaviour</h4>

<p>Here is the structure i will use in this article :</p>
<p>[java]import org.junit.Before;</p>
<p>import org.junit.Test;</p>
<p>import static org.junit.Assert.*;</p>
<p>import static org.easymock.EasyMock.*;</p>
<p>public class SimpleServiceTest {
    private SimpleService simpleService;
    private ISimpleDao simpleDaoMock;</p>
<div class="code"><pre><span class="err">@</span><span class="n">Before</span>
<span class="n">public</span> <span class="kt">void</span> <span class="n">setUp</span><span class="p">(){</span>
    <span class="n">simpleService</span> <span class="o">=</span> <span class="n">new</span> <span class="n">SimpleService</span><span class="p">();</span>
    <span class="n">simpleService</span><span class="p">.</span><span class="n">setDao</span><span class="p">(</span><span class="n">simpleDaoMock</span><span class="p">);</span>
<span class="p">}</span>

<span class="err">@</span><span class="n">Test</span>
<span class="n">public</span> <span class="kt">void</span> <span class="n">insertValid</span><span class="p">(){}</span>

<span class="err">@</span><span class="n">Test</span>
<span class="n">public</span> <span class="kt">void</span> <span class="n">insertNotValid</span><span class="p">(){}</span>

<span class="err">@</span><span class="n">Test</span>
<span class="n">public</span> <span class="kt">void</span> <span class="n">save</span><span class="p">(){}</span>

<span class="err">@</span><span class="n">Test</span>
<span class="n">public</span> <span class="kt">void</span> <span class="n">removeWithoutException</span><span class="p">()</span> <span class="n">throws</span> <span class="n">NotExistingException</span> <span class="p">{}</span>

<span class="err">@</span><span class="n">Test</span>
<span class="n">public</span> <span class="kt">void</span> <span class="n">removeWithException</span><span class="p">()</span> <span class="n">throws</span> <span class="n">NotExistingException</span> <span class="p">{}</span>

<span class="err">@</span><span class="n">Test</span>
<span class="n">public</span> <span class="kt">void</span> <span class="n">size</span><span class="p">(){}</span>

<span class="err">@</span><span class="n">Test</span>
<span class="n">public</span> <span class="kt">void</span> <span class="n">debug</span><span class="p">(){}</span>
</pre></div>


<p>}[/java]</p>
<p>First of all, we'll start with create a mock object. For that, we've to use the EasyMock class and its method createMock, with the interface in parameter. To improve code readability, we use a static import like what we do in general with JUnit.</p>
<p>[java]import org.junit.Before;</p>
<p>import org.junit.Test;</p>
<p>import static org.junit.Assert.*;</p>
<p>import static org.easymock.EasyMock.*;</p>
<p>public class SimpleServiceTest {
    private SimpleService simpleService;
    private ISimpleDao simpleDaoMock;</p>
<div class="code"><pre><span class="err">@</span><span class="n">Before</span>
<span class="n">public</span> <span class="kt">void</span> <span class="n">setUp</span><span class="p">(){</span>
    <span class="n">simpleDaoMock</span> <span class="o">=</span> <span class="n">createMock</span><span class="p">(</span><span class="n">ISimpleDao</span><span class="p">.</span><span class="n">class</span><span class="p">);</span>

    <span class="n">simpleService</span> <span class="o">=</span> <span class="n">new</span> <span class="n">SimpleService</span><span class="p">();</span>
    <span class="n">simpleService</span><span class="p">.</span><span class="n">setDao</span><span class="p">(</span><span class="n">simpleDaoMock</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>


<p>}[/java]</p>
<p>This will create a mock objet implementing ISimpleDao interface. The first thing we can do with EasyMock is verify than a method has been called. EasyMock works like a recorder :</p>
<ul>
    <li>We play the desired sequence on the mock object.</li>
    <li>We record the played sequence.</li>
    <li>We test the object</li>
    <li>We verify that the test sequence correspond to the recorded one</li>
</ul>

<p>So, we'll test to start that the debug() method of SimpleService call the debug() method of our Dao :</p>
<p>[java]@Test</p>
<p>public void debug(){
    simpleDaoMock.debug();</p>
<div class="code"><pre><span class="n">replay</span><span class="p">(</span><span class="n">simpleDaoMock</span><span class="p">);</span>

<span class="n">simpleService</span><span class="p">.</span><span class="n">debug</span><span class="p">();</span>

<span class="n">verify</span><span class="p">(</span><span class="n">simpleDaoMock</span><span class="p">);</span>
</pre></div>


<p>}[/java]</p>
<p>The replay method enable to save the record and the verify method compare the two records are equals. If not equals, the verify method will launch AssertionError. If you launch the written test, it will executes fines, but if we comment the dao.debug() statement in SimpleSerivce, the test will fail :</p>
<pre>java.lang.AssertionError:
  Expectation failure on verify:
    debug(): expected: 1, actual: 0
    at org.easymock.internal.MocksControl.verify(MocksControl.java:111)
    at org.easymock.EasyMock.verify(EasyMock.java:1608)
    at com.dvp.wichtounet.easymock.SimpleServiceTest.debug(SimpleServiceTest.java:45)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
    at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
    at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
    at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
    at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
    at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)
    at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
    at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
    at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
    at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
    at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
    at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
    at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
    at org.junit.runner.JUnitCore.run(JUnitCore.java:157)
    at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:94)
    at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:165)
    at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:60)
    at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
    at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
    at com.intellij.rt.execution.application.AppMain.main(AppMain.java:110)</pre>

<p>So, EasyMock has detected that the method has not bee called and the test fails. If you want to verify that a non-void method has been called , you will have an IllegalStateException because no return behaviour has been specified. We will see that in the next chapter.</p>
<!--nextpage-->

<h4>3. Wait for return values</h4>

<p>We will now work with methods returning values. In this case, we've to define a return behaviour. To do that, we must use the expect() method to encapsulate the call and the andReturn() method to specify a return value. Here is how we can test the size() method :</p>
<p>[java]@Test</p>
<p>public void size(){
    expect(simpleDaoMock.count()).andReturn(32);</p>
<div class="code"><pre><span class="n">replay</span><span class="p">(</span><span class="n">simpleDaoMock</span><span class="p">);</span>

<span class="n">assertEquals</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">simpleService</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>

<span class="n">verify</span><span class="p">(</span><span class="n">simpleDaoMock</span><span class="p">);</span>
</pre></div>


<p>}[/java]</p>
<p>With that, we make two tests, we verify that the count method has been called and that size() return the same value as count(). That is the case if we launch the test. We can see that it's really simple to specify a return value for a mocked method.</p>
<h4>4. Work with exceptions</h4>

<p>EasyMock can also work with exceptions. We can use again the expect() method, but this times we will use the andThrow method to specify the throwed exception. Here is what we can do with the remove() method test with and without exception :</p>
<p>[java]@Test</p>
<p>public void removeWithoutException() throws NotExistingException {
    simpleDaoMock.remove("Mary");</p>
<div class="code"><pre><span class="n">replay</span><span class="p">(</span><span class="n">simpleDaoMock</span><span class="p">);</span>

<span class="n">assertTrue</span><span class="p">(</span><span class="n">simpleService</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">"Mary"</span><span class="p">));</span>

<span class="n">verify</span><span class="p">(</span><span class="n">simpleDaoMock</span><span class="p">);</span>
</pre></div>


<p>}</p>
<p>@Test</p>
<p>public void removeWithException() throws NotExistingException {
    simpleDaoMock.remove("Arthur");</p>
<div class="code"><pre><span class="n">expectLastCall</span><span class="p">().</span><span class="n">andThrow</span><span class="p">(</span><span class="n">new</span> <span class="n">NotExistingException</span><span class="p">());</span>

<span class="n">replay</span><span class="p">(</span><span class="n">simpleDaoMock</span><span class="p">);</span>

<span class="n">assertFalse</span><span class="p">(</span><span class="n">simpleService</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">"Arthur"</span><span class="p">));</span>

<span class="n">verify</span><span class="p">(</span><span class="n">simpleDaoMock</span><span class="p">);</span>
</pre></div>


<p>}[/java]</p>
<p>Once again, only one method call is enough to specify a behaviour. I think it's here that we can see the power of mocks objects.</p>
<!--nextpage-->

<h4>5. Miscellaneous</h4>

<h5>5.1. Verify the number of calls</h5>

<p>Now we can test the save() method :</p>
<p>[java]@Test</p>
<p>public void save(){
    simpleDaoMock.save("xyzzy");
    simpleDaoMock.save("xyzzy");
    simpleDaoMock.save("xyzzy");
    simpleDaoMock.save("xyzzy");
    simpleDaoMock.save("xyzzy");</p>
<div class="code"><pre><span class="n">replay</span><span class="p">(</span><span class="n">simpleDaoMock</span><span class="p">);</span>

<span class="n">simpleService</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">"xyzzy"</span><span class="p">,</span> <span class="s">"xyzzy"</span><span class="p">,</span> <span class="s">"xyzzy"</span><span class="p">,</span> <span class="s">"xyzzy"</span><span class="p">,</span> <span class="s">"xyzzy"</span><span class="p">);</span>

<span class="n">verify</span><span class="p">(</span><span class="n">simpleDaoMock</span><span class="p">);</span>
</pre></div>


<p>}[/java]</p>
<p>This kind of code is really heavy to write with a high number of calls. We have two solutions. We can do a loop for all the calls or use the times() method of EasyMock :</p>
<p>[java]@Test</p>
<p>public void save(){
    simpleDaoMock.save("xyzzy");</p>
<div class="code"><pre><span class="n">expectLastCall</span><span class="p">().</span><span class="n">times</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>

<span class="n">replay</span><span class="p">(</span><span class="n">simpleDaoMock</span><span class="p">);</span>

<span class="n">simpleService</span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">"xyzzy"</span><span class="p">,</span> <span class="s">"xyzzy"</span><span class="p">,</span> <span class="s">"xyzzy"</span><span class="p">,</span> <span class="s">"xyzzy"</span><span class="p">,</span> <span class="s">"xyzzy"</span><span class="p">);</span>

<span class="n">verify</span><span class="p">(</span><span class="n">simpleDaoMock</span><span class="p">);</span>
</pre></div>


<p>}[/java]</p>
<p>A lot clearer, no ? It's also possible to specify that a method must called any times with the anyTimes() method and an interval of times with the times(min,max) method.</p>
<h5>5.2. Verify calls order</h5>

<p>We will now test the insert() method :</p>
<p>[java]@Test</p>
<p>public void insertValid(){
    expect(simpleDaoMock.isValid("Arthur")).andReturn(true);</p>
<div class="code"><pre><span class="n">simpleDaoMock</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">"Arthur"</span><span class="p">);</span>

<span class="n">replay</span><span class="p">(</span><span class="n">simpleDaoMock</span><span class="p">);</span>

<span class="n">simpleService</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">"Arthur"</span><span class="p">);</span>

<span class="n">verify</span><span class="p">(</span><span class="n">simpleDaoMock</span><span class="p">);</span>
</pre></div>


<p>}</p>
<p>@Test</p>
<p>public void insertNotValid(){
    expect(simpleDaoMock.isValid("Arthur")).andReturn(false);</p>
<div class="code"><pre><span class="n">replay</span><span class="p">(</span><span class="n">simpleDaoMock</span><span class="p">);</span>

<span class="n">simpleService</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="s">"Arthur"</span><span class="p">);</span>

<span class="n">verify</span><span class="p">(</span><span class="n">simpleDaoMock</span><span class="p">);</span>
</pre></div>


<p>}[/java]</p>
<p>You're going to say that we've already seen all that stuff. But in that kind of case, it could be interesting to verify that the calls are in the good order. Indeed, if the method isValid() is called after the insert, that's really useful. With EasyMock, there is two ways to verify calls order. First, you can use the createStrictMock insted of createMock to create your mock or you can use the checkOrder(mock, true) method to specify that the mock is strict. A strict mock is simply a mock who cares about the order of the calls. So we can keep all our tests in the current state and just use one of this two methods and the order will be checked. Of course, we can verify the order only in certain tests methods. That can be done using checkOrder(mock, true) at the start of the test method.</p>
<h5>5.3. Mock a class</h5>

<p>EasyMock has an extension to mock classes and not interfaces. It's EasyMock Class Extesion. All the use is the same, we just have to use this import :</p>
<p>[java]import static org.easymock.classextension.EasyMock.*;[/java]</p>
<p>Moreover, we can also make a partial mocking with by example only one method :</p>
<p>[java]Mocked mock = createMockBuilder(Mocked.class).addMockedMethod("mockedMethod").createMock();[/java]</p>
<p>Keep in mind that the final classes are not supported and that the final methods are not mocked.</p>
<!--nextpage-->

<h4>6. Conclusion</h4>

<p>So, we have seen all the features of EasyMock to create mock objects for unit tests. Like you've seen, it's a really simple but powerful way to verify the behaviour of an object depending on an other. There are others libraries for mock objects like JMock, JMockit or Mockito, but personally, i think EasyMock is most comfortable to use and give all the features i need to make my own unit tests. That's why i choose this library to make this article.</p>
<p>I hope this article has interested you. Don't hesitate to comment it ;)</p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/03/mock-objects-easymock.html#disqus_thread" data-disqus-identifier="cache/posts/2010/03/mock-objects-easymock.html">Comments</a>


        </p></article>
    
        <div>
        <ul class="pager">
            <li class="previous">
                <a href="index-4.html" rel="prev">← Newer posts</a>
            </li>
            <li class="next">
                <a href="index-2.html" rel="next">Older posts →</a>
            </li>
        </ul>
        </div>

    
        
       <script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>


	


            </div>
            <!--End of body content-->
        </div>
    </div>
</div>

<!-- Footer -->

<footer>
    Contents © 2014         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/4.0/88x31.png"></a>
        <ul class="footer_inline_ul">
            
        </ul>
</footer>


            <script src="assets/js/all-nocdn.js" type="text/javascript"></script>


    
<!-- AddThis Smart Layers BEGIN -->
<!-- Go to http://www.addthis.com/get/smart-layers to customize -->
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5327566b264df4ee"></script>
<script type="text/javascript">
  addthis.layers({
    'theme' : 'dark',
    'share' : {
      'position' : 'right',
      'numPreferredServices' : 5
    }, 
    'follow' : {
      'services' : [
        {'service': 'twitter', 'id': 'wichtounet'},
        {'service': 'google_follow', 'id': '+BaptisteWicht'}
      ]
    }   
  });
</script>
<!-- AddThis Smart Layers END -->


    <script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script>
    

<script type="text/javascript" src="assets/js/tipuesearch_set.js"></script>
<script type="text/javascript" src="assets/js/tipuesearch.js"></script>
<script type="text/javascript">
$(document).ready(function() {
  $('#tipue_search_input').tipuesearch({
      'mode': 'json',
      'contentLocation': '/assets/js/tipuesearch_content.json',
      'showUrl': false
  });
});
</script>


</body></html>