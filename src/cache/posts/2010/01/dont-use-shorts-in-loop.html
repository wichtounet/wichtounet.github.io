<p><html><body><p>After a post I read on a french forum, i asked myself of the performances using shorts as loop indexes for loop with few iterations (less than 32768).</p>
<p>At first view, it can be tempting because we save 2 octets, so why use an int instead a short ?</p>
<p>But, when we think of that, we see that the int is more adapted. Indeed, it's more performant.</p>
<p>Why ?</p>
<!--more-->

<p>In Java language, all the operations on integers are made in int. Thus, if we use a short as loop index, at each iterations, a typecasting will be made, that's really heavier than a simple affectation to int.</p>
<p>Here were my first results :</p>
<p></p><pre>Time for int : 1441 ms</p>
<p>Time for short : 3015 ms</pre></p>
<p>The short version is two times slower !</p>
<p>But like Jean have said, my first test was not correct at all because it doesn't consider some issues that could occurs with micro-benchmarks.</p>
<p>So I write a new test using a Java Benchmarking framework from Brent Boyer. Here is a little test with that framework :</p>
<p>[java]package com.wicht;</p>
<p>import bb.util.Benchmark;</p>
<p>import java.util.concurrent.Callable;</p>
<p>public class ShortIndexesLoop {
    public static void main(String[] args) {
        Callable callableInt = new Callable(){
            public Long call() throws Exception {
                long result = 0;</p>
<div class="code"><pre>            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">f</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">lt</span><span class="p">;</span> <span class="mi">32760</span><span class="p">;</span> <span class="n">f</span><span class="o">++</span><span class="p">){</span>
                  <span class="n">result</span> <span class="o">+=</span> <span class="n">f</span><span class="p">;</span>
              <span class="p">}</span>

            <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="n">Callable</span> <span class="n">callableShort</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Callable</span><span class="p">(){</span>
        <span class="n">public</span> <span class="n">Long</span> <span class="n">call</span><span class="p">()</span> <span class="n">throws</span> <span class="n">Exception</span> <span class="p">{</span>
            <span class="kt">long</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">short</span> <span class="n">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">f</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">lt</span><span class="p">;</span> <span class="mi">32760</span><span class="p">;</span> <span class="n">f</span><span class="o">++</span><span class="p">){</span>
                  <span class="n">result</span> <span class="o">+=</span> <span class="n">f</span><span class="p">;</span>
              <span class="p">}</span>

            <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="n">try</span> <span class="p">{</span>
        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Result with int &quot;</span> <span class="o">+</span> <span class="n">new</span> <span class="n">Benchmark</span><span class="p">(</span><span class="n">callableInt</span><span class="p">));</span>
        <span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">&quot;Result with short &quot;</span> <span class="o">+</span> <span class="n">new</span> <span class="n">Benchmark</span><span class="p">(</span><span class="n">callableShort</span><span class="p">));</span>
    <span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>}[/java]</p>
<p>And here are the results :</p>
<pre>Result with int first = 695.181 us, mean = 43.233 us (CI deltas: -49.358 ns, +74.073 ns), sd = 42.938 us (CI deltas: -11.634 us, +16.426 us)

Result with short first = 733.224 us, mean = 45.679 us (CI deltas: -62.975 ns, +63.932 ns), sd = 45.567 us (CI deltas: -5.877 us, +8.020 us)</pre>

<p>So the results are lower. This time, the short version is 5.657% slower than the int version. Note that this can vary a lot depending on your configuration.</p>
<p>I talk here of for loops, but the case is the same when you use while loops with indexes.</p>
<p>Here are also the results with long, double and float versions :</p>
<pre>Result with long first = 816.555 us, mean = 104.771 us (CI deltas: -236.563 ns, +344.219 ns), sd = 143.295 us (CI deltas: -39.149 us, +63.700 us)

Result with float first = 1.018 ms, mean = 58.055 us (CI deltas: -87.036 ns, +113.537 ns), sd = 70.757 us (CI deltas: -14.269 us, +19.962 us)

Result with double first = 912.115 us, mean = 57.918 us (CI deltas: -66.644 ns, +91.312 ns), sd = 55.185 us (CI deltas: -12.617 us, +25.160 us)</pre>

<p>We can see that the long version is the slowest one and that float and double are equivalent but slower than int and short.</p>
<p>To conclude, always use int as loop indexes add a very little improvements of performances, but not a great thing and do not use long for loops indexes.</body></html></p>