<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Tutorials and short posts about programming, C++, Java, Assembly, Operating Systems Development, Compilers, ...">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Blog blog("Baptiste Wicht"); (old posts, page 26) | Blog blog("Baptiste Wicht");</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="rss.xml">
<link rel="canonical" href="https://baptiste-wicht.com/index-26.html">
<link rel="prev" href="index-27.html" type="text/html">
<link rel="next" href="index-25.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link href="favicon.ico" rel="icon" type="image/x-icon">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-2175227-7', 'auto');
  var metas = document.getElementsByTagName('meta'), tagsList = [];
  for (var i=0; i<metas.length; i++) {
    if (metas[i].getAttribute('property') == 'article:tag') {
      tagsList.push( metas[i].getAttribute('content'));
    }
  }
  ga('set', 'dimension1', tagsList.join('|'));
  ga('send', 'pageview');
</script>
</head>
<body>

<!-- Menubar -->

<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<div class="container-fluid">
<!-- This keeps the margins nice -->
    <div class="row">
        <div class="col-sm-3 col-lg-2">
            <nav class="navbar navbar-inverse navbar-fixed-side"><div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="https://baptiste-wicht.com/">
                        <span id="blog-title">Blog blog("Baptiste Wicht");</span>
                    </a>
                </div>
<!-- /.navbar-header -->

                <div class="collapse navbar-collapse navbar-ex1-collapse">
                    <ul class="nav navbar-nav">
<li>
<a href="stories/about.html">About</a>
                </li>
<li>
<a href="stories/publications.html">Publications</a>
                </li>
<li>
<a href="stories/projects.html">Projects</a>
                </li>
<li>
<a href="categories/index.html">Tags</a>
                </li>
<li>
<a href="archive.html">Archives</a>



                        </li>
<li class="wicht-navbar-right">
                            <a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
                                <img src="assets/img/twitter.png" alt="Follow @wichtounet on Twitter"></a>
                        </li>

                    </ul>
</div>
<!-- /.navbar-collapse -->
            </nav>
</div> <!-- col -->
        <div class="col-sm-9 col-lg-10">
            <div id="content"></div>
            
        <article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2014/09/short-introduction-to-deep-learning.html" class="u-url">Short introduction to deep learning</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2014-09-12T20:41:58+02:00">2014-09-12 20:41</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>At my school, I gave a short presentation about Deep Learning and the
implementation I made in C++.</p>
<p>It is nothing fancy, but it could be interesting to someone.</p>
<div style="text-align:center;"><iframe src="//www.slideshare.net/slideshow/embed_code/39024941" width="476" height="400" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe></div>
<p>Don't hesitate if you have any comments or questions about the presentation ;)</p>
<p>The implementation is here: <a class="reference external" href="https://github.com/wichtounet/dll">https://github.com/wichtounet/dll</a></p>
        </div>
            
    
    <a href="posts/2014/09/short-introduction-to-deep-learning.html#disqus_thread" data-disqus-identifier="cache/posts/2014/09/short-introduction-to-deep-learning.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html" class="u-url">A Mutt journey: Search mails with notmuch</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2014-08-02T17:24:12+02:00">2014-08-02 17:24</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>In the previous installment in the Mutt series, <a class="reference external" href="http://baptiste-wicht.com/posts/2014/07/a-mutt-journey-my-mutt-configuration.html">I've talked about my Mutt
configuration</a>.
In this post, I'll talk about notmuch and how to use it to search through mails.</p>
<p>By default, you can search mails in Mutt by using the / key. By doing that, you
can only search in the current folder. This is very fast, but this is not always
what you want. When you don't know in which folder the mail you are looking for
is, you don't want to test each folder. By default, there are no feature to
achieve global searching in Mutt.</p>
<p>That is where notmuch comes to the rescue. notmuch is a very simple tool that
allows you to search through your mail. As its name indicates, it does not do
much. It doesn't download your mails, you have to have them locally, which is
perfect <a class="reference external" href="http://baptiste-wicht.com/posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html">if you use offlineimap</a>.
It does not provide a user interface, but you can query it from the command line
and it can be used from other tools. It should be available in most of the
distributions.</p>
<section id="configuration-3"><h2>Configuration</h2>
<p>The configuration of notmuch is fairly simple. You can write your
<code>.notmuch-config</code> directly or run <code>notmuch setup</code> that will
interactively help you to fill the configuration.</p>
<p>Here is my configuration:</p>
<div class="code"><pre class="code text"><a id="rest_code_6b9275bcb8b1440588f0987c63ed4b54-1" name="rest_code_6b9275bcb8b1440588f0987c63ed4b54-1" href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#rest_code_6b9275bcb8b1440588f0987c63ed4b54-1"></a>[database]
<a id="rest_code_6b9275bcb8b1440588f0987c63ed4b54-2" name="rest_code_6b9275bcb8b1440588f0987c63ed4b54-2" href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#rest_code_6b9275bcb8b1440588f0987c63ed4b54-2"></a>path=/data/oi/Gmail/
<a id="rest_code_6b9275bcb8b1440588f0987c63ed4b54-3" name="rest_code_6b9275bcb8b1440588f0987c63ed4b54-3" href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#rest_code_6b9275bcb8b1440588f0987c63ed4b54-3"></a>
<a id="rest_code_6b9275bcb8b1440588f0987c63ed4b54-4" name="rest_code_6b9275bcb8b1440588f0987c63ed4b54-4" href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#rest_code_6b9275bcb8b1440588f0987c63ed4b54-4"></a>[user]
<a id="rest_code_6b9275bcb8b1440588f0987c63ed4b54-5" name="rest_code_6b9275bcb8b1440588f0987c63ed4b54-5" href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#rest_code_6b9275bcb8b1440588f0987c63ed4b54-5"></a>name=Baptiste Wicht
<a id="rest_code_6b9275bcb8b1440588f0987c63ed4b54-6" name="rest_code_6b9275bcb8b1440588f0987c63ed4b54-6" href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#rest_code_6b9275bcb8b1440588f0987c63ed4b54-6"></a>primary_email=baptiste.wicht@gmail.com
<a id="rest_code_6b9275bcb8b1440588f0987c63ed4b54-7" name="rest_code_6b9275bcb8b1440588f0987c63ed4b54-7" href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#rest_code_6b9275bcb8b1440588f0987c63ed4b54-7"></a>
<a id="rest_code_6b9275bcb8b1440588f0987c63ed4b54-8" name="rest_code_6b9275bcb8b1440588f0987c63ed4b54-8" href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#rest_code_6b9275bcb8b1440588f0987c63ed4b54-8"></a>[new]
<a id="rest_code_6b9275bcb8b1440588f0987c63ed4b54-9" name="rest_code_6b9275bcb8b1440588f0987c63ed4b54-9" href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#rest_code_6b9275bcb8b1440588f0987c63ed4b54-9"></a>tags=inbox
<a id="rest_code_6b9275bcb8b1440588f0987c63ed4b54-10" name="rest_code_6b9275bcb8b1440588f0987c63ed4b54-10" href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#rest_code_6b9275bcb8b1440588f0987c63ed4b54-10"></a>ignore=
<a id="rest_code_6b9275bcb8b1440588f0987c63ed4b54-11" name="rest_code_6b9275bcb8b1440588f0987c63ed4b54-11" href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#rest_code_6b9275bcb8b1440588f0987c63ed4b54-11"></a>
<a id="rest_code_6b9275bcb8b1440588f0987c63ed4b54-12" name="rest_code_6b9275bcb8b1440588f0987c63ed4b54-12" href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#rest_code_6b9275bcb8b1440588f0987c63ed4b54-12"></a>[search]
<a id="rest_code_6b9275bcb8b1440588f0987c63ed4b54-13" name="rest_code_6b9275bcb8b1440588f0987c63ed4b54-13" href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#rest_code_6b9275bcb8b1440588f0987c63ed4b54-13"></a>exclude_tags=deleted;
<a id="rest_code_6b9275bcb8b1440588f0987c63ed4b54-14" name="rest_code_6b9275bcb8b1440588f0987c63ed4b54-14" href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#rest_code_6b9275bcb8b1440588f0987c63ed4b54-14"></a>
<a id="rest_code_6b9275bcb8b1440588f0987c63ed4b54-15" name="rest_code_6b9275bcb8b1440588f0987c63ed4b54-15" href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#rest_code_6b9275bcb8b1440588f0987c63ed4b54-15"></a>[maildir]
<a id="rest_code_6b9275bcb8b1440588f0987c63ed4b54-16" name="rest_code_6b9275bcb8b1440588f0987c63ed4b54-16" href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#rest_code_6b9275bcb8b1440588f0987c63ed4b54-16"></a>synchronize_flags=true
</pre></div>
<p>It needs of cours the place where your mails are stored. Then, some information
about you. The next section is to specify which tags you want to add to new
mails. Here, I specified that each new mail must be tagged with <cite>inbox</cite>. You can
add several tags to new mails. In the <cite>[search]</cite> section, the excluded tags are
specified.</p>
</section><section id="usage-2"><h2>Usage</h2>
<p>Once you have configured notmuch, you can run <cite>notmuch new</cite> to process all
existing mails. The first run may take some time (in minutes, it is still quite
fast), but the subsequent runs will be very fast. You should run notmuch after
each offlineimap run. I personally run it in a shell script that is run by cron.
You could also use one of the hooks of offlineimap to run notmuch.</p>
<p>Once indexing has been done, you can start searching your mails. The first
option to search mail is simply to use <cite>notmuch search &lt;query&gt;</cite> from the command
line. This will directly displays the results. Search is instant on my mails.</p>
<p>If you use mutt-kz like me, notmuch support is directly integrated. You can type
X, and then type your query like <code>notmuch://?query=X</code> and the results will
be displayed as a normal Mutt folder. You can open mails directly from here and
you can also edit the mails as if you were in their source folders. This is
really practical.</p>
<p>If you use mutt, you can have the same experience, by using the <cite>notmuch-mutt</cite>
patch (<cite>here &lt;http://notmuchmail.org/notmuch-mutt/&gt;</cite>). In several distributions,
there is an option to build it with this support or another package to add the
feature.</p>
<p>Another feature of notmuch is its ability to tag mails. It automatically tags
new mails and deleted mails. But you can also explicitely tag messages by using
<code>notmuch tag</code>. For instance, to tag all messages from the notmuch mailing
list:</p>
<div class="code"><pre class="code text"><a id="rest_code_3f38ddf2f57d4397b686d841745988a6-1" name="rest_code_3f38ddf2f57d4397b686d841745988a6-1" href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#rest_code_3f38ddf2f57d4397b686d841745988a6-1"></a>notmuch tag +notmuch -- tag:new and to:notmuch@notmuchmail.org
</pre></div>
<p>I personally don't use this feature since I use imapfilter and IMAP folders to
sort my mail, but it can be very useful. You can run these commands in the
cronjob and always have you tags up to date. Tags can then be used in notmuch to
search or to create virtual folder in Mutt.</p>
</section><section id="conclusion-7"><h2>Conclusion</h2>
<p>That is already more or less everything that there is to know about notmuch. It
does not do a lot of thing, but it does them really well.</p>
<p>That concludes the series of posts on Mutt. If you have any question on my Mutt
configuration, I'd be glad to extend on the comments.</p>
</section>
</div>
            
    
    <a href="posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#disqus_thread" data-disqus-identifier="cache/posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2014/07/catch-powerful-yet-simple-cpp-test-framework.html" class="u-url">Catch: A powerful yet simple C++ test framework</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2014-07-28T13:21:49+02:00">2014-07-28 13:21</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>Recently, I came accross a new test framework for C++ program: Catch.</p>
<p>Until I found Catch, I was using Boost Test Framework. It is working quite well,
but the problem is that you need to build Boost and link to the Boost Test
Framework, which is not highly convenient. I wanter something lighter and easier
to integrate.</p>
<p>Catch is header only, you only have to include one header for each test file.
Moreover, it is very easy to combine several source files without linking
problems.</p>
<section id="usage"><h2>Usage</h2>
<p>The usage is really simple. Here is a basic example:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_2d339ebcc78448d8adebd3b6e0c0512f-1" name="rest_code_2d339ebcc78448d8adebd3b6e0c0512f-1" href="posts/2014/07/catch-powerful-yet-simple-cpp-test-framework.html#rest_code_2d339ebcc78448d8adebd3b6e0c0512f-1"></a><span class="cp">#define CATCH_CONFIG_MAIN</span>
<a id="rest_code_2d339ebcc78448d8adebd3b6e0c0512f-2" name="rest_code_2d339ebcc78448d8adebd3b6e0c0512f-2" href="posts/2014/07/catch-powerful-yet-simple-cpp-test-framework.html#rest_code_2d339ebcc78448d8adebd3b6e0c0512f-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">"catch.hpp"</span>
<a id="rest_code_2d339ebcc78448d8adebd3b6e0c0512f-3" name="rest_code_2d339ebcc78448d8adebd3b6e0c0512f-3" href="posts/2014/07/catch-powerful-yet-simple-cpp-test-framework.html#rest_code_2d339ebcc78448d8adebd3b6e0c0512f-3"></a>
<a id="rest_code_2d339ebcc78448d8adebd3b6e0c0512f-4" name="rest_code_2d339ebcc78448d8adebd3b6e0c0512f-4" href="posts/2014/07/catch-powerful-yet-simple-cpp-test-framework.html#rest_code_2d339ebcc78448d8adebd3b6e0c0512f-4"></a><span class="n">TEST_CASE</span><span class="p">(</span><span class="w"> </span><span class="s">"stupid/1=2"</span><span class="p">,</span><span class="w"> </span><span class="s">"Prove that one equals 2"</span><span class="w"> </span><span class="p">){</span>
<a id="rest_code_2d339ebcc78448d8adebd3b6e0c0512f-5" name="rest_code_2d339ebcc78448d8adebd3b6e0c0512f-5" href="posts/2014/07/catch-powerful-yet-simple-cpp-test-framework.html#rest_code_2d339ebcc78448d8adebd3b6e0c0512f-5"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<a id="rest_code_2d339ebcc78448d8adebd3b6e0c0512f-6" name="rest_code_2d339ebcc78448d8adebd3b6e0c0512f-6" href="posts/2014/07/catch-powerful-yet-simple-cpp-test-framework.html#rest_code_2d339ebcc78448d8adebd3b6e0c0512f-6"></a><span class="w">    </span><span class="n">REQUIRE</span><span class="p">(</span><span class="w"> </span><span class="n">one</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">2</span><span class="w"> </span><span class="p">);</span>
<a id="rest_code_2d339ebcc78448d8adebd3b6e0c0512f-7" name="rest_code_2d339ebcc78448d8adebd3b6e0c0512f-7" href="posts/2014/07/catch-powerful-yet-simple-cpp-test-framework.html#rest_code_2d339ebcc78448d8adebd3b6e0c0512f-7"></a><span class="p">}</span>
</pre></div>
<p>The define is made to ensure that Catch will generate a main for you. This
should only defined in one of your tests files if you have several. You define a
new test case using the <code>TEST_CASE</code> macro. There are two parameters, the
first one is the name of the test case, you can use any name, you don't have to
use a valid C++ name. The second parameter is a longer description of the test
case.</p>
<p>You then use <code>REQUIRE</code> to verify a condition. You can also use
<code>CHECK</code> to verify a condition, the difference being that it does not stop
if the condition is not true. <code>CHECK</code> is a good tool to put together some
conditions that are related. There also exists <code>REQUIRE_FALSE</code> and
<code>CHECK_FALSE</code> versions.</p>
<p>As you can see, there are no <code>REQUIRE_EQUALS</code> or things like that, you can
use any comparison operator you want in the <code>REQUIRE</code>.</p>
<p>This produces an executable that will, by default, run every test contained in
the executable. You can also configure the output report to be XML or JUnit if
you want or run a subset of your tests. Take a look at the command line usage by
running the executable with the -h option if you want more information.</p>
<p>Here is the result of the previous test:</p>
<pre class="literal-block">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
catch_test_1 is a Catch v1.0 b52 host application.
Run with -? for options

-------------------------------------------------------------------------------
stupid/1=2
-------------------------------------------------------------------------------
src/catch/test1.cpp:4
...............................................................................

src/catch/test1.cpp:6: FAILED:
  REQUIRE( one == 2 )
with expansion:
  1 == 2

===============================================================================
test cases: 1 | 1 failed
assertions: 1 | 1 failed</pre>
<p>For each failed condition, the source location is printed as well as some
information on the test that failed. What is also interesting is the "with
expansion" information that shows LHS and RHS of the comparison operator.</p>
<p>You can also check for exceptions with several macros:</p>
<ul class="simple">
<li><p><code>REQUIRE_THROWS(expression)</code> and <code>CHECK_THROWS(expression)</code>
verify that an exception is thrown when the given expresssion is evaluated.</p></li>
<li><p><code>REQUIRE_THROWS_AS(expression, exception_type)</code> and
<code>CHECK_THROWS_AS(expression, exception_type)</code> verify the the given
exception is thrown.</p></li>
<li><p><code>REQUIRE_NOTHROW(expression)</code> and <code>CHECK_NOTHROW(expression)</code>
verify that no exception is thrown.</p></li>
</ul></section><section id="conclusion-6"><h2>Conclusion</h2>
<p>I have only covered the most basic features, there is more that you can do with
Catch: fixtures, logging and BDD-style test cases for instance. For more
information you can read the <a class="reference external" href="https://github.com/philsquared/Catch/blob/master/docs/reference-index.md">reference documentation</a>.</p>
<p>I'm really satisfied with this framework. It also can be used for Objective-C if
you are interested. You can download Catch <a class="reference external" href="https://github.com/philsquared/Catch">on Github</a>.</p>
<p>If you want more examples, you can take a look at the <a class="reference external" href="https://github.com/wichtounet/etl/tree/master/test">ETL</a> tests that are all
made with Catch.</p>
</section>
</div>
            
    
    <a href="posts/2014/07/catch-powerful-yet-simple-cpp-test-framework.html#disqus_thread" data-disqus-identifier="cache/posts/2014/07/catch-powerful-yet-simple-cpp-test-framework.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html" class="u-url">ETL - C++ library for vector and matrix computations</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2014-07-25T10:46:33+02:00">2014-07-25 10:46</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>When working on Machine Learning algorithms, I was in need of a simple library
to ease working with vectors and matrix. This is the reason why I started
developing ETL (Expression Template Library).</p>
<p>ETL is a small header only library for C++ that provides vector and matrix
classes with support for Expression Templates to perform very efficient
operations on them.</p>
<p>The library supports statically sized and dynamically sized vector and matrix
structures with efficient element-wise operations. All the operations are
implemented lazily with Expression Templates, they are only implemented once the
expression is assigned to a concrete structure.</p>
<section id="data-structures"><h2>Data structures</h2>
<p>Several structures are available:</p>
<ul class="simple">
<li><p><code>fast_vector&lt;T, Rows&gt;</code>: A vector of size Rows with elements of type T. This must
be used when you know the size of the vector at compile-time.</p></li>
<li><p><code>dyn_vector&lt;T&gt;</code>: A vector with element of type T. The size of the vector can be
set at runtime.</p></li>
<li><p><code>fast_matrix&lt;T, Rows,Columns&gt;</code>: A matrix of size Rows x Columns with elements of
type T. This must be used when you know the size of the matrix at
compile-time.</p></li>
<li><p><code>dyn_matrix&lt;T&gt;</code>: A matrix with element of type T. The size of the matrix can be
set at runtime.</p></li>
</ul>
<p>All the structures are size-invariant, once set they cannot be grown or
shrinked.</p>
<p>In every operations that involves fast version of the structures, all the sizes
are known at compile-time, this gives the compiler a lot of opportunities for
optimization.</p>
</section><section id="element-wise-operations"><h2>Element-wise operations</h2>
<p>Classic element-wise operations can be done on vector and matrix as if it was
done on scalars. Matrices and vectors can also be added, subtracted, divided,
...  by scalars.</p>
<p>Here is an example of what can be done:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_246be8b9a0eb41249a7696fcc5b7242a-1" name="rest_code_246be8b9a0eb41249a7696fcc5b7242a-1" href="posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html#rest_code_246be8b9a0eb41249a7696fcc5b7242a-1"></a><span class="n">etl</span><span class="o">::</span><span class="n">dyn_vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">a</span><span class="p">({</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">3.0</span><span class="p">});</span>
<a id="rest_code_246be8b9a0eb41249a7696fcc5b7242a-2" name="rest_code_246be8b9a0eb41249a7696fcc5b7242a-2" href="posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html#rest_code_246be8b9a0eb41249a7696fcc5b7242a-2"></a><span class="n">etl</span><span class="o">::</span><span class="n">dyn_vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">b</span><span class="p">({</span><span class="mf">3.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">});</span>
<a id="rest_code_246be8b9a0eb41249a7696fcc5b7242a-3" name="rest_code_246be8b9a0eb41249a7696fcc5b7242a-3" href="posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html#rest_code_246be8b9a0eb41249a7696fcc5b7242a-3"></a>
<a id="rest_code_246be8b9a0eb41249a7696fcc5b7242a-4" name="rest_code_246be8b9a0eb41249a7696fcc5b7242a-4" href="posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html#rest_code_246be8b9a0eb41249a7696fcc5b7242a-4"></a><span class="n">etl</span><span class="o">::</span><span class="n">dyn_vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="w"> </span><span class="n">c</span><span class="p">(</span><span class="mf">1.4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">1.2</span><span class="p">);</span>
</pre></div>
<p>All the operations are only executed once the expression is evaluated to
construct the dyn_vector. No temporaries are involved. This is as efficient as
if a single for loop was used and each element was computed directly.</p>
<p>You can easily assign the same value to a structure by using the operator = on
it.</p>
</section><section id="unary-operators"><h2>Unary operators</h2>
<p>Several unary operators are available. Each operation is performed on every
element of the vector or the matrix.</p>
<p>Available operators:</p>
<ul class="simple">
<li><p><code>log</code></p></li>
<li><p><code>abs</code></p></li>
<li><p><code>sign</code></p></li>
<li><p><code>max/min</code></p></li>
<li><p><code>sigmoid</code></p></li>
<li><p><code>noise</code>: Add standard normal noise to each element</p></li>
<li><p><code>logistic_noise</code>: Add normal noise of mean zero and variance sigmoid(x) to each
element</p></li>
<li><p><code>exp</code></p></li>
<li><p><code>softplus</code></p></li>
<li><p><code>bernoulli</code></p></li>
</ul>
<p>Several transformations are also available:</p>
<ul class="simple">
<li><p><code>hflip</code>: Flip the vector or the matrix horizontally</p></li>
<li><p><code>vflip</code>: Flip the vector or the matrix vertically</p></li>
<li><p><code>fflip</code>: Flip the vector or the matrix horizontally and vertically. It is the
equivalent of <code>hflip(vflip(x))</code></p></li>
<li><p><code>dim/row/col</code>: Return a vector representing a sub part of a matrix (a row or a
col)</p></li>
<li><p><code>reshape</code>: Interpret a vector as a matrix</p></li>
</ul>
<p>Again, all these operations are performed lazily, they are only executed when the
expression is assigned to something.</p>
</section><section id="lazy-evaluation"><h2>Lazy evaluation</h2>
<p>All binary and unary operations are applied lazily, only when they are assigned
to a concrete vector or matrix class.</p>
<p>The expression can be evaluated using the <code>s(x)</code> function that returns a
concrete class (fast_vector,fast_matrix,dyn_vector,dyn_matrix) based on the
expression.</p>
</section><section id="reduction"><h2>Reduction</h2>
<p>Several reduction functions are available:</p>
<ul class="simple">
<li><p>sum: Return the sum of a vector or matrix</p></li>
<li><p>mean: Return the sum of a vector or matrix</p></li>
<li><p>dot: Return the dot product of two vector or matrices</p></li>
</ul></section><section id="functions"><h2>Functions</h2>
<p>The header <em>convolution.hpp</em> provides several convolution operations both in 1D
(vector) and 2D (matrix). All the convolution are available in valid, full and
same versions.</p>
<p>The header <em>mutiplication.hpp</em> provides the matrix multiplication operation
(<code>mmult</code>). For now on, only the naive algorithm is available. I'll
probably add support for Strassen algorithm in the near future.</p>
<p>It is possible to pass an expression rather than an data structure to functions.
You have to keep in mind that expression are lazy, therefore if you pass a + b
to a matrix multiplication, an addition will be run each time an element is
accessed (n^3 times), therefore, it is rarely efficient.</p>
</section><section id="examples"><h2>Examples</h2>
<p>Here are some examples of these operators (taken from my Machine Learning
Library):</p>
<div class="code"><pre class="code cpp"><a id="rest_code_5fe248248f2f4cb798e063c2251c1206-1" name="rest_code_5fe248248f2f4cb798e063c2251c1206-1" href="posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html#rest_code_5fe248248f2f4cb798e063c2251c1206-1"></a><span class="n">h_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sigmoid</span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mmul</span><span class="p">(</span><span class="n">reshape</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_visible</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v_a</span><span class="p">),</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">));</span>
<a id="rest_code_5fe248248f2f4cb798e063c2251c1206-2" name="rest_code_5fe248248f2f4cb798e063c2251c1206-2" href="posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html#rest_code_5fe248248f2f4cb798e063c2251c1206-2"></a><span class="n">h_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">bernoulli</span><span class="p">(</span><span class="n">h_a</span><span class="p">);</span>
</pre></div>
<div class="code"><pre class="code cpp"><a id="rest_code_b7f7ac470f844c5e9abbc3210ee69aa6-1" name="rest_code_b7f7ac470f844c5e9abbc3210ee69aa6-1" href="posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html#rest_code_b7f7ac470f844c5e9abbc3210ee69aa6-1"></a><span class="n">h_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">min</span><span class="p">(</span><span class="n">max</span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mmul</span><span class="p">(</span><span class="n">reshape</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_visible</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v_a</span><span class="p">),</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">),</span><span class="w"> </span><span class="mf">0.0</span><span class="p">),</span><span class="w"> </span><span class="mf">6.0</span><span class="p">);</span>
<a id="rest_code_b7f7ac470f844c5e9abbc3210ee69aa6-2" name="rest_code_b7f7ac470f844c5e9abbc3210ee69aa6-2" href="posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html#rest_code_b7f7ac470f844c5e9abbc3210ee69aa6-2"></a><span class="n">h_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ranged_noise</span><span class="p">(</span><span class="n">h_a</span><span class="p">,</span><span class="w"> </span><span class="mf">6.0</span><span class="p">);</span>
</pre></div>
<div class="code"><pre class="code cpp"><a id="rest_code_4250846af4584cb8bfb239d25260c2b6-1" name="rest_code_4250846af4584cb8bfb239d25260c2b6-1" href="posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html#rest_code_4250846af4584cb8bfb239d25260c2b6-1"></a><span class="n">weight</span><span class="w"> </span><span class="n">exp_sum</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">sum</span><span class="p">(</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mmul</span><span class="p">(</span><span class="n">reshape</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_visible</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v_a</span><span class="p">),</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">)));</span>
<a id="rest_code_4250846af4584cb8bfb239d25260c2b6-2" name="rest_code_4250846af4584cb8bfb239d25260c2b6-2" href="posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html#rest_code_4250846af4584cb8bfb239d25260c2b6-2"></a>
<a id="rest_code_4250846af4584cb8bfb239d25260c2b6-3" name="rest_code_4250846af4584cb8bfb239d25260c2b6-3" href="posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html#rest_code_4250846af4584cb8bfb239d25260c2b6-3"></a><span class="n">h_a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">exp</span><span class="p">(</span><span class="n">b</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">mmul</span><span class="p">(</span><span class="n">reshape</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">num_visible</span><span class="o">&gt;</span><span class="p">(</span><span class="n">v_a</span><span class="p">),</span><span class="w"> </span><span class="n">w</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">exp_sum</span><span class="p">;</span>
<a id="rest_code_4250846af4584cb8bfb239d25260c2b6-4" name="rest_code_4250846af4584cb8bfb239d25260c2b6-4" href="posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html#rest_code_4250846af4584cb8bfb239d25260c2b6-4"></a>
<a id="rest_code_4250846af4584cb8bfb239d25260c2b6-5" name="rest_code_4250846af4584cb8bfb239d25260c2b6-5" href="posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html#rest_code_4250846af4584cb8bfb239d25260c2b6-5"></a><span class="k">auto</span><span class="w"> </span><span class="n">max</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">max_element</span><span class="p">(</span><span class="n">h_a</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">h_a</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
<a id="rest_code_4250846af4584cb8bfb239d25260c2b6-6" name="rest_code_4250846af4584cb8bfb239d25260c2b6-6" href="posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html#rest_code_4250846af4584cb8bfb239d25260c2b6-6"></a>
<a id="rest_code_4250846af4584cb8bfb239d25260c2b6-7" name="rest_code_4250846af4584cb8bfb239d25260c2b6-7" href="posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html#rest_code_4250846af4584cb8bfb239d25260c2b6-7"></a><span class="n">h_s</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0</span><span class="p">;</span>
<a id="rest_code_4250846af4584cb8bfb239d25260c2b6-8" name="rest_code_4250846af4584cb8bfb239d25260c2b6-8" href="posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html#rest_code_4250846af4584cb8bfb239d25260c2b6-8"></a><span class="n">h_s</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">distance</span><span class="p">(</span><span class="n">h_a</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">max</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0</span><span class="p">;</span>
</pre></div>
</section><section id="conclusion-5"><h2>Conclusion</h2>
<p>This library is available on Github: <a class="reference external" href="https://github.com/wichtounet/etl">etl</a>.
It is licensed under MIT license.</p>
<p>It is header-only, therefore you don't have to build it. However, it uses some
recent C++14 stuff, you'll need a recent version of Clang or G++ to be able to
use it.</p>
<p>If you find an issue or have an idea to improve it, just post it on Github or
as a comment here and I'll do my best to work on that. If you have any question
on the usage of the library, I'd be glad to answer them.</p>
</section>
</div>
            
    
    <a href="posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html#disqus_thread" data-disqus-identifier="cache/posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2014/07/a-mutt-journey-my-mutt-configuration.html" class="u-url">A Mutt journey: Mutt configuration</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2014-07-22T22:14:32+02:00">2014-07-22 22:14</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>If you've followed my Mutt posts, you'll know that I'm <a class="reference external" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html">filtering my mails with
imapfilter</a> and
<a class="reference external" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html">downloading them with offlineimap</a>.</p>
<p>In this post, I'll share my Mutt configuration. I'm not using Mutt directly, but
mutt-kz which is a fork with good notmuch integration. For this post, it won't
change anything.</p>
<section id="configuration-2"><h2>Configuration</h2>
<p>The complete configuration is made in the .muttrc file. Mutt configuration
supports the source command so that you can put some of your settings in another
files and source them from the .muttrc file. You'll see that the configuration
can soon grow large and therefore, splitting it in several files will save you a
lot of maintenance issues ;)</p>
<p>First, let's tell Mutt who we are:</p>
<pre class="literal-block">set from = "baptiste.wicht@gmail.com"
set realname = "Baptiste Wicht"</pre>
</section><section id="receive-mail"><h2>Receive mail</h2>
<p>As I'm using offlineimap to get my mails, there is no IMAP settings in my
configuration. But you need to tell Mutt where the mails are:</p>
<pre class="literal-block">set folder = /data/oi/

set spoolfile = "+Gmail/INBOX"
set postponed = "+Gmail/drafts"

source ~/.mutt/mailboxes</pre>
<p>The spoolfile and postponed are specifying the inbox and draft mailboxes. The
.mutt/mailboxes file is generated by offlineimap.</p>
<p>By default, Mutt will ask you to move read messages from INBOX to another
mailbox (set by mbox). I personally let my read messages in my inbox and move
them myself in a folder. For that, you have to disable the move:</p>
<pre class="literal-block">set move = no</pre>
<p>If you move a mail from a mailbox to another, Mutt will ask for confirmation,
you can disable this confirmation:</p>
<pre class="literal-block">set confirmappend = no</pre>
<p>If you use Mutt, you want to read plaintext messages rather than monstruous
HTML. You can tell Mutt to always open text plain if any:</p>
<pre class="literal-block">alternative_order text/plain text/html</pre>
<p>If the mail has no text/plain part, you can manage to read HTML in Mutt in an
almost sane format. First, you need to tell Mutt to open html messages:</p>
<pre class="literal-block">auto_view text/html</pre>
<p>And then, you need to tell it how to open it. Mutt reads a mailcap file to know
how to open content. You can tell Mutt where it is:</p>
<pre class="literal-block">set mailcap_path = ~/.mailcap</pre>
<p>And then, you have to edit the .mailcap file:</p>
<pre class="literal-block">text/html; w3m -I %{charset} -T text/html; copiousoutput;</pre>
<p>That will use w3m to output the message inside Mutt. It works quite well. You
can also use linx if you prefer.</p>
</section><section id="send-mail"><h2>Send mail</h2>
<p>You need to indicate Mutt how to send mail:</p>
<pre class="literal-block">set smtp_url = "smtp://baptistewicht@smtp.gmail.com:587/"
set smtp_pass = "SECRET"</pre>
<p>Some people prefer to use another SMTP client instead of Mutt builtin SMTP
support, you can also do that by setting sendmail to the mailer program.</p>
<p>It is generally a good idea to enforce the charset of sent mail:</p>
<pre class="literal-block">set send_charset="utf-8"</pre>
<p>You can choose another charset if you prefer ;)</p>
<p>You need to configure vim to correctly handle mail editing:</p>
<pre class="literal-block">set editor='vim + -c "set textwidth=72" -c "set wrap" -c "set spell spelllang=en"'</pre>
<p>It sets the width of the text, enable wrap and configure spelling.</p>
<p>By default, Mutt will ask you if you want to include the body of the message you
reply to in your answer and the reply subject. You can make that faster by using
these two lines:</p>
<pre class="literal-block">set include=yes
set fast_reply</pre>
<p>Once mail are sent, they are copied in your outgoing mailbox. If you use GMail,
the STMP server already does that for you, therefore you should disable this
behavior:</p>
<pre class="literal-block">set copy = no</pre>
</section><section id="appearance"><h2>Appearance</h2>
<p>Many things can also be configured in the appearance of Mutt. If you like the
threaded view of GMail, you want to configure Mutt in a similar way:</p>
<pre class="literal-block">set sort = 'threads'
set sort_aux = 'reverse-last-date-received'</pre>
<p>It is not as good as the GMail view, but it does the job :)</p>
<p>You can make reading mail more comfortable using smart wrapping:</p>
<pre class="literal-block">set smart_wrap</pre>
<p>A mail has many many headers and you don't want to see them all:</p>
<pre class="literal-block">ignore *
unignore From To Reply-To Cc Bcc Subject Date Organization X-Label X-Mailer User-Agent</pre>
<p>With that, you just configure which headers you're interested in.</p>
<p>If you're using the sidebar patch (and you should be ;), you can configure the
sidebar:</p>
<pre class="literal-block">set sidebar_visible = yes
set sidebar_width = 35
set sort_sidebar = desc

color sidebar_new yellow default</pre>
<p>It makes the sidebar always visible with a width of 35 and sort the mailboxes.
The last line makes yellow the mailboxes that have unread mails.</p>
<p>The index_format allows you to set what will shown for every mail in the index
view:</p>
<pre class="literal-block">set index_format = "%4C %Z %{%b %d} %-15.15L %?M?(#%03M)&amp;(%4l)? %?y?{%.20y}? %?g?{%.20g} ?%s (%c)"</pre>
<p>This is a classical example that display the sender, the flags, the date, the
subject, the size of the mail and so on. You will need to look at the <a class="reference external" href="http://www.mutt.org/doc/manual/manual-6.html">Reference</a> to have more information on
what you can do with the format variables. There are plenty of information that
can be shown.</p>
<p>You can also configure the text that is present on the status bar:</p>
<pre class="literal-block">set status_chars  = " *%A"
set status_format = "───[ Folder: %f ]───[%r%m messages%?n? (%n new)?%?d? (%d to delete)?%?t? (%t tagged)? ]───%&gt;─%?p?( %p postponed )?───"</pre>
<p>The example here displays the current folder, the number of mails in it with
some details on deleted and unread mails and finally the number of postponed
mail. Again, if you want more information, you can read the reference.</p>
<p>You can configure Mutt so that the index view is always visible when you read
mails. For instance, to always show 8 mails in the index:</p>
<pre class="literal-block">set pager_index_lines=8</pre>
<p>Another important thing you can configure is the colors of Mutt. I'm not gonna
cover everything, since Mutt is very powerful on this part. For instance, here
are some examples from my configuration:</p>
<p>color index         red             white           "~v~(~F)!~N"                # collapsed thread with flagged, no unread
color index         yellow          white           "~v~(~F~N)"                 # collapsed thread with some unread &amp; flagged
color index_subject brightred       default         "~z &gt;100K"
color header        blue            default         "^(Subject)"</p>
<p>Unless you are really wanting to spend time on this part, I recommend to pick an
existing theme. I took a Solarized theme <a class="reference external" href="https://github.com/altercation/mutt-colors-solarized">here</a>. It looks quite good
and works well. There other themes available, you'll surely find the one that
looks best for you.</p>
</section><section id="bindings"><h2>Bindings</h2>
<p>Bindings are always very important. If like me, you're a vim aficionado, you'll
want your Mutt bindings to be as close as possible to vim. The default settings
are quite good, but not always close to vim.</p>
<p>Something that is important to know when you configure Mutt bindings is that
they are relative to the current view open (index, pager,browser,attach, ...).
You can bind a keystroke to a different action in each view. You can also select
several views in which the keystroke is valid.</p>
<p>If you are using the sidebar patch (and again, you should ;) ), you'll want to
configure fast bindings for it. Here are mine:</p>
<pre class="literal-block">bind index,pager \Ck sidebar-prev
bind index,pager \Cj sidebar-next
bind index,pager \Cl sidebar-open
bind index,pager \Cn sidebar-scroll-up
bind index,pager \Cv sidebar-scroll-down
bind index,pager \Ct sidebar-toggle</pre>
<p>I use Ctrl+j,k to move inside the sidebar. I use Ctrl+l to open a folder and
Ctrl+n,v to scroll up and down. The last one is to toggle between multiple
sidebars for instance if you use notmuch.</p>
<p>I find l very good to open messages in the index too:</p>
<pre class="literal-block">bind index l display-message
bind index gg first-entry
bind index G last-entry
bind index h noop               # Disable h</pre>
<p>gg and G are used to go to the first and last element. Here I disabled h which
had a not often used command.</p>
<p>The pager is the view where you read mail:</p>
<pre class="literal-block">bind pager h exit
bind pager gg top
bind pager G bottom
bind pager J next-line
bind pager K previous-line</pre>
<p>In this view, I use h to get out of the pager, gg and G as usual. As I always
let the index open, I already use j and k to move in the index, so I chose J and
K to move in the pager.</p>
<p>The browser is the view where you select folders for instance:</p>
<pre class="literal-block">bind browser l select-entry
bind browser L view-file
bind browser gg first-entry
bind browser G last-entry
bind browser h exit</pre>
<p>Again, I use l and h to go back and forth and gg and G to go first and last. j
and k are already used here to go up and down.</p>
<p>In the attach view:</p>
<pre class="literal-block">bind attach h exit
bind attach e edit-type # Edit MIME Types
bind attach l view-attach</pre>
<p>I use h to exit and l to view an attachment.</p>
<p>That is it for my bindings, but you configure a lot more of them.</p>
</section><section id="conclusion-4"><h2>Conclusion</h2>
<p>This is the end of this post. I have covered my complete Mutt configuration
here. My .muttrc is available <a class="reference external" href="https://github.com/wichtounet/dotfiles/blob/master/.muttrc">online</a>.</p>
<p>If you have comments on my configuration, you're welcome to let a comment on
this post ;)</p>
<p>In the next blog post about my "Mutt journey", I'll talk about notmuch and this
will likely be the last post on this series.</p>
</section>
</div>
            
    
    <a href="posts/2014/07/a-mutt-journey-my-mutt-configuration.html#disqus_thread" data-disqus-identifier="cache/posts/2014/07/a-mutt-journey-my-mutt-configuration.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2014/07/pm-011-a-simple-workspace-manager-for-git-projects.html" class="u-url">pm 0.1.1 - A simple workspace manager for Git projects</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2014-07-20T20:52:18+02:00">2014-07-20 20:52</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>In the last month, I've developped a very simple tool in Python: <em>pm</em>. This tool
allows to check the status of all the Git repositories inside a repository. I've
just released the first version of this tool: pm-0.1.1</p>
<p>Those who are following this blog will perhaps wonder why Python and not C++ :)
The reason is quite simple, I wanted to improve my skills in Python. And what is
better than to develop a project from scratch.</p>
<section id="features"><h2>Features</h2>
<p>The main feature of this application is to show the status of every projects in
a directory. The status of your projects can be queried by using <code>pm
status</code>. On my computer this gives something like that:</p>
<img alt="/images/pm_status.png" src="images/pm_status.png"><p>The state of each branch of each project is shown. There different possible
status (they are cumulative):
* Behind remote: Commits are available on the remote repository
* Ahead of remote: Some local commits are no pushed
* Diverged: Behind and Ahead
* Uncomitted changes: Some changes are not committed
* Clean: Indicates that everything is committed, pushed and pull.</p>
<p>By default, the directory is ~/dev/ but you can change it by passing the
repository to the command, if you pass a relative directory, it will be relative
to home. For instance, here is the status of my doc repositories:</p>
<img alt="/images/pm_status_2.png" src="images/pm_status_2.png"><p>Another feature that can be useful is that it is able to check the status of
submodules with the -s option:</p>
<img alt="/images/pm_status_sm.png" src="images/pm_status_sm.png"><p>As you can see it supports recursive submodules. For each submodule it will
indicate if there are new commits available or not.</p>
<p>pm is not only able to show status of the projects, it can also fetch the status
of branches from remote by using <code>pm fetch</code>. All the remote branches are
fetched from remote. It can also automatically update the projects that are
behind remote (equivalent of git pull) with <code>pm update</code>. Only projects
that can be fast-forwarded are updated.</p>
</section><section id="installation-2"><h2>Installation</h2>
<p>Thanks to <em>pip</em>, installation of pm is quite simple:</p>
<pre class="literal-block">pip install pm</pre>
<p>If you don't want to use pip, you can install it by hand:</p>
<pre class="literal-block">wget https://github.com/wichtounet/pm/archive/0.1.1.tar.gz
tar xf 0.1.1.tar.gz
cd 0.1.1
python setup.py install</pre>
<p>For those interested, source code is available <a class="reference external" href="https://github.com/wichtounet/pm">on Github</a>.</p>
<p>If you have any suggestion for the tool or on the source code, post a comment to
this post ;)</p>
</section>
</div>
            
    
    <a href="posts/2014/07/pm-011-a-simple-workspace-manager-for-git-projects.html#disqus_thread" data-disqus-identifier="cache/posts/2014/07/pm-011-a-simple-workspace-manager-for-git-projects.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html" class="u-url">A Mutt Journey: Download mails with offlineimap</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2014-07-16T19:54:40+02:00">2014-07-16 19:54</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>In the series of posts about Mutt, I recently presented how I was <a class="reference external" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html">filtering my email</a>. In this
post, I'll show how I download my emails locally using offlineimap. This is the
perfect companion for Mutt.</p>
<p>With Mutt, you can easily directly query an IMAP server and keep the views up to
date with it. There are a few problem with this approach:</p>
<ul class="simple">
<li><p>First, you wont' be able to read your mails when you'are offline. It is
rarely an issue in these days, but it can be useful.</p></li>
<li><p>Opening an IMAP folder with a large number of mails (&gt;1000) can be quite
slow. I've several large folders and it was a pain opening them.</p></li>
<li><p>When Mutt synchronizes with the state of the IMAP server, you'll encounter a
freeze. If you want to synchronize often, it is quite boring.</p></li>
</ul>
<p>Having your mails offline on your computers solves all these problems. Moreover,
it is also a good way to have a backup of your mails. I'm gonna talk here about
the usage for Mutt, but you can use offlineimap just for backup or for migration
reasons. The downside is that you have to store it locally. My mails takes
around 5GB on my computer.</p>
<p>offlineimap is a very simple tool to synchronize emails from IMAP servers. It
only supports IMAP, but in those days it is not a limitation. The
synchronization is made both ways, it will upload your local changes to the IMAP
server. It is very powerful when paired with a MUA such as Mutt.</p>
<p>To use offlineimap, you have to put your configuration in the ~/.offlineimaprc.
You can synchronize several accounts at once, in this post, we'll focus on one,
but the process is the same for several accounts. I'll focus on Gmail too, but
again it is the same with a bit different parameters for other mail accounts.</p>
<section id="configuration"><h2>Configuration</h2>
<p>First, we have to declare the account:</p>
<div class="code"><pre class="code text"><a id="rest_code_7b35df7b2f4641929f11218d8eb0f06a-1" name="rest_code_7b35df7b2f4641929f11218d8eb0f06a-1" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_7b35df7b2f4641929f11218d8eb0f06a-1"></a>[general]
<a id="rest_code_7b35df7b2f4641929f11218d8eb0f06a-2" name="rest_code_7b35df7b2f4641929f11218d8eb0f06a-2" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_7b35df7b2f4641929f11218d8eb0f06a-2"></a>accounts = Gmail
<a id="rest_code_7b35df7b2f4641929f11218d8eb0f06a-3" name="rest_code_7b35df7b2f4641929f11218d8eb0f06a-3" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_7b35df7b2f4641929f11218d8eb0f06a-3"></a>
<a id="rest_code_7b35df7b2f4641929f11218d8eb0f06a-4" name="rest_code_7b35df7b2f4641929f11218d8eb0f06a-4" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_7b35df7b2f4641929f11218d8eb0f06a-4"></a>[Account Gmail]
<a id="rest_code_7b35df7b2f4641929f11218d8eb0f06a-5" name="rest_code_7b35df7b2f4641929f11218d8eb0f06a-5" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_7b35df7b2f4641929f11218d8eb0f06a-5"></a>localrepository = Gmail-Local
<a id="rest_code_7b35df7b2f4641929f11218d8eb0f06a-6" name="rest_code_7b35df7b2f4641929f11218d8eb0f06a-6" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_7b35df7b2f4641929f11218d8eb0f06a-6"></a>remoterepository = Gmail-Remote
</pre></div>
<p><strong>accounts</strong> is the list of accounts that we have, here only one. Then, in
account, repositories are just names of the repositories we'll declare now.</p>
<p>The local repository has to be configured:</p>
<div class="code"><pre class="code text"><a id="rest_code_eaca68b7d1d94c7a97e76f43621c507b-1" name="rest_code_eaca68b7d1d94c7a97e76f43621c507b-1" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_eaca68b7d1d94c7a97e76f43621c507b-1"></a>[Repository Gmail-Local]
<a id="rest_code_eaca68b7d1d94c7a97e76f43621c507b-2" name="rest_code_eaca68b7d1d94c7a97e76f43621c507b-2" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_eaca68b7d1d94c7a97e76f43621c507b-2"></a>type = Maildir
<a id="rest_code_eaca68b7d1d94c7a97e76f43621c507b-3" name="rest_code_eaca68b7d1d94c7a97e76f43621c507b-3" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_eaca68b7d1d94c7a97e76f43621c507b-3"></a>localfolders = /data/oi/Gmail/
<a id="rest_code_eaca68b7d1d94c7a97e76f43621c507b-4" name="rest_code_eaca68b7d1d94c7a97e76f43621c507b-4" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_eaca68b7d1d94c7a97e76f43621c507b-4"></a>sep = /
</pre></div>
<p>The first important point is <strong>localfolders</strong> that sets where the mail will be
put on your computer. <strong>sep</strong> defines the separator used for nested IMAP
folders. I recommend / since Mutt will nest them automatically if / is used as
separator.</p>
<p>Then, the remote repository has to be configured:</p>
<div class="code"><pre class="code text"><a id="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-1" name="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-1" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_92d9c86bc64e4fb49b4babea1e151b6f-1"></a>[Repository Gmail-Remote]
<a id="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-2" name="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-2" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_92d9c86bc64e4fb49b4babea1e151b6f-2"></a>type = Gmail
<a id="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-3" name="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-3" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_92d9c86bc64e4fb49b4babea1e151b6f-3"></a>remoteuser = USER
<a id="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-4" name="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-4" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_92d9c86bc64e4fb49b4babea1e151b6f-4"></a>remotepass = PASSWORD
<a id="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-5" name="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-5" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_92d9c86bc64e4fb49b4babea1e151b6f-5"></a>realdelete = no
<a id="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-6" name="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-6" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_92d9c86bc64e4fb49b4babea1e151b6f-6"></a>folderfilter = lambda folder: folder not in ['[Gmail]/All Mail',
<a id="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-7" name="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-7" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_92d9c86bc64e4fb49b4babea1e151b6f-7"></a>                                             '[Gmail]/Important',
<a id="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-8" name="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-8" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_92d9c86bc64e4fb49b4babea1e151b6f-8"></a>                                             '[Gmail]/Starred',
<a id="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-9" name="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-9" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_92d9c86bc64e4fb49b4babea1e151b6f-9"></a>                                             ]
<a id="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-10" name="rest_code_92d9c86bc64e4fb49b4babea1e151b6f-10" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_92d9c86bc64e4fb49b4babea1e151b6f-10"></a>sslcacertfile = /etc/ssl/certs/ca-certificates.crt
</pre></div>
<p><strong>remotepass</strong> and <strong>remoteuser</strong> are your user names and password. You can also
use <strong>remotepassfile</strong> to read the password from a file. <strong>realdelete=no</strong>
indicates that we only want to remove all the labels of deleted mails. For
Gmail, it means that the mail will still be in the All Mail folder. The last
line (sslcacertfile) is mandatory for recent versions of offlineimap. The
<strong>folderfilter</strong> is a function that filters some folders. In my case, I do not
want to get the "All Mail", "Important" and "Starred" of my Gmail account
because it is only a duplicata of the mails in other labels. What is pretty cool
with offlineimap is that you can write Python directly in it for some of the
configuration options. Here is rule for filter is plain Python, so you can
complicated filtering if you want.</p>
<p>Last, but not least, offlineimap can generates a list of mailboxes (one for each
folder in every account). It is pretty useful since Mutt can then read this file
and you'll find your mailboxes directly configured in Mutt :)</p>
<p>This code will generate a file ~/.mutt/mailboxes that you can source in your
Mutt configuration and get the complete list of available mailboxes. This will
be kept up to date if you add new IMAP folders on the server for instance.</p>
<div class="code"><pre class="code text"><a id="rest_code_7c604aefd15645b7a039426a69905f5c-1" name="rest_code_7c604aefd15645b7a039426a69905f5c-1" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_7c604aefd15645b7a039426a69905f5c-1"></a>[mbnames]
<a id="rest_code_7c604aefd15645b7a039426a69905f5c-2" name="rest_code_7c604aefd15645b7a039426a69905f5c-2" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_7c604aefd15645b7a039426a69905f5c-2"></a>enabled = yes
<a id="rest_code_7c604aefd15645b7a039426a69905f5c-3" name="rest_code_7c604aefd15645b7a039426a69905f5c-3" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_7c604aefd15645b7a039426a69905f5c-3"></a>filename = ~/.mutt/mailboxes
<a id="rest_code_7c604aefd15645b7a039426a69905f5c-4" name="rest_code_7c604aefd15645b7a039426a69905f5c-4" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_7c604aefd15645b7a039426a69905f5c-4"></a>header = "mailboxes "
<a id="rest_code_7c604aefd15645b7a039426a69905f5c-5" name="rest_code_7c604aefd15645b7a039426a69905f5c-5" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_7c604aefd15645b7a039426a69905f5c-5"></a>peritem = "+%(accountname)s/%(foldername)s"
<a id="rest_code_7c604aefd15645b7a039426a69905f5c-6" name="rest_code_7c604aefd15645b7a039426a69905f5c-6" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_7c604aefd15645b7a039426a69905f5c-6"></a>sep = " "
<a id="rest_code_7c604aefd15645b7a039426a69905f5c-7" name="rest_code_7c604aefd15645b7a039426a69905f5c-7" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_7c604aefd15645b7a039426a69905f5c-7"></a>footer = "\n"
</pre></div>
</section><section id="translate-names"><h2>Translate names</h2>
<p>You may have seen in the previous section some weird folder name like
"[Gmail]/All mail", this is how Gmail names folders that are not labels. This is
quite ugly and will create odd looking folders on your computer. You can
configure offlineimap to rename these names to better ones. For that, you'll
need to rule (in Python ;) ), one to translate from remote to local and one to
do the reverse.</p>
<p>Here is what I did:</p>
<div class="code"><pre class="code text"><a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-1" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-1" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-1"></a>[Repository Gmail-Local]
<a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-2" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-2" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-2"></a>nametrans = lambda folder: {'drafts':   '[Gmail]/Drafts',
<a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-3" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-3" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-3"></a>                            'sent':     '[Gmail]/Sent Mail',
<a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-4" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-4" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-4"></a>                            'important':'[Gmail]/Important',
<a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-5" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-5" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-5"></a>                            'spam':     '[Gmail]/Spam',
<a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-6" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-6" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-6"></a>                            'starred':  '[Gmail]/Starred',
<a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-7" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-7" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-7"></a>                            'trash':    '[Gmail]/Trash',
<a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-8" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-8" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-8"></a>                            'archive':  '[Gmail]/All Mail',
<a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-9" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-9" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-9"></a>                            }.get(folder, folder)
<a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-10" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-10" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-10"></a>
<a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-11" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-11" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-11"></a>[Repository Gmail-Remote]
<a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-12" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-12" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-12"></a>nametrans = lambda folder: {'[Gmail]/Drafts':    'drafts',
<a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-13" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-13" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-13"></a>                            '[Gmail]/Sent Mail': 'sent',
<a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-14" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-14" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-14"></a>                            '[Gmail]/Starred':   'flagged',
<a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-15" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-15" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-15"></a>                            '[Gmail]/Important':   'important',
<a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-16" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-16" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-16"></a>                            '[Gmail]/Spam':   'spam',
<a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-17" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-17" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-17"></a>                            '[Gmail]/Trash':     'trash',
<a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-18" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-18" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-18"></a>                            '[Gmail]/All Mail':  'archive',
<a id="rest_code_e5bf08db6ff14491ad14e27b072d7a60-19" name="rest_code_e5bf08db6ff14491ad14e27b072d7a60-19" href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#rest_code_e5bf08db6ff14491ad14e27b072d7a60-19"></a>                            }.get(folder, folder)
</pre></div>
<p>I simply renamed all "[Gmail]" folders into something more readable and that
makes more sense to me. It is not limited to special Gmail folders of course,
this can also be applied to rename a folder X into a folder Y in the same. As it
is Python, you can do sophisticated stuff if necessary.</p>
</section><section id="speed-up-things"><h2>Speed up things</h2>
<p>If you happen to sync your mails often, you may want to speed things up. There
are several ways to do that.</p>
<p>The first thing you can do is use several connections to the server. You can set
maxconnections to a number higher than 1 in the remote repository configuration.
I tested several values and for Gmail 2 was the fastest choice. You can try some
values with your server to see what value is good.</p>
<p>Instead of plain old text files for the status of the mails, offlineimap can use
a sqlite backend. This is much faster since the complete file is not rewritten
for each update of the flags. For that behaviour, you have to set
<strong>status_backend = sqlite</strong> in the Account configuration.</p>
<p>Another thing you can do is reduce the I/O involved during sync by setting
general.fsync to false. With that, offlineimap won't have to wait for disk
operation completion after each operation.</p>
<p>You can run offlineimap in quick mode with -q option. With this option, change
in flags of remote messages will not be updated locally. Changes on the local
side will be uploaded corectly. It is generally a good idea is to run
offlineimap in quick mode often (every X minutes) and run it in normal mode once
or twice a day.</p>
<p>You can also specify which folder to sync with the -f option. Sometimes it is
enough to sync INBOX for instance. It may be much faster.</p>
</section><section id="conclusion-3"><h2>Conclusion</h2>
<p>Now that you have fully configured offlineimap, you can make it run by hand or
in a cron job. I personally run it every 5 minutes, you can choose your
favourite frequency according to your workflow. I think I'll reduce the
frequency further, it is more comfortable to get mails only by batch and not
too much of them.</p>
<p>If you're interested, you can take a look at <a class="reference external" href="https://github.com/wichtounet/dotfiles/blob/master/.offlineimaprc">my .offlineimaprc configuration</a>.</p>
<p>If you want more information about this awesome tool, you can take a look at the
<a class="reference external" href="http://docs.offlineimap.org/en/latest/">reference documentation</a>.</p>
<p>This is it for this part of this series. In the next post, I'll present my Mutt
configuration and how I use it.</p>
</section>
</div>
            
    
    <a href="posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html#disqus_thread" data-disqus-identifier="cache/posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html" class="u-url">A Mutt Journey: Filter mails with imapfilter</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2014-07-08T20:58:32+02:00">2014-07-08 20:58</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>About a month ago, I decided to switch to Mutt to read my emails. I kept my
GMail account, but I don't use the web interface anymore. It took me a long time
to prepare a complete enviromnent.</p>
<p>Currently, i'm using:</p>
<ul class="simple">
<li><p>imapfilter to filter mails</p></li>
<li><p>offlineimap to download my mails</p></li>
<li><p>notmuch to quickly search all my mails</p></li>
</ul>
<p>And of course Mutt. To be precise, I use mutt-kz, a fork of mutt with very good
notmuch integration.</p>
<p>I'll try to explain each part of my environment in a series of articles on this
blog. The first one will be about imapfilter.</p>
<p>imapfilter is a mail filtering utility. It connects to a remote server using
IMAP and is then able to move, copy or delete mails around. You can use it for
several tasks:</p>
<ul class="simple">
<li><p>Delete unwanted mail</p></li>
<li><p>Move mails into folders according to rules</p></li>
</ul>
<p>What is pretty cool is that the configuration is entirely made in Lua. It is
quite easy to write rules and then apply them to several mailboxes as if you
were programming.</p>
<p>Another advantage of imapfilter is that it works at the server level. Therefore,
even if you use your web client from time to time or check your mail on your
phone, the changes will still be viewable.</p>
<p>The configuration is done in the ~/.imapfilter/config.lua file. The
configuration is quite easy, you have to declare an IMAP object as the account.</p>
<div class="code"><pre class="code lua"><a id="rest_code_6e71ace8d5dc49678d0c0aea7e5710f5-1" name="rest_code_6e71ace8d5dc49678d0c0aea7e5710f5-1" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_6e71ace8d5dc49678d0c0aea7e5710f5-1"></a><span class="kd">local</span> <span class="n">account</span> <span class="o">=</span> <span class="n">IMAP</span> <span class="p">{</span>
<a id="rest_code_6e71ace8d5dc49678d0c0aea7e5710f5-2" name="rest_code_6e71ace8d5dc49678d0c0aea7e5710f5-2" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_6e71ace8d5dc49678d0c0aea7e5710f5-2"></a>    <span class="n">server</span> <span class="o">=</span> <span class="s1">'imap_sever'</span><span class="p">,</span>
<a id="rest_code_6e71ace8d5dc49678d0c0aea7e5710f5-3" name="rest_code_6e71ace8d5dc49678d0c0aea7e5710f5-3" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_6e71ace8d5dc49678d0c0aea7e5710f5-3"></a>    <span class="n">username</span> <span class="o">=</span> <span class="s1">'username'</span><span class="p">,</span>
<a id="rest_code_6e71ace8d5dc49678d0c0aea7e5710f5-4" name="rest_code_6e71ace8d5dc49678d0c0aea7e5710f5-4" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_6e71ace8d5dc49678d0c0aea7e5710f5-4"></a>    <span class="n">password</span> <span class="o">=</span> <span class="s1">'password'</span><span class="p">,</span>
<a id="rest_code_6e71ace8d5dc49678d0c0aea7e5710f5-5" name="rest_code_6e71ace8d5dc49678d0c0aea7e5710f5-5" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_6e71ace8d5dc49678d0c0aea7e5710f5-5"></a>    <span class="n">ssl</span> <span class="o">=</span> <span class="s1">'ssl3'</span><span class="p">,</span>
<a id="rest_code_6e71ace8d5dc49678d0c0aea7e5710f5-6" name="rest_code_6e71ace8d5dc49678d0c0aea7e5710f5-6" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_6e71ace8d5dc49678d0c0aea7e5710f5-6"></a><span class="p">}</span>
</pre></div>
<p>As the configuration is in Lua, you can easily get the password from another
file. For instance, here is my account declaration:</p>
<div class="code"><pre class="code lua"><a id="rest_code_f52bad0c7da74f299574095ddd495663-1" name="rest_code_f52bad0c7da74f299574095ddd495663-1" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_f52bad0c7da74f299574095ddd495663-1"></a><span class="kd">local</span> <span class="n">account</span> <span class="o">=</span> <span class="n">IMAP</span> <span class="p">{</span>
<a id="rest_code_f52bad0c7da74f299574095ddd495663-2" name="rest_code_f52bad0c7da74f299574095ddd495663-2" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_f52bad0c7da74f299574095ddd495663-2"></a>    <span class="n">server</span> <span class="o">=</span> <span class="s1">'imap.gmail.com'</span><span class="p">,</span>
<a id="rest_code_f52bad0c7da74f299574095ddd495663-3" name="rest_code_f52bad0c7da74f299574095ddd495663-3" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_f52bad0c7da74f299574095ddd495663-3"></a>    <span class="n">username</span> <span class="o">=</span> <span class="s1">'baptiste.wicht@gmail.com'</span><span class="p">,</span>
<a id="rest_code_f52bad0c7da74f299574095ddd495663-4" name="rest_code_f52bad0c7da74f299574095ddd495663-4" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_f52bad0c7da74f299574095ddd495663-4"></a>    <span class="n">password</span> <span class="o">=</span> <span class="n">get_imap_password</span><span class="p">(</span><span class="s2">".password.offlineimaprc"</span><span class="p">),</span>
<a id="rest_code_f52bad0c7da74f299574095ddd495663-5" name="rest_code_f52bad0c7da74f299574095ddd495663-5" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_f52bad0c7da74f299574095ddd495663-5"></a>    <span class="n">ssl</span> <span class="o">=</span> <span class="s1">'ssl3'</span><span class="p">,</span>
<a id="rest_code_f52bad0c7da74f299574095ddd495663-6" name="rest_code_f52bad0c7da74f299574095ddd495663-6" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_f52bad0c7da74f299574095ddd495663-6"></a><span class="p">}</span>
<a id="rest_code_f52bad0c7da74f299574095ddd495663-7" name="rest_code_f52bad0c7da74f299574095ddd495663-7" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_f52bad0c7da74f299574095ddd495663-7"></a>
<a id="rest_code_f52bad0c7da74f299574095ddd495663-8" name="rest_code_f52bad0c7da74f299574095ddd495663-8" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_f52bad0c7da74f299574095ddd495663-8"></a><span class="c1">-- Utility function to get IMAP password from file</span>
<a id="rest_code_f52bad0c7da74f299574095ddd495663-9" name="rest_code_f52bad0c7da74f299574095ddd495663-9" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_f52bad0c7da74f299574095ddd495663-9"></a><span class="kr">function</span> <span class="nf">get_imap_password</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
<a id="rest_code_f52bad0c7da74f299574095ddd495663-10" name="rest_code_f52bad0c7da74f299574095ddd495663-10" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_f52bad0c7da74f299574095ddd495663-10"></a>    <span class="kd">local</span> <span class="n">home</span> <span class="o">=</span> <span class="nb">os.getenv</span><span class="p">(</span><span class="s2">"HOME"</span><span class="p">)</span>
<a id="rest_code_f52bad0c7da74f299574095ddd495663-11" name="rest_code_f52bad0c7da74f299574095ddd495663-11" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_f52bad0c7da74f299574095ddd495663-11"></a>    <span class="kd">local</span> <span class="n">file</span> <span class="o">=</span> <span class="n">home</span> <span class="o">..</span> <span class="s2">"/"</span> <span class="o">..</span> <span class="n">file</span>
<a id="rest_code_f52bad0c7da74f299574095ddd495663-12" name="rest_code_f52bad0c7da74f299574095ddd495663-12" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_f52bad0c7da74f299574095ddd495663-12"></a>    <span class="kd">local</span> <span class="n">str</span> <span class="o">=</span> <span class="nb">io.open</span><span class="p">(</span><span class="n">file</span><span class="p">):</span><span class="n">read</span><span class="p">()</span>
<a id="rest_code_f52bad0c7da74f299574095ddd495663-13" name="rest_code_f52bad0c7da74f299574095ddd495663-13" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_f52bad0c7da74f299574095ddd495663-13"></a>    <span class="kr">return</span> <span class="n">str</span><span class="p">;</span>
<a id="rest_code_f52bad0c7da74f299574095ddd495663-14" name="rest_code_f52bad0c7da74f299574095ddd495663-14" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_f52bad0c7da74f299574095ddd495663-14"></a><span class="kr">end</span>
</pre></div>
<p>It gets the password by reading a file in the home directory.</p>
<p>Once, you have the account, you can check the status of a folder with the
check_status() function. For instance:</p>
<div class="code"><pre class="code lua"><a id="rest_code_66ac8e81c01b4d668cb9693572915686-1" name="rest_code_66ac8e81c01b4d668cb9693572915686-1" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_66ac8e81c01b4d668cb9693572915686-1"></a><span class="n">account</span><span class="p">.</span><span class="n">INBOX</span><span class="p">:</span><span class="n">check_status</span><span class="p">()</span>
<a id="rest_code_66ac8e81c01b4d668cb9693572915686-2" name="rest_code_66ac8e81c01b4d668cb9693572915686-2" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_66ac8e81c01b4d668cb9693572915686-2"></a><span class="n">account</span><span class="p">[</span><span class="s1">'[Gmail]/Trash'</span><span class="p">]:</span><span class="n">check_status</span><span class="p">()</span>
</pre></div>
<p>You can run imapfilter simply by launching imapfilter on the command line. Once
imapfilter is run, it will print the status of the folder you choses:</p>
<pre class="literal-block">38 messages, 0 recent, 6 unseen, in baptiste.wicht@gmail.com@imap.gmail.com/INBOX.
70 messages, 0 recent, 67 unseen, in baptiste.wicht@gmail.com@imap.gmail.com/[Gmail]/Trash.</pre>
<p>Several functions are important:</p>
<ul class="simple">
<li><p>select_all() on a folder allows you to get messages from an account to them
perform action on them</p></li>
<li><p>contain_subject('subject') on a list of mails allows you to keep only the mails
that contains 'subject' in their subject</p></li>
<li><p>contain_from('from') on a list of mails allows you to keep only the mails
that comes from 'from'</p></li>
<li><p>contain_to('to') on a list of mails allows you to keep only the mails
that are addressed to 'to'</p></li>
<li><p>delete_messages() on a collection of mails deletes all of them</p></li>
<li><p>move_messages(folder) on a collection of mails moves all of them to another
folder.</p></li>
</ul>
<p>You can also mix different IMAP accounts, you don't have to use only one.</p>
<p>For instance, if you would delete all the mail coming from me, you could do:</p>
<div class="code"><pre class="code lua"><a id="rest_code_4010cc3fcd494148ba599fde0284209d-1" name="rest_code_4010cc3fcd494148ba599fde0284209d-1" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_4010cc3fcd494148ba599fde0284209d-1"></a><span class="n">mails</span> <span class="o">=</span> <span class="n">account</span><span class="p">.</span><span class="n">INBOX</span><span class="p">:</span><span class="n">select_all</span><span class="p">()</span>
<a id="rest_code_4010cc3fcd494148ba599fde0284209d-2" name="rest_code_4010cc3fcd494148ba599fde0284209d-2" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_4010cc3fcd494148ba599fde0284209d-2"></a><span class="n">filtered</span> <span class="o">=</span> <span class="n">mails</span><span class="p">:</span><span class="n">contains_from</span><span class="p">(</span><span class="s2">"baptiste.wicht@gmail.com"</span><span class="p">)</span>
<a id="rest_code_4010cc3fcd494148ba599fde0284209d-3" name="rest_code_4010cc3fcd494148ba599fde0284209d-3" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_4010cc3fcd494148ba599fde0284209d-3"></a><span class="n">filtered</span><span class="p">:</span><span class="n">delete_messages</span><span class="p">()</span>
</pre></div>
<p>Or you could move all the mails containing Urgent in the subject line to an IMAP
folder:</p>
<div class="code"><pre class="code lua"><a id="rest_code_5bcb34c7ddc24d6282d9fa10ee95dd5a-1" name="rest_code_5bcb34c7ddc24d6282d9fa10ee95dd5a-1" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_5bcb34c7ddc24d6282d9fa10ee95dd5a-1"></a><span class="n">mails</span> <span class="o">=</span> <span class="n">account</span><span class="p">.</span><span class="n">INBOX</span><span class="p">:</span><span class="n">select_all</span><span class="p">()</span>
<a id="rest_code_5bcb34c7ddc24d6282d9fa10ee95dd5a-2" name="rest_code_5bcb34c7ddc24d6282d9fa10ee95dd5a-2" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_5bcb34c7ddc24d6282d9fa10ee95dd5a-2"></a><span class="n">filtered</span> <span class="o">=</span> <span class="n">mails</span><span class="p">:</span><span class="n">contains_subject</span><span class="p">(</span><span class="s2">"Urgent"</span><span class="p">)</span>
<a id="rest_code_5bcb34c7ddc24d6282d9fa10ee95dd5a-3" name="rest_code_5bcb34c7ddc24d6282d9fa10ee95dd5a-3" href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#rest_code_5bcb34c7ddc24d6282d9fa10ee95dd5a-3"></a><span class="n">filtered</span><span class="p">:</span><span class="n">move_messages</span><span class="p">(</span><span class="n">account</span><span class="p">[</span><span class="s2">"urgent_mails"</span><span class="p">])</span>
</pre></div>
<p>If you want some more examples, you can take a look at <a class="reference external" href="https://github.com/wichtounet/dotfiles/blob/master/.imapfilter/config.lua">my imapfilter
configuration</a>.</p>
<p>The best way to start using it is to look at examples, there are plenty of them
in the internet, especially in Github dotfiles repositories.</p>
<p>The reference documentation is available using 'man imapfilter_config', there is
plenty more to see.</p>
<p>For more information, you can also consult the <a class="reference external" href="https://github.com/lefcha/imapfilter">offical site</a>.</p>
<p>That is it for this part of the mutt series. In the next post about mutt, I'll
talk about how I use offlineimap to get my mails.</p>
        </div>
            
    
    <a href="posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html#disqus_thread" data-disqus-identifier="cache/posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2014/07/budgetwarrior-04-enhanced-wish-list-and-aggregate.html" class="u-url">budgetwarrior 0.4 - Enhanced wish list and aggregate</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2014-07-06T10:59:55+02:00">2014-07-06 10:59</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>I've just released a new version of my command-line budget manager:
budgetwarrior 0.4.</p>
<section id="enhanced-aggregate-overview"><h2>Enhanced aggregate overview</h2>
<p>The aggregate overviews have been greatly improved. First, there is now a
<em>budget overview month</em> command that groups all expenses of amonth together.
Here is a possible output:</p>
<img alt="/images/budget_04_aggregate_month.png" src="images/budget_04_aggregate_month.png"><p>It also possible to use <em>--full</em> option to also aggregate together the different
accounts:</p>
<img alt="/images/budget_04_aggregate_month_full.png" src="images/budget_04_aggregate_month_full.png"><p>Another new option is <em>--no-group</em> that disables the grouping by categories:</p>
<img alt="/images/budget_04_aggregate_month_full_ng.png" src="images/budget_04_aggregate_month_full_ng.png"><p>Moreover, the separator of categories can now be configured with <em>--separator=</em>.</p>
<p>All these options can also be set in the configuration with these options:</p>
<ul class="simple">
<li><p>aggregate_full : If set to true, does the same as the --full option.</p></li>
<li><p>aggregate_no_group : If set to true, does the same as the --no-group option.</p></li>
<li><p>aggregate_separator : Sets the separator for grouping.</p></li>
</ul></section><section id="enhanced-wish-list"><h2>Enhanced wish list</h2>
<p>The wishes management has also been improved.</p>
<p>First, each wish can now be set an Urgency and Importance level. This is now
shown in wish status as simple indicators:</p>
<img alt="/images/budget_04_wish_status.png" src="images/budget_04_wish_status.png"><p>Moreover, the accuracy of the estimation compared to the paid amount is shown in
<em>wish list</em>:</p>
<img alt="/images/budget_04_wish_list.png" src="images/budget_04_wish_list.png"></section><section id="various-changes"><h2>Various changes</h2>
<p>Objective status now shows more information about the status of the objectives:</p>
<img alt="/images/budget_04_objective_status.png" src="images/budget_04_objective_status.png"><p>The versioning module has been improved. The <em>versioning sync</em> does now perform
a commmit as well as pull/push. <em>versioning push</em>, <em>versioning pull</em> and
<em>versioning status</em> commands have been added.</p>
<p><em>budget version</em> command shows the version of budgetwarrior.</p>
<p>Aliases a now available to make shorted commands:</p>
<ul class="simple">
<li><p>budget sync -&gt; budget versioning sync</p></li>
<li><p>budget aggregate -&gt; budget overview aggregate</p></li>
</ul></section><section id="installation"><h2>Installation</h2>
<p>If you are on Gentoo, you can install it using layman:</p>
<pre class="literal-block">layman -a wichtounet
emerge -a budgetwarrior</pre>
<p>If you are on Arch Linux, you can use this <a class="reference external" href="https://github.com/StreakyCobra/aur">AUR repository</a>.</p>
<p>For other systems, you'll have to install from sources:</p>
<pre class="literal-block">git clone git://github.com/wichtounet/budgetwarrior.git
cd budgetwarrior
make
sudo make install</pre>
</section><section id="conclusion-2"><h2>Conclusion</h2>
<p>If you are interested by the sources, you can download them on Github:
<a class="reference external" href="https://github.com/wichtounet/budgetwarrior">budgetwarrior</a>.</p>
<p>If you have a suggestion or you found a bug, please post an issue on Github.</p>
<p>If you have any comment, don't hesitate to contact me, either by letting a
comment on this post or by email.</p>
</section>
</div>
            
    
    <a href="posts/2014/07/budgetwarrior-04-enhanced-wish-list-and-aggregate.html#disqus_thread" data-disqus-identifier="cache/posts/2014/07/budgetwarrior-04-enhanced-wish-list-and-aggregate.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html" class="u-url">Compile integer Square Roots at compile-time in C++</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2014-07-02T21:05:11+02:00">2014-07-02 21:05</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>For one of my projects, I needed to evaluate a square root at compile-time.
There are several ways to implement it and some are better than the others.</p>
<p>In this post, I'll show several versions, both with Template Metaprogramming
(TMP) and constexpr functions.</p>
<section id="naive-version"><h2>Naive version</h2>
<p>The easiest way to implement it is to enumerate the integers until we find two
integers that when multiplied are equal to our number. This can easily be
implemented in C++ with class template and partial specialization:</p>
<div class="code"><pre class="code c++"><a id="rest_code_39fbf18d6a5d4c05a2c2010787e19d9d-1" name="rest_code_39fbf18d6a5d4c05a2c2010787e19d9d-1" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_39fbf18d6a5d4c05a2c2010787e19d9d-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">N</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">I</span><span class="o">=</span><span class="mi">1</span><span class="o">&gt;</span>
<a id="rest_code_39fbf18d6a5d4c05a2c2010787e19d9d-2" name="rest_code_39fbf18d6a5d4c05a2c2010787e19d9d-2" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_39fbf18d6a5d4c05a2c2010787e19d9d-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">ct_sqrt</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">I</span><span class="o">*</span><span class="n">I</span><span class="o">&lt;</span><span class="n">N</span><span class="p">)</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">ct_sqrt</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="n">I</span><span class="o">+</span><span class="mi">1</span><span class="o">&gt;::</span><span class="n">value</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">I</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
<a id="rest_code_39fbf18d6a5d4c05a2c2010787e19d9d-3" name="rest_code_39fbf18d6a5d4c05a2c2010787e19d9d-3" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_39fbf18d6a5d4c05a2c2010787e19d9d-3"></a>
<a id="rest_code_39fbf18d6a5d4c05a2c2010787e19d9d-4" name="rest_code_39fbf18d6a5d4c05a2c2010787e19d9d-4" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_39fbf18d6a5d4c05a2c2010787e19d9d-4"></a><span class="k">template</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">N</span><span class="o">&gt;</span>
<a id="rest_code_39fbf18d6a5d4c05a2c2010787e19d9d-5" name="rest_code_39fbf18d6a5d4c05a2c2010787e19d9d-5" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_39fbf18d6a5d4c05a2c2010787e19d9d-5"></a><span class="k">struct</span><span class="w"> </span><span class="nc">ct_sqrt</span><span class="o">&lt;</span><span class="n">N</span><span class="p">,</span><span class="n">N</span><span class="o">&gt;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="p">,</span><span class="w"> </span><span class="n">N</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
</pre></div>
<p>Really easy, isn't it ? If we test it with 100, it gives 10. But, if we try with
higher values, we are going to run into problem. For instance, when compiled
with 289, here is what clang++ gives me:</p>
<pre class="literal-block">src/sqrt/tmp.cpp:5:64: fatal error: recursive template instantiation exceeded maximum depth of 256
struct ct_sqrt : std::integral_constant&lt;std::size_t, (I*I&lt;N) ? ct_sqrt&lt;N,I+1&gt;::value : I &gt; {};
                                                               ^
src/sqrt/tmp.cpp:5:64: note: in instantiation of template class 'ct_sqrt&lt;289, 257&gt;' requested here
struct ct_sqrt : std::integral_constant&lt;std::size_t, (I*I&lt;N) ? ct_sqrt&lt;N,I+1&gt;::value : I &gt; {};
                                                               ^
src/sqrt/tmp.cpp:5:64: note: in instantiation of template class 'ct_sqrt&lt;289, 256&gt;' requested here
struct ct_sqrt : std::integral_constant&lt;std::size_t, (I*I&lt;N) ? ct_sqrt&lt;N,I+1&gt;::value : I &gt; {};
                                                               ^
src/sqrt/tmp.cpp:5:64: note: in instantiation of template class 'ct_sqrt&lt;289, 255&gt;' requested here
struct ct_sqrt : std::integral_constant&lt;std::size_t, (I*I&lt;N) ? ct_sqrt&lt;N,I+1&gt;::value : I &gt; {};
                                                               ^
src/sqrt/tmp.cpp:5:64: note: in instantiation of template class 'ct_sqrt&lt;289, 254&gt;' requested here
struct ct_sqrt : std::integral_constant&lt;std::size_t, (I*I&lt;N) ? ct_sqrt&lt;N,I+1&gt;::value : I &gt; {};
                                                               ^
src/sqrt/tmp.cpp:5:64: note: in instantiation of template class 'ct_sqrt&lt;289, 253&gt;' requested here
struct ct_sqrt : std::integral_constant&lt;std::size_t, (I*I&lt;N) ? ct_sqrt&lt;N,I+1&gt;::value : I &gt; {};
                                                               ^
src/sqrt/tmp.cpp:5:64: note: (skipping 247 contexts in backtrace; use -ftemplate-backtrace-limit=0 to see all)
src/sqrt/tmp.cpp:5:64: note: in instantiation of template class 'ct_sqrt&lt;289, 5&gt;' requested here
struct ct_sqrt : std::integral_constant&lt;std::size_t, (I*I&lt;N) ? ct_sqrt&lt;N,I+1&gt;::value : I &gt; {};
                                                               ^
src/sqrt/tmp.cpp:5:64: note: in instantiation of template class 'ct_sqrt&lt;289, 4&gt;' requested here
struct ct_sqrt : std::integral_constant&lt;std::size_t, (I*I&lt;N) ? ct_sqrt&lt;N,I+1&gt;::value : I &gt; {};
                                                               ^
src/sqrt/tmp.cpp:5:64: note: in instantiation of template class 'ct_sqrt&lt;289, 3&gt;' requested here
struct ct_sqrt : std::integral_constant&lt;std::size_t, (I*I&lt;N) ? ct_sqrt&lt;N,I+1&gt;::value : I &gt; {};
                                                               ^
src/sqrt/tmp.cpp:5:64: note: in instantiation of template class 'ct_sqrt&lt;289, 2&gt;' requested here
struct ct_sqrt : std::integral_constant&lt;std::size_t, (I*I&lt;N) ? ct_sqrt&lt;N,I+1&gt;::value : I &gt; {};
                                                               ^
src/sqrt/tmp.cpp:11:18: note: in instantiation of template class 'ct_sqrt&lt;289, 1&gt;' requested here
    std::cout &lt;&lt; ct_sqrt&lt;289&gt;::value &lt;&lt; std::endl;
                 ^
src/sqrt/tmp.cpp:5:64: note: use -ftemplate-depth=N to increase recursive template instantiation depth
struct ct_sqrt : std::integral_constant&lt;std::size_t, (I*I&lt;N) ? ct_sqrt&lt;N,I+1&gt;::value : I &gt; {};
                                                               ^</pre>
<p>And it is only to compute the square root for 289, not a big number. We could of
course increase the template depth limit (-ftemplate-depth=X), but that would
only get us a bit farther. If you try with g++, you should see that this works,
that is because g++ has a higher template depth limit (900 for 4.8.2 on my
machine) where clang has a default limit of 256. It can be noted too that with
g++ no context is skipped, therefore the error is quite long.</p>
<p>Now that C++11 gives us constexpr function, we can rewrite it more cleanly:</p>
<div class="code"><pre class="code c++"><a id="rest_code_a627dd4ba0d44ed0b8c7ca789b621948-1" name="rest_code_a627dd4ba0d44ed0b8c7ca789b621948-1" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_a627dd4ba0d44ed0b8c7ca789b621948-1"></a><span class="k">constexpr</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="nf">ct_sqrt</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">){</span>
<a id="rest_code_a627dd4ba0d44ed0b8c7ca789b621948-2" name="rest_code_a627dd4ba0d44ed0b8c7ca789b621948-2" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_a627dd4ba0d44ed0b8c7ca789b621948-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">ct_sqrt</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">i</span><span class="p">);</span>
<a id="rest_code_a627dd4ba0d44ed0b8c7ca789b621948-3" name="rest_code_a627dd4ba0d44ed0b8c7ca789b621948-3" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_a627dd4ba0d44ed0b8c7ca789b621948-3"></a><span class="p">}</span>
</pre></div>
<p>Much nicer :) And it works perfectly with 289. And it works quite well up to a
large number. But it still fails once we git large numbers. For instance, here
is what clang++ gives me with 302500 (550*550):</p>
<pre class="literal-block">src/sqrt/constexpr.cpp:8:36: error: constexpr variable 'result' must be initialized by a constant expression
static constexpr const std::size_t result = ct_sqrt(SQRT_VALUE);
                                   ^        ~~~~~~~~~~~~~~~~~~~
src/sqrt/constexpr.cpp:5:38: note: constexpr evaluation exceeded maximum depth of 512 calls
    return n == i ? n : (i * i &lt; n ? ct_sqrt(n, i + 1) : i);
                                     ^
src/sqrt/constexpr.cpp:5:38: note: in call to 'ct_sqrt(302500, 512)'
src/sqrt/constexpr.cpp:5:38: note: in call to 'ct_sqrt(302500, 511)'
src/sqrt/constexpr.cpp:5:38: note: in call to 'ct_sqrt(302500, 510)'
src/sqrt/constexpr.cpp:5:38: note: in call to 'ct_sqrt(302500, 509)'
src/sqrt/constexpr.cpp:5:38: note: in call to 'ct_sqrt(302500, 508)'
src/sqrt/constexpr.cpp:5:38: note: (skipping 502 calls in backtrace; use -fconstexpr-backtrace-limit=0 to see all)
src/sqrt/constexpr.cpp:5:38: note: in call to 'ct_sqrt(302500, 5)'
src/sqrt/constexpr.cpp:5:38: note: in call to 'ct_sqrt(302500, 4)'
src/sqrt/constexpr.cpp:5:38: note: in call to 'ct_sqrt(302500, 3)'
src/sqrt/constexpr.cpp:5:38: note: in call to 'ct_sqrt(302500, 2)'
src/sqrt/constexpr.cpp:8:45: note: in call to 'ct_sqrt(302500, 1)'
static constexpr const std::size_t result = ct_sqrt(SQRT_VALUE);
                                            ^</pre>
<p>Again, we run into the limits of the compiler. And again, the limit can be
change with fconstexpr-backtrace-limit=X. With g++, the result is the same
(without the skipped part, which makes the error horribly long), but the command
to change the depth is -fconstexpr-depth=X.</p>
<p>So, if we need to compute higher square roots at compile-time, we need a better
version.</p>
</section><section id="binary-search-version"><h2>Binary Search version</h2>
<p>To find the good square root, you don't need to iterate through all the numbers
from 1 to N, you can perform a binary search to find the numbers to test. I
found a very nice implementation by John Khvatov (<a class="reference external" href="http://jkhvatov.blogspot.ch/2009/11/c-compile-time-square-root-sqrt-using.html">source</a>).</p>
<p>Here is an adaptation of its code:</p>
<div class="code"><pre class="code c++"><a id="rest_code_4b1c0832671b446b9612b018a9468613-1" name="rest_code_4b1c0832671b446b9612b018a9468613-1" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_4b1c0832671b446b9612b018a9468613-1"></a><span class="cp">#define MID(a, b) ((a+b)/2)</span>
<a id="rest_code_4b1c0832671b446b9612b018a9468613-2" name="rest_code_4b1c0832671b446b9612b018a9468613-2" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_4b1c0832671b446b9612b018a9468613-2"></a><span class="cp">#define POW(a) (a*a)</span>
<a id="rest_code_4b1c0832671b446b9612b018a9468613-3" name="rest_code_4b1c0832671b446b9612b018a9468613-3" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_4b1c0832671b446b9612b018a9468613-3"></a>
<a id="rest_code_4b1c0832671b446b9612b018a9468613-4" name="rest_code_4b1c0832671b446b9612b018a9468613-4" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_4b1c0832671b446b9612b018a9468613-4"></a><span class="k">template</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">res</span><span class="o">&gt;</span>
<a id="rest_code_4b1c0832671b446b9612b018a9468613-5" name="rest_code_4b1c0832671b446b9612b018a9468613-5" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_4b1c0832671b446b9612b018a9468613-5"></a><span class="k">struct</span><span class="w"> </span><span class="nc">ct_sqrt</span><span class="p">;</span>
<a id="rest_code_4b1c0832671b446b9612b018a9468613-6" name="rest_code_4b1c0832671b446b9612b018a9468613-6" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_4b1c0832671b446b9612b018a9468613-6"></a>
<a id="rest_code_4b1c0832671b446b9612b018a9468613-7" name="rest_code_4b1c0832671b446b9612b018a9468613-7" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_4b1c0832671b446b9612b018a9468613-7"></a><span class="k">template</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">r</span><span class="o">&gt;</span>
<a id="rest_code_4b1c0832671b446b9612b018a9468613-8" name="rest_code_4b1c0832671b446b9612b018a9468613-8" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_4b1c0832671b446b9612b018a9468613-8"></a><span class="k">struct</span><span class="w"> </span><span class="nc">ct_sqrt</span><span class="o">&lt;</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="o">&gt;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
<a id="rest_code_4b1c0832671b446b9612b018a9468613-9" name="rest_code_4b1c0832671b446b9612b018a9468613-9" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_4b1c0832671b446b9612b018a9468613-9"></a>
<a id="rest_code_4b1c0832671b446b9612b018a9468613-10" name="rest_code_4b1c0832671b446b9612b018a9468613-10" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_4b1c0832671b446b9612b018a9468613-10"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">r</span><span class="o">&gt;</span>
<a id="rest_code_4b1c0832671b446b9612b018a9468613-11" name="rest_code_4b1c0832671b446b9612b018a9468613-11" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_4b1c0832671b446b9612b018a9468613-11"></a><span class="k">struct</span><span class="w"> </span><span class="nc">ct_sqrt</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="p">,</span><span class="w"> </span><span class="n">ct_sqrt</span><span class="o">&lt;</span><span class="n">res</span><span class="p">,</span>
<a id="rest_code_4b1c0832671b446b9612b018a9468613-12" name="rest_code_4b1c0832671b446b9612b018a9468613-12" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_4b1c0832671b446b9612b018a9468613-12"></a><span class="w">        </span><span class="p">(</span><span class="n">POW</span><span class="p">(</span><span class="n">MID</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">MID</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span>
<a id="rest_code_4b1c0832671b446b9612b018a9468613-13" name="rest_code_4b1c0832671b446b9612b018a9468613-13" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_4b1c0832671b446b9612b018a9468613-13"></a><span class="w">        </span><span class="p">(</span><span class="n">POW</span><span class="p">(</span><span class="n">MID</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">MID</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">r</span><span class="p">)</span><span class="o">&gt;::</span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
</pre></div>
<p>With smart binary search, you can reduce A LOT the numbers that needs to be
tested in order to find the answer. It very easily found the answer for 302500.
It can find the square root of almost all integers, until it fails due to
overflows. I think it is really great :)</p>
<p>Of course, we can also do the constexpr version:</p>
<div class="code"><pre class="code c++"><a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-1" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-1" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-1"></a><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="nf">ct_mid</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">b</span><span class="p">){</span>
<a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-2" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-2" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-3" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-3" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-3"></a><span class="p">}</span>
<a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-4" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-4" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-4"></a>
<a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-5" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-5" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-5"></a><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="nf">ct_pow</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">a</span><span class="p">){</span>
<a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-6" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-6" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="o">*</span><span class="n">a</span><span class="p">;</span>
<a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-7" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-7" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-7"></a><span class="p">}</span>
<a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-8" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-8" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-8"></a>
<a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-9" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-9" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-9"></a><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="nf">ct_sqrt</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">r</span><span class="p">){</span>
<a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-10" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-10" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-10"></a><span class="w">    </span><span class="k">return</span>
<a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-11" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-11" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-11"></a><span class="w">        </span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">r</span>
<a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-12" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-12" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-12"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">ct_sqrt</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">ct_pow</span><span class="p">(</span>
<a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-13" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-13" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-13"></a><span class="w">            </span><span class="n">ct_mid</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">l</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ct_mid</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-14" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-14" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-14"></a><span class="w">            </span><span class="n">ct_pow</span><span class="p">(</span><span class="n">ct_mid</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">))</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">res</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">ct_mid</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-15" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-15" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-15"></a><span class="p">}</span>
<a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-16" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-16" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-16"></a>
<a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-17" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-17" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-17"></a><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="nf">ct_sqrt</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">res</span><span class="p">){</span>
<a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-18" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-18" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-18"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ct_sqrt</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">);</span>
<a id="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-19" name="rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-19" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_b1d788b4e9ef42f390a1e8e6681ffb08-19"></a><span class="p">}</span>
</pre></div>
<p>Which is a bit more understandable. It works the same way than the previous one
and is only limited by numeric overflow.</p>
</section><section id="c-14-fun"><h2>C++14 Fun</h2>
<p>In C++14, the constraints on constexpr functions have been highly relaxed, we
can now use variables, if/then/else statements, loops and so on... in constexpr
functions making them much more readable. Here is the C++14 version of the
previous code:</p>
<div class="code"><pre class="code c++"><a id="rest_code_f668811117ef44d4afccc0e193a39ce1-1" name="rest_code_f668811117ef44d4afccc0e193a39ce1-1" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_f668811117ef44d4afccc0e193a39ce1-1"></a><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="nf">ct_sqrt</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">r</span><span class="p">){</span>
<a id="rest_code_f668811117ef44d4afccc0e193a39ce1-2" name="rest_code_f668811117ef44d4afccc0e193a39ce1-2" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_f668811117ef44d4afccc0e193a39ce1-2"></a><span class="w">    </span><span class="k">if</span><span class="p">(</span><span class="n">l</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">r</span><span class="p">){</span>
<a id="rest_code_f668811117ef44d4afccc0e193a39ce1-3" name="rest_code_f668811117ef44d4afccc0e193a39ce1-3" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_f668811117ef44d4afccc0e193a39ce1-3"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
<a id="rest_code_f668811117ef44d4afccc0e193a39ce1-4" name="rest_code_f668811117ef44d4afccc0e193a39ce1-4" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_f668811117ef44d4afccc0e193a39ce1-4"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_f668811117ef44d4afccc0e193a39ce1-5" name="rest_code_f668811117ef44d4afccc0e193a39ce1-5" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_f668811117ef44d4afccc0e193a39ce1-5"></a><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">r</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">l</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<a id="rest_code_f668811117ef44d4afccc0e193a39ce1-6" name="rest_code_f668811117ef44d4afccc0e193a39ce1-6" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_f668811117ef44d4afccc0e193a39ce1-6"></a>
<a id="rest_code_f668811117ef44d4afccc0e193a39ce1-7" name="rest_code_f668811117ef44d4afccc0e193a39ce1-7" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_f668811117ef44d4afccc0e193a39ce1-7"></a><span class="w">        </span><span class="k">if</span><span class="p">(</span><span class="n">mid</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">res</span><span class="p">){</span>
<a id="rest_code_f668811117ef44d4afccc0e193a39ce1-8" name="rest_code_f668811117ef44d4afccc0e193a39ce1-8" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_f668811117ef44d4afccc0e193a39ce1-8"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ct_sqrt</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">l</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="p">);</span>
<a id="rest_code_f668811117ef44d4afccc0e193a39ce1-9" name="rest_code_f668811117ef44d4afccc0e193a39ce1-9" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_f668811117ef44d4afccc0e193a39ce1-9"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_f668811117ef44d4afccc0e193a39ce1-10" name="rest_code_f668811117ef44d4afccc0e193a39ce1-10" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_f668811117ef44d4afccc0e193a39ce1-10"></a><span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="n">ct_sqrt</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="n">mid</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">r</span><span class="p">);</span>
<a id="rest_code_f668811117ef44d4afccc0e193a39ce1-11" name="rest_code_f668811117ef44d4afccc0e193a39ce1-11" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_f668811117ef44d4afccc0e193a39ce1-11"></a><span class="w">        </span><span class="p">}</span>
<a id="rest_code_f668811117ef44d4afccc0e193a39ce1-12" name="rest_code_f668811117ef44d4afccc0e193a39ce1-12" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_f668811117ef44d4afccc0e193a39ce1-12"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_f668811117ef44d4afccc0e193a39ce1-13" name="rest_code_f668811117ef44d4afccc0e193a39ce1-13" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_f668811117ef44d4afccc0e193a39ce1-13"></a><span class="p">}</span>
<a id="rest_code_f668811117ef44d4afccc0e193a39ce1-14" name="rest_code_f668811117ef44d4afccc0e193a39ce1-14" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_f668811117ef44d4afccc0e193a39ce1-14"></a>
<a id="rest_code_f668811117ef44d4afccc0e193a39ce1-15" name="rest_code_f668811117ef44d4afccc0e193a39ce1-15" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_f668811117ef44d4afccc0e193a39ce1-15"></a><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="nf">ct_sqrt</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">res</span><span class="p">){</span>
<a id="rest_code_f668811117ef44d4afccc0e193a39ce1-16" name="rest_code_f668811117ef44d4afccc0e193a39ce1-16" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_f668811117ef44d4afccc0e193a39ce1-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ct_sqrt</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">res</span><span class="p">);</span>
<a id="rest_code_f668811117ef44d4afccc0e193a39ce1-17" name="rest_code_f668811117ef44d4afccc0e193a39ce1-17" href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#rest_code_f668811117ef44d4afccc0e193a39ce1-17"></a><span class="p">}</span>
</pre></div>
<p>I think this version is highly superior than the previous version. Don't you
think ?</p>
<p>It performs exactly the same as the previous. This can only be done in clang for
now, but that will come eventually to gcc too.</p>
</section><section id="conclusion"><h2>Conclusion</h2>
<p>As you saw, there are several ways to compute a square root at compile-time in
C++. The constexpr versions are much more readable and generally more scalable
than the template metaprogramming version. Moreover, now, with C++14, we can
write constexpr functions almost as standard function, which makes really great.</p>
<p>I hope that is is helpful to some of you :)</p>
<p>All the sources are available on Github: <a class="reference external" href="https://github.com/wichtounet/articles/tree/master/src/sqrt">https://github.com/wichtounet/articles/tree/master/src/sqrt</a></p>
</section>
</div>
            
    
    <a href="posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html#disqus_thread" data-disqus-identifier="cache/posts/2014/07/compile-integer-square-roots-at-compile-time-in-cpp.html">Comments</a>


        </article><nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-27.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-25.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div> <!-- col -->
    </div>
<!-- row  -->
</div>
<!-- container-fluid -->

<!-- End of Menubar -->

<!-- Footer -->

<footer>
    Contents © 2023         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         - License: 
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="assets/img/cc.png"></a>
        <ul class="footer_inline_ul"></ul></footer><!-- Late loading stuff  --><script src="assets/js/all-nocdn.js"></script><!-- Google platform JS -->
</body>
</html>