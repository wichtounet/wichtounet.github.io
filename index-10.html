<!DOCTYPE html><html lang="en">
<head>
    <link href="favicon.ico" rel="icon" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Website about vtechnologies Java, Spring, OSGi, Hardware,...">
    <meta name="author" content="Baptiste Wicht">
    <title>@Blog("Baptiste Wicht") (old posts, page 10) | @Blog("Baptiste Wicht")</title>
    
            <link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
      <link rel="canonical" href="http://wichtounet.github.io/index-10.html">
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
            <link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">

    
    
    <link rel="stylesheet" type="text/css" href="assets/css/tipuesearch.css">
    
</head>
<body>

<div class="social_container">
    <div class="social_container_gplus">
        <a target="_blank" title="Share on Google+" href="https://plusone.google.com/_/+1/confirm?hl=en&amp;url=http://wichtounet.github.io/index-10.html"><img src="assets/img/google_plus.png"></a>
    </div>
    <div class="social_container_facebook">
        <a target="_blank" title="Share on Facebook" href="http://www.facebook.com/sharer/sharer.php?u=#url"><img src="assets/img/facebook.png"></a>
    </div>
    <div class="social_container_twitter">
        <a target="_blank" title="Tweet on Twitter" href="http://twitter.com/home?status=#url"><img src="assets/img/twitter.svg"></a>
    </div>
</div>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid"><!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://wichtounet.github.io/">@Blog("Baptiste Wicht")</a>
        </div><!-- /.navbar-header -->
        
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                
                <li><a href="stories/about.html">About</a>
                </li><li><a href="stories/publications.html">Publications</a>
                </li><li><a href="stories/donate.html">Donate</a>
                </li><li><a href="stories/contact.html">Contact</a>
                </li><li><a href="stories/faq.html">FAQ</a>
                </li><li><a href="stories/legal.html">Legal</a>
                </li><li><a href="archive.html">Archives</a>
                </li><li><a href="categories/index.html">Tags</a>
                </li><li><a href="rss.xml">RSS</a>

            </li></ul>

            <span class="navbar-form pull-left">
                <form action="stories/search.html">
                    <input type="text" name="q" id="tipue_search_input">
                </form>
            </span>
            
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounewichtounet">
                        <img src="assets/img/twitter.svg" alt="Follow @wichtounet on Twitter">
                    </a>
                </li>
                <li>
                    <a target="_blank" title="Follow +BaptisteWicht on Google+" href="https://plus.google.com/+BaptisteWicht">
                        <img src="assets/img/google_plus.svg" alt="Follow +BaptisteWicht on Google+">
                    </a>
                </li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>

<!-- End of Menubar -->

<div class="body-container">

    <!-- Sidebar -->

    <div class="left-sidebar">
            <div class="left-sidebar-widget">
                <h3>Welcome to my blog</h3>
                <div class="left-sidebar-widget-content">
                    <div class="g-person" data-width="275" data-href="//plus.google.com/u/0/103113673902796202116" data-theme="dark" data-layout="landscape" data-rel="author"></div>
                </div>
            </div>

            <div class="left-sidebar-widget">
                <h3>Tags</h3>
                <div class="left-sidebar-widget-content">
                    <div id="tags_container">
                        <canvas width="275" height="250" id="tags_canvas">
                            <p>Anything in here will be replaced on browsers that support the canvas element</p>
                        </canvas>
                    </div>
                </div>
            </div>

        
        <div class="left-sidebar-widget">
            <h3>Recent comments</h3>
            <div class="left-sidebar-widget-content">
                <div id="recentcomments" class="dsq-widget">
                    <script type="text/javascript" src="http://blogwichtounet.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=0&amp;avatar_size=28&amp;excerpt_length=50"></script> 
                </div>
            </div>
        </div>

        <div class="left-sidebar-widget">
            <h3>Popular posts</h3>
            <div class="left-sidebar-widget-content">
                <div id="popularthreads" class="dsq-widget">
                    <script type="text/javascript" src="http://blogwichtounet.disqus.com/popular_threads_widget.js?num_items=5&amp;days_back=90"></script>
                </div>
            </div>
        </div>
        
        <div class="left-sidebar-widget">
            <h3>Blogroll</h3>
            <div class="left-sidebar-widget-content">
                <ul>
                    <li><a target="_blank" href="http://www.asjava.com/">AsJava.com : Java Tutorial</a></li>
                    <li><a target="_blank" href="http://www.mkyong.com/">Mkyong : Java Tutorials</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Content -->

    <div class="container">
            <div class="body-content">

            <div class="row">
                
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/08/java-concurrency-in-practice-book-review.html" class="u-url">Java Concurrency in Practice - Book Review</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2010-08-23T07:05:00+02:00">2010-08-23 07:05</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>I used my holidays to concentrate myself on the reading of my last book : Java Concurrency in Practice of Brian Goetz (with Tim Peierls, Joshua Bloch, Joseph Bowbeer, David Holmes and Doug Lea).</p>
<p>This book is, in my point of view, the reference for the development of concurrency programs in Java.</p>
<p>Reading this book, you will learn that concurrency is everywhere when programming in Java (all the examples are in Java, but the theory  is valid for almost all programming languages). You will also learn why the GUI Frameworks are single-threaded. You will also understand that a lot of Java programs aren't correct because of the lack of thread safety.</p>
<p>The first chapter, the introduction, explains what's are the threads and why we use parallel processing. It contains also the first interleaving example (really simple) and how to solve it. In the third chapter, the author explains what is Thread Safety and how to achieve it using locks (intrinsic locks with synchronized). In the next chapter, you learn how to share objects between several threads. This include the notions of visibility, immutability, thread confinement and safe publication. With the fourth chapter, you learn how to design a thread safe class, delegate the thread safety to an other class and learn why it's really important to document the synchronization policies. In the last chapter of this first part, we see how to build blocks of statements. We use concurrent collections, blocking queues, synchronizers, blocking and interruptible methods.</p>
<p>The second part is about structuring concurrent applications. It contains information about the executor framework, finding parallelism, the cancellation and the shutdown of tasks, the thread pools and the GUI applications.</p>
<p>The third part is about liveness hazards, performance and scalability and also about testing concurrent programs.</p>
<p>The last part describe advanced topics. It contains explicit locks using ReentrantLock. It explains also how to build custom synchronizers. A chapter is about building concurrent programs using non-blocking algorithms. This algorithms are better performing but a lot more difficult to build. And the last chapter is about the Java Memory Model. This chapter is very technical but really interesting if you are interested to understand deeply the Java language.</p>
<p>To conclude, this book is a reference for every person who want to write concurrent applications.</p>
<p>Post Scriptum : This is the hundredth post of this blog. I'm proud to see that there is a lot of regular readers and I hope that this blog will live long.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/08/java-concurrency-in-practice-book-review.html#disqus_thread" data-disqus-identifier="cache/posts/2010/08/java-concurrency-in-practice-book-review.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/08/holidays.html" class="u-url">Holidays</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2010-08-15T12:37:52+02:00">2010-08-15 12:37</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>Monday, I will go on holidays for one week. I'll not have internet except on my smartphone, so I'll not post on this blog during one week.</p>
<p>I will just approve comments and perhaps answer to comments if this is necessary, but this is all.</p>
<p>So, to next week.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/08/holidays.html#disqus_thread" data-disqus-identifier="cache/posts/2010/08/holidays.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/08/a-website-for-jtheque.html" class="u-url">A website for JTheque</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2010-08-14T11:51:40+02:00">2010-08-14 11:51</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>I've the pleasure to inform you that I've created a <strong>new website in English for JTheque</strong> : <a title="JTheque Project Website" href="http://www.jtheque.com" target="_blank">http://www.jtheque.com</a></p>
<p>The old websites of JTheque (a French website and a French forge) were completely out of date and were too complicated too manage. This time I created an english, really simple, website to add the more useful informations about my JTheque projects. I always wanted to have a real website for JTheque. Before that, I had the Maven auto generated websites, but this is not a real website and it's not really good-looking. I used Google Sites to create this website.</p>
<p>At this time, I've included three projects in the website : JTheque Core, JTheque Utils and JTheque XML Utils. There is not a lot of informations for the moment,  but from this time I'll include all the future informations in this new website and I will of course inform you via this blog of all the informations about my projects.</p>
<p>I hope that this website will interest you and that it will help to promote a little my JTheque Project.</p>
<p>If you found any error on the website, don't hesitate to contact me, via comment or email or whatever you want. If you need more informations on one or more project, don't hesitate to request them and I will include them in the website as soon as possible.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/08/a-website-for-jtheque.html#disqus_thread" data-disqus-identifier="cache/posts/2010/08/a-website-for-jtheque.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/08/do-not-use-relative-path-with-logback.html" class="u-url">Do not use relative path with LogBack</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2010-08-12T07:53:14+02:00">2010-08-12 07:53</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>A little tip that can be useful and save a lot of time : Do not use relative path with LogBack.</p>
<p>I wondered why this little LogBack configuration didn't work :</p>
<div class="code"><pre><span class="cp">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span>

<span class="nt">&lt;configuration&gt;</span>
    <span class="nt">&lt;contextName&gt;</span>JTheque<span class="nt">&lt;/contextName&gt;</span>

    <span class="nt">&lt;appender</span> <span class="na">name=</span><span class="s">"FILE"</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.RollingFileAppender"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;file&gt;</span>logs/jtheque.log<span class="nt">&lt;/file&gt;</span>

        <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.FixedWindowRollingPolicy"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;FileNamePattern&gt;</span>logs/jtheque.%i.log.zip<span class="nt">&lt;/FileNamePattern&gt;</span>
            <span class="nt">&lt;MinIndex&gt;</span>1<span class="nt">&lt;/MinIndex&gt;</span>
            <span class="nt">&lt;MaxIndex&gt;</span>5<span class="nt">&lt;/MaxIndex&gt;</span>
        <span class="nt">&lt;/rollingPolicy&gt;</span>

        <span class="nt">&lt;triggeringPolicy</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.SizeBasedTriggeringPolicy"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;MaxFileSize&gt;</span>5MB<span class="nt">&lt;/MaxFileSize&gt;</span>
        <span class="nt">&lt;/triggeringPolicy&gt;</span>

        <span class="nt">&lt;layout</span> <span class="na">class=</span><span class="s">"ch.qos.logback.classic.PatternLayout"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;Pattern&gt;</span>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n<span class="nt">&lt;/Pattern&gt;</span>
        <span class="nt">&lt;/layout&gt;</span>
    <span class="nt">&lt;/appender&gt;</span>

    <span class="nt">&lt;root</span> <span class="na">level=</span><span class="s">"DEBUG"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;appender-ref</span> <span class="na">ref=</span><span class="s">"FILE"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/root&gt;</span>
<span class="nt">&lt;/configuration&gt;</span>
</pre></div>


<p>No file were written. I searched during a long time and after that tested with an absolute path and it worked really well. But absolute path is not very good. But, you can use system properties in the configuration, so I used user.dir to make the think works : </p>
<div class="code"><pre>        ...
        <span class="nt">&lt;file&gt;</span>${user.dir}/logs/jtheque.log<span class="nt">&lt;/file&gt;</span>

        <span class="nt">&lt;rollingPolicy</span> <span class="na">class=</span><span class="s">"ch.qos.logback.core.rolling.FixedWindowRollingPolicy"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;FileNamePattern&gt;</span>${user.dir}/logs/jtheque.%i.log.zip<span class="nt">&lt;/FileNamePattern&gt;</span>
            <span class="nt">&lt;MinIndex&gt;</span>1<span class="nt">&lt;/MinIndex&gt;</span>
            <span class="nt">&lt;MaxIndex&gt;</span>5<span class="nt">&lt;/MaxIndex&gt;</span>
        <span class="nt">&lt;/rollingPolicy&gt;</span>
        ...
</pre></div>


<p>And this time, it works well !</p>
<p>Hope this will be useful to somebody.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/08/do-not-use-relative-path-with-logback.html#disqus_thread" data-disqus-identifier="cache/posts/2010/08/do-not-use-relative-path-with-logback.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/08/generate-graphs-benchmarks-easily.html" class="u-url">Generate graphs benchmarks easily</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2010-08-11T07:04:50+02:00">2010-08-11 07:04</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>After launching a lot of benchmarks for <a title="Java File Copy Benchmark" href="http://www.baptiste-wicht.com/2010/08/file-copy-in-java-benchmark/" target="_blank">file copy benchmark</a> and always generating the graphs from the results in Excel, I realized that I was loosing a lot of time to do that. So like any Java developer, I decided to create a little tool that do the work automatically for me.</p>
<p>For creating benchmarks, I'm using a little micro-benchmarking framework, <a title="How to write correct benchmarks" href="http://www.baptiste-wicht.com/2010/04/write-corrects-benchmarks/" target="_blank">described here</a>. After the results are generated, I automatically generate a bar chart of the result using JFreeChart.</p>
<p>Here is an example of graph generated by the tool :</p>
<p><a href="wp-content/uploads/2010/08/graph-example.png"><img class="size-full wp-image-931" title="Example graph" src="wp-content/uploads/2010/08/graph-example.png" alt="Example graph" width="500" height="400"></a></p>
<!--more-->

<h4>Usage of the library</h4>

<p>The usage is quite simple. By example, if you want to benchmark two methods :</p>
<div class="code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">method1</span><span class="o">(){</span>
    <span class="c1">//Code...</span>
<span class="o">}</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">method2</span><span class="o">(){</span>
    <span class="c1">//Code...</span>
<span class="o">}</span>
</pre></div>


<p>Start creating a Benchs :</p>
<div class="code"><pre><span class="n">Benchs</span> <span class="n">benchs</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Benchs</span><span class="o">(</span><span class="s">"Title of the benchmark"</span><span class="o">);</span>

<span class="n">benchs</span><span class="o">.</span><span class="na">setFolder</span><span class="o">(</span><span class="s">"folder_path"</span><span class="o">);</span>
</pre></div>


<p>folder_path indicates the folder were the graphs will be generated.</p>
<p>And let’s start the benchs :</p>
<div class="code"><pre><span class="n">benchs</span><span class="o">.</span><span class="na">bench</span><span class="o">(</span><span class="s">"First method"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Runnable</span><span class="o">(){</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">method1</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">});</span>

<span class="n">benchs</span><span class="o">.</span><span class="na">bench</span><span class="o">(</span><span class="s">"Second method"</span><span class="o">,</span> <span class="k">new</span> <span class="n">Runnable</span><span class="o">(){</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">method2</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">});</span>

<span class="n">benchs</span><span class="o">.</span><span class="na">generateCharts</span><span class="o">();</span>
</pre></div>


<p>The charts will be generated in the specified folder.</p>
<h3>Sub chart</h3>

<p>If in the first graph, there is some methods that takes a lot more time than the others methods, a sub chart will be generated including only the best methods. The methods to be removed from the graph to create the sub graph are selected using an exclusion factor. All the benchmarks with a mean exclusionFactor times higher than an other benchmark mean will be excluded. You can configure the exclusion factor using the setExclusionFactor setter. The default is 50.</p>
<p>You can donwload it here : <a href="http://www.baptiste-wicht.com/public/downloads/benchmark-utils.tar.gz">benchmark-utils.tar.gz</a></p>
<p>You can consult the <a title="GitHub website of benchmark-utils" href="http://wiki.github.com/wichtounet/benchmark-utils/" target="_blank">GitHub website</a> for more informations and to get the sources.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/08/generate-graphs-benchmarks-easily.html#disqus_thread" data-disqus-identifier="cache/posts/2010/08/generate-graphs-benchmarks-easily.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/08/tip-launch-java-applications-from-java-applications-with-ant.html" class="u-url">Quick Tip : Launch Java Applications From Java applications with Ant</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2010-08-09T07:22:42+02:00">2010-08-09 07:22</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>One week ago, I searched a way <strong>to launch a Java application</strong> from an other Java application without loosing portability. And I found a post on StackOverflow explaining how achieve that goal using <strong>Apache Ant</strong>.</p>
<p>It's really easy. It use the Ant classes and simulate a project launching and a build task. In this post, we'll see a simple method to launch an application from Java.</p>
<!--more-->

<p>Here is a simple method that launch an application using Ant :</p>
<div class="code"><pre><span class="kn">package</span> <span class="n">org</span><span class="o">.</span><span class="na">jtheque</span><span class="o">.</span><span class="na">osgi</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.tools.ant.BuildException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.tools.ant.BuildLogger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.tools.ant.DefaultLogger</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.tools.ant.DemuxOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.tools.ant.Project</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.tools.ant.taskdefs.Java</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.PrintStream</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Launcher</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="nf">launchApplication</span><span class="o">(</span><span class="n">Class</span> <span class="n">mainClass</span><span class="o">,</span> <span class="n">String</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="kt">int</span> <span class="n">returnCode</span><span class="o">;</span>

        <span class="n">Project</span> <span class="n">project</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Project</span><span class="o">();</span>

        <span class="n">project</span><span class="o">.</span><span class="na">setBasedir</span><span class="o">(</span><span class="n">System</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"user.dir"</span><span class="o">));</span>
        <span class="n">project</span><span class="o">.</span><span class="na">init</span><span class="o">();</span>

        <span class="n">PrintStream</span> <span class="n">out</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">;</span>
        <span class="n">PrintStream</span> <span class="n">err</span> <span class="o">=</span> <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">;</span>

        <span class="n">BuildLogger</span> <span class="n">logger</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DefaultLogger</span><span class="o">();</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">setOutputPrintStream</span><span class="o">(</span><span class="n">out</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">setErrorPrintStream</span><span class="o">(</span><span class="n">err</span><span class="o">);</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">setMessageOutputLevel</span><span class="o">(</span><span class="n">Project</span><span class="o">.</span><span class="na">MSG_INFO</span><span class="o">);</span>

        <span class="n">project</span><span class="o">.</span><span class="na">addBuildListener</span><span class="o">(</span><span class="n">logger</span><span class="o">);</span>

        <span class="n">System</span><span class="o">.</span><span class="na">setOut</span><span class="o">(</span><span class="k">new</span> <span class="n">PrintStream</span><span class="o">(</span><span class="k">new</span> <span class="n">DemuxOutputStream</span><span class="o">(</span><span class="n">project</span><span class="o">,</span> <span class="kc">false</span><span class="o">)));</span>
        <span class="n">System</span><span class="o">.</span><span class="na">setErr</span><span class="o">(</span><span class="k">new</span> <span class="n">PrintStream</span><span class="o">(</span><span class="k">new</span> <span class="n">DemuxOutputStream</span><span class="o">(</span><span class="n">project</span><span class="o">,</span> <span class="kc">true</span><span class="o">)));</span>

        <span class="n">project</span><span class="o">.</span><span class="na">fireBuildStarted</span><span class="o">();</span>

        <span class="n">Throwable</span> <span class="n">caught</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">project</span><span class="o">.</span><span class="na">log</span><span class="o">(</span><span class="s">"Launch Application"</span><span class="o">);</span>

            <span class="n">Java</span> <span class="n">javaTask</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Java</span><span class="o">();</span>
            <span class="n">javaTask</span><span class="o">.</span><span class="na">setTaskName</span><span class="o">(</span><span class="s">"Application Launcher"</span><span class="o">);</span>
            <span class="n">javaTask</span><span class="o">.</span><span class="na">setProject</span><span class="o">(</span><span class="n">project</span><span class="o">);</span>
            <span class="n">javaTask</span><span class="o">.</span><span class="na">setFork</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="n">javaTask</span><span class="o">.</span><span class="na">setFailonerror</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="n">javaTask</span><span class="o">.</span><span class="na">setCloneVm</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="n">javaTask</span><span class="o">.</span><span class="na">setClassname</span><span class="o">(</span><span class="n">mainClass</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
            <span class="n">javaTask</span><span class="o">.</span><span class="na">setArgs</span><span class="o">(</span><span class="n">args</span><span class="o">);</span>
            <span class="n">javaTask</span><span class="o">.</span><span class="na">init</span><span class="o">();</span>

            <span class="n">returnCode</span> <span class="o">=</span> <span class="n">javaTask</span><span class="o">.</span><span class="na">executeJava</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">BuildException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">caught</span> <span class="o">=</span> <span class="n">e</span><span class="o">;</span>

            <span class="n">returnCode</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="n">project</span><span class="o">.</span><span class="na">fireBuildFinished</span><span class="o">(</span><span class="n">caught</span><span class="o">);</span>

        <span class="n">System</span><span class="o">.</span><span class="na">setOut</span><span class="o">(</span><span class="n">out</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">setErr</span><span class="o">(</span><span class="n">err</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">returnCode</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>


<p>Here are some explanations :</p>
<p></p><ul>
    <li>First, we create a new Project using the user directory as base directory and init it.</li>
    <li>Then, we create a simple logger using the System.out and System.err streams and replace then with demux streams</li>
    <li>After that, we create the Java task. By using setCloneVm(true), the new virtual machine will clone the properties of the current virtual machine. We must use a fork virtual machine to get the return code of the application. We set also the name of the class and the args of the launch. Finally we init and execute the task</li>
    <li>Once the application is finished, we get the return code and restore the old System.out and System.err streams</li>
</ul>
<p>It's extremely simple and portable and the code is, I think, very clean.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/08/tip-launch-java-applications-from-java-applications-with-ant.html#disqus_thread" data-disqus-identifier="cache/posts/2010/08/tip-launch-java-applications-from-java-applications-with-ant.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/08/presentation-usage-h2-database-engine.html" class="u-url">Presentation and use of H2 Database Engine</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2010-08-06T07:04:09+02:00">2010-08-06 07:04</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>It makes a long time now that I started to use the <strong>H2 Database Engine</strong> as embedded database in JTheque and other projects. This post is a presentation of this database engine and some informations about its utilization.</p>
<p>H2 is a <strong>pure Java database</strong>. It can work as <strong>embedded database</strong> or in <strong>server mode</strong>. The developers of the database have made all to have a very small footprint for this database, it takes around 1MB jar file size.</p>
<!--more-->

<h4>Performances</h4>

<p>Another feature the developers find important in this database is the performance. Here are two comparison graphs for H2, Derby and HSQLDB, generated directly from the benchmark data from the official H2 site.</p>
<p><a href="wp-content/uploads/2010/08/Perfs-Embedded.png"><img class="size-full wp-image-894" title="Performances of H2 in Embedded Mode" src="wp-content/uploads/2010/08/Perfs-Embedded.png" alt="Performances of H2 in Embedded Mode" width="317" height="272"></a></p>
<p><a href="wp-content/uploads/2010/08/Perfs-Server.png"><img class="size-full wp-image-893" title="Performances of H2 in Server Mode" src="wp-content/uploads/2010/08/Perfs-Server.png" alt="Performances of H2 in Server Mode" width="301" height="278"></a></p>
<p>As you can see, the performances of H2 are very good. It's the main reason I've used H2 instead of HSQLDB.</p>
<h4>Modes</h4>

<p>H2 can work in three modes. Embedded, Server or Mixed modes. In each mode, you can use memory or persistent tables.</p>
<p><a href="wp-content/uploads/2010/08/connection-mode-embedded.png"><img class="aligncenter size-full wp-image-897" title="H2 Embedded Mode" src="wp-content/uploads/2010/08/connection-mode-embedded.png" alt="H2 Embedded Mode"></a></p>
<p>In this mode, the database is only accessible from the current virtual machine. It's the fastest connection mode.</p>
<p><a href="wp-content/uploads/2010/08/connection-mode-remote.png"><img class="aligncenter size-full wp-image-896" title="H2 Server Mode" src="wp-content/uploads/2010/08/connection-mode-remote.png" alt="H2 Server Mode"></a></p>
<p>In this mode, the database runs in a server, so several applications can access the database engines. Of course, this mode is slower than in embedded mode, because all datas are transfered using TCP/IP.</p>
<p><a href="wp-content/uploads/2010/08/connection-mode-mixed.png"><img class="size-full wp-image-895" title="H2 Mixed Mode" src="wp-content/uploads/2010/08/connection-mode-mixed.png" alt="H2 Mixed Mode" width="403" height="240"></a></p>
<p>In this mode, the first application create the application in embedded mode but also start a server to provide access to the database.</p>
<h4>Use</h4>

<p>The use of this database is as simple as the use of any other database. You just have to create to the database using the JDBC Driver and the database will be automatically created if needed or the server launched if needed.</p>
<p>By example, here it's an example to create an database in embedded mode, you just have to do that :</p>
<div class="code"><pre><span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">"org.hsqldb.jdbcDriver"</span><span class="o">).</span><span class="na">newInstance</span><span class="o">();</span>

<span class="n">Connection</span> <span class="n">connexion</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="s">"jdbc:h2:test"</span><span class="o">,</span> <span class="s">"sa"</span><span class="o">,</span>  <span class="s">""</span><span class="o">);</span>
</pre></div>


<p>test is the name of the database. If the database already exists, the data will be loaded.</p>
<p>You can also create a database in memory. There is no persisting data. When you close the database, there is no data persisted. It's useful for benchmarking by example.  It's also the mode with the best performances. Here is an example to create a memory database (named test) :</p>
<div class="code"><pre><span class="n">Connection</span> <span class="n">connexion</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="s">"jdbc:h2:mem:test"</span><span class="o">,</span> <span class="s">"sa"</span><span class="o">,</span>  <span class="s">""</span><span class="o">);</span>
</pre></div>


<p>To start the server, you have two choice. You can launch it from the command line :</p>
<div class="code"><pre><span class="n">java</span> <span class="o">-</span><span class="n">cp</span> <span class="n">h2</span><span class="o">*.</span><span class="na">jar</span> <span class="n">org</span><span class="o">.</span><span class="na">h2</span><span class="o">.</span><span class="na">tools</span><span class="o">.</span><span class="na">Server</span>
</pre></div>


<p>Or programmatically :</p>
<div class="code"><pre><span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="n">Server</span><span class="o">.</span><span class="na">createTcpServer</span><span class="o">(</span><span class="n">args</span><span class="o">).</span><span class="na">start</span><span class="o">();</span>

<span class="o">...</span>

<span class="n">server</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
</pre></div>


<p>And to connect to a remove server, just change the JDBC URL :</p>
<div class="code"><pre><span class="n">Connection</span> <span class="n">connexion</span> <span class="o">=</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="s">"jdbc:h2:tcp://localhost/~/test"</span><span class="o">,</span> <span class="s">"sa"</span><span class="o">,</span>  <span class="s">""</span><span class="o">);</span>
</pre></div>


<p>The database is closed when the last connection to the database is closed.</p>
<p>The SQL used is strandard SQL with some adds to support the features of H2. The syntax is described on the oficial site : <a href="http://www.h2database.com/html/grammar.html" target="_blank">SQL Grammar</a>. By example, here are the SQL requests for creating the different types of database of H2 :</p>
<div class="code"><pre><span class="k">CREATE</span> <span class="n">CACHED</span> <span class="k">TABLE</span> <span class="n">cachedTable</span> <span class="p">...</span>
<span class="k">CREATE</span> <span class="n">MEMORY</span> <span class="k">TABLE</span> <span class="n">memTable</span> <span class="p">...</span>
<span class="k">CREATE</span> <span class="n">MEMORY</span> <span class="k">TEMPORARY</span> <span class="k">TABLE</span> <span class="n">memTempTable</span> <span class="p">...</span>
<span class="k">CREATE</span> <span class="n">CACHED</span> <span class="k">TEMPORARY</span> <span class="k">TABLE</span> <span class="n">memTempTable</span> <span class="p">...</span>
</pre></div>


<ul>
    <li>A cached table is the default type of table. The data are persistent and not limited by the memory.</li>
    <li>A memory table is also persistent but the index of data is kept in the memory, so memory table cannot be too large.</li>
    <li>A temporary table is deleted when closing the database.</li>
</ul>

<p>So, I think we covered here the main things we must know to start using H2 Database Engine.</p>
<p>For more informations, consult <a href="http://www.h2database.com/" target="_blank">the official site</a>.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/08/presentation-usage-h2-database-engine.html#disqus_thread" data-disqus-identifier="cache/posts/2010/08/presentation-usage-h2-database-engine.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/08/java-file-copy-benchmarks-update.html" class="u-url">Java File Copy Benchmarks Update</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2010-08-04T09:04:35+02:00">2010-08-04 09:04</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>I've made an update of my benchmark about file copy methods in Java. I've been asked for new informations about this benchmark and for new test, so I've included more results and informations.</p>
<p>This new version include two new complete benchmarks :</p>
<ol>
    <li>Benchmark on the same disk (Ext4)</li>
    <li>Benchmark between two disks (Ext4 -&gt; Ext4)</li>
</ol>

<p>And of course the old benchmark is always here : Benchmark between two disks (Ext4 -&gt; NTFS).</p>
<p>I've also included more informations about the disk and the benchmark. The statistics informations about the results are also included in the post. So you can found the standard deviation of the results and the confidence intervals of the results stats.</p>
<p>And last but not least I've included a new method to copy files using the cp executable of Linux.</p>
<p>The results are always available at the same place : <a title="File Copy in Java - Benchmark" href="http://www.baptiste-wicht.com/2010/08/file-copy-in-java-benchmark/" target="_self">File Copy in Java - Benchmark</a></p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/08/java-file-copy-benchmarks-update.html#disqus_thread" data-disqus-identifier="cache/posts/2010/08/java-file-copy-benchmarks-update.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/08/file-copy-in-java-benchmark.html" class="u-url">File copy in Java - Benchmark</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2010-08-02T07:18:44+02:00">2010-08-02 07:18</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>Yesterday I wondered if the copyFile method in JTheque Utils was the best method or if I need to change. So I decided to do a benchmark.</p>
<p>So I searched all the methods to copy a File in Java, even the bad methods and found 5 methods :</p>
<p></p><ol>
    <li><strong>Native Copy</strong> : Make the copy using the cp executable of Linux</li>
    <li><strong>Naive Streams Copy</strong> : Open two streams, one to read, one to write and transfer the content byte by byte.</li>
    <li><strong>Naive Readers Copy</strong> : Open two readers, one to read, one to write and transfer the content character by character.</li>
    <li><strong>Buffered Streams Copy</strong> : Same as the first but using buffered streams instead of simple streams.</li>
    <li><strong>Buffered Readers Copy</strong> : Same as the second but using buffered readers instead of simple readers.</li>
    <li><strong>Custom Buffer Stream Copy</strong> : Same as the first but reading the file not byte by byte but using a simple byte array as buffer.</li>
    <li><strong>Custom Buffer Reader Copy</strong> : Same as the fifth but using a Reader instead of a stream.</li>
    <li><strong>Custom Buffer Buffered Stream Copy</strong> : Same as the fifth but using buffered streams.</li>
    <li><strong>Custom Buffer Buffered Reader Copy</strong> : Same as the sixth but using buffered readers.</li>
    <li><strong>NIO Buffer Copy</strong> : Using NIO Channel and using a ByteBuffer to make the transfer.</li>
    <li><strong>NIO Transfer Copy</strong> : Using NIO Channel and direct transfer from one channel to other.</li>
    <li><strong>Path (Java 7) Copy</strong> : Using the Path class of Java 7 and its method copyTo()</li>
</ol>
<p>I think, this is the principal methods to copy a file to another file. The different methods are available at the end of the post. Pay attention that the methods with Readers only works with text files because Readers are using character by character reading so it doesn't work on a binary file like an image. Here I used a buffer size of 4096 bytes. Of course, use a higher value improve the performances of custom buffer strategies.</p>
<p>For the benchmark, I made the tests using different files.</p>
<ol>
    <li>Little file (5 KB)</li>
    <li>Medium file (50 KB)</li>
    <li>Big file (5 MB)</li>
    <li>Fat file (50 MB)</li>
    <li>And an enormous file (1.3 GB) only binary</li>
</ol>

<p>And I made the tests first using text files and then using binary files. I made the tests using in three modes :</p>
<ol>
    <li>On the same hard disk. It's an IDE Hard Disk of 250 GB with 8 MB of cache. It's formatted in Ext4.</li>
    <li>Between two disk. I used the first disk and an other SATA Hard Disk of 250 GB with 16 MB of cache. It's formatted in Ext4.</li>
    <li>Between two disk. I used the first disk and an other SATA Hard Disk of 1 TB with 32 MB of cache. It's formatted using NTFS.</li>
</ol>

<p>I used a benchmark framework, <a title="Micro-Benchmarking framework" href="http://www.baptiste-wicht.com/2010/04/write-corrects-benchmarks/" target="_blank">described here</a>, to make the tests of all the methods. The tests have been made on my personal computer (Ubuntu 10.04 64 bits, Intel Core 2 Duo 3.16 GHz, 6 Go DDR2, SATA Hard Disks). The Java version used is a Java 7 64 bits Virtual Machine.</p>
<p>I've cut the post into several pages due to the length of the post :</p>
<ol>
    <li>Introduction about the benchmark</li>
    <li>Benchmark on the same disk</li>
    <li>Benchmark between Ext4 and Ext4</li>
    <li>Benchmark between Ext4 and NTFS</li>
    <li>Conclusions about the benchmark results</li>
</ol>

<!--nextpage-->

<h4>Benchmark on the same disk (Ext4)</h4>

<p>So let's start with the results of the benchmarking using the same disk.</p>
<p><a href="wp-content/uploads/2010/08/little-text-same-disk.png"><img class="size-full wp-image-964" title="Little Text Benchmark Results" src="wp-content/uploads/2010/08/little-text-same-disk.png" alt="Little Text Benchmark Results" width="500" height="400"></a></p>
<p>We can see that here the native and naive streams methods are a lot slower than the other methods. So lets remove the naive  streams method from the graph to have a better view on the other methods :</p>
<p><a href="wp-content/uploads/2010/08/little-text-same-disk-sub.png"><img class="size-full wp-image-965" title="Little Text Benchmark Sub Results" src="wp-content/uploads/2010/08/little-text-same-disk-sub.png" alt="Little Text Benchmark Sub Results" width="500" height="400"></a></p>
<p>The first conclusion we can do is that the naive readers is a lot faster than the naive streams. It's because Reader use a buffer internally and this is not the case in streams. The others methods are closer, so we'll see with the next sizes what happens.</p>
<p><a href="wp-content/uploads/2010/08/medium-text-same-disk-sub.png"><img class="size-full wp-image-967" title="Medium Text Benchmark Results" src="wp-content/uploads/2010/08/medium-text-same-disk-sub.png" alt="Medium Text Benchmark Results" width="500" height="400"></a></p>
<p>Here, we have removed the two naive methods because they are too slows compared to the others.</p>
<p>The readers methods are slower than the equivalent streams methods because readers are working on chars, so they must make characters conversion for every char of the file, so this is a cost to add.</p>
<p>Another observation is that the custom buffer strategy is faster than the buffering of the streams and than using custom buffer with a buffered stream or a single stream doesn't change anything. The same observation can be made using the custom buffer using readers, it's the same with buffered readers or not. This is logical, because with custom buffer we made 4096 (size of the buffer) times less invocations to the read method and because we ask for a complete buffer we have not a lot of I/O operations. So the buffer of the streams (or the readers) is not useful here.</p>
<p>The NIO Buffer, NIO Transfer and Path strategies are almost equivalent to custom buffer.</p>
<p><a href="wp-content/uploads/2010/08/big-text-same-disk-sub.png"><img class="size-full wp-image-969" title="Big Text Benchmark Results" src="wp-content/uploads/2010/08/big-text-same-disk-sub.png" alt="Big Text Benchmark Results" width="500" height="400"></a></p>
<p>Here we see the limits of the simple buffered stream (and readers methods). And another really interesting thing we see is that the native is now faster than buffered streams and readers. Native method must start an external program and this has a cost not negligible. But the copy using the cp executable is really fast and that's because when the file size grows, the native method becomes interesting. All the other methods except the readers are almost equivalent.</p>
<p><a href="wp-content/uploads/2010/08/fat-text-same-disk.png"><img class="size-full wp-image-970" title="Fat Text Benchmark Results" src="wp-content/uploads/2010/08/fat-text-same-disk.png" alt="Fat Text Benchmark Results" width="500" height="400"></a></p>
<p>This time we can see that the native copy method is here as fast as the custom buffer streams. The fast method is the NIO Transfer method.</p>
<p>It's interesting to see that it doesn't take 100 ms to copy a 50 MB file.</p>
<p>We'll see with binary now. We'll directly start with a 5 MB file.</p>
<p><a href="wp-content/uploads/2010/08/big-binary-same-disk.png"><img class="size-full wp-image-971" title="Big Binary Benchmark Results" src="wp-content/uploads/2010/08/big-binary-same-disk.png" alt="Big Binary Benchmark Results" width="500" height="400"></a></p>
<p>We see exactly the same results as with a text file. The native method start to be interesting. We see precisely that the NIOand Path methods are really interesting here.</p>
<p><a href="wp-content/uploads/2010/08/fat-binary-same-disk.png"><img class="size-full wp-image-972" title="Fat Binary Benchmark Results" src="wp-content/uploads/2010/08/fat-binary-same-disk.png" alt="Fat Binary Benchmark Results" width="500" height="400"></a></p>
<p>We can see that all the methods are really, really close, but the native, NIO Buffer, NIO Transfer and Path methods are the best. Just to be sure of these results, let's test with a bigger file :</p>
<p><a href="wp-content/uploads/2010/08/enormous-binary-same-disk.png"><img class="size-full wp-image-973" title="Enormous Binary Benchmark Results" src="wp-content/uploads/2010/08/enormous-binary-same-disk.png" alt="Enormous Binary Benchmark Results" width="500" height="400"></a></p>
<p>Here we can see that the native method become to be the fastest one. The other method are really close. I thought the NIO Transfer will be normally faster. Due to the size of the file the benchmark has been made only a little number of times, so the number can be inaccurate. We see that he Path method is really close to the other.</p>
<p>The detailed informations (standard deviation, confidence intervals and other stats stuff) are available in the conclusion page.</p>
<!--nextpage-->

<h4>Benchmark between two disks (Ext4 -&gt; Ext4)</h4>

<p>Here are the results of the same tests but using two hard disk with the same formatting (Ext4).</p>
<p><a href="wp-content/uploads/2010/08/little-text-same-disk1.png"><img class="size-full wp-image-975" title="Little Text Benchmark Results" src="wp-content/uploads/2010/08/little-text-same-disk1.png" alt="Little Text Benchmark Results" width="500" height="400"></a></p>
<p>We see exactly the same results as in the first benchmark. The naive streams iscompletely useless for little files. So let's remove itand see what happens for interesting methods :</p>
<p><a href="wp-content/uploads/2010/08/little-text-between-disks-sub.png"><img class="size-full wp-image-976" title="Little Text Benchmark Results" src="wp-content/uploads/2010/08/little-text-between-disks-sub.png" alt="Little Text Benchmark Results" width="500" height="400"></a></p>
<p>Here again, the conclusion are the same and the times are not enough big to make global conclusions.</p>
<p><a href="wp-content/uploads/2010/08/medium-text-between-disks-sub.png"><img class="size-full wp-image-977" title="Medium Text Benchmark Results" src="wp-content/uploads/2010/08/medium-text-between-disks-sub.png" alt="Medium Text Benchmark Results" width="500" height="400"></a></p>
<p>Here, we have the limits of the buffered strategy and see a real advantage of custom buffer strategy. We also see that the NIO Transfer and Path methods are taking a little advantage. But again, the times are really short.</p>
<p><a href="wp-content/uploads/2010/08/big-text-between-disks-sub.png"><img class="size-full wp-image-978" title="Big Text Benchmark Results" src="wp-content/uploads/2010/08/big-text-between-disks-sub.png" alt="Big Text Benchmark Results" width="500" height="400"></a></p>
<p>We can see the reintroduction of the native method on the interesting methods.</p>
<p><a href="wp-content/uploads/2010/08/fat-text-between-disks.png"><img class="size-full wp-image-979" title="Fat Text Benchmark Results" src="wp-content/uploads/2010/08/fat-text-between-disks.png" alt="Fat Text Benchmark Results" width="500" height="400"></a></p>
<p>So we covered the text files. If we compare the times between the first benchmark (the same disk) and this method (between two disk), we can see that the times are almost the same, just a little slower for some methods. So let's watch the big binary files :</p>
<p><a href="wp-content/uploads/2010/08/fat-binary-between-disks.png"><img class="size-full wp-image-980" title="Fat Binary Benchmark Results" src="wp-content/uploads/2010/08/fat-binary-between-disks.png" alt="Fat Binary Benchmark Results" width="500" height="400"></a></p>
<p>Again, the results are close to using the same disk. So let's see with the last file :</p>
<p><a href="wp-content/uploads/2010/08/enormous-binary-between-disks.png"><img class="size-full wp-image-981" title="Enormous Binary Benchmark Results" src="wp-content/uploads/2010/08/enormous-binary-between-disks.png" alt="Enormous Binary Benchmark Results" width="500" height="400"></a></p>
<p>This time, the differences are impressive. The native and NIO Buffer methods are the fastest methods. The NIO Transfer is a little slower but the Path method is a lot slower here.</p>
<p>This transfer is a lot faster than on the same disk. I'm not sure of the cause of these results. The only reason I can found is that the operating system can made the two things at the same time, reading on the first disk and writing on the second disk. If someone has a better conclusion, don't hesitate to comment the post.</p>
<p>The detailed informations (standard deviation, confidence intervals and other stats stuff) are available in the conclusion page.</p>
<!--nextpage-->

<h4>Benchmark between two disks (Ext4 -&gt; NTFS)</h4>

<p>Here are the results of the first version of this post. The first disk is always the same, but the second disk is a NTFS. For concision, I removed some graphes. I've also removed the conclusion that are the same as the first two benchmarks. The native method is not covered in these results.</p>
<p><a href="wp-content/uploads/2010/08/little-text-file-2.png"><img class="size-full wp-image-876" title="Little Text File - Best results" src="wp-content/uploads/2010/08/little-text-file-2.png" alt="Little Text File - Best results" width="483" height="411"></a></p>
<p>The best two versions are the Buffered Streams and Buffered Readers. Here this is because the buffered streams and readers can write the file in only one operation. Here the times are in microseconds, so there is really little differences between the methods. So the results are not really relevant.</p>
<p>Now, let's test with a bigger file.</p>
<p><a href="wp-content/uploads/2010/08/medium-text-file.png"><img class="size-full wp-image-877" title="Medium Text File" src="wp-content/uploads/2010/08/medium-text-file.png" alt="Medium Text File" width="488" height="371"></a></p>
<p>We can see that the versions with the Readers are a little slower than the version with the streams. This is because Readers works on character and for every read() operation, a char conversion must be made, and the same conversion must be made on the other side.</p>
<p>Another observation is that the custom buffer strategy is faster than the buffering of the streams and than using custom buffer with a buffered stream or a single stream doesn't change anything. The same observation can be made using the custom buffer using readers, it's the same with buffered readers or not. This is logical, because with custom buffer we made 4096 (size of the buffer) times less invocations to the read method and because we ask for a complete buffer we have not a lot of I/O operations. So the buffer of the streams (or the readers) is not useful here. The NIO buffer strategy is almost equivalent to custom buffer. And the direct transfer using NIO is here slower than the custom buffer methods. I think this is because here the cost of invoking native methods in the operating system level is higher than simply the cost of making the file copy.</p>
<p><a href="wp-content/uploads/2010/08/big-text-file-2.png"><img class="size-full wp-image-879" title="Big Text File - Best results" src="wp-content/uploads/2010/08/big-text-file-2.png" alt="Big Text File - Best results" width="483" height="391"></a></p>
<p>Here, it's now clear that the custom buffer strategy is a better than the simple buffered streams or readers and that using custom buffer and buffered streams is really useful for bigger files. The Custom Buffer Readers method is better than Custom Buffer Streams because FileReader use a buffer internally.</p>
<p>And now, continue with a bigger file :</p>
<p><a href="wp-content/uploads/2010/08/fat-text-file.png"><img class="size-full wp-image-880" title="Fat Text File Results" src="wp-content/uploads/2010/08/fat-text-file.png" alt="Fat Text File Results" width="483" height="392"></a></p>
<p>You can see that it doesn't take 500 ms to copy a 50 MB file using the custom buffer strategy and that it even doesn't take 400 ms with the NIO Transfer method. Really quick isn't it ? We can see that for a big file, the NIO Transfer start to show an advantage, we'll better see that in the binary file benchmarks. We will directly start with a big file (5 MB) for this benchmark :</p>
<p><a href="wp-content/uploads/2010/08/big-binary-file.png"><img class="size-full wp-image-881" title="Big Binary File Results" src="wp-content/uploads/2010/08/big-binary-file.png" alt="Big Binary File Results" width="483" height="291"></a></p>
<p>So we can make the same conclusion as for the text files, of course, the buffered streams methods is not fast. The other methods are really close.</p>
<p><a href="wp-content/uploads/2010/08/fat-binary-file.png"><img class="size-full wp-image-883" title="Fat Binary File Results" src="wp-content/uploads/2010/08/fat-binary-file.png" alt="Fat Binary File Results" width="483" height="291"></a></p>
<p>We see here again that the NIO Transfer is gaining advantages more the files is bigger.</p>
<p>And just for the pleasure, a great file (1.3 GB) :</p>
<p><a href="wp-content/uploads/2010/08/enormous-binary-file.png"><img class="size-full wp-image-882" title="Enormous Binary File Results" src="wp-content/uploads/2010/08/enormous-binary-file.png" alt="Enormous Binary File Results" width="483" height="291"></a></p>
<p>We see that all the methods are really close, but the NIO Transfer method has an advantage of 500 ms. It's not negligible.</p>
<p>A conclusion we can make is that transfering a file from Ext4 to Ext4 is a lot faster than from Ext4 to NTFS. I think it's logical because the operating system must made conversions. I think it's not because of the disk, because the NTFS disk is the faster I've.</p>
<!--nextpage-->

<h4>Conclusion</h4>

<p>In conclusion, the NIO Transfer method is the best one for big files but it's not the fastest for little files (&lt; 5 MB). But the custom buffer strategy (and the NIO Buffer too) are also really fast methods to copy files. We've also see that the method using the native utility tools to make the copy is faster as NIO for big files (&lt; 1 GB) but it's really slow for little files because of the cost of invoking an external program.</p>
<p>So perhaps, the best method is a method that make a custom buffer strategy on the little files and a NIO Transfer on the big ones and perhaps use the native executable on the really bigger ones. But it will be interesting to also make the tests on an other computer and operating system.</p>
<p>We can take several rules from this benchmark :</p>
<ol>
    <li>Never made a copy of file byte by byte (or char by char)</li>
    <li>Prefer a buffer in your side more than in the stream to make less invocations of the read method, but don't forget the buffer in the side of the streams</li>
    <li>Pay attention to the size of the buffers</li>
    <li>Don't use char conversion if you only need to tranfer the content of a file, so don't use Reader if you need only streams.</li>
    <li>Don't hesitate to use channels to make file transfer, it's the fastest way to make a file transfer.</li>
    <li>Consider the native executable invocation only for really bigger files.</li>
    <li>The new Path method of Java 7 is really fast except for the transfer of an enormous file between two disks.</li>
</ol>

<p>I hope this benchmark (and its results) interested you.</p>
<p>Here are the sources of the benchmark : <a href="wp-content/uploads/2010/08/FileCopyBenchmark2.java">File Copy Benchmark Version 3</a></p>
<p>Here are the informations complete for the benchmark between two disks : <a href="wp-content/uploads/2010/08/results.txt">Complete results of first two benchmarks</a></p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/08/file-copy-in-java-benchmark.html#disqus_thread" data-disqus-identifier="cache/posts/2010/08/file-copy-in-java-benchmark.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2010/07/effective-java-second-edition-book-review.html" class="u-url">Effective Java, second edition – Book Review</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2010-07-30T07:30:55+02:00">2010-07-30 07:30</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>Before reading that book, I read the translation in French of the first edition, but I've thinked that it will be interesting to read the second edition and this time in English.</p>
<p><a href="wp-content/uploads/2010/07/effective-java-cover-scan.jpg"><img class="aligncenter size-full wp-image-813" title="Effective Java Cover" src="wp-content/uploads/2010/07/effective-java-cover-scan.jpg" alt="Effective Java Cover" width="275" height="345"></a></p>
<p>This book is <strong>the book to read</strong> if you want to write <strong>good Java code</strong>. All the advices are really useful. It's really comfortable to read book from a person who master Java. In fact, Joshua led the design and implementation of numerous Java features.</p>
<!--more-->

<p>The book is separated into 10 chapters :</p>
<ol>
    <li><strong>Creating and destroying objects</strong> : This first chapter is about how to create the objects. It describes methods to improve the creation of objects, like static factories, builders or singletons.</li>
    <li><strong>Methods common to all objects</strong> : This chapter explains how, and when, to implement the equals, hashCode, clone, toString and compareTo methods. Here, the contract of these methods  are described and explained and the examples show you how to code these methods.</li>
    <li><strong>Classes and interfaces</strong> :  Here, we learn how to use the interfaces and abstract classes to have a good design. It describe also when to use inheritance or composition.</li>
    <li><strong>Generics</strong> :This chapter explains how to work with generics. We learn how to avoid unchecked warnings and how to create generics methods.</li>
    <li><strong>Enum and annotations</strong> : The fifth chapter is about the use of enums and annotations in your API. We learn how to create powerful enums and annotations to improve code. We also learn how to use the power of these two concepts to create flexible and powerful code.</li>
    <li><strong>Methods</strong> : This chapter cover the creation of methods. How to write them, what to do with the parameters and what to return from a method.</li>
    <li><strong>General programming</strong> : Here you'll found about 10 general advices like avoiding float and double if exact answers are needed or avoid wrappers.</li>
    <li><strong>Exceptions</strong> : This chapter teach you how to work with exceptions and how to create code that throws exceptions.</li>
    <li><strong>Concurrency</strong> : Here you will learn what you to use when you need to work with several threads. It shows what the standard API contains for concurrency utilities. Moreover you will see what to avoid to use when making concurrent programs.</li>
    <li><strong>Serialization</strong> :  The last chapter is about the serialization. We'll see how to make a class Serializable and how to work with Serializable classes. We see also several advanced techniques (readResolve or serialization proxies) for instance control.</li>
</ol>

<p>If you follow the advices of all the chapters, you'll be able to create really flexible, maintainable and usable API.</p>
<p>To conclude, I must say that this book must be read by every advanced programmers. It's not a book to learn Java from the basis, but a book to learn how to write good Java especially how to create API for others.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2010/07/effective-java-second-edition-book-review.html#disqus_thread" data-disqus-identifier="cache/posts/2010/07/effective-java-second-edition-book-review.html">Comments</a>


        </p></article>
    
        <div>
        <ul class="pager">
            <li class="previous">
                <a href="index-11.html" rel="prev">← Newer posts</a>
            </li>
            <li class="next">
                <a href="index-9.html" rel="next">Older posts →</a>
            </li>
        </ul>
        </div>

    
        
       <script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>


	


            </div>
        </div>
    </div>
</div>

<!-- Footer -->

<footer>
    Contents © 2014         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/4.0/88x31.png"></a>
        <ul class="footer_inline_ul">
            
        </ul>
</footer>


            <script src="assets/js/all-nocdn.js" type="text/javascript"></script>


<!-- Late loading stuff  -->

    <script type="text/javascript">
      $(document).ready(function() {
        jQuery.getJSON('/assets/js/tag_cloud_data.json', function(data) {
            var items = [];

            $.each(data, function(key, val) {
                items.push('<li><a href="' + val[1] +'" '+'data-weight="'+val[0]+'"'+'>' + key + '</a></li>');
            });

            $('<div/>', {
                'id': 'tags',
                html: '<ul>' + items.join('') + '</ul>'
            }).appendTo('body');

            if(!$('#tags_canvas').tagcanvas({
                textColour: '#FFFFFF',
                outlineColour: '#ff00ff',
                reverse: true,
                depth: 0.8,
                maxSpeed: 0.05,
                weight: true,
                weightFrom: "data-weight",
                weightSizeMin: 8,
                weightSizeMax: 24
            },'tags')) {
                //something went wrong, hide the canvas container
                $('#tags_container').hide();
            }});
        });
    </script>

<!-- Google platform JS -->
    
<script type="text/javascript" src="https://apis.google.com/js/platform.js"></script>


    


<!-- Tipue Search -->

<script type="text/javascript" src="assets/js/tipuesearch_set.js"></script>
<script type="text/javascript" src="assets/js/tipuesearch.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $('#tipue_search_input').tipuesearch({
        'mode': 'json',
        'contentLocation': '/assets/js/tipuesearch_content.json',
        'showUrl': false
        });
        });
</script>

<script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script>






</body>
</html>