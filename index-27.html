<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Tutorials and short posts about programming, C++, Java, Assembly, Operating Systems Development, Compilers, ...">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Blog blog("Baptiste Wicht"); (old posts, page 27) | Blog blog("Baptiste Wicht");</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="rss.xml">
<link rel="canonical" href="https://baptiste-wicht.com/index-27.html">
<link rel="prev" href="index-28.html" type="text/html">
<link rel="next" href="index-26.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link href="favicon.ico" rel="icon" type="image/x-icon">
<link rel="publisher" href="https://plus.google.com/+BaptisteWicht">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-2175227-7', 'auto');
  var metas = document.getElementsByTagName('meta'), tagsList = [];
  for (var i=0; i<metas.length; i++) {
    if (metas[i].getAttribute('property') == 'article:tag') {
      tagsList.push( metas[i].getAttribute('content'));
    }
  }
  ga('set', 'dimension1', tagsList.join('|'));
  ga('send', 'pageview');
</script>
</head>
<body>

<!-- Menubar -->

<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<div class="container-fluid">
<!-- This keeps the margins nice -->
    <div class="row">
        <div class="col-sm-3 col-lg-2">
            <nav class="navbar navbar-inverse navbar-fixed-side"><div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="https://baptiste-wicht.com/">
                        <span id="blog-title">Blog blog("Baptiste Wicht");</span>
                    </a>
                </div>
<!-- /.navbar-header -->

                <div class="collapse navbar-collapse navbar-ex1-collapse">
                    <ul class="nav navbar-nav">
<li>
<a href="stories/about.html">About</a>
                </li>
<li>
<a href="stories/publications.html">Publications</a>
                </li>
<li>
<a href="stories/projects.html">Projects</a>
                </li>
<li>
<a href="categories/index.html">Tags</a>
                </li>
<li>
<a href="archive.html">Archives</a>
                </li>
<li>
<a href="http://feeds.feedburner.com/BaptisteWicht">RSS</a>


                            </li>
<li class="navbar-content">
                                <h3>Tags</h3>
                            </li>
                            <li class="navbar-empty">
                                <div id="tag_cloud_left_container" style="line-height: 18px !important;"></div>
                            </li>
                            <li class="navbar-block">


                        </li><li class="wicht-navbar-right">
                            <a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
                                <img src="assets/img/twitter.png" alt="Follow @wichtounet on Twitter"></a>
                        </li>

                    </ul>
</div>
<!-- /.navbar-collapse -->
            </nav>
</div> <!-- col -->
        <div class="col-sm-9 col-lg-10">
            <div id="content"></div>
            
        <article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2015/06/improve-etl-compile-time-with-precompiled-headers.html" class="u-url">Improve ETL compile-time with Precompiled Headers</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2015-06-20T15:08:31+02:00">2015-06-20 15:08</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>Very recently, I started trying to improve the compile-time of the ETL test suite. While not critical, it is always better to have tests that compile as fast as possible. In a <a class="reference external" href="http://baptiste-wicht.com/posts/2015/06/how-i-improved-a-bit-compile-time-of-etl.html">previous post</a>, I was able to improve the time a bit by improve the makefile, using pragra once and avoiding <cite>&lt;iostream&gt;</cite> headers. With these techniques, I reduced the compile-time from 87.5 to 84.1, which is not bad, but not as good as I would have expected.</p>
<p>In the previous, I had not tried to use Precompiled Headers (PCH) to improve the compile time, so I thought it would be a good time to do it.</p>
<section id="precompiled-headers"><h2>Precompiled Headers</h2>
<p>Precompiled Headers are an option of the compiler, where one header gets compiled. Normally, you only compile source files into object files, but you can also compile headers, although it is not the same thing. When a compiler compiles a header, it can do a lot of preprocessing (macros, includes, AST, symbols) and then store all the results into a precompiled header file. Once you compile the source files, the compiler will try to use the precompiled header file instead of the real header file. Of course, this can breaks the C++ standard since with that a header can not have different behaviour based on macros for instance. For these reasons (and probably implementation reasons as well), precompiled headers are really limited.</p>
<p>If we take the case of G++, G++ will consider the precompiled header file instead of the standard header only if (for a complete list, take a look at the GCC docs):</p>
<ul class="simple">
<li><p>The same compilation flags are the same between the two compilations</p></li>
<li><p>The same compiler binary is used for the compilations</p></li>
<li><p>Only one precompiled header can be used in each compilation</p></li>
<li><p>The same macros must be defined</p></li>
<li><p>The include of the header must be before every possible C/C++ token</p></li>
</ul>
<p>If all these conditions are met and you try to <cite>#include "header.hpp</cite> and there is a header.hpp.gch (the precompiled file) available in the search path, then the precompiled header will be taken instead of the standard one.</p>
<p>With clang, it is a bit different because the precompiled header cannot be included automatically, but has to be included explicitely in the source code, meaning you have to modify your code for this technique to work. This is a bad thing in my opinion, you never should have to modify your code to profit from a compiler feature. This is why I haven't used and don't plan to use precompiled headers with clang.</p>
</section><section id="how-to"><h2>How-to</h2>
<p>Once you know all the conditions for a precompiled header to be automatically included, it is quite straightforward to use them.</p>
<p>To generate a PCH file is easy:</p>
<pre class="literal-block">g++ options header.hpp</pre>
<p>This will generate header.hpp.gch. When you compile your source file using header.hpp, you don't have anything to do, you just have to compile it as usually and if all the conditions are met, the PCH file will be used instead of the other header.</p>
</section><section id="results-and-conclusion"><h2>Results and conclusion</h2>
<p>I added precompiled header support into my <a class="reference external" href="https://github.com/wichtounet/make-utils">make-utils</a> collection of Makefile utilities and tested it on ETL. I have precompiled a header that itself included Catch and ETL. Almost all test files are including this header. With this change, I went from 84 seconds to 78seconds. Headers are taking 1.5seconds to be precompiled. This is a nice result I think. If your application is not as template-heavy as mine or if you have more source files, you should expect better improvements.</p>
<p>To conclude, even if precompiled headers are a sound way to reduce compile-time, they are really limited to some cases. I'm not a fan of the feature overally. It is not portable between compilers and not standard. Anyway, if you are really in need of saving some time, you should not hesitate too much ;)</p>
</section>
</div>
            
    
    <a href="posts/2015/06/improve-etl-compile-time-with-precompiled-headers.html#disqus_thread" data-disqus-identifier="cache/posts/2015/06/improve-etl-compile-time-with-precompiled-headers.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2015/06/how-i-improved-a-bit-compile-time-of-etl.html" class="u-url">How I improved (a bit) compile time of ETL ?</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2015-06-16T22:00:21+02:00">2015-06-16 22:00</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>Recently I read several articles about C++ and compile time and I wondered if I could improve the compile time of my Expression Template Library (ETL) project. ETL is a header-only and template-heavy library. I'm not going to the change the design completely or to use type erasure techniques to reduce the compile time, ETL is all about performance.</p>
<p>As a disclaimer, don't expect fancy results from this post, I haven't been able to reduce compile time a lot, but I still wanted to share my experience.</p>
<p>I've used g++-4.9.2 to perform these tests.</p>
<p>I'm compiling the complete test suite (around 6900 source lines of codes in 36 files) in release mode. Each test file includes the ETL (around 10K SLOC). Each test is run with 8 threads (make -j8). For each result, I have run a complete build 5 times and taken the best result as the final result. Everything is run on a SSD and I have more than enough RAM to handle all the compilation in parallel.</p>
<p>The reference build time was 87.5 seconds.</p>
<section id="compile-and-generate-dependency-files-at-the-same-time"><h2>Compile and generate dependency files at the same time</h2>
<p>To help write my makefiles, I'm using a set of functions that I have written. This includes automatic dependency generation using -MM -MT options of the compiler. Until now, I had two targets, one to compile the cpp file into the object file and another one to generate the dependency file. I recently saw that compilers were able to do both at the same time! Clang, G++ and the Intel compiler all have a -MD -MF options that lets you generate the dependency file at the same time you compile your file, saving you at least one read of the file.</p>
<p>My compilation rule in my makefile has now become:</p>
<div class="code"><pre class="code makefile"><a id="rest_code_be80e2f56ad44e96be064d187fd23f62-1" name="rest_code_be80e2f56ad44e96be064d187fd23f62-1" href="posts/2015/06/how-i-improved-a-bit-compile-time-of-etl.html#rest_code_be80e2f56ad44e96be064d187fd23f62-1"></a><span class="nf">release/$(1)/%.cpp.o</span><span class="o">:</span><span class="w"> </span><span class="k">$(</span><span class="nv">1</span><span class="k">)</span>/%.<span class="n">cpp</span>
<a id="rest_code_be80e2f56ad44e96be064d187fd23f62-2" name="rest_code_be80e2f56ad44e96be064d187fd23f62-2" href="posts/2015/06/how-i-improved-a-bit-compile-time-of-etl.html#rest_code_be80e2f56ad44e96be064d187fd23f62-2"></a><span class="w">    </span>@<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>release/<span class="k">$(</span><span class="m">1</span><span class="k">)</span>/
<a id="rest_code_be80e2f56ad44e96be064d187fd23f62-3" name="rest_code_be80e2f56ad44e96be064d187fd23f62-3" href="posts/2015/06/how-i-improved-a-bit-compile-time-of-etl.html#rest_code_be80e2f56ad44e96be064d187fd23f62-3"></a><span class="w">    </span><span class="k">$(</span>CXX<span class="k">)</span><span class="w"> </span><span class="k">$(</span>CXX_FLAGS<span class="k">)</span><span class="w"> </span><span class="k">$(</span>RELEASE_FLAGS<span class="k">)</span><span class="w"> </span><span class="k">$(</span><span class="m">2</span><span class="k">)</span><span class="w"> </span>-MD<span class="w"> </span>-MF<span class="w"> </span>release/<span class="k">$(</span><span class="m">1</span><span class="k">)</span>/<span class="nv">$$</span>*.cpp.d<span class="w"> </span>-o<span class="w"> </span>release/<span class="k">$(</span><span class="m">1</span><span class="k">)</span>/<span class="nv">$$</span>*.cpp.o<span class="w"> </span>-c<span class="w"> </span><span class="k">$(</span><span class="m">1</span><span class="k">)</span>/<span class="nv">$$</span>*.cpp
<a id="rest_code_be80e2f56ad44e96be064d187fd23f62-4" name="rest_code_be80e2f56ad44e96be064d187fd23f62-4" href="posts/2015/06/how-i-improved-a-bit-compile-time-of-etl.html#rest_code_be80e2f56ad44e96be064d187fd23f62-4"></a><span class="w">    </span>@<span class="w"> </span>sed<span class="w"> </span>-i<span class="w"> </span>-e<span class="w"> </span><span class="s1">'s@^\(.*\)\.o:@\1.d \1.o:@'</span><span class="w"> </span>release/<span class="k">$(</span><span class="m">1</span><span class="k">)</span>/<span class="nv">$$</span>*.cpp.d
</pre></div>
<p>This reduced the compilation time to 86.8 seconds. Not that much reduction, but it still is quite nice to know that. I would have expected this to reduce more the compile time.</p>
<section id="use-pragma-once"><h3>Use #pragma once</h3>
<p>Normally, I'm not a fan of #pragma since it is not standard, but for now ETL only supports three compilers and only very recent of them, so I have the guarantee that #pragma once is available, so what the hell!</p>
<p>I've replaced all the include guards by single #pragma once directives.</p>
<p>Again, the results are not impressive, this reduced the compile time to 86.2 seconds. I would only advise to use this if you are sure of the compilers you want to support and you need the extra time.</p>
</section><section id="avoid-iostream"><h3>Avoid &lt;iostream&gt;</h3>
<p>I've read that the &lt;iostream&gt; header was one of the slowest to compile of the STL. It is only one that is included several times in my headers only for stream operators and it turns out that there is a &lt;iosfwd&gt; header that forward declares a lot of things from the &lt;iostream&gt; and other I/O headers.</p>
<p>By replacing all &lt;iostream&gt; include by &lt;iosfwd&gt;, compile time has gone down to 84.1 seconds.</p>
</section><section id="conclusion-8"><h3>Conclusion</h3>
<p>By using the three techniques, I've reduced the compile time from 87.5 to 84.1 seconds. I would have honestly hoped for more improvements, but this is a already a good start.</p>
<p>As a side note, clang compile time is 45.2 seconds under the same conditions (was 46.2 seconds before the optimizations). It is really much faster :) I'm still using GCC a lot since in several cases, it does generate much better code and in average, the generated code if faster (on my benchmarks at least). I don't have the numbers for icc, but icc is definitely the slowest of the three. When I have it available (at work), I use for release build before running something. The generated executables are generally faster (I only use Intel processors) and sometimes the difference can be quite important.</p>
<p>If you have ideas to reduce further the compile time on this test case, I'd be glad to hear them and put them to the test.</p>
<p>I hope that this small experience would be helpful to some of you :)</p>
</section><section id="other-techniques"><h3>Other techniques</h3>
<p>There are several other techniques that you can use to reduce compile time:</p>
<ol class="arabic simple">
<li><p>Precompiled Headers are supported by both Clang and GCC, altough not in a compatible. I haven't tested this in a while, but it is quite effective and a very interesting technique. The main problem with this is that is not standard and not compatible between compilers. But it probably is the most efficient techniques when you have lots of headers and lots of templates as in my case.</p></li>
<li><p>Unity builds can make full rebuild much faster. I personally don't like unity builds especially because it is only really good for full builds and you generally don't do full rebuilds that much (I know, I know, this is also the test done in this article :) ). Moreover, it also sucks at doing parallel builds.</p></li>
<li><p>Pimpl idioms and other type erasure techniques can reduce compile time a lot. If it is well done, it can be implemented without so much overhead.</p></li>
<li><p>Explicit instantiation of templates can also help, but only in the case of a user program. In the case of a library itself, you cannot do anything.</p></li>
<li><p>Reduce inclusions and use forward declarations, obviously...</p></li>
<li><p>Use tools like distcc (I very rarely use it) and ccache (I generally use it).</p></li>
<li><p>Update your compiler</p></li>
<li><p>Upgrade your computer ;)</p></li>
<li><p>...</p></li>
</ol></section></section>
</div>
            
    
    <a href="posts/2015/06/how-i-improved-a-bit-compile-time-of-etl.html#disqus_thread" data-disqus-identifier="cache/posts/2015/06/how-i-improved-a-bit-compile-time-of-etl.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html" class="u-url">Continuous Performance Management with CPM for C++</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2015-06-14T14:02:57+02:00">2015-06-14 14:02</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>For some time, I have wanted some tool to monitor the performance of some of my projects. There are plenty of tools for Continuous Integration and Sonar is really great for continuous monitoring of code quality, but I haven't found anything satisfying for monitoring performance of C++ code. So I decided to write my own. <a class="reference external" href="https://github.com/wichtounet/cpm">Continous Performance Monitor (CPM)</a> is a simple C++ tool that helps you running benchmarks for your C++ programs and generate web reports based on the results. In this article, I will present this tool. CPM is especially made to benchmark several sub parts of libraries, but it perfectly be used to benchmark a whole program as well.</p>
<p>The idea is to couple it with a Continuous Integration tool (I use Jenkins for instance) and run the benchmarks for every new push in a repository. With that, you can check if you have performance regression for instance or simply see if your changes were really improving the performance as much as you thought.</p>
<p>It is made of two separate parts:</p>
<ol class="arabic simple">
<li><p>A header-only library that you can use to benchmark your program and that will give you the performance results. It will also generate a JSON report of the collected data.</p></li>
<li><p>A program that will generate a web version of the reports with analysis over time, over different compilers or over different configurations.</p></li>
</ol>
<p>CPM is especially made to benchmark functions that takes input data and which runtime depends on the dimensions of the input data. For each benchmark, CPM will execute it with several different input sizes. There are different ways to define a benchmark:</p>
<ul class="simple">
<li><p><em>two_pass</em>: The benchmark is made of two part, the initialization part is called once for each input size and then the benchmark part is repeated several times for the measure. This is the most general version.</p></li>
<li><p><em>global</em>: The benchmark will be run with different input sizes but uses global data that will be randomized before each measure</p></li>
<li><p><em>simple</em>: The benchmark will be run with different input sizes, data will not be randomized</p></li>
<li><p><em>once</em>: The benchmark will be run with no input size.</p></li>
</ul>
<p>Note: The randomization of the data can be disabled.</p>
<p>You can run independent benchmarks or you can run sections of benchmarks. A section is used to compared different implementations of the same thing. For instance, I use them to compare different implementation of convolution or to see how ETL compete with other Expression Templates library.</p>
<img alt="/images/cpm_large.png" src="images/cpm_large.png"><section id="examples"><h2>Examples</h2>
<p>I've uploaded three generated reports so that you can have look at some results:</p>
<ul class="simple">
<li><p>Results of the ETL benchmark (one page per benchmark): <a class="reference external" href="http://baptiste-wicht.com/cpm/etl/">Site 1</a> <a class="reference external" href="https://github.com/wichtounet/etl/blob/master/workbench/benchmark.cpp">Source 1</a></p></li>
<li><p>Results of simple ETL / Blaze / Eigen3 comparison: <a class="reference external" href="http://baptiste-wicht.com/cpm/etl_blaze_eigen/">Site 2</a> <a class="reference external" href="https://github.com/wichtounet/etl_vs_blaze/blob/master/src/simple.cpp">Source 2</a></p></li>
<li><p>Results of the CPM dummy examples: <a class="reference external" href="http://baptiste-wicht.com/cpm/examples/">Site 3</a> <a class="reference external" href="https://github.com/wichtounet/cpm/blob/master/examples/simple.cpp">Source 3</a></p></li>
</ul></section><section id="run-benchmarks"><h2>Run benchmarks</h2>
<p>There are two ways of running CPM. You can directly use the library to run the benchmarks or you can use the macro facilities to make it easier. I recommend to use the second way since it is easier and I'm gonna try to keep it stable while the library can change. If you want an example of using the library directly, you can take a look at <a class="reference external" href="https://github.com/wichtounet/cpm/blob/master/examples/simple.cpp">this example</a>. In this chapter, I'm gonna focus on the macro-way.</p>
<p>The library is available <a class="reference external" href="https://github.com/wichtounet/cpm">here</a>, you can either include as a submodule of your projects or install it globally to have access to its headers.</p>
<p>The first thing to do is to include the CPM header:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_66037f4e9e5b49c1b18b8510bc714049-1" name="rest_code_66037f4e9e5b49c1b18b8510bc714049-1" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_66037f4e9e5b49c1b18b8510bc714049-1"></a><span class="cp">#define CPM_BENCHMARK "Example Benchmarks"</span>
<a id="rest_code_66037f4e9e5b49c1b18b8510bc714049-2" name="rest_code_66037f4e9e5b49c1b18b8510bc714049-2" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_66037f4e9e5b49c1b18b8510bc714049-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">"cpm/cpm.hpp"</span>
</pre></div>
<p>You have to name your benchmark. This will automatically creates a main and will run all the declared benchmark.</p>
<section id="define-benchmarks"><h3>Define benchmarks</h3>
<p>Benchmarks can be defined either in a CPM_BENCH functor or in the global scope with <code>CPM_DIRECT_BENCH</code>.</p>
<ol class="arabic simple">
<li><p>simple</p></li>
</ol>
<div class="code"><pre class="code cpp"><a id="rest_code_0d80e8eab4df4e8982e68bbf7cd39713-1" name="rest_code_0d80e8eab4df4e8982e68bbf7cd39713-1" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_0d80e8eab4df4e8982e68bbf7cd39713-1"></a><span class="n">CPM_DIRECT_BENCH_SIMPLE</span><span class="p">(</span><span class="s">"bench_name"</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d</span><span class="p">){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">2</span><span class="n">_ns</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="p">})</span>
</pre></div>
<p>The first argument is the name of the benchmark and the second argument is the function that will be benchmarked by the system, this function takes the input size as input.</p>
<ol class="arabic simple" start="2">
<li><p>global</p></li>
</ol>
<div class="code"><pre class="code cpp"><a id="rest_code_ff8939f765ea4eba97e1d8a1fccbd023-1" name="rest_code_ff8939f765ea4eba97e1d8a1fccbd023-1" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_ff8939f765ea4eba97e1d8a1fccbd023-1"></a><span class="n">CPM_BENCH</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_ff8939f765ea4eba97e1d8a1fccbd023-2" name="rest_code_ff8939f765ea4eba97e1d8a1fccbd023-2" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_ff8939f765ea4eba97e1d8a1fccbd023-2"></a><span class="w">    </span><span class="n">test</span><span class="w"> </span><span class="n">a</span><span class="p">{</span><span class="mi">3</span><span class="p">};</span>
<a id="rest_code_ff8939f765ea4eba97e1d8a1fccbd023-3" name="rest_code_ff8939f765ea4eba97e1d8a1fccbd023-3" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_ff8939f765ea4eba97e1d8a1fccbd023-3"></a><span class="w">    </span><span class="n">CPM_GLOBAL</span><span class="p">(</span><span class="s">"bench_name"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">a</span><span class="p">](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d</span><span class="p">){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="n">_ns</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">a</span><span class="p">);</span>
<a id="rest_code_ff8939f765ea4eba97e1d8a1fccbd023-4" name="rest_code_ff8939f765ea4eba97e1d8a1fccbd023-4" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_ff8939f765ea4eba97e1d8a1fccbd023-4"></a><span class="p">}</span>
</pre></div>
<p>The first argument is the name of the benchmark, the second is the function being benchmarked and the following arguments must be references to global data that will be randomized by CPM.</p>
<ol class="arabic simple" start="3">
<li><p>two_pass</p></li>
</ol>
<div class="code"><pre class="code cpp"><a id="rest_code_3f7b828c6dad4e5cb7658b93841a945c-1" name="rest_code_3f7b828c6dad4e5cb7658b93841a945c-1" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_3f7b828c6dad4e5cb7658b93841a945c-1"></a><span class="n">CPM_DIRECT_BENCH_TWO_PASS</span><span class="p">(</span><span class="s">"bench_name"</span><span class="p">,</span>
<a id="rest_code_3f7b828c6dad4e5cb7658b93841a945c-2" name="rest_code_3f7b828c6dad4e5cb7658b93841a945c-2" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_3f7b828c6dad4e5cb7658b93841a945c-2"></a><span class="w">    </span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d</span><span class="p">){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">test</span><span class="p">{</span><span class="n">d</span><span class="p">});</span><span class="w"> </span><span class="p">},</span>
<a id="rest_code_3f7b828c6dad4e5cb7658b93841a945c-3" name="rest_code_3f7b828c6dad4e5cb7658b93841a945c-3" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_3f7b828c6dad4e5cb7658b93841a945c-3"></a><span class="w">    </span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="o">&amp;</span><span class="w"> </span><span class="n">d2</span><span class="p">){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">d2</span><span class="p">.</span><span class="n">d</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="n">_ns</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<a id="rest_code_3f7b828c6dad4e5cb7658b93841a945c-4" name="rest_code_3f7b828c6dad4e5cb7658b93841a945c-4" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_3f7b828c6dad4e5cb7658b93841a945c-4"></a><span class="p">)</span>
</pre></div>
<p>Again, the first argument is the name. The second argument is the initialization functor. This functor must returns a tuple with all the information that will be passed (unpacked) to the third argument (the benchmark functor). Everything that is being returned by the initialization functor will be randomized.</p>
</section><section id="select-the-input-sizes"><h3>Select the input sizes</h3>
<p>By default, CPM will invoke your benchmarks with values from 10 to 1000000, multiplying it by 10 each step. This can be tuned for each benchmark and section independently. Each benchmark macro has a _P suffix that allows you to set the size policy:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_c72938b1c1774515a20c626493394663-1" name="rest_code_c72938b1c1774515a20c626493394663-1" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_c72938b1c1774515a20c626493394663-1"></a><span class="n">CPM_SIMPLE_P</span><span class="p">(</span>
<a id="rest_code_c72938b1c1774515a20c626493394663-2" name="rest_code_c72938b1c1774515a20c626493394663-2" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_c72938b1c1774515a20c626493394663-2"></a><span class="w">    </span><span class="n">VALUES_POLICY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span>
<a id="rest_code_c72938b1c1774515a20c626493394663-3" name="rest_code_c72938b1c1774515a20c626493394663-3" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_c72938b1c1774515a20c626493394663-3"></a><span class="w">    </span><span class="s">"simple_a_n"</span><span class="p">,</span>
<a id="rest_code_c72938b1c1774515a20c626493394663-4" name="rest_code_c72938b1c1774515a20c626493394663-4" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_c72938b1c1774515a20c626493394663-4"></a><span class="w">    </span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d</span><span class="p">){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="n">_ns</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="p">});</span>
</pre></div>
<p>You can also have several sizes (for multidimensional data structures or algorithms):</p>
<div class="code"><pre class="code cpp"><a id="rest_code_12032090a8414131a8879502b8576eef-1" name="rest_code_12032090a8414131a8879502b8576eef-1" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_12032090a8414131a8879502b8576eef-1"></a><span class="n">CPM_DIRECT_BENCH_TWO_PASS_P</span><span class="p">(</span>
<a id="rest_code_12032090a8414131a8879502b8576eef-2" name="rest_code_12032090a8414131a8879502b8576eef-2" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_12032090a8414131a8879502b8576eef-2"></a><span class="w">    </span><span class="n">NARY_POLICY</span><span class="p">(</span><span class="n">VALUES_POLICY</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span><span class="p">,</span><span class="w"> </span><span class="mi">64</span><span class="p">),</span><span class="w"> </span><span class="n">VALUES_POLICY</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">)),</span>
<a id="rest_code_12032090a8414131a8879502b8576eef-3" name="rest_code_12032090a8414131a8879502b8576eef-3" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_12032090a8414131a8879502b8576eef-3"></a><span class="w">    </span><span class="s">"convmtx2"</span><span class="p">,</span>
<a id="rest_code_12032090a8414131a8879502b8576eef-4" name="rest_code_12032090a8414131a8879502b8576eef-4" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_12032090a8414131a8879502b8576eef-4"></a><span class="w">    </span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d1</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d2</span><span class="p">){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">dmat</span><span class="p">(</span><span class="n">d1</span><span class="p">,</span><span class="w"> </span><span class="n">d1</span><span class="p">),</span><span class="w"> </span><span class="n">dmat</span><span class="p">((</span><span class="n">d1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">d2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">d1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">d2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="n">d2</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">d2</span><span class="p">));</span><span class="w"> </span><span class="p">},</span>
<a id="rest_code_12032090a8414131a8879502b8576eef-5" name="rest_code_12032090a8414131a8879502b8576eef-5" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_12032090a8414131a8879502b8576eef-5"></a><span class="w">    </span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="cm">/*d1*/</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d2</span><span class="p">,</span><span class="w"> </span><span class="n">dmat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">dmat</span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">){</span><span class="w"> </span><span class="n">b</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">etl</span><span class="o">::</span><span class="n">convmtx2</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">d2</span><span class="p">,</span><span class="w"> </span><span class="n">d2</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<a id="rest_code_12032090a8414131a8879502b8576eef-6" name="rest_code_12032090a8414131a8879502b8576eef-6" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_12032090a8414131a8879502b8576eef-6"></a><span class="p">)</span>
</pre></div>
</section><section id="configure-benchmarks"><h3>Configure benchmarks</h3>
<p>By default, each benchmark is run 10 times for warmup and then repeated 50 times, but you can define your own values:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_293df39e87fc4f6a86e3f27a1b6461ba-1" name="rest_code_293df39e87fc4f6a86e3f27a1b6461ba-1" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_293df39e87fc4f6a86e3f27a1b6461ba-1"></a><span class="cp">#define CPM_WARMUP 3</span>
<a id="rest_code_293df39e87fc4f6a86e3f27a1b6461ba-2" name="rest_code_293df39e87fc4f6a86e3f27a1b6461ba-2" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_293df39e87fc4f6a86e3f27a1b6461ba-2"></a><span class="cp">#define CPM_REPEAT 10</span>
</pre></div>
<p>This must be done before the inclusion of the header.</p>
</section><section id="define-sections"><h3>Define sections</h3>
<p>Sections are simply a group of benchmarks, so instead of putting several benchmarks inside a <code>CPM_BENCH</code>, you can put them inside a <code>CPM_SECTION</code>. For instance:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-1" name="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-1" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_0e33b186c9a646dea61d1fdc2b0c537b-1"></a><span class="n">CPM_SECTION</span><span class="p">(</span><span class="s">"mmul"</span><span class="p">)</span>
<a id="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-2" name="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-2" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_0e33b186c9a646dea61d1fdc2b0c537b-2"></a><span class="w">    </span><span class="n">CPM_SIMPLE</span><span class="p">(</span><span class="s">"std"</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d</span><span class="p">){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">d</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">9</span><span class="n">_ns</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="p">});</span>
<a id="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-3" name="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-3" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_0e33b186c9a646dea61d1fdc2b0c537b-3"></a><span class="w">    </span><span class="n">CPM_SIMPLE</span><span class="p">(</span><span class="s">"fast"</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d</span><span class="p">){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">3</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="n">_ns</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="p">});</span>
<a id="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-4" name="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-4" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_0e33b186c9a646dea61d1fdc2b0c537b-4"></a><span class="w">    </span><span class="n">CPM_SIMPLE</span><span class="p">(</span><span class="s">"common"</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d</span><span class="p">){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="n">_ns</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="p">});</span>
<a id="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-5" name="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-5" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_0e33b186c9a646dea61d1fdc2b0c537b-5"></a><span class="p">}</span>
<a id="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-6" name="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-6" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_0e33b186c9a646dea61d1fdc2b0c537b-6"></a><span class="n">CPM_SECTION</span><span class="p">(</span><span class="s">"conv"</span><span class="p">)</span>
<a id="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-7" name="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-7" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_0e33b186c9a646dea61d1fdc2b0c537b-7"></a><span class="w">    </span><span class="n">CPM_TWO_PASS</span><span class="p">(</span><span class="s">"std"</span><span class="p">,</span>
<a id="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-8" name="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-8" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_0e33b186c9a646dea61d1fdc2b0c537b-8"></a><span class="w">        </span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d</span><span class="p">){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">test</span><span class="p">{</span><span class="n">d</span><span class="p">});</span><span class="w"> </span><span class="p">},</span>
<a id="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-9" name="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-9" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_0e33b186c9a646dea61d1fdc2b0c537b-9"></a><span class="w">        </span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="o">&amp;</span><span class="w"> </span><span class="n">d2</span><span class="p">){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">d2</span><span class="p">.</span><span class="n">d</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="n">_ns</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<a id="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-10" name="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-10" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_0e33b186c9a646dea61d1fdc2b0c537b-10"></a><span class="w">        </span><span class="p">);</span>
<a id="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-11" name="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-11" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_0e33b186c9a646dea61d1fdc2b0c537b-11"></a><span class="w">    </span><span class="n">CPM_TWO_PASS</span><span class="p">(</span><span class="s">"fast"</span><span class="p">,</span>
<a id="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-12" name="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-12" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_0e33b186c9a646dea61d1fdc2b0c537b-12"></a><span class="w">        </span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d</span><span class="p">){</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_tuple</span><span class="p">(</span><span class="n">test</span><span class="p">{</span><span class="n">d</span><span class="p">});</span><span class="w"> </span><span class="p">},</span>
<a id="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-13" name="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-13" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_0e33b186c9a646dea61d1fdc2b0c537b-13"></a><span class="w">        </span><span class="p">[](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">test</span><span class="o">&amp;</span><span class="w"> </span><span class="n">d2</span><span class="p">){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">d2</span><span class="p">.</span><span class="n">d</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="n">_ns</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<a id="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-14" name="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-14" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_0e33b186c9a646dea61d1fdc2b0c537b-14"></a><span class="w">        </span><span class="p">);</span>
<a id="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-15" name="rest_code_0e33b186c9a646dea61d1fdc2b0c537b-15" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_0e33b186c9a646dea61d1fdc2b0c537b-15"></a><span class="p">}</span>
</pre></div>
<p>You can also set different warmup and repeat values for each section by using <code>CPM_SECTION_O</code>:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_3e557621ca2c4ae1b32e7e2a28cc18fe-1" name="rest_code_3e557621ca2c4ae1b32e7e2a28cc18fe-1" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_3e557621ca2c4ae1b32e7e2a28cc18fe-1"></a><span class="n">CPM_SECTION_O</span><span class="p">(</span><span class="s">"fft"</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">51</span><span class="p">)</span>
<a id="rest_code_3e557621ca2c4ae1b32e7e2a28cc18fe-2" name="rest_code_3e557621ca2c4ae1b32e7e2a28cc18fe-2" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_3e557621ca2c4ae1b32e7e2a28cc18fe-2"></a><span class="w">    </span><span class="n">test</span><span class="w"> </span><span class="n">a</span><span class="p">{</span><span class="mi">3</span><span class="p">};</span>
<a id="rest_code_3e557621ca2c4ae1b32e7e2a28cc18fe-3" name="rest_code_3e557621ca2c4ae1b32e7e2a28cc18fe-3" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_3e557621ca2c4ae1b32e7e2a28cc18fe-3"></a><span class="w">    </span><span class="n">test</span><span class="w"> </span><span class="n">b</span><span class="p">{</span><span class="mi">5</span><span class="p">};</span>
<a id="rest_code_3e557621ca2c4ae1b32e7e2a28cc18fe-4" name="rest_code_3e557621ca2c4ae1b32e7e2a28cc18fe-4" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_3e557621ca2c4ae1b32e7e2a28cc18fe-4"></a><span class="w">    </span><span class="n">CPM_GLOBAL</span><span class="p">(</span><span class="s">"std"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">a</span><span class="p">](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d</span><span class="p">){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">d</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="n">_ns</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">a</span><span class="p">);</span>
<a id="rest_code_3e557621ca2c4ae1b32e7e2a28cc18fe-5" name="rest_code_3e557621ca2c4ae1b32e7e2a28cc18fe-5" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_3e557621ca2c4ae1b32e7e2a28cc18fe-5"></a><span class="w">    </span><span class="n">CPM_GLOBAL</span><span class="p">(</span><span class="s">"mkl"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">b</span><span class="p">](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d</span><span class="p">){</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">((</span><span class="n">factor</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">d</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">d</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">d</span><span class="p">))</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1</span><span class="n">_ns</span><span class="w"> </span><span class="p">);</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">b</span><span class="p">);</span>
<a id="rest_code_3e557621ca2c4ae1b32e7e2a28cc18fe-6" name="rest_code_3e557621ca2c4ae1b32e7e2a28cc18fe-6" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_3e557621ca2c4ae1b32e7e2a28cc18fe-6"></a><span class="p">}</span>
</pre></div>
<p>will be warmup 11 times and run 51 times.</p>
<p>The size policy can also be changed for the complete section (cannot be changed independently for benchmarks inside the section):</p>
<div class="code"><pre class="code cpp"><a id="rest_code_9476d82702de4419b5b125e9467f9782-1" name="rest_code_9476d82702de4419b5b125e9467f9782-1" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_9476d82702de4419b5b125e9467f9782-1"></a><span class="n">CPM_SECTION_P</span><span class="p">(</span><span class="s">"mmul"</span><span class="p">,</span>
<a id="rest_code_9476d82702de4419b5b125e9467f9782-2" name="rest_code_9476d82702de4419b5b125e9467f9782-2" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_9476d82702de4419b5b125e9467f9782-2"></a><span class="w">    </span><span class="n">NARY_POLICY</span><span class="p">(</span><span class="n">STD_STOP_POLICY</span><span class="p">,</span><span class="w"> </span><span class="n">VALUES_POLICY</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span><span class="w"> </span><span class="n">VALUES_POLICY</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">64</span><span class="p">)))</span>
<a id="rest_code_9476d82702de4419b5b125e9467f9782-3" name="rest_code_9476d82702de4419b5b125e9467f9782-3" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_9476d82702de4419b5b125e9467f9782-3"></a><span class="w">    </span><span class="n">test</span><span class="w"> </span><span class="n">a</span><span class="p">{</span><span class="mi">3</span><span class="p">};</span>
<a id="rest_code_9476d82702de4419b5b125e9467f9782-4" name="rest_code_9476d82702de4419b5b125e9467f9782-4" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_9476d82702de4419b5b125e9467f9782-4"></a><span class="w">    </span><span class="n">test</span><span class="w"> </span><span class="n">b</span><span class="p">{</span><span class="mi">5</span><span class="p">};</span>
<a id="rest_code_9476d82702de4419b5b125e9467f9782-5" name="rest_code_9476d82702de4419b5b125e9467f9782-5" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_9476d82702de4419b5b125e9467f9782-5"></a><span class="w">    </span><span class="n">CPM_GLOBAL</span><span class="p">(</span><span class="s">"std"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">a</span><span class="p">](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d1</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d2</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d3</span><span class="p">){</span><span class="w"> </span><span class="cm">/* Something */</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">a</span><span class="p">);</span>
<a id="rest_code_9476d82702de4419b5b125e9467f9782-6" name="rest_code_9476d82702de4419b5b125e9467f9782-6" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_9476d82702de4419b5b125e9467f9782-6"></a><span class="w">    </span><span class="n">CPM_GLOBAL</span><span class="p">(</span><span class="s">"mkl"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">a</span><span class="p">](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d1</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d2</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d3</span><span class="p">){</span><span class="w"> </span><span class="cm">/* Something */</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">a</span><span class="p">);</span>
<a id="rest_code_9476d82702de4419b5b125e9467f9782-7" name="rest_code_9476d82702de4419b5b125e9467f9782-7" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_9476d82702de4419b5b125e9467f9782-7"></a><span class="w">    </span><span class="n">CPM_GLOBAL</span><span class="p">(</span><span class="s">"bla"</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="o">&amp;</span><span class="n">a</span><span class="p">](</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d1</span><span class="p">,</span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d2</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="kt">size_t</span><span class="w"> </span><span class="n">d3</span><span class="p">){</span><span class="w"> </span><span class="cm">/* Something */</span><span class="w"> </span><span class="p">},</span><span class="w"> </span><span class="n">a</span><span class="p">);</span>
<a id="rest_code_9476d82702de4419b5b125e9467f9782-8" name="rest_code_9476d82702de4419b5b125e9467f9782-8" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_9476d82702de4419b5b125e9467f9782-8"></a><span class="p">}</span>
</pre></div>
</section><section id="run"><h3>Run</h3>
<p>Once your benchmarks and sections are defined, you can build you program as a normal C++ main and run it. You can pass several options:</p>
<div class="code"><pre class="code text"><a id="rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-1" name="rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-1" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-1"></a>./debug/bin/full -h
<a id="rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-2" name="rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-2" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-2"></a>Usage:
<a id="rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-3" name="rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-3" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-3"></a>  ./debug/bin/full [OPTION...]
<a id="rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-4" name="rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-4" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-4"></a>
<a id="rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-5" name="rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-5" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-5"></a>  -n, --name arg           Benchmark name
<a id="rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-6" name="rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-6" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-6"></a>  -t, --tag arg            Tag name
<a id="rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-7" name="rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-7" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-7"></a>  -c, --configuration arg  Configuration
<a id="rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-8" name="rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-8" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-8"></a>  -o, --output arg         Output folder
<a id="rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-9" name="rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-9" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_2fb696f6c2bb47e4b9b25d399b25d0aa-9"></a>  -h, --help               Print help
</pre></div>
<p>The tag is used to distinguish between runs, I recommend that you use a SCM identifier for the tag. If you want to run your program with different configurations (compiler options for instance), you'll have to set the configuration with the --configuration option.</p>
<p>Here is a possible output:</p>
<div class="code"><pre class="code text"><a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-1" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-1" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-1"></a> Start CPM benchmarks
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-2" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-2" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-2"></a>    Results will be automatically saved in /home/wichtounet/dev/cpm/results/10.cpm
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-3" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-3" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-3"></a>    Each test is warmed-up 10 times
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-4" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-4" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-4"></a>    Each test is repeated 50 times
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-5" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-5" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-5"></a>    Time Sun Jun 14 15:33:51 2015
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-6" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-6" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-6"></a>
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-7" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-7" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-7"></a>    Tag: 10
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-8" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-8" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-8"></a>    Configuration:
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-9" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-9" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-9"></a>    Compiler: clang-3.5.0
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-10" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-10" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-10"></a>    Operating System: Linux x86_64 3.16.5-gentoo
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-11" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-11" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-11"></a>
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-12" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-12" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-12"></a>
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-13" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-13" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-13"></a> simple_a(10) : mean: 52.5us (52.3us,52.7us) stddev: 675ns min: 48.5us max: 53.3us througput: 190KEs
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-14" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-14" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-14"></a> simple_a(100) : mean: 50.1us (48us,52.2us) stddev: 7.53us min: 7.61us max: 52.3us througput: 2MEs
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-15" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-15" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-15"></a> simple_a(1000) : mean: 52.7us (52.7us,52.7us) stddev: 48.7ns min: 52.7us max: 53us througput: 19MEs
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-16" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-16" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-16"></a> simple_a(10000) : mean: 62.6us (62.6us,62.7us) stddev: 124ns min: 62.6us max: 63.5us througput: 160MEs
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-17" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-17" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-17"></a> simple_a(100000) : mean: 161us (159us,162us) stddev: 5.41us min: 132us max: 163us througput: 622MEs
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-18" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-18" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-18"></a> simple_a(1000000) : mean: 1.16ms (1.16ms,1.17ms) stddev: 7.66us min: 1.15ms max: 1.18ms througput: 859MEs
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-19" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-19" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-19"></a>
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-20" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-20" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-20"></a>-----------------------------------------
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-21" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-21" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-21"></a>|            gemm |       std |     mkl |
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-22" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-22" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-22"></a>-----------------------------------------
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-23" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-23" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-23"></a>|           10x10 | 51.7189us | 64.64ns |
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-24" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-24" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-24"></a>|         100x100 | 52.4336us | 63.42ns |
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-25" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-25" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-25"></a>|       1000x1000 | 56.0097us |  63.2ns |
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-26" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-26" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-26"></a>|     10000x10000 | 95.6123us | 63.52ns |
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-27" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-27" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-27"></a>|   100000x100000 | 493.795us | 63.48ns |
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-28" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-28" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-28"></a>| 1000000x1000000 | 4.46646ms |  63.8ns |
<a id="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-29" name="rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-29" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f4ce72abc04a4fabad04c590a7e6a2d9-29"></a>-----------------------------------------
</pre></div>
<p>The program will give you for each benchmark, the mean duration (with confidence interval), the standard deviation of the samples, the min and max duration and an estimated throughput. The throughput is simply using the size and the mean duration. Each section is directly compared with an array-like output. Once the benchmark is run, a JSON report will be generated inside the output folder.</p>
</section></section><section id="continuous-monitoring"><h2>Continuous Monitoring</h2>
<p>Once you have run the benchmark, you can use the CPM program to generate the web reports. It will generate:</p>
<ul class="simple">
<li><p>1 performance graph for each benchmark and section</p></li>
<li><p>1 graph comparing the performances over time of your benchmark sections if you have run the benchmark several time</p></li>
<li><p>1 graph comparing different compiler if you have compiled your program with different compiler</p></li>
<li><p>1 graph comparing different configuration if you have run the benchmark with different configuration</p></li>
<li><p>1 table summary for each benchmark / section</p></li>
</ul>
<p>First you have to build and install the CPM program (you can have a look at the <a class="reference external" href="https://github.com/wichtounet/cpm/blob/master/README.rst">Readme</a> for more informations.</p>
<p>Several options are available:</p>
<div class="code"><pre class="code text"><a id="rest_code_f1d6550419c14fef8325cd5765722a2b-1" name="rest_code_f1d6550419c14fef8325cd5765722a2b-1" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f1d6550419c14fef8325cd5765722a2b-1"></a>Usage:
<a id="rest_code_f1d6550419c14fef8325cd5765722a2b-2" name="rest_code_f1d6550419c14fef8325cd5765722a2b-2" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f1d6550419c14fef8325cd5765722a2b-2"></a>  cpm [OPTION...]  results_folder
<a id="rest_code_f1d6550419c14fef8325cd5765722a2b-3" name="rest_code_f1d6550419c14fef8325cd5765722a2b-3" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f1d6550419c14fef8325cd5765722a2b-3"></a>
<a id="rest_code_f1d6550419c14fef8325cd5765722a2b-4" name="rest_code_f1d6550419c14fef8325cd5765722a2b-4" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f1d6550419c14fef8325cd5765722a2b-4"></a>      --time-sizes             Display multiple sizes in the time graphs
<a id="rest_code_f1d6550419c14fef8325cd5765722a2b-5" name="rest_code_f1d6550419c14fef8325cd5765722a2b-5" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f1d6550419c14fef8325cd5765722a2b-5"></a>  -t, --theme arg              Theme name [raw,bootstrap,boostrap-tabs] (default:bootstrap)
<a id="rest_code_f1d6550419c14fef8325cd5765722a2b-6" name="rest_code_f1d6550419c14fef8325cd5765722a2b-6" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f1d6550419c14fef8325cd5765722a2b-6"></a>  -c, --hctheme theme_name     Highcharts Theme name [std,dark_unica] (default:dark_unica)
<a id="rest_code_f1d6550419c14fef8325cd5765722a2b-7" name="rest_code_f1d6550419c14fef8325cd5765722a2b-7" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f1d6550419c14fef8325cd5765722a2b-7"></a>  -o, --output output_folder   Output folder (default:reports)
<a id="rest_code_f1d6550419c14fef8325cd5765722a2b-8" name="rest_code_f1d6550419c14fef8325cd5765722a2b-8" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f1d6550419c14fef8325cd5765722a2b-8"></a>      --input arg              Input results
<a id="rest_code_f1d6550419c14fef8325cd5765722a2b-9" name="rest_code_f1d6550419c14fef8325cd5765722a2b-9" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f1d6550419c14fef8325cd5765722a2b-9"></a>  -s, --sort-by-tag            Sort by tag instaed of time
<a id="rest_code_f1d6550419c14fef8325cd5765722a2b-10" name="rest_code_f1d6550419c14fef8325cd5765722a2b-10" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f1d6550419c14fef8325cd5765722a2b-10"></a>  -p, --pages                  General several HTML pages (one per bench/section)
<a id="rest_code_f1d6550419c14fef8325cd5765722a2b-11" name="rest_code_f1d6550419c14fef8325cd5765722a2b-11" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f1d6550419c14fef8325cd5765722a2b-11"></a>  -d, --disable-time           Disable time graphs
<a id="rest_code_f1d6550419c14fef8325cd5765722a2b-12" name="rest_code_f1d6550419c14fef8325cd5765722a2b-12" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f1d6550419c14fef8325cd5765722a2b-12"></a>      --disable-compiler       Disable compiler graphs
<a id="rest_code_f1d6550419c14fef8325cd5765722a2b-13" name="rest_code_f1d6550419c14fef8325cd5765722a2b-13" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f1d6550419c14fef8325cd5765722a2b-13"></a>      --disable-configuration  Disable configuration graphs
<a id="rest_code_f1d6550419c14fef8325cd5765722a2b-14" name="rest_code_f1d6550419c14fef8325cd5765722a2b-14" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f1d6550419c14fef8325cd5765722a2b-14"></a>      --disable-summary        Disable summary table
<a id="rest_code_f1d6550419c14fef8325cd5765722a2b-15" name="rest_code_f1d6550419c14fef8325cd5765722a2b-15" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_f1d6550419c14fef8325cd5765722a2b-15"></a>  -h, --help                   Print help
</pre></div>
<p>There are 3 themes:</p>
<ul class="simple">
<li><p><em>bootstrap</em>: The default theme, using Bootstrap to make a responsive interface.</p></li>
<li><p><em>bootstrap-tabs</em>: Similar to the <em>bootstrap</em> theme except that only is displayed at the same time for each benchmark, with tabs.</p></li>
<li><p><em>raw</em> : A very basic theme, only using Highcharts library for graphs. It is very minimalistic</p></li>
</ul>
<p>For instance, here are how the reports are generated for the ETL benchmark:</p>
<div class="code"><pre class="code text"><a id="rest_code_a7cb82f869ef483b9509ea5f5aa9693c-1" name="rest_code_a7cb82f869ef483b9509ea5f5aa9693c-1" href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#rest_code_a7cb82f869ef483b9509ea5f5aa9693c-1"></a>cpm -p -s -t bootstrap -c dark_unica -o reports results
</pre></div>
<p>Here is the graph generated for the "R = A + B + C" benchmark and different compilers:</p>
<img alt="/images/cpm_etl_compiler.png" src="images/cpm_etl_compiler.png"><p>and its summary:</p>
<img alt="/images/cpm_etl_summary.png" src="images/cpm_etl_summary.png"><p>Here is the graph for a 2D convolution with ETL:</p>
<img alt="/images/cpm_etl_section.png" src="images/cpm_etl_section.png"><p>And the graph for different configurations of ETL and the dense matrix matrix multiplication:</p>
<img alt="/images/cpm_etl_configuration.png" src="images/cpm_etl_configuration.png"></section><section id="conclusion-and-future-work"><h2>Conclusion and Future Work</h2>
<p>Although CPM is already working, there are several things that could be done to improve it further:</p>
<ul class="simple">
<li><p>The generated web report could benefit from a global summary.</p></li>
<li><p>The throughput evaluation should be evaluated more carefully.</p></li>
<li><p>The tool should automatically evaluate the number of times that each tests should be run to have a good result instead of global warmup and repeat constants.</p></li>
<li><p>A better bootstrapping procedure should be used to determine the quality of the results and compute the confidence intervals.</p></li>
<li><p>The performances of the website with lots of graphs should be improved.</p></li>
<li><p>Make CPM more general-purpose to support larger needs.</p></li>
</ul>
<p>Here it is, I have summed most of the features of the CPM Continuous Performance Analysis tool. I hope that it will be helpful to some of you as well.</p>
<p>If you have other ideas or want to contribute something to the project, you can directly open an issue or a pull request on <a class="reference external" href="https://github.com/wichtounet/cpm">Github</a>. Or contact me via this site or Github.</p>
</section>
</div>
            
    
    <a href="posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html#disqus_thread" data-disqus-identifier="cache/posts/2015/06/continuous-performance-management-with-cpm-for-cpp.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2015/05/cpp17-fold-expressions.html" class="u-url">C++17 Fold Expressions</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2015-05-23T19:08:20+02:00">2015-05-23 19:08</time></small>
</h1>
        <hr>
<div class="p-summary">
        <section id="variadic-templates"><h2>Variadic Templates</h2>
<p>C++11 introduced variadic template to the languages. This new feature allows to write template functions and classes taking an arbitrary number of template parameters. This a feature I really like and I already used it quite a lot in my different libraries. Here is a very simple example computing the sum of the parameters:</p>
<div class="code"><pre class="code c++"><a id="rest_code_82f7f9f2a7c749509b3be704fcf95761-1" name="rest_code_82f7f9f2a7c749509b3be704fcf95761-1" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_82f7f9f2a7c749509b3be704fcf95761-1"></a><span class="k">auto</span><span class="w"> </span><span class="n">old_sum</span><span class="p">(){</span>
<a id="rest_code_82f7f9f2a7c749509b3be704fcf95761-2" name="rest_code_82f7f9f2a7c749509b3be704fcf95761-2" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_82f7f9f2a7c749509b3be704fcf95761-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="rest_code_82f7f9f2a7c749509b3be704fcf95761-3" name="rest_code_82f7f9f2a7c749509b3be704fcf95761-3" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_82f7f9f2a7c749509b3be704fcf95761-3"></a><span class="p">}</span>
<a id="rest_code_82f7f9f2a7c749509b3be704fcf95761-4" name="rest_code_82f7f9f2a7c749509b3be704fcf95761-4" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_82f7f9f2a7c749509b3be704fcf95761-4"></a>
<a id="rest_code_82f7f9f2a7c749509b3be704fcf95761-5" name="rest_code_82f7f9f2a7c749509b3be704fcf95761-5" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_82f7f9f2a7c749509b3be704fcf95761-5"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T1</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span>
<a id="rest_code_82f7f9f2a7c749509b3be704fcf95761-6" name="rest_code_82f7f9f2a7c749509b3be704fcf95761-6" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_82f7f9f2a7c749509b3be704fcf95761-6"></a><span class="k">auto</span><span class="w"> </span><span class="n">old_sum</span><span class="p">(</span><span class="n">T1</span><span class="w"> </span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="p">...</span><span class="w"> </span><span class="n">ts</span><span class="p">){</span>
<a id="rest_code_82f7f9f2a7c749509b3be704fcf95761-7" name="rest_code_82f7f9f2a7c749509b3be704fcf95761-7" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_82f7f9f2a7c749509b3be704fcf95761-7"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">old_sum</span><span class="p">(</span><span class="n">ts</span><span class="p">...);</span>
<a id="rest_code_82f7f9f2a7c749509b3be704fcf95761-8" name="rest_code_82f7f9f2a7c749509b3be704fcf95761-8" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_82f7f9f2a7c749509b3be704fcf95761-8"></a><span class="p">}</span>
</pre></div>
<p>What can be seen here is a typical use of variadic templates. Almost all the time, is is necessary to use recursion and several functions to unpack the parameters and process them. There is only one way to unpack the arguments, by using the ... operator that simply put comma between arguments. Even if it works well, it is a bit heavy on the code. This will likely be completely optimized to a series of addition by the compiler, but it may still happen in more complicated functions that this is not done. Moreover, the intent is not always clear with that.</p>
<p>That is why C++17 introduced an extension for the variadic template, fold expressions.</p>
</section><section id="fold-expressions"><h2>Fold expressions</h2>
<p>Fold expressions are a new way to unpack variadic parameters with operators. For now, only Clang 3.6 supports C++17 fold expression, with the -std=c++1z flag. That is the compiler I used to validate the examples of this post.</p>
<p>The syntax is bit disturbing at first but quite logical once you get used to it:</p>
<div class="code"><pre class="code c++"><a id="rest_code_758d2f45387b42ad9a037698e18b03f0-1" name="rest_code_758d2f45387b42ad9a037698e18b03f0-1" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_758d2f45387b42ad9a037698e18b03f0-1"></a><span class="p">(</span><span class="w"> </span><span class="n">pack</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="p">)</span><span class="w">             </span><span class="c1">//(1)</span>
<a id="rest_code_758d2f45387b42ad9a037698e18b03f0-2" name="rest_code_758d2f45387b42ad9a037698e18b03f0-2" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_758d2f45387b42ad9a037698e18b03f0-2"></a><span class="p">(</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="n">pack</span><span class="w"> </span><span class="p">)</span><span class="w">             </span><span class="c1">//(2)</span>
<a id="rest_code_758d2f45387b42ad9a037698e18b03f0-3" name="rest_code_758d2f45387b42ad9a037698e18b03f0-3" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_758d2f45387b42ad9a037698e18b03f0-3"></a><span class="p">(</span><span class="w"> </span><span class="n">pack</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="n">init</span><span class="w"> </span><span class="p">)</span><span class="w">     </span><span class="c1">//(3)</span>
<a id="rest_code_758d2f45387b42ad9a037698e18b03f0-4" name="rest_code_758d2f45387b42ad9a037698e18b03f0-4" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_758d2f45387b42ad9a037698e18b03f0-4"></a><span class="p">(</span><span class="w"> </span><span class="n">init</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="n">op</span><span class="w"> </span><span class="n">pack</span><span class="w"> </span><span class="p">)</span><span class="w">     </span><span class="c1">//(4)</span>
</pre></div>
<p>Where <em>pack</em> is an unexpanded parameter pack, <em>op</em> an operator and <em>init</em> a value. The version (1) is a right fold that is expanded like (P1 op (P2 op (P3 ... (PN-1 op PN)))). The version (2) is a left fold where the expansion is taken from the left. The (3) and (4) versions are almost the same except for an init value. Only some operators (+,*,&amp;,|,&amp;&amp;,||, ,) have defined init values and can be used with the versions (1) and (2). The other operators can only be used with an init value.</p>
<p>For instance, here is how we could write the sum functions with fold expressions:</p>
<div class="code"><pre class="code c++"><a id="rest_code_59c98b0f91bd42638439fd97c33d5e0d-1" name="rest_code_59c98b0f91bd42638439fd97c33d5e0d-1" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_59c98b0f91bd42638439fd97c33d5e0d-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span>
<a id="rest_code_59c98b0f91bd42638439fd97c33d5e0d-2" name="rest_code_59c98b0f91bd42638439fd97c33d5e0d-2" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_59c98b0f91bd42638439fd97c33d5e0d-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">fold_sum_1</span><span class="p">(</span><span class="n">T</span><span class="p">...</span><span class="w"> </span><span class="n">s</span><span class="p">){</span>
<a id="rest_code_59c98b0f91bd42638439fd97c33d5e0d-3" name="rest_code_59c98b0f91bd42638439fd97c33d5e0d-3" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_59c98b0f91bd42638439fd97c33d5e0d-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(...</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">);</span>
<a id="rest_code_59c98b0f91bd42638439fd97c33d5e0d-4" name="rest_code_59c98b0f91bd42638439fd97c33d5e0d-4" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_59c98b0f91bd42638439fd97c33d5e0d-4"></a><span class="p">}</span>
</pre></div>
<p>I personally think it is much better, it clearly states our intent and does not need recursion. By default, the init value used for addition is 0, but you can change it:</p>
<div class="code"><pre class="code c++"><a id="rest_code_58c00fa61b91448a80ea3d1efb0d4bc1-1" name="rest_code_58c00fa61b91448a80ea3d1efb0d4bc1-1" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_58c00fa61b91448a80ea3d1efb0d4bc1-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span>
<a id="rest_code_58c00fa61b91448a80ea3d1efb0d4bc1-2" name="rest_code_58c00fa61b91448a80ea3d1efb0d4bc1-2" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_58c00fa61b91448a80ea3d1efb0d4bc1-2"></a><span class="k">auto</span><span class="w"> </span><span class="n">fold_sum_2</span><span class="p">(</span><span class="n">T</span><span class="p">...</span><span class="w"> </span><span class="n">s</span><span class="p">){</span>
<a id="rest_code_58c00fa61b91448a80ea3d1efb0d4bc1-3" name="rest_code_58c00fa61b91448a80ea3d1efb0d4bc1-3" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_58c00fa61b91448a80ea3d1efb0d4bc1-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">s</span><span class="p">);</span>
<a id="rest_code_58c00fa61b91448a80ea3d1efb0d4bc1-4" name="rest_code_58c00fa61b91448a80ea3d1efb0d4bc1-4" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_58c00fa61b91448a80ea3d1efb0d4bc1-4"></a><span class="p">}</span>
</pre></div>
<p>This will yield the sum of the elements plus one.</p>
<p>This can be also very practical to print some elements for instance:</p>
<div class="code"><pre class="code c++"><a id="rest_code_58be85e3f41c4e108d34d6a8c7fca450-1" name="rest_code_58be85e3f41c4e108d34d6a8c7fca450-1" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_58be85e3f41c4e108d34d6a8c7fca450-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="p">...</span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_58be85e3f41c4e108d34d6a8c7fca450-2" name="rest_code_58be85e3f41c4e108d34d6a8c7fca450-2" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_58be85e3f41c4e108d34d6a8c7fca450-2"></a><span class="kt">void</span><span class="w"> </span><span class="n">print_1</span><span class="p">(</span><span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_58be85e3f41c4e108d34d6a8c7fca450-3" name="rest_code_58be85e3f41c4e108d34d6a8c7fca450-3" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_58be85e3f41c4e108d34d6a8c7fca450-3"></a><span class="w">    </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="p">...</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">args</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">'\n'</span><span class="p">;</span>
<a id="rest_code_58be85e3f41c4e108d34d6a8c7fca450-4" name="rest_code_58be85e3f41c4e108d34d6a8c7fca450-4" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_58be85e3f41c4e108d34d6a8c7fca450-4"></a><span class="p">}</span>
</pre></div>
<p>And this can even be used when doing Template Metaprogramming, for instance here is a TMP version of the and operator:</p>
<div class="code"><pre class="code c++"><a id="rest_code_6e44861787604d55bf9611be60eed265-1" name="rest_code_6e44861787604d55bf9611be60eed265-1" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_6e44861787604d55bf9611be60eed265-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">...</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span>
<a id="rest_code_6e44861787604d55bf9611be60eed265-2" name="rest_code_6e44861787604d55bf9611be60eed265-2" href="posts/2015/05/cpp17-fold-expressions.html#rest_code_6e44861787604d55bf9611be60eed265-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">fold_and</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">B</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">...)</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
</pre></div>
</section><section id="conclusion-7"><h2>Conclusion</h2>
<p>C++17 fold expressions are a really nice additions to the language that makes working with variadic templates much easier. This already makes me wish for C++17 release :)</p>
<p>The source code for the examples are available on Github: <a class="reference external" href="https://github.com/wichtounet/articles/blob/master/src/fold_expressions.cpp">https://github.com/wichtounet/articles/blob/master/src/fold_expressions.cpp</a></p>
</section>
</div>
            
    
    <a href="posts/2015/05/cpp17-fold-expressions.html#disqus_thread" data-disqus-identifier="cache/posts/2015/05/cpp17-fold-expressions.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2015/05/sonar-cpp-community-plugin-review.html" class="u-url">Sonar C++ Community Plugin Review</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2015-05-14T17:09:59+02:00">2015-05-14 17:09</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>It's been a long time since I have written on this blog. I have had quite a lot of work between my Ph.D and my teaching. I have several projects going on, I'll try to write updates on them later on.</p>
<p>Some time ago, I wrote an article <cite>about the official C++ plugin for Sonar &lt;http://baptiste-wicht.com/posts/2014/10/sonarqube-inspections-for-cpp-projects.html&gt;</cite>. I was quite disappointed by the quality of a plugin. I was expecting more from an expensive official plugin.</p>
<p>There is an open-source alternative to the commercial plugin: <cite>sonar-cxx-plugin &lt;https://github.com/wenns/sonar-cxx&gt;</cite>. I already tested it quite some time ago (a development version of the 0.9.1 version) and the results were quite bad. I'm using C++11 and C++14 in almost all of my projects and the support was quite bad at that time. Happily, this support has now gotten much better :) In this article, I'll talk about the version 0.9.2.</p>
<section id="usage-2"><h2>Usage</h2>
<p>The usage of this plugin is very easy, you don't need any complicated build wrapping techniques for it. You simply need to complete a <em>sonar-project.properties</em> file:</p>
<pre class="literal-block">sonar.projectKey=etl
sonar.projectName=etl
sonar.projectVersion=1.0

sonar.sourceEncoding=UTF-8
sonar.sources=include,test,workbench
sonar.language=c++</pre>
<p>After that, you simply have to use <em>sonar-runner</em> as for any other Sonar project:</p>
<blockquote>
<p>sonar-runner</p>
</blockquote>
<p>And the analysis will be run.</p>
<p>I haven't had any issues with the analysis. However, the plugin is not yet completely C++11/C++14 compatible, therefore I'm encountering a lot of parser errors during the analysis. When an error is encountered by the parser, the line is skipped and the parser goes to the next line. This means that the analysis of the line is incomplete, which may lead to false positives or to missing issues. This comes from that sonar-cxx uses its own parser, which is to on par with clang-compatible parsers for instance.</p>
<p>Here is the Sonar summary of my ETL project:</p>
<img alt="/images/sonar_summary.png" src="images/sonar_summary.png"></section><section id="inspections-2"><h2>Inspections</h2>
<p>This plugin supports some inspections on itself. Nevertheless, you have to enable since it seems that most of them are disable by default. Code duplication is also automatically generated during the analysis:</p>
<img alt="/images/sonar_duplicated.png" src="images/sonar_duplicated.png"><p>The philosophy of this project is not to develop all inspections, but to integrate with other tools. For instance, cppcheck is already supported and the integration works perfectly. Here are the tools that sonar-cxx supports for quality analysis:</p>
<ul class="simple">
<li><p>cppcheck</p></li>
<li><p>valgrind</p></li>
<li><p>Vera++</p></li>
<li><p>RATS</p></li>
<li><p>PC-Lint</p></li>
</ul>
<p>I have only tested cppcheck for now. I plan to use valgrind running on my tests in the future. I don't plan to use the others.</p>
<p>It should also be noted that the plugin supports compiler warnings coming from G++ and Visual Studio. I don't use this since I compile all my projects with -Werror.</p>
<p>The biggest absent here is Clang, there is no support for its warnings, its static-analyzer or its advanced clang-tidy tool. If clang-tidy support does not come in the near future, I'm planning to try to add it myself, provided I find some time.</p>
<p>You can have to some inspections on one of my project:</p>
<img alt="/images/sonar_inspections.png" src="images/sonar_inspections.png"><p>As with any Sonar projects, you have access to the Hotsposts view:</p>
<img alt="/images/sonar_hotspots.png" src="images/sonar_hotspots.png"></section><section id="unit-tests-integration"><h2>Unit Tests Integration</h2>
<p>I have been able to integrate my unit tests results inside Sonar. The plugin expects JUnit compatible format. Several of C++ unit test libraries already generates compatible format. In my case, I used Catch and it worked very well.</p>
<p>What is even more interesting is the support for code coverage. You have to run your coverage-enabled executable and then use gcovr to generate an XML file that the plugin can read.</p>
<p>This support works quite well. The only thing I haven't been able to make work is the execution time computation of the unit tests, but that is not something I really care about.</p>
<p>Here are the coverage results for one of my files:</p>
<img alt="/images/sonar_coverage.png" src="images/sonar_coverage.png"></section><section id="conclusion-6"><h2>Conclusion</h2>
<p><strong>Pros</strong></p>
<ul class="simple">
<li><p>Support of a lot of external tools</p></li>
<li><p>Very easy to use</p></li>
<li><p>Duplicated code analysis</p></li>
<li><p>Very good code coverage analysis integration</p></li>
</ul>
<p><strong>Cons</strong></p>
<ul class="simple">
<li><p>Too few integrated inspections</p></li>
<li><p>Limited parsing of C++</p></li>
<li><p>Not fully compatible with C++11/C++14</p></li>
<li><p>False positives</p></li>
<li><p>Not enough love for clang (compiler warnings, clang-tidy, tooling, static-analyzer, ...)</p></li>
</ul>
<p>The provided metrics are really good, the usage is quite simple and this plugin supports some external tools adding interesting inspections. Even if this plugin is not perfect, it is a very good way to do Continuous Quality Analysis of your C++ projects. I personally find it superior to the official plugin. The usage is more simple (no build-wrapper that does not work), it supports more external tools and supports JUnit reports. On the other hand, it has much less integrated inspections and rely more on external tools. Both have problems with modern C++ features.</p>
<p>What I would really like in this plugin is the support of the clang-tidy analyzer (and other Clang analysis tools) and also complete C++11/C++14 support. I honestly think that the only way to fix the latter is to switch to Clang parsing with libtooling rather than developing an in-house parser, but that is not up to me.</p>
<p>I will definitely continue to use this plugin to generate metrics for my C++ projects. I use it with Jenkins which launch the analysis every time I push to one my git repositories. This plugin definitely shows promises.</p>
</section>
</div>
            
    
    <a href="posts/2015/05/sonar-cpp-community-plugin-review.html#disqus_thread" data-disqus-identifier="cache/posts/2015/05/sonar-cpp-community-plugin-review.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html" class="u-url">How to speed up RAID (5-6) growing with mdadm ?</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2015-03-07T15:01:56+01:00">2015-03-07 15:01</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>Yesterday, I added my 11th disk to my RAID 6 array. As the last time it took my more than 20 hours, I spent some time investigating how to speed things up and this post contains some tips on how to achieve good grow performances. With these tips, I have been able to reach a speed of about 55K in average during reshape. It did finish in about 13 hours.</p>
<p>First, take into account that some of these tips may depend on your configuration. In my case, this server is only used for this RAID, so I don't care if the CPU is used a lot during rebuild or if other processes are suffering from the load. This may not be the case with your configuration. Moreover, I speak only of hard disks, if you use SSD RAID, there are probably better way of tuning the rebuild (or perhaps it is fast enough). Finally, you have know that a RAID reshape is going to be slow, there is no way you'll grow a 10+ RAID array in one hour. G</p>
<p>In the examples, I use /dev/md0 as the raid array, you'll have to change this to your array name.</p>
<p>The first 3 tips can be used even after the rebuild has started and you should see the differences in real-time. But, these 3 tips will also be erased after each reboot.</p>
<section id="increase-speed-limits"><h2>Increase speed limits</h2>
<p>The easiest thing to do is to increase the system speed limits on raid. You can see the current limits on your system by using these commands:</p>
<div class="code"><pre class="code bash"><a id="rest_code_993f579f50b04f78a879039afa390648-1" name="rest_code_993f579f50b04f78a879039afa390648-1" href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html#rest_code_993f579f50b04f78a879039afa390648-1"></a>sysctl<span class="w"> </span>dev.raid.speed_limit_min
<a id="rest_code_993f579f50b04f78a879039afa390648-2" name="rest_code_993f579f50b04f78a879039afa390648-2" href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html#rest_code_993f579f50b04f78a879039afa390648-2"></a>sysctl<span class="w"> </span>dev.raid.speed_limit_max
</pre></div>
<p>These values are set in Kibibytes per second (KiB/s).</p>
<p>You can put them to high values:</p>
<div class="code"><pre class="code bash"><a id="rest_code_0f53dd58ad064c6491e566c6ec2502e3-1" name="rest_code_0f53dd58ad064c6491e566c6ec2502e3-1" href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html#rest_code_0f53dd58ad064c6491e566c6ec2502e3-1"></a>sysctl<span class="w"> </span>-w<span class="w"> </span>dev.raid.speed_limit_min<span class="o">=</span><span class="m">100000</span>
<a id="rest_code_0f53dd58ad064c6491e566c6ec2502e3-2" name="rest_code_0f53dd58ad064c6491e566c6ec2502e3-2" href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html#rest_code_0f53dd58ad064c6491e566c6ec2502e3-2"></a>sysctl<span class="w"> </span>-w<span class="w"> </span>dev.raid.speed_limit_max<span class="o">=</span><span class="m">500000</span>
</pre></div>
<p>At least with these values, you won't be limited by the system.</p>
</section><section id="increase-stripe-cache-size"><h2>Increase stripe cache size</h2>
<p>By allowing the array to use more memory for its stripe cache, you may improve the performances. In some cases, it can improve performances by up to 6 times. By default, the size of the stripe cache is 256, in pages. By default, Linux uses 4096B pages. If you use 256 pages for the stripe cache and you have 10 disks, the cache would use 10*256*4096=10MiB of RAM. In my case, I have increased it to 4096:</p>
<div class="code"><pre class="code bash"><a id="rest_code_dc0d97a1595c4925bc27b311d69fc0e2-1" name="rest_code_dc0d97a1595c4925bc27b311d69fc0e2-1" href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html#rest_code_dc0d97a1595c4925bc27b311d69fc0e2-1"></a><span class="nb">echo</span><span class="w"> </span><span class="m">4096</span><span class="w"> </span>&gt;<span class="w"> </span>/sys/block/md0/md/stripe_cache_size
</pre></div>
<p>The maximum value is 32768. If you have many disks, this may well take all your available memory. I don't think values higher than 4096 will improve performance, but feel free to try it ;)</p>
</section><section id="increase-read-ahead"><h2>Increase read-ahead</h2>
<p>If configured too low, the read-ahead of your array may make things slower.</p>
<p>You can see get the current read-ahead value with this command:</p>
<div class="code"><pre class="code bash"><a id="rest_code_5726d63b382d4e6799a93a8b19eda6a5-1" name="rest_code_5726d63b382d4e6799a93a8b19eda6a5-1" href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html#rest_code_5726d63b382d4e6799a93a8b19eda6a5-1"></a>blockdev<span class="w"> </span>--getra<span class="w"> </span>/dev/md0
</pre></div>
<p>These values are in 512B sector. You can set it to 32MB to be sure:</p>
<div class="code"><pre class="code bash"><a id="rest_code_accaf7762c7542db944c8fe8375f706a-1" name="rest_code_accaf7762c7542db944c8fe8375f706a-1" href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html#rest_code_accaf7762c7542db944c8fe8375f706a-1"></a>blockdev<span class="w"> </span>--setra<span class="w"> </span><span class="m">65536</span><span class="w"> </span>/dev/md0
</pre></div>
<p>This can improve the performances, but don't expect this to be a game-changer unless it was configured really low at the first place.</p>
</section><section id="tip-reshape-stuck-at-0k-s"><h2>Tip: Reshape stuck at 0K/s</h2>
<p>If reshape starts, but with a speed of 0K/s, you can try to issue this simple
command:</p>
<div class="code"><pre class="code bash"><a id="rest_code_74b3d253e67d4746b412629f74bf686a-1" name="rest_code_74b3d253e67d4746b412629f74bf686a-1" href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html#rest_code_74b3d253e67d4746b412629f74bf686a-1"></a><span class="nb">echo</span><span class="w"> </span>max<span class="w"> </span>&gt;<span class="w"> </span>/sys/block/md0/md/sync_max
</pre></div>
<p>And the reshape should start directly at your maximum speed.</p>
<p>The solution is the same if you are growing any type of RAID level with parity
(RAID5, RAID6, ...).</p>
</section><section id="bonus-speed-up-standard-resync-with-a-write-intent-bitmap"><h2>Bonus: Speed up standard resync with a write-intent bitmap</h2>
<p>Although it won't speed up the growing of your array, this is something that you should do after the rebuild has finished. Write-intent bitmaps is a kind of map of what needs to be resynced. This is of great help in several cases:</p>
<ul class="simple">
<li><p>When the computer crash (power shutdown for instance)</p></li>
<li><p>If a disk is disconnected, then reconnected.</p></li>
</ul>
<p>In these case, it may totally avoid the need of a rebuild which is great in my opinion. Moreover, it does not take any space on the array since it uses space that is not usable by the array.</p>
<p>Here is how to enable it:</p>
<div class="code"><pre class="code bash"><a id="rest_code_8526b4253c4a45d3960fa45d910608e6-1" name="rest_code_8526b4253c4a45d3960fa45d910608e6-1" href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html#rest_code_8526b4253c4a45d3960fa45d910608e6-1"></a>mdadm<span class="w"> </span>--grow<span class="w"> </span>--bitmap<span class="o">=</span>internal<span class="w"> </span>/dev/md0
</pre></div>
<p>However, it may cause some write performance degradation. In my case, I haven't seen any noticeable degradation, but if it is the case, you may want to disable it:</p>
<div class="code"><pre class="code bash"><a id="rest_code_6a255f721a954a2ca00ef87ad4e6f639-1" name="rest_code_6a255f721a954a2ca00ef87ad4e6f639-1" href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html#rest_code_6a255f721a954a2ca00ef87ad4e6f639-1"></a>mdadm<span class="w"> </span>--grow<span class="w"> </span>--bitmap<span class="o">=</span>none<span class="w"> </span>/dev/md0
</pre></div>
</section><section id="bonus-monitor-rebuild-process"><h2>Bonus: Monitor rebuild process</h2>
<p>If you want to monitor the build process, you can use the watch command:</p>
<div class="code"><pre class="code bash"><a id="rest_code_b2eae958a18b491c971689bda4834e9c-1" name="rest_code_b2eae958a18b491c971689bda4834e9c-1" href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html#rest_code_b2eae958a18b491c971689bda4834e9c-1"></a>watch<span class="w"> </span>cat<span class="w"> </span>/proc/mdstat
</pre></div>
<p>With that you'll see the rebuild going in real-time.</p>
<p>You can also monitor the I/O statistics:</p>
<div class="code"><pre class="code bash"><a id="rest_code_4a7d351f466b4182ace7f23050ea2ab8-1" name="rest_code_4a7d351f466b4182ace7f23050ea2ab8-1" href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html#rest_code_4a7d351f466b4182ace7f23050ea2ab8-1"></a>watch<span class="w"> </span>iostat<span class="w"> </span>-k<span class="w"> </span><span class="m">1</span><span class="w"> </span><span class="m">2</span>
</pre></div>
</section><section id="bonus-how-to-grow-a-raid-5-6-array"><h2>Bonus: How to grow a RAID 5-6 array</h2>
<p>As a sidenote, this section indicates how to grow an array. If you  want to add the disk /dev/sdl to the array /dev/md0, you'll first have to add it:</p>
<div class="code"><pre class="code bash"><a id="rest_code_92e28ab35ee24188ac6893506d4aab36-1" name="rest_code_92e28ab35ee24188ac6893506d4aab36-1" href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html#rest_code_92e28ab35ee24188ac6893506d4aab36-1"></a>mdadm<span class="w"> </span>--add<span class="w"> </span>/dev/md0<span class="w"> </span>/dev/sdl
</pre></div>
<p>This will add the disk as a spare disk. If you had 5 disks before, you'll want to grow it to 6:</p>
<div class="code"><pre class="code bash"><a id="rest_code_53509f64aee4414f9e888b340690bc63-1" name="rest_code_53509f64aee4414f9e888b340690bc63-1" href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html#rest_code_53509f64aee4414f9e888b340690bc63-1"></a>mdadm<span class="w"> </span>--grow<span class="w"> </span>--backup-file<span class="o">=</span>/root/grow_md0_backup_file<span class="w"> </span>--raid-devices<span class="o">=</span><span class="m">6</span><span class="w"> </span>/dev/md0
</pre></div>
<p>The backup file must be on another disk of course. The backup file is optional but improves the chance of success if you have a power shutdown or another form of unexpected shutdown. If you know what you're doing, you can grow it without backup-file:</p>
<div class="code"><pre class="code bash"><a id="rest_code_bdc3af54aafe4e81ad00cf8b53538b6e-1" name="rest_code_bdc3af54aafe4e81ad00cf8b53538b6e-1" href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html#rest_code_bdc3af54aafe4e81ad00cf8b53538b6e-1"></a>mdadm<span class="w"> </span>--grow<span class="w"> </span>--raid-devices<span class="o">=</span><span class="m">6</span><span class="w"> </span>/dev/md0
</pre></div>
<p>This command will return almost instantly, but the actual reshape won't likely be finished for hours (maybe days).</p>
<p>Once the rebuild is finished, you'll still have to extend the partitions with resize2fs. If you use LVM on top of the array, you'll have to resize the Physical Volume (PV) first:</p>
<div class="code"><pre class="code bash"><a id="rest_code_2fa1f293601549f8b655ff5633305978-1" name="rest_code_2fa1f293601549f8b655ff5633305978-1" href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html#rest_code_2fa1f293601549f8b655ff5633305978-1"></a>pvresize<span class="w"> </span>/dev/md0
</pre></div>
<p>and then extend the Logical Volume (s) (LV). For instance, if you want to add 1T to a LV named /dev/vgraid/work:</p>
<div class="code"><pre class="code bash"><a id="rest_code_06d58ec6f4fa4035a7aaf85d146e2a59-1" name="rest_code_06d58ec6f4fa4035a7aaf85d146e2a59-1" href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html#rest_code_06d58ec6f4fa4035a7aaf85d146e2a59-1"></a>vgextend<span class="w"> </span>-r<span class="w"> </span>-L+1T<span class="w"> </span>/dev/vgraid/work
</pre></div>
<p>The -r option will automatically resize the underlying filesystem. Otherwise, you'd still have to resize it with resize2fs.</p>
</section><section id="conclusion-5"><h2>Conclusion</h2>
<p>These are the changes I have found that speed up the reshape process. There are others that you may test in your case. For instance, in some systems disabling NCQ on each disk may help.</p>
<p>I hope that these tips will help you doing fast rebuilds in your RAID array :)</p>
</section>
</div>
            
    
    <a href="posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html#disqus_thread" data-disqus-identifier="cache/posts/2015/03/how-to-speed-up-raid-5-6-growing-with-mdadm.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2015/03/named-optional-template-parameters-compile-time.html" class="u-url">Named Optional Template parameters to configure a class at compile-time</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2015-03-01T15:52:41+01:00">2015-03-01 15:52</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>In this post, I'll describe a technique that can be used to configure a class at compile-time when there are multiple, optional parameters, with default values to this class. I used this technique in my dll project to configure each instance of Restricted Boltzmann Machine.</p>
<p>The technique presented here will only work with C++11 because of the need for variadic template. This could be emulated without them by fixing a maximum number of parameters, but I won't go into this in this post.</p>
<section id="the-problem"><h2>The problem</h2>
<p>For this post, we'll take the case of a single class, let's call it configurable. This class has several parameters:</p>
<ul class="simple">
<li><p>A of type int</p></li>
<li><p>B of type char</p></li>
<li><p>C of an enum type</p></li>
<li><p>D of type bool</p></li>
<li><p>E is a type</p></li>
<li><p>F is a template type</p></li>
</ul>
<p>This class could simply be written as such:</p>
<div class="code"><pre class="code c++"><a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-1" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-1"></a><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">type</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-2" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-2"></a><span class="w">    </span><span class="n">AAA</span><span class="p">,</span>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-3" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-3"></a><span class="w">    </span><span class="n">BBB</span><span class="p">,</span>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-4" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-4"></a><span class="w">    </span><span class="n">CCC</span>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-5" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-5"></a><span class="p">};</span>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-6" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-6"></a>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-7" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-7" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-7"></a><span class="k">template</span><span class="o">&lt;</span><span class="kt">int</span><span class="w"> </span><span class="n">T_A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">T_B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sc">'b'</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">T_C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">type</span><span class="o">::</span><span class="n">BBB</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">T_D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T_E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">watcher_1</span><span class="p">,</span><span class="w"> </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="o">&gt;</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">T_F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">trainer_1</span><span class="o">&gt;</span>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-8" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-8" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-8"></a><span class="k">struct</span><span class="w"> </span><span class="nc">configurable_v1</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-9" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-9" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-9"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T_A</span><span class="p">;</span>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-10" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-10" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-10"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T_B</span><span class="p">;</span>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-11" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-11" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-11"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T_C</span><span class="p">;</span>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-12" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-12" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-12"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T_D</span><span class="p">;</span>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-13" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-13" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-13"></a>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-14" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-14" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-14"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T_E</span><span class="p">;</span>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-15" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-15" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-15"></a>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-16" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-16" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-16"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">C</span><span class="o">&gt;</span>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-17" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-17" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-17"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T_F</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="p">;</span>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-18" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-18" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-18"></a>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-19" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-19" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-19"></a><span class="w">    </span><span class="c1">//Something useful</span>
<a id="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-20" name="rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-20" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b4e33271f07e4bb1aa9577d6c04cdd7b-20"></a><span class="p">};</span>
</pre></div>
<p>and used simply as well:</p>
<div class="code"><pre class="code c++"><a id="rest_code_e8a147f3bcb44864955d17d367fd4756-1" name="rest_code_e8a147f3bcb44864955d17d367fd4756-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_e8a147f3bcb44864955d17d367fd4756-1"></a><span class="k">using</span><span class="w"> </span><span class="n">configurable_v1_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">configurable_v1</span><span class="o">&lt;</span><span class="mi">100</span><span class="p">,</span><span class="w"> </span><span class="sc">'z'</span><span class="p">,</span><span class="w"> </span><span class="n">type</span><span class="o">::</span><span class="n">CCC</span><span class="p">,</span><span class="w"> </span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="n">watcher_2</span><span class="p">,</span><span class="w"> </span><span class="n">trainer_2</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
<p>This works well and nothing is wrong with this code. However, if you want all default values but the last one, you have to specify each and every one of the previous template parameters as well. The first disadvantage is that it is verbose and tedious. Secondly, instead of using directly the default values implicitly, you have specified them. This means that if the default values are changed by the library authors or even by you in the configurable_v1 class, either all the usages will be out of sync or you'll have to update them. And again, this is not practical. Moreover, if the author of the configurable_v1 template adds new template parameters before the last, you'll have to update all the instantiation points as well.</p>
<p>Moreover, here we only have 6 parameters, if you have more, the problem becomes even worse.</p>
</section><section id="the-solution"><h2>The solution</h2>
<p>What can we do to improve over these problems ? We are going to use variadic template parameters in the configurable class and use simple classes for each possible parameters. This will be done in the configurable_v2 class. At the end you could use the class as such:</p>
<div class="code"><pre class="code c++"><a id="rest_code_933cf787d3424a139153ae2eea9fd4f1-1" name="rest_code_933cf787d3424a139153ae2eea9fd4f1-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_933cf787d3424a139153ae2eea9fd4f1-1"></a><span class="k">using</span><span class="w"> </span><span class="n">configurable_v2_t1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">configurable_v2</span><span class="o">&lt;</span><span class="n">a</span><span class="o">&lt;</span><span class="mi">100</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">&lt;</span><span class="sc">'z'</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">&lt;</span><span class="n">type</span><span class="o">::</span><span class="n">CCC</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">e</span><span class="o">&lt;</span><span class="n">watcher_2</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">f</span><span class="o">&lt;</span><span class="n">trainer_2</span><span class="o">&gt;&gt;</span><span class="p">;</span>
<a id="rest_code_933cf787d3424a139153ae2eea9fd4f1-2" name="rest_code_933cf787d3424a139153ae2eea9fd4f1-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_933cf787d3424a139153ae2eea9fd4f1-2"></a><span class="k">using</span><span class="w"> </span><span class="n">configurable_v2_t2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">configurable_v2</span><span class="o">&lt;</span><span class="n">f</span><span class="o">&lt;</span><span class="n">trainer_2</span><span class="o">&gt;&gt;</span><span class="p">;</span>
</pre></div>
<p>You can note, that on the second line, we only specified the value for the last parameter without specifiyng any other value :) This is also much more flexible since the order of the parameters has absolutely no impact. Here, for the sake of the example, the parameters are badly named, so it is not very clear what this do, but in practice, you can give better names to the parameters and make the types more clear. Here is an example from my dll library:</p>
<div class="code"><pre class="code c++"><a id="rest_code_30bf00529d004fb19486207057a216f0-1" name="rest_code_30bf00529d004fb19486207057a216f0-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_30bf00529d004fb19486207057a216f0-1"></a><span class="k">using</span><span class="w"> </span><span class="n">rbm_t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dll</span><span class="o">::</span><span class="n">rbm_desc</span><span class="o">&lt;</span>
<a id="rest_code_30bf00529d004fb19486207057a216f0-2" name="rest_code_30bf00529d004fb19486207057a216f0-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_30bf00529d004fb19486207057a216f0-2"></a><span class="w">    </span><span class="mi">28</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">28</span><span class="p">,</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span>
<a id="rest_code_30bf00529d004fb19486207057a216f0-3" name="rest_code_30bf00529d004fb19486207057a216f0-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_30bf00529d004fb19486207057a216f0-3"></a><span class="w">   </span><span class="n">dll</span><span class="o">::</span><span class="n">batch_size</span><span class="o">&lt;</span><span class="mi">25</span><span class="o">&gt;</span><span class="p">,</span>
<a id="rest_code_30bf00529d004fb19486207057a216f0-4" name="rest_code_30bf00529d004fb19486207057a216f0-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_30bf00529d004fb19486207057a216f0-4"></a><span class="w">   </span><span class="n">dll</span><span class="o">::</span><span class="n">momentum</span><span class="p">,</span>
<a id="rest_code_30bf00529d004fb19486207057a216f0-5" name="rest_code_30bf00529d004fb19486207057a216f0-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_30bf00529d004fb19486207057a216f0-5"></a><span class="w">   </span><span class="n">dll</span><span class="o">::</span><span class="n">weight_decay</span><span class="o">&lt;&gt;</span><span class="p">,</span>
<a id="rest_code_30bf00529d004fb19486207057a216f0-6" name="rest_code_30bf00529d004fb19486207057a216f0-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_30bf00529d004fb19486207057a216f0-6"></a><span class="w">   </span><span class="n">dll</span><span class="o">::</span><span class="n">visible</span><span class="o">&lt;</span><span class="n">dll</span><span class="o">::</span><span class="n">unit_type</span><span class="o">::</span><span class="n">GAUSSIAN</span><span class="o">&gt;</span><span class="p">,</span>
<a id="rest_code_30bf00529d004fb19486207057a216f0-7" name="rest_code_30bf00529d004fb19486207057a216f0-7" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_30bf00529d004fb19486207057a216f0-7"></a><span class="w">   </span><span class="n">dll</span><span class="o">::</span><span class="n">shuffle</span><span class="p">,</span>
<a id="rest_code_30bf00529d004fb19486207057a216f0-8" name="rest_code_30bf00529d004fb19486207057a216f0-8" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_30bf00529d004fb19486207057a216f0-8"></a><span class="w">   </span><span class="n">dll</span><span class="o">::</span><span class="n">weight_type</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span>
<a id="rest_code_30bf00529d004fb19486207057a216f0-9" name="rest_code_30bf00529d004fb19486207057a216f0-9" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_30bf00529d004fb19486207057a216f0-9"></a><span class="o">&gt;::</span><span class="n">rbm_t</span><span class="p">;</span>
</pre></div>
<p>rbm_desc is class that is configurable with this technique, expect that the first two parameters are mandatory and not named. I personally thinks that this is quite clear, but of course I may be biased ;)</p>
<p>So let's code!</p>
<p>The class declaration is quite simple:</p>
<div class="code"><pre class="code c++"><a id="rest_code_2da743bb13ad4674b6da519abe7124ca-1" name="rest_code_2da743bb13ad4674b6da519abe7124ca-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_2da743bb13ad4674b6da519abe7124ca-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_2da743bb13ad4674b6da519abe7124ca-2" name="rest_code_2da743bb13ad4674b6da519abe7124ca-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_2da743bb13ad4674b6da519abe7124ca-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">configurable_v2</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_2da743bb13ad4674b6da519abe7124ca-3" name="rest_code_2da743bb13ad4674b6da519abe7124ca-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_2da743bb13ad4674b6da519abe7124ca-3"></a><span class="w">    </span><span class="c1">//Coming</span>
<a id="rest_code_2da743bb13ad4674b6da519abe7124ca-4" name="rest_code_2da743bb13ad4674b6da519abe7124ca-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_2da743bb13ad4674b6da519abe7124ca-4"></a><span class="p">}</span>
</pre></div>
<p>We will now have to exact values and types from Args in order to get the 4 values, the type and the template type out of Args.</p>
</section><section id="extracting-integral-values"><h2>Extracting integral values</h2>
<p>We will start with the parameter <em>a</em> that holds a value of type int with a default value of 1. Here is one way of writing it:</p>
<div class="code"><pre class="code c++"><a id="rest_code_ca4bb568555643b9bdd0715181a5ee34-1" name="rest_code_ca4bb568555643b9bdd0715181a5ee34-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_ca4bb568555643b9bdd0715181a5ee34-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">a_id</span><span class="p">;</span>
<a id="rest_code_ca4bb568555643b9bdd0715181a5ee34-2" name="rest_code_ca4bb568555643b9bdd0715181a5ee34-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_ca4bb568555643b9bdd0715181a5ee34-2"></a>
<a id="rest_code_ca4bb568555643b9bdd0715181a5ee34-3" name="rest_code_ca4bb568555643b9bdd0715181a5ee34-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_ca4bb568555643b9bdd0715181a5ee34-3"></a><span class="k">template</span><span class="o">&lt;</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="o">&gt;</span>
<a id="rest_code_ca4bb568555643b9bdd0715181a5ee34-4" name="rest_code_ca4bb568555643b9bdd0715181a5ee34-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_ca4bb568555643b9bdd0715181a5ee34-4"></a><span class="k">struct</span><span class="w"> </span><span class="nc">a</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_ca4bb568555643b9bdd0715181a5ee34-5" name="rest_code_ca4bb568555643b9bdd0715181a5ee34-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_ca4bb568555643b9bdd0715181a5ee34-5"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">type_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a_id</span><span class="p">;</span>
<a id="rest_code_ca4bb568555643b9bdd0715181a5ee34-6" name="rest_code_ca4bb568555643b9bdd0715181a5ee34-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_ca4bb568555643b9bdd0715181a5ee34-6"></a><span class="p">};</span>
</pre></div>
<p>So, <em>a</em> is simply an integral constant with another typedef <em>type_id</em>. Why do we need this id ? Because a is a type template, we cannot use std::is_same to compare it with other types, since its value is part of the type. If we had only int values, we could easily write a traits that indicates if the type is a specialization of a, but since will have several types, this would be a real pain to do and we would need such a traits for each possible type. Here the simple way to go is to add inner identifiers to each types.</p>
<p>We can now write a struct to extract the int value for a from <em>Args</em>. <em>Args</em> is a list of types in the form parameter_name&lt;parameter_value&gt;... . We have to find a specialization of a inside this list. If such a specialization is present, we'll take its integral constant value as the value for a, otherwise, we'll take the default values. Here is what we want to do:</p>
<div class="code"><pre class="code c++"><a id="rest_code_96efb7d4991647bc9fa1ae09bbb71750-1" name="rest_code_96efb7d4991647bc9fa1ae09bbb71750-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_96efb7d4991647bc9fa1ae09bbb71750-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_96efb7d4991647bc9fa1ae09bbb71750-2" name="rest_code_96efb7d4991647bc9fa1ae09bbb71750-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_96efb7d4991647bc9fa1ae09bbb71750-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">configurable_v2</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_96efb7d4991647bc9fa1ae09bbb71750-3" name="rest_code_96efb7d4991647bc9fa1ae09bbb71750-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_96efb7d4991647bc9fa1ae09bbb71750-3"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_value_int</span><span class="o">&lt;</span><span class="n">a</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_96efb7d4991647bc9fa1ae09bbb71750-4" name="rest_code_96efb7d4991647bc9fa1ae09bbb71750-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_96efb7d4991647bc9fa1ae09bbb71750-4"></a>
<a id="rest_code_96efb7d4991647bc9fa1ae09bbb71750-5" name="rest_code_96efb7d4991647bc9fa1ae09bbb71750-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_96efb7d4991647bc9fa1ae09bbb71750-5"></a><span class="w">    </span><span class="c1">//Coming</span>
<a id="rest_code_96efb7d4991647bc9fa1ae09bbb71750-6" name="rest_code_96efb7d4991647bc9fa1ae09bbb71750-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_96efb7d4991647bc9fa1ae09bbb71750-6"></a><span class="p">}</span>
</pre></div>
<p>We specify directly into the class the default values (1) for a and we use the class <em>get_value_int</em> to get its value from the variadic type list. Here is the implementation:</p>
<div class="code"><pre class="code c++"><a id="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-1" name="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-2" name="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">get_value_int</span><span class="p">;</span>
<a id="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-3" name="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-3"></a>
<a id="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-4" name="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-4"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D</span><span class="o">&gt;</span>
<a id="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-5" name="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-5"></a><span class="k">struct</span><span class="w"> </span><span class="nc">get_value_int</span><span class="o">&lt;</span><span class="n">D</span><span class="o">&gt;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">D</span><span class="o">::</span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
<a id="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-6" name="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-6"></a>
<a id="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-7" name="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-7" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-7"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T2</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-8" name="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-8" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-8"></a><span class="k">struct</span><span class="w"> </span><span class="nc">get_value_int</span><span class="o">&lt;</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">T2</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-9" name="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-9" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-9"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D2</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T22</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">Enable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">void</span><span class="o">&gt;</span>
<a id="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-10" name="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-10" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-10"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">impl</span>
<a id="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-11" name="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-11" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-11"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">get_value_int</span><span class="o">&lt;</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
<a id="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-12" name="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-12" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-12"></a>
<a id="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-13" name="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-13" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-13"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D2</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T22</span><span class="o">&gt;</span>
<a id="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-14" name="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-14" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-14"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">impl</span><span class="w"> </span><span class="o">&lt;</span><span class="n">D2</span><span class="p">,</span><span class="w"> </span><span class="n">T22</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">enable_if_t</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D2</span><span class="o">::</span><span class="n">type_id</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T22</span><span class="o">::</span><span class="n">type_id</span><span class="o">&gt;::</span><span class="n">value</span><span class="o">&gt;&gt;</span>
<a id="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-15" name="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-15" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-15"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">T22</span><span class="o">::</span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
<a id="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-16" name="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-16" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-16"></a>
<a id="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-17" name="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-17" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-17"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">impl</span><span class="o">&lt;</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">T2</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-18" name="rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-18" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_0fe7a0bbe32d42429f45acd2c3f675cc-18"></a><span class="p">};</span>
</pre></div>
<p>If you are not really familiar with Template Metaprogramming (TMP), this may seems very unfamiliar or even barbaric, but I'll try to explain into details what is going on here :)</p>
<p><em>get_value_int</em> is a template that takes a type D, representing the parameter we want to extract and its default, and the list of args. It has a first partial specialization for the case when Args is empty. In which case, its value is simply the value inside D (the default value). The second partial specialization handles the case when there are at least one type (T2) inside the list of args. This separation in two partial specialization is the standard way to works with variadic template parameters. This specialization is more complicated than the first one since it uses an inner class to get the value out of the list. The inner class (impl) takes the parameter type (D2), the type that is present in the list (T22) and a special parameter (Enable) that is used for SFINAE. If you're not familiar with SFINAE (you're probably not reading this article...), it is, put simply, a mean to activate or deactivate a template class or function based on its template parameters. Here, the partial specialization of <em>impl</em> is enabled if <em>T22</em> and <em>D2</em> have the same <em>type_id</em>, in which case, the value of <em>T22</em> is taken as the return of <em>impl</em>. In the basic case, template recursion is used to continue iterating over the list of types. The fact that this has to be done into two template classes is because we cannot add a new template parameter to a partial template specialization even without a name. We cannot either add a simple <em>Enable</em> parameter to get_value_int, we cannot put before Args since then it would be necessary to give it a value in the code that uses it which is not practical neither a good practice.</p>
<p>We can now do the same for b that is of type char. Here is the parameter definition for b:</p>
<div class="code"><pre class="code c++"><a id="rest_code_41a2e0323e7e4300ae1a6abeceee934d-1" name="rest_code_41a2e0323e7e4300ae1a6abeceee934d-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_41a2e0323e7e4300ae1a6abeceee934d-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">a_id</span><span class="p">;</span>
<a id="rest_code_41a2e0323e7e4300ae1a6abeceee934d-2" name="rest_code_41a2e0323e7e4300ae1a6abeceee934d-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_41a2e0323e7e4300ae1a6abeceee934d-2"></a>
<a id="rest_code_41a2e0323e7e4300ae1a6abeceee934d-3" name="rest_code_41a2e0323e7e4300ae1a6abeceee934d-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_41a2e0323e7e4300ae1a6abeceee934d-3"></a><span class="k">template</span><span class="o">&lt;</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="o">&gt;</span>
<a id="rest_code_41a2e0323e7e4300ae1a6abeceee934d-4" name="rest_code_41a2e0323e7e4300ae1a6abeceee934d-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_41a2e0323e7e4300ae1a6abeceee934d-4"></a><span class="k">struct</span><span class="w"> </span><span class="nc">a</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_41a2e0323e7e4300ae1a6abeceee934d-5" name="rest_code_41a2e0323e7e4300ae1a6abeceee934d-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_41a2e0323e7e4300ae1a6abeceee934d-5"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">type_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a_id</span><span class="p">;</span>
<a id="rest_code_41a2e0323e7e4300ae1a6abeceee934d-6" name="rest_code_41a2e0323e7e4300ae1a6abeceee934d-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_41a2e0323e7e4300ae1a6abeceee934d-6"></a><span class="p">};</span>
</pre></div>
<p>This code is highly similar to the code for a, so we can generalize a bit this with a base class:</p>
<div class="code"><pre class="code c++"><a id="rest_code_1ee530682e8749e5a45eb91a5cf7633d-1" name="rest_code_1ee530682e8749e5a45eb91a5cf7633d-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1ee530682e8749e5a45eb91a5cf7633d-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">a_id</span><span class="p">;</span>
<a id="rest_code_1ee530682e8749e5a45eb91a5cf7633d-2" name="rest_code_1ee530682e8749e5a45eb91a5cf7633d-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1ee530682e8749e5a45eb91a5cf7633d-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">b_id</span><span class="p">;</span>
<a id="rest_code_1ee530682e8749e5a45eb91a5cf7633d-3" name="rest_code_1ee530682e8749e5a45eb91a5cf7633d-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1ee530682e8749e5a45eb91a5cf7633d-3"></a>
<a id="rest_code_1ee530682e8749e5a45eb91a5cf7633d-4" name="rest_code_1ee530682e8749e5a45eb91a5cf7633d-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1ee530682e8749e5a45eb91a5cf7633d-4"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">ID</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="n">value</span><span class="o">&gt;</span>
<a id="rest_code_1ee530682e8749e5a45eb91a5cf7633d-5" name="rest_code_1ee530682e8749e5a45eb91a5cf7633d-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1ee530682e8749e5a45eb91a5cf7633d-5"></a><span class="k">struct</span><span class="w"> </span><span class="nc">value_conf_t</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_1ee530682e8749e5a45eb91a5cf7633d-6" name="rest_code_1ee530682e8749e5a45eb91a5cf7633d-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1ee530682e8749e5a45eb91a5cf7633d-6"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">type_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ID</span><span class="p">;</span>
<a id="rest_code_1ee530682e8749e5a45eb91a5cf7633d-7" name="rest_code_1ee530682e8749e5a45eb91a5cf7633d-7" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1ee530682e8749e5a45eb91a5cf7633d-7"></a><span class="p">};</span>
<a id="rest_code_1ee530682e8749e5a45eb91a5cf7633d-8" name="rest_code_1ee530682e8749e5a45eb91a5cf7633d-8" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1ee530682e8749e5a45eb91a5cf7633d-8"></a>
<a id="rest_code_1ee530682e8749e5a45eb91a5cf7633d-9" name="rest_code_1ee530682e8749e5a45eb91a5cf7633d-9" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1ee530682e8749e5a45eb91a5cf7633d-9"></a><span class="k">template</span><span class="o">&lt;</span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="o">&gt;</span>
<a id="rest_code_1ee530682e8749e5a45eb91a5cf7633d-10" name="rest_code_1ee530682e8749e5a45eb91a5cf7633d-10" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1ee530682e8749e5a45eb91a5cf7633d-10"></a><span class="k">struct</span><span class="w"> </span><span class="nc">a</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">value_conf_t</span><span class="o">&lt;</span><span class="n">a_id</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
<a id="rest_code_1ee530682e8749e5a45eb91a5cf7633d-11" name="rest_code_1ee530682e8749e5a45eb91a5cf7633d-11" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1ee530682e8749e5a45eb91a5cf7633d-11"></a>
<a id="rest_code_1ee530682e8749e5a45eb91a5cf7633d-12" name="rest_code_1ee530682e8749e5a45eb91a5cf7633d-12" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1ee530682e8749e5a45eb91a5cf7633d-12"></a><span class="k">template</span><span class="o">&lt;</span><span class="kt">char</span><span class="w"> </span><span class="n">value</span><span class="o">&gt;</span>
<a id="rest_code_1ee530682e8749e5a45eb91a5cf7633d-13" name="rest_code_1ee530682e8749e5a45eb91a5cf7633d-13" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1ee530682e8749e5a45eb91a5cf7633d-13"></a><span class="k">struct</span><span class="w"> </span><span class="nc">b</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">value_conf_t</span><span class="o">&lt;</span><span class="n">b_id</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
</pre></div>
<p>This make the next  parameters easier to describe and avoids small mistakes.</p>
<p>Making <em>get_value_char</em> could be achieved by replacing each <em>int</em> by <em>char</em> but this would create a lot of duplicated code. So instead of writing <em>get_value_char</em>, we will replace <em>get_value_int</em> with a generic <em>get_value</em> that is able to extract any integral value type:</p>
<div class="code"><pre class="code c++"><a id="rest_code_4d176e0a68b14423bf1482ae56066aa4-1" name="rest_code_4d176e0a68b14423bf1482ae56066aa4-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_4d176e0a68b14423bf1482ae56066aa4-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_4d176e0a68b14423bf1482ae56066aa4-2" name="rest_code_4d176e0a68b14423bf1482ae56066aa4-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_4d176e0a68b14423bf1482ae56066aa4-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">get_value</span><span class="p">;</span>
<a id="rest_code_4d176e0a68b14423bf1482ae56066aa4-3" name="rest_code_4d176e0a68b14423bf1482ae56066aa4-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_4d176e0a68b14423bf1482ae56066aa4-3"></a>
<a id="rest_code_4d176e0a68b14423bf1482ae56066aa4-4" name="rest_code_4d176e0a68b14423bf1482ae56066aa4-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_4d176e0a68b14423bf1482ae56066aa4-4"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T2</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_4d176e0a68b14423bf1482ae56066aa4-5" name="rest_code_4d176e0a68b14423bf1482ae56066aa4-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_4d176e0a68b14423bf1482ae56066aa4-5"></a><span class="k">struct</span><span class="w"> </span><span class="nc">get_value</span><span class="o">&lt;</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">T2</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_4d176e0a68b14423bf1482ae56066aa4-6" name="rest_code_4d176e0a68b14423bf1482ae56066aa4-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_4d176e0a68b14423bf1482ae56066aa4-6"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D2</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T22</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">Enable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">void</span><span class="o">&gt;</span>
<a id="rest_code_4d176e0a68b14423bf1482ae56066aa4-7" name="rest_code_4d176e0a68b14423bf1482ae56066aa4-7" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_4d176e0a68b14423bf1482ae56066aa4-7"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">impl</span>
<a id="rest_code_4d176e0a68b14423bf1482ae56066aa4-8" name="rest_code_4d176e0a68b14423bf1482ae56066aa4-8" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_4d176e0a68b14423bf1482ae56066aa4-8"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">D</span><span class="o">::</span><span class="n">value</span><span class="p">),</span><span class="w"> </span><span class="n">get_value</span><span class="o">&lt;</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
<a id="rest_code_4d176e0a68b14423bf1482ae56066aa4-9" name="rest_code_4d176e0a68b14423bf1482ae56066aa4-9" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_4d176e0a68b14423bf1482ae56066aa4-9"></a>
<a id="rest_code_4d176e0a68b14423bf1482ae56066aa4-10" name="rest_code_4d176e0a68b14423bf1482ae56066aa4-10" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_4d176e0a68b14423bf1482ae56066aa4-10"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D2</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T22</span><span class="o">&gt;</span>
<a id="rest_code_4d176e0a68b14423bf1482ae56066aa4-11" name="rest_code_4d176e0a68b14423bf1482ae56066aa4-11" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_4d176e0a68b14423bf1482ae56066aa4-11"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">impl</span><span class="w"> </span><span class="o">&lt;</span><span class="n">D2</span><span class="p">,</span><span class="w"> </span><span class="n">T22</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">enable_if_t</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D2</span><span class="o">::</span><span class="n">type_id</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T22</span><span class="o">::</span><span class="n">type_id</span><span class="o">&gt;::</span><span class="n">value</span><span class="o">&gt;&gt;</span>
<a id="rest_code_4d176e0a68b14423bf1482ae56066aa4-12" name="rest_code_4d176e0a68b14423bf1482ae56066aa4-12" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_4d176e0a68b14423bf1482ae56066aa4-12"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">D</span><span class="o">::</span><span class="n">value</span><span class="p">),</span><span class="w"> </span><span class="n">T22</span><span class="o">::</span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
<a id="rest_code_4d176e0a68b14423bf1482ae56066aa4-13" name="rest_code_4d176e0a68b14423bf1482ae56066aa4-13" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_4d176e0a68b14423bf1482ae56066aa4-13"></a>
<a id="rest_code_4d176e0a68b14423bf1482ae56066aa4-14" name="rest_code_4d176e0a68b14423bf1482ae56066aa4-14" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_4d176e0a68b14423bf1482ae56066aa4-14"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">impl</span><span class="o">&lt;</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">T2</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_4d176e0a68b14423bf1482ae56066aa4-15" name="rest_code_4d176e0a68b14423bf1482ae56066aa4-15" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_4d176e0a68b14423bf1482ae56066aa4-15"></a><span class="p">};</span>
<a id="rest_code_4d176e0a68b14423bf1482ae56066aa4-16" name="rest_code_4d176e0a68b14423bf1482ae56066aa4-16" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_4d176e0a68b14423bf1482ae56066aa4-16"></a>
<a id="rest_code_4d176e0a68b14423bf1482ae56066aa4-17" name="rest_code_4d176e0a68b14423bf1482ae56066aa4-17" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_4d176e0a68b14423bf1482ae56066aa4-17"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D</span><span class="o">&gt;</span>
<a id="rest_code_4d176e0a68b14423bf1482ae56066aa4-18" name="rest_code_4d176e0a68b14423bf1482ae56066aa4-18" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_4d176e0a68b14423bf1482ae56066aa4-18"></a><span class="k">struct</span><span class="w"> </span><span class="nc">get_value</span><span class="o">&lt;</span><span class="n">D</span><span class="o">&gt;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="k">decltype</span><span class="p">(</span><span class="n">D</span><span class="o">::</span><span class="n">value</span><span class="p">),</span><span class="w"> </span><span class="n">D</span><span class="o">::</span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
</pre></div>
<p>This code is almost the same as get_value_int except that the return type is deduced from the value of the parameters. I used <em>decltype</em> and <em>auto</em> to automatically gets the correct types for the values. This is the only thing that changed.</p>
<p>With that we are ready the parameter c as well:</p>
<div class="code"><pre class="code c++"><a id="rest_code_61fb40ac54224bccac08504114747eae-1" name="rest_code_61fb40ac54224bccac08504114747eae-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_61fb40ac54224bccac08504114747eae-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_61fb40ac54224bccac08504114747eae-2" name="rest_code_61fb40ac54224bccac08504114747eae-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_61fb40ac54224bccac08504114747eae-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">configurable_v2</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_61fb40ac54224bccac08504114747eae-3" name="rest_code_61fb40ac54224bccac08504114747eae-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_61fb40ac54224bccac08504114747eae-3"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_value</span><span class="o">&lt;</span><span class="n">a</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_61fb40ac54224bccac08504114747eae-4" name="rest_code_61fb40ac54224bccac08504114747eae-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_61fb40ac54224bccac08504114747eae-4"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_value</span><span class="o">&lt;</span><span class="n">b</span><span class="o">&lt;</span><span class="sc">'b'</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_61fb40ac54224bccac08504114747eae-5" name="rest_code_61fb40ac54224bccac08504114747eae-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_61fb40ac54224bccac08504114747eae-5"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_value</span><span class="o">&lt;</span><span class="n">c</span><span class="o">&lt;</span><span class="n">type</span><span class="o">::</span><span class="n">BBB</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_61fb40ac54224bccac08504114747eae-6" name="rest_code_61fb40ac54224bccac08504114747eae-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_61fb40ac54224bccac08504114747eae-6"></a>
<a id="rest_code_61fb40ac54224bccac08504114747eae-7" name="rest_code_61fb40ac54224bccac08504114747eae-7" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_61fb40ac54224bccac08504114747eae-7"></a><span class="w">    </span><span class="c1">//Coming</span>
<a id="rest_code_61fb40ac54224bccac08504114747eae-8" name="rest_code_61fb40ac54224bccac08504114747eae-8" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_61fb40ac54224bccac08504114747eae-8"></a><span class="p">};</span>
</pre></div>
</section><section id="extracting-boolean-flags"><h2>Extracting boolean flags</h2>
<p>The parameter d is a bit different since it is a boolean flag that puts directly the value to true. We could simply make a integral boolean value (and this would work), but here I needed a boolean flag for activating a feature deactivated by default.</p>
<p>Defining the parameter is easy:</p>
<div class="code"><pre class="code c++"><a id="rest_code_e9d1d40a115d4b79b717f23154f9416a-1" name="rest_code_e9d1d40a115d4b79b717f23154f9416a-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_e9d1d40a115d4b79b717f23154f9416a-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">ID</span><span class="o">&gt;</span>
<a id="rest_code_e9d1d40a115d4b79b717f23154f9416a-2" name="rest_code_e9d1d40a115d4b79b717f23154f9416a-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_e9d1d40a115d4b79b717f23154f9416a-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">basic_conf_t</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_e9d1d40a115d4b79b717f23154f9416a-3" name="rest_code_e9d1d40a115d4b79b717f23154f9416a-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_e9d1d40a115d4b79b717f23154f9416a-3"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">type_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ID</span><span class="p">;</span>
<a id="rest_code_e9d1d40a115d4b79b717f23154f9416a-4" name="rest_code_e9d1d40a115d4b79b717f23154f9416a-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_e9d1d40a115d4b79b717f23154f9416a-4"></a><span class="p">};</span>
<a id="rest_code_e9d1d40a115d4b79b717f23154f9416a-5" name="rest_code_e9d1d40a115d4b79b717f23154f9416a-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_e9d1d40a115d4b79b717f23154f9416a-5"></a>
<a id="rest_code_e9d1d40a115d4b79b717f23154f9416a-6" name="rest_code_e9d1d40a115d4b79b717f23154f9416a-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_e9d1d40a115d4b79b717f23154f9416a-6"></a><span class="k">struct</span><span class="w"> </span><span class="nc">d_id</span><span class="p">;</span>
<a id="rest_code_e9d1d40a115d4b79b717f23154f9416a-7" name="rest_code_e9d1d40a115d4b79b717f23154f9416a-7" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_e9d1d40a115d4b79b717f23154f9416a-7"></a><span class="k">struct</span><span class="w"> </span><span class="nc">d</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">basic_conf_t</span><span class="o">&lt;</span><span class="n">d_id</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
</pre></div>
<p>It is similar to the other parameters, except that it has no value. You'll see later in this article why type_id is necessary here.</p>
<p>To check if the flag is present, we'll write the is_present template:</p>
<div class="code"><pre class="code c++"><a id="rest_code_1bfaedb0e4e049f18e36313b335e87b6-1" name="rest_code_1bfaedb0e4e049f18e36313b335e87b6-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1bfaedb0e4e049f18e36313b335e87b6-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T1</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_1bfaedb0e4e049f18e36313b335e87b6-2" name="rest_code_1bfaedb0e4e049f18e36313b335e87b6-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1bfaedb0e4e049f18e36313b335e87b6-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">is_present</span><span class="p">;</span>
<a id="rest_code_1bfaedb0e4e049f18e36313b335e87b6-3" name="rest_code_1bfaedb0e4e049f18e36313b335e87b6-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1bfaedb0e4e049f18e36313b335e87b6-3"></a>
<a id="rest_code_1bfaedb0e4e049f18e36313b335e87b6-4" name="rest_code_1bfaedb0e4e049f18e36313b335e87b6-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1bfaedb0e4e049f18e36313b335e87b6-4"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T1</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T2</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_1bfaedb0e4e049f18e36313b335e87b6-5" name="rest_code_1bfaedb0e4e049f18e36313b335e87b6-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1bfaedb0e4e049f18e36313b335e87b6-5"></a><span class="k">struct</span><span class="w"> </span><span class="nc">is_present</span><span class="o">&lt;</span><span class="n">T1</span><span class="p">,</span><span class="w"> </span><span class="n">T2</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="n">T1</span><span class="p">,</span><span class="w"> </span><span class="n">T2</span><span class="o">&gt;::</span><span class="n">value</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">is_present</span><span class="o">&lt;</span><span class="n">T1</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
<a id="rest_code_1bfaedb0e4e049f18e36313b335e87b6-6" name="rest_code_1bfaedb0e4e049f18e36313b335e87b6-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1bfaedb0e4e049f18e36313b335e87b6-6"></a>
<a id="rest_code_1bfaedb0e4e049f18e36313b335e87b6-7" name="rest_code_1bfaedb0e4e049f18e36313b335e87b6-7" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1bfaedb0e4e049f18e36313b335e87b6-7"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T1</span><span class="o">&gt;</span>
<a id="rest_code_1bfaedb0e4e049f18e36313b335e87b6-8" name="rest_code_1bfaedb0e4e049f18e36313b335e87b6-8" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_1bfaedb0e4e049f18e36313b335e87b6-8"></a><span class="k">struct</span><span class="w"> </span><span class="nc">is_present</span><span class="o">&lt;</span><span class="n">T1</span><span class="o">&gt;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">false_type</span><span class="w"> </span><span class="p">{};</span>
</pre></div>
<p>This time, the template is much easier. We simply need to iterate through all the types from the variadic template parameter and test if the type is present somewhere. Again, you can see that we used two partial template specialization to handle the different cases.</p>
<p>With this we can now get the value for D:</p>
<div class="code"><pre class="code c++"><a id="rest_code_9a7344c84f184818be32557a736d5080-1" name="rest_code_9a7344c84f184818be32557a736d5080-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_9a7344c84f184818be32557a736d5080-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_9a7344c84f184818be32557a736d5080-2" name="rest_code_9a7344c84f184818be32557a736d5080-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_9a7344c84f184818be32557a736d5080-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">configurable_v2</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_9a7344c84f184818be32557a736d5080-3" name="rest_code_9a7344c84f184818be32557a736d5080-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_9a7344c84f184818be32557a736d5080-3"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_value</span><span class="o">&lt;</span><span class="n">a</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_9a7344c84f184818be32557a736d5080-4" name="rest_code_9a7344c84f184818be32557a736d5080-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_9a7344c84f184818be32557a736d5080-4"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_value</span><span class="o">&lt;</span><span class="n">b</span><span class="o">&lt;</span><span class="sc">'b'</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_9a7344c84f184818be32557a736d5080-5" name="rest_code_9a7344c84f184818be32557a736d5080-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_9a7344c84f184818be32557a736d5080-5"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_value</span><span class="o">&lt;</span><span class="n">c</span><span class="o">&lt;</span><span class="n">type</span><span class="o">::</span><span class="n">BBB</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_9a7344c84f184818be32557a736d5080-6" name="rest_code_9a7344c84f184818be32557a736d5080-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_9a7344c84f184818be32557a736d5080-6"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">is_present</span><span class="o">&lt;</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_9a7344c84f184818be32557a736d5080-7" name="rest_code_9a7344c84f184818be32557a736d5080-7" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_9a7344c84f184818be32557a736d5080-7"></a>
<a id="rest_code_9a7344c84f184818be32557a736d5080-8" name="rest_code_9a7344c84f184818be32557a736d5080-8" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_9a7344c84f184818be32557a736d5080-8"></a><span class="w">    </span><span class="c1">//Coming</span>
<a id="rest_code_9a7344c84f184818be32557a736d5080-9" name="rest_code_9a7344c84f184818be32557a736d5080-9" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_9a7344c84f184818be32557a736d5080-9"></a><span class="p">};</span>
</pre></div>
</section><section id="extracting-types"><h2>Extracting types</h2>
<p>The next parameter does not hold a value, but a type. It won't be an integral constant, but it will define a typedef value with the configured type:</p>
<div class="code"><pre class="code c++"><a id="rest_code_10664b15e4514dd88521d2a56871078a-1" name="rest_code_10664b15e4514dd88521d2a56871078a-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_10664b15e4514dd88521d2a56871078a-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">ID</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="rest_code_10664b15e4514dd88521d2a56871078a-2" name="rest_code_10664b15e4514dd88521d2a56871078a-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_10664b15e4514dd88521d2a56871078a-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">type_conf_t</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_10664b15e4514dd88521d2a56871078a-3" name="rest_code_10664b15e4514dd88521d2a56871078a-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_10664b15e4514dd88521d2a56871078a-3"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">type_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ID</span><span class="p">;</span>
<a id="rest_code_10664b15e4514dd88521d2a56871078a-4" name="rest_code_10664b15e4514dd88521d2a56871078a-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_10664b15e4514dd88521d2a56871078a-4"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="p">;</span>
<a id="rest_code_10664b15e4514dd88521d2a56871078a-5" name="rest_code_10664b15e4514dd88521d2a56871078a-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_10664b15e4514dd88521d2a56871078a-5"></a><span class="p">};</span>
<a id="rest_code_10664b15e4514dd88521d2a56871078a-6" name="rest_code_10664b15e4514dd88521d2a56871078a-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_10664b15e4514dd88521d2a56871078a-6"></a>
<a id="rest_code_10664b15e4514dd88521d2a56871078a-7" name="rest_code_10664b15e4514dd88521d2a56871078a-7" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_10664b15e4514dd88521d2a56871078a-7"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="rest_code_10664b15e4514dd88521d2a56871078a-8" name="rest_code_10664b15e4514dd88521d2a56871078a-8" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_10664b15e4514dd88521d2a56871078a-8"></a><span class="k">struct</span><span class="w"> </span><span class="nc">e</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">type_conf_t</span><span class="o">&lt;</span><span class="n">e_id</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
</pre></div>
<p>You may think that the extracting will be very different, but in fact it very similar. And here it is:</p>
<div class="code"><pre class="code c++"><a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-1" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-2" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">get_type</span><span class="p">;</span>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-3" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-3"></a>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-4" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-4"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T2</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-5" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-5"></a><span class="k">struct</span><span class="w"> </span><span class="nc">get_type</span><span class="o">&lt;</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">T2</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-6" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-6"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D2</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T22</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">Enable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">void</span><span class="o">&gt;</span>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-7" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-7" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-7"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">impl</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-8" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-8" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-8"></a><span class="w">        </span><span class="k">using</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">get_type</span><span class="o">&lt;</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-9" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-9" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-9"></a><span class="w">    </span><span class="p">};</span>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-10" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-10" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-10"></a>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-11" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-11" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-11"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D2</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T22</span><span class="o">&gt;</span>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-12" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-12" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-12"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">impl</span><span class="w"> </span><span class="o">&lt;</span><span class="n">D2</span><span class="p">,</span><span class="w"> </span><span class="n">T22</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">enable_if_t</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D2</span><span class="o">::</span><span class="n">type_id</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T22</span><span class="o">::</span><span class="n">type_id</span><span class="o">&gt;::</span><span class="n">value</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-13" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-13" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-13"></a><span class="w">        </span><span class="k">using</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T22</span><span class="o">::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-14" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-14" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-14"></a><span class="w">    </span><span class="p">};</span>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-15" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-15" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-15"></a>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-16" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-16" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-16"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">impl</span><span class="o">&lt;</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">T2</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-17" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-17" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-17"></a><span class="p">};</span>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-18" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-18" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-18"></a>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-19" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-19" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-19"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D</span><span class="o">&gt;</span>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-20" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-20" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-20"></a><span class="k">struct</span><span class="w"> </span><span class="nc">get_type</span><span class="o">&lt;</span><span class="n">D</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-21" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-21" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-21"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">D</span><span class="o">::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_b57d905ecd204ecba60e0bb8adeae518-22" name="rest_code_b57d905ecd204ecba60e0bb8adeae518-22" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b57d905ecd204ecba60e0bb8adeae518-22"></a><span class="p">};</span>
</pre></div>
<p>Every integral constant has been replaced with alias declaration (with <em>using</em>) and we need to use the <em>typename</em> disambiguator in from of X::value, but that's it :) We could probably have created an integral_type struct to simplify it a bit further, but I don't think that would change a lot. The code of the class follows the same changes:</p>
<div class="code"><pre class="code c++"><a id="rest_code_d847a9e93ee14e06be464e768c2a0c19-1" name="rest_code_d847a9e93ee14e06be464e768c2a0c19-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_d847a9e93ee14e06be464e768c2a0c19-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_d847a9e93ee14e06be464e768c2a0c19-2" name="rest_code_d847a9e93ee14e06be464e768c2a0c19-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_d847a9e93ee14e06be464e768c2a0c19-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">configurable_v2</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_d847a9e93ee14e06be464e768c2a0c19-3" name="rest_code_d847a9e93ee14e06be464e768c2a0c19-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_d847a9e93ee14e06be464e768c2a0c19-3"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_value</span><span class="o">&lt;</span><span class="n">a</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_d847a9e93ee14e06be464e768c2a0c19-4" name="rest_code_d847a9e93ee14e06be464e768c2a0c19-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_d847a9e93ee14e06be464e768c2a0c19-4"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_value</span><span class="o">&lt;</span><span class="n">b</span><span class="o">&lt;</span><span class="sc">'b'</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_d847a9e93ee14e06be464e768c2a0c19-5" name="rest_code_d847a9e93ee14e06be464e768c2a0c19-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_d847a9e93ee14e06be464e768c2a0c19-5"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_value</span><span class="o">&lt;</span><span class="n">c</span><span class="o">&lt;</span><span class="n">type</span><span class="o">::</span><span class="n">BBB</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_d847a9e93ee14e06be464e768c2a0c19-6" name="rest_code_d847a9e93ee14e06be464e768c2a0c19-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_d847a9e93ee14e06be464e768c2a0c19-6"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">is_present</span><span class="o">&lt;</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_d847a9e93ee14e06be464e768c2a0c19-7" name="rest_code_d847a9e93ee14e06be464e768c2a0c19-7" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_d847a9e93ee14e06be464e768c2a0c19-7"></a>
<a id="rest_code_d847a9e93ee14e06be464e768c2a0c19-8" name="rest_code_d847a9e93ee14e06be464e768c2a0c19-8" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_d847a9e93ee14e06be464e768c2a0c19-8"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">get_type</span><span class="o">&lt;</span><span class="n">e</span><span class="o">&lt;</span><span class="n">watcher_1</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_d847a9e93ee14e06be464e768c2a0c19-9" name="rest_code_d847a9e93ee14e06be464e768c2a0c19-9" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_d847a9e93ee14e06be464e768c2a0c19-9"></a>
<a id="rest_code_d847a9e93ee14e06be464e768c2a0c19-10" name="rest_code_d847a9e93ee14e06be464e768c2a0c19-10" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_d847a9e93ee14e06be464e768c2a0c19-10"></a><span class="w">    </span><span class="c1">//Coming</span>
<a id="rest_code_d847a9e93ee14e06be464e768c2a0c19-11" name="rest_code_d847a9e93ee14e06be464e768c2a0c19-11" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_d847a9e93ee14e06be464e768c2a0c19-11"></a><span class="p">};</span>
</pre></div>
</section><section id="extracting-template-types"><h2>Extracting template types</h2>
<p>The last parameter is not a type but a template, so there are some slight changes necessary to extract them. First, let's take a look at the parameter definition:</p>
<div class="code"><pre class="code c++"><a id="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-1" name="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">ID</span><span class="p">,</span><span class="w"> </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="o">&gt;</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-2" name="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">template_type_conf_t</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-3" name="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-3"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">type_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ID</span><span class="p">;</span>
<a id="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-4" name="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-4"></a>
<a id="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-5" name="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-5"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">C</span><span class="o">&gt;</span>
<a id="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-6" name="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-6"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">T</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="p">;</span>
<a id="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-7" name="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-7" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-7"></a><span class="p">};</span>
<a id="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-8" name="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-8" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-8"></a>
<a id="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-9" name="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-9" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-9"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="o">&gt;</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-10" name="rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-10" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_93f10b6f5a8c405c96bdcc3b5ea09582-10"></a><span class="k">struct</span><span class="w"> </span><span class="nc">f</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">template_type_conf_t</span><span class="o">&lt;</span><span class="n">f_id</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
</pre></div>
<p>Here instead of taking a simple type, we take a type template with one template parameter. This design has a great limitations. It won't be possible to use it for template that takes more than one template parameter. You have to create an extract template for each possible combination that you want to handle. In my case, I only had the case of a template with one template parameter, but if you have several combination, you'll have to write more code. It is quite simple code, since the adaptations are minor, but it is still tedious. Here is the <em>get_template_type</em> template:</p>
<div class="code"><pre class="code c++"><a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-1" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-2" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">get_template_type</span><span class="p">;</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-3" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-3"></a>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-4" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-4"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T2</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-5" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-5"></a><span class="k">struct</span><span class="w"> </span><span class="nc">get_template_type</span><span class="o">&lt;</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">T2</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-6" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-6"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D2</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T22</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">Enable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">void</span><span class="o">&gt;</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-7" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-7" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-7"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">impl</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-8" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-8" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-8"></a><span class="w">        </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">C</span><span class="o">&gt;</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-9" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-9" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-9"></a><span class="w">        </span><span class="k">using</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">get_template_type</span><span class="o">&lt;</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="k">template</span><span class="w"> </span><span class="n">value</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="p">;</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-10" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-10" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-10"></a><span class="w">    </span><span class="p">};</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-11" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-11" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-11"></a>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-12" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-12" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-12"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D2</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T22</span><span class="o">&gt;</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-13" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-13" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-13"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">impl</span><span class="w"> </span><span class="o">&lt;</span><span class="n">D2</span><span class="p">,</span><span class="w"> </span><span class="n">T22</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">enable_if_t</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D2</span><span class="o">::</span><span class="n">type_id</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T22</span><span class="o">::</span><span class="n">type_id</span><span class="o">&gt;::</span><span class="n">value</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-14" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-14" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-14"></a><span class="w">        </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">C</span><span class="o">&gt;</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-15" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-15" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-15"></a><span class="w">        </span><span class="k">using</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T22</span><span class="o">::</span><span class="k">template</span><span class="w"> </span><span class="n">value</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="p">;</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-16" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-16" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-16"></a><span class="w">    </span><span class="p">};</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-17" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-17" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-17"></a>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-18" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-18" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-18"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">C</span><span class="o">&gt;</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-19" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-19" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-19"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">impl</span><span class="o">&lt;</span><span class="n">D</span><span class="p">,</span><span class="w"> </span><span class="n">T2</span><span class="o">&gt;::</span><span class="k">template</span><span class="w"> </span><span class="n">value</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="p">;</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-20" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-20" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-20"></a><span class="p">};</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-21" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-21" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-21"></a>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-22" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-22" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-22"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">D</span><span class="o">&gt;</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-23" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-23" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-23"></a><span class="k">struct</span><span class="w"> </span><span class="nc">get_template_type</span><span class="o">&lt;</span><span class="n">D</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-24" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-24" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-24"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">C</span><span class="o">&gt;</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-25" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-25" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-25"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">D</span><span class="o">::</span><span class="k">template</span><span class="w"> </span><span class="n">value</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="p">;</span>
<a id="rest_code_a2716f8087534929addfcc2d5d0acfb7-26" name="rest_code_a2716f8087534929addfcc2d5d0acfb7-26" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_a2716f8087534929addfcc2d5d0acfb7-26"></a><span class="p">};</span>
</pre></div>
<p>Again, there are only few changes. Every previous alias declaration is now a template alias declaration and we have to use <em>template</em> disambiguator in front of value. We now have the final piece to write the configurable_v2 class:</p>
<div class="code"><pre class="code c++"><a id="rest_code_b980d030ea604cbdad844a104876ccbb-1" name="rest_code_b980d030ea604cbdad844a104876ccbb-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b980d030ea604cbdad844a104876ccbb-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_b980d030ea604cbdad844a104876ccbb-2" name="rest_code_b980d030ea604cbdad844a104876ccbb-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b980d030ea604cbdad844a104876ccbb-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">configurable_v2</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_b980d030ea604cbdad844a104876ccbb-3" name="rest_code_b980d030ea604cbdad844a104876ccbb-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b980d030ea604cbdad844a104876ccbb-3"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_value</span><span class="o">&lt;</span><span class="n">a</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_b980d030ea604cbdad844a104876ccbb-4" name="rest_code_b980d030ea604cbdad844a104876ccbb-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b980d030ea604cbdad844a104876ccbb-4"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_value</span><span class="o">&lt;</span><span class="n">b</span><span class="o">&lt;</span><span class="sc">'b'</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_b980d030ea604cbdad844a104876ccbb-5" name="rest_code_b980d030ea604cbdad844a104876ccbb-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b980d030ea604cbdad844a104876ccbb-5"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_value</span><span class="o">&lt;</span><span class="n">c</span><span class="o">&lt;</span><span class="n">type</span><span class="o">::</span><span class="n">BBB</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_b980d030ea604cbdad844a104876ccbb-6" name="rest_code_b980d030ea604cbdad844a104876ccbb-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b980d030ea604cbdad844a104876ccbb-6"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">is_present</span><span class="o">&lt;</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_b980d030ea604cbdad844a104876ccbb-7" name="rest_code_b980d030ea604cbdad844a104876ccbb-7" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b980d030ea604cbdad844a104876ccbb-7"></a>
<a id="rest_code_b980d030ea604cbdad844a104876ccbb-8" name="rest_code_b980d030ea604cbdad844a104876ccbb-8" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b980d030ea604cbdad844a104876ccbb-8"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">get_type</span><span class="o">&lt;</span><span class="n">e</span><span class="o">&lt;</span><span class="n">watcher_1</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_b980d030ea604cbdad844a104876ccbb-9" name="rest_code_b980d030ea604cbdad844a104876ccbb-9" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b980d030ea604cbdad844a104876ccbb-9"></a>
<a id="rest_code_b980d030ea604cbdad844a104876ccbb-10" name="rest_code_b980d030ea604cbdad844a104876ccbb-10" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b980d030ea604cbdad844a104876ccbb-10"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">C</span><span class="o">&gt;</span>
<a id="rest_code_b980d030ea604cbdad844a104876ccbb-11" name="rest_code_b980d030ea604cbdad844a104876ccbb-11" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b980d030ea604cbdad844a104876ccbb-11"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">get_template_type</span><span class="o">&lt;</span><span class="n">f</span><span class="o">&lt;</span><span class="n">trainer_1</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="k">template</span><span class="w"> </span><span class="n">value</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="p">;</span>
<a id="rest_code_b980d030ea604cbdad844a104876ccbb-12" name="rest_code_b980d030ea604cbdad844a104876ccbb-12" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_b980d030ea604cbdad844a104876ccbb-12"></a><span class="p">};</span>
</pre></div>
</section><section id="validating-parameter-rules"><h2>Validating parameter rules</h2>
<p>If you have more parameters and several classes that are configured in this manner, the user may use a wrong parameter in the list. In that case, nothing will happen, the parameter will simply be ignored. Sometimes, this behavior is acceptable, but sometimes it is better to make the code invalid. That's what we are going to do here by specifying a list of valid parameters and using static_assert to ensure this condition.</p>
<p>Here is the assertion:</p>
<div class="code"><pre class="code c++"><a id="rest_code_82d3d3af815f49b68aa6ed80b82b7733-1" name="rest_code_82d3d3af815f49b68aa6ed80b82b7733-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_82d3d3af815f49b68aa6ed80b82b7733-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_82d3d3af815f49b68aa6ed80b82b7733-2" name="rest_code_82d3d3af815f49b68aa6ed80b82b7733-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_82d3d3af815f49b68aa6ed80b82b7733-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">configurable_v2</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_82d3d3af815f49b68aa6ed80b82b7733-3" name="rest_code_82d3d3af815f49b68aa6ed80b82b7733-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_82d3d3af815f49b68aa6ed80b82b7733-3"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_value</span><span class="o">&lt;</span><span class="n">a</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_82d3d3af815f49b68aa6ed80b82b7733-4" name="rest_code_82d3d3af815f49b68aa6ed80b82b7733-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_82d3d3af815f49b68aa6ed80b82b7733-4"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">B</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_value</span><span class="o">&lt;</span><span class="n">b</span><span class="o">&lt;</span><span class="sc">'b'</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_82d3d3af815f49b68aa6ed80b82b7733-5" name="rest_code_82d3d3af815f49b68aa6ed80b82b7733-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_82d3d3af815f49b68aa6ed80b82b7733-5"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">get_value</span><span class="o">&lt;</span><span class="n">c</span><span class="o">&lt;</span><span class="n">type</span><span class="o">::</span><span class="n">BBB</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_82d3d3af815f49b68aa6ed80b82b7733-6" name="rest_code_82d3d3af815f49b68aa6ed80b82b7733-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_82d3d3af815f49b68aa6ed80b82b7733-6"></a><span class="w">    </span><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">D</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">is_present</span><span class="o">&lt;</span><span class="n">d</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_82d3d3af815f49b68aa6ed80b82b7733-7" name="rest_code_82d3d3af815f49b68aa6ed80b82b7733-7" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_82d3d3af815f49b68aa6ed80b82b7733-7"></a>
<a id="rest_code_82d3d3af815f49b68aa6ed80b82b7733-8" name="rest_code_82d3d3af815f49b68aa6ed80b82b7733-8" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_82d3d3af815f49b68aa6ed80b82b7733-8"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">E</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">get_type</span><span class="o">&lt;</span><span class="n">e</span><span class="o">&lt;</span><span class="n">watcher_1</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
<a id="rest_code_82d3d3af815f49b68aa6ed80b82b7733-9" name="rest_code_82d3d3af815f49b68aa6ed80b82b7733-9" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_82d3d3af815f49b68aa6ed80b82b7733-9"></a>
<a id="rest_code_82d3d3af815f49b68aa6ed80b82b7733-10" name="rest_code_82d3d3af815f49b68aa6ed80b82b7733-10" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_82d3d3af815f49b68aa6ed80b82b7733-10"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">C</span><span class="o">&gt;</span>
<a id="rest_code_82d3d3af815f49b68aa6ed80b82b7733-11" name="rest_code_82d3d3af815f49b68aa6ed80b82b7733-11" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_82d3d3af815f49b68aa6ed80b82b7733-11"></a><span class="w">    </span><span class="k">using</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">get_template_type</span><span class="o">&lt;</span><span class="n">f</span><span class="o">&lt;</span><span class="n">trainer_1</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="k">template</span><span class="w"> </span><span class="n">value</span><span class="o">&lt;</span><span class="n">C</span><span class="o">&gt;</span><span class="p">;</span>
<a id="rest_code_82d3d3af815f49b68aa6ed80b82b7733-12" name="rest_code_82d3d3af815f49b68aa6ed80b82b7733-12" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_82d3d3af815f49b68aa6ed80b82b7733-12"></a>
<a id="rest_code_82d3d3af815f49b68aa6ed80b82b7733-13" name="rest_code_82d3d3af815f49b68aa6ed80b82b7733-13" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_82d3d3af815f49b68aa6ed80b82b7733-13"></a><span class="w">    </span><span class="k">static_assert</span><span class="p">(</span>
<a id="rest_code_82d3d3af815f49b68aa6ed80b82b7733-14" name="rest_code_82d3d3af815f49b68aa6ed80b82b7733-14" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_82d3d3af815f49b68aa6ed80b82b7733-14"></a><span class="w">        </span><span class="n">is_valid</span><span class="o">&lt;</span><span class="n">tmp_list</span><span class="o">&lt;</span><span class="n">a_id</span><span class="p">,</span><span class="w"> </span><span class="n">b_id</span><span class="p">,</span><span class="w"> </span><span class="n">c_id</span><span class="p">,</span><span class="w"> </span><span class="n">d_id</span><span class="p">,</span><span class="w"> </span><span class="n">e_id</span><span class="p">,</span><span class="w"> </span><span class="n">f_id</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span>
<a id="rest_code_82d3d3af815f49b68aa6ed80b82b7733-15" name="rest_code_82d3d3af815f49b68aa6ed80b82b7733-15" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_82d3d3af815f49b68aa6ed80b82b7733-15"></a><span class="w">        </span><span class="s">"Invalid parameters type"</span><span class="p">);</span>
<a id="rest_code_82d3d3af815f49b68aa6ed80b82b7733-16" name="rest_code_82d3d3af815f49b68aa6ed80b82b7733-16" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_82d3d3af815f49b68aa6ed80b82b7733-16"></a>
<a id="rest_code_82d3d3af815f49b68aa6ed80b82b7733-17" name="rest_code_82d3d3af815f49b68aa6ed80b82b7733-17" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_82d3d3af815f49b68aa6ed80b82b7733-17"></a><span class="w">    </span><span class="c1">//Something useful</span>
<a id="rest_code_82d3d3af815f49b68aa6ed80b82b7733-18" name="rest_code_82d3d3af815f49b68aa6ed80b82b7733-18" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_82d3d3af815f49b68aa6ed80b82b7733-18"></a><span class="p">};</span>
</pre></div>
<p>Since the is_valid traits needs two variadic list of parameters, we have to encapsulate list of valid types in another structure (<em>tmp_list</em>) to separate the two sets. Here is the implementation of the validation:</p>
<div class="code"><pre class="code c++"><a id="rest_code_abd74351cc3342feb8c9f7a05b26be92-1" name="rest_code_abd74351cc3342feb8c9f7a05b26be92-1" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_abd74351cc3342feb8c9f7a05b26be92-1"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Valid</span><span class="o">&gt;</span>
<a id="rest_code_abd74351cc3342feb8c9f7a05b26be92-2" name="rest_code_abd74351cc3342feb8c9f7a05b26be92-2" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_abd74351cc3342feb8c9f7a05b26be92-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">tmp_list</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_abd74351cc3342feb8c9f7a05b26be92-3" name="rest_code_abd74351cc3342feb8c9f7a05b26be92-3" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_abd74351cc3342feb8c9f7a05b26be92-3"></a><span class="w">    </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="rest_code_abd74351cc3342feb8c9f7a05b26be92-4" name="rest_code_abd74351cc3342feb8c9f7a05b26be92-4" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_abd74351cc3342feb8c9f7a05b26be92-4"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">contains</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">is_present</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">::</span><span class="n">type_id</span><span class="p">,</span><span class="w"> </span><span class="n">Valid</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
<a id="rest_code_abd74351cc3342feb8c9f7a05b26be92-5" name="rest_code_abd74351cc3342feb8c9f7a05b26be92-5" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_abd74351cc3342feb8c9f7a05b26be92-5"></a><span class="p">};</span>
<a id="rest_code_abd74351cc3342feb8c9f7a05b26be92-6" name="rest_code_abd74351cc3342feb8c9f7a05b26be92-6" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_abd74351cc3342feb8c9f7a05b26be92-6"></a>
<a id="rest_code_abd74351cc3342feb8c9f7a05b26be92-7" name="rest_code_abd74351cc3342feb8c9f7a05b26be92-7" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_abd74351cc3342feb8c9f7a05b26be92-7"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">L</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_abd74351cc3342feb8c9f7a05b26be92-8" name="rest_code_abd74351cc3342feb8c9f7a05b26be92-8" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_abd74351cc3342feb8c9f7a05b26be92-8"></a><span class="k">struct</span><span class="w"> </span><span class="nc">is_valid</span><span class="p">;</span>
<a id="rest_code_abd74351cc3342feb8c9f7a05b26be92-9" name="rest_code_abd74351cc3342feb8c9f7a05b26be92-9" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_abd74351cc3342feb8c9f7a05b26be92-9"></a>
<a id="rest_code_abd74351cc3342feb8c9f7a05b26be92-10" name="rest_code_abd74351cc3342feb8c9f7a05b26be92-10" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_abd74351cc3342feb8c9f7a05b26be92-10"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">L</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">T1</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">Args</span><span class="o">&gt;</span>
<a id="rest_code_abd74351cc3342feb8c9f7a05b26be92-11" name="rest_code_abd74351cc3342feb8c9f7a05b26be92-11" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_abd74351cc3342feb8c9f7a05b26be92-11"></a><span class="k">struct</span><span class="w"> </span><span class="nc">is_valid</span><span class="w"> </span><span class="o">&lt;</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">T1</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">,</span><span class="w"> </span><span class="n">L</span><span class="o">::</span><span class="k">template</span><span class="w"> </span><span class="n">contains</span><span class="o">&lt;</span><span class="n">T1</span><span class="o">&gt;::</span><span class="n">value</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">is_valid</span><span class="o">&lt;</span><span class="n">L</span><span class="p">,</span><span class="w"> </span><span class="n">Args</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
<a id="rest_code_abd74351cc3342feb8c9f7a05b26be92-12" name="rest_code_abd74351cc3342feb8c9f7a05b26be92-12" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_abd74351cc3342feb8c9f7a05b26be92-12"></a>
<a id="rest_code_abd74351cc3342feb8c9f7a05b26be92-13" name="rest_code_abd74351cc3342feb8c9f7a05b26be92-13" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_abd74351cc3342feb8c9f7a05b26be92-13"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">L</span><span class="o">&gt;</span>
<a id="rest_code_abd74351cc3342feb8c9f7a05b26be92-14" name="rest_code_abd74351cc3342feb8c9f7a05b26be92-14" href="posts/2015/03/named-optional-template-parameters-compile-time.html#rest_code_abd74351cc3342feb8c9f7a05b26be92-14"></a><span class="k">struct</span><span class="w"> </span><span class="nc">is_valid</span><span class="w"> </span><span class="o">&lt;</span><span class="n">L</span><span class="o">&gt;</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">true_type</span><span class="w"> </span><span class="p">{};</span>
</pre></div>
<p>The struct tmp_list has a single inner class (<em>contains</em>) that test if a given type is present in the list. For this, we reuse the is_present template that we created when extracting boolean flag. The <em>is_valid</em> template simply test that each parameter is present in the <em>tmp_list</em>.</p>
<p>Validation could also be made so that no parameters could be present twice, but I will put that aside for now.</p>
</section><section id="conclusion-4"><h2>Conclusion</h2>
<p>Here it is :)</p>
<p>We now have a set of template that allow us to configure a class at compile-time with named, optional, template parameters, with default and in any order. I personally thinks that this is a great way to configure a class at compile-time and it is also another proof of the power of C++. If you think that the code is complicated, don't forget that this is only the library code, the client code on contrary is at least as clear as the original version and even has several advantages.</p>
<p>I hope that this article interested you and that you learned something.</p>
<p>The code of this article is available on Github: <a class="reference external" href="https://github.com/wichtounet/articles/blob/master/src/named_template_par/configurable.cpp">https://github.com/wichtounet/articles/blob/master/src/named_template_par/configurable.cpp</a>
It has been tested on Clang 3.5 and GCC 4.9.1.</p>
</section>
</div>
            
    
    <a href="posts/2015/03/named-optional-template-parameters-compile-time.html#disqus_thread" data-disqus-identifier="cache/posts/2015/03/named-optional-template-parameters-to-configure-a-class-at-compile-time.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2014/10/sonarqube-inspections-for-cpp-projects.html" class="u-url">SonarQube inspections for C++ projects</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2014-10-05T14:55:46+02:00">2014-10-05 14:55</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>Back in the days, when I used to develop in Java (I hadn't discovered the
wonders of C++ :) ), I used Sonar a lot for my projects. Sonar is a great tool
for quality inspections of a project. Sonar has been made for Java and is mostly
free and opensource (some plugins are commercial) to inspect Java projects.
Unfortunately, this is not the case for C++ inspection. Indeed, the C++ plugin
cost 7000 euros (more than 8500$). As I mostly work on C++ for opensource and
school projects, I'm definitely not able to buy it. I wanted for a long time to
test the commercial C++ plugin. For this article, sonarsource provided me with a
short (very short) time license for the C++ plugin.</p>
<p>There is also another option for C++ which is the C++ community plugin:
<a class="reference external" href="https://github.com/wenns/sonar-cxx">https://github.com/wenns/sonar-cxx</a>. I have tested it some time ago, but I was
not satisfied with it, I had several errors and had to use a dev version to make
it work a bit. Moreover, the C++11 support is inexistant and management of
parsing error is not really satisfying. But maybe it is good for you. This
article will only focus on the commercial plugin.</p>
<section id="usage"><h2>Usage</h2>
<p>For each project that you want to analyze with Sonar, you have to create a
sonar-project.properties files describing some basic information about your
project.</p>
<p>Then, there are two ways to inspect a C++ project. The first one and recommended
one is to use the <em>build-wrapper</em> executable. It is a sub project that you have
to download and install alongside Sonar. It works by wrapping the commands to
your build systems:</p>
<pre class="literal-block">build-wrapper make all</pre>
<p>and this should generate enough informations for not having to fill each field
in the project configuration. The, you have to use the <em>sonar-runner</em> program to
upload to Sonar.</p>
<p>I tried it on several projects and there seems to be a problem with the
includes. It didn't include the header files in the Sonar inspections.</p>
<p>I finally ended up using manual configuration of the Sonar project and the
header files were included correctly. However, you normally have to include many
information in the configuration including all macros for instance. For now, I
haven't bothered generating them and it doesn't seem to impact too much the
results.</p>
<p>When I look in the log, it seems that there are still a lot of parsing errors.
They seem mostly related to some compiler macro, especially the __has_feature__
macro of clang. This is the same problem with the build-wrapper. When I don't
use the build-wrapper I also have other problems with macros for unit testing.</p>
<p>I also have other errors coming during the inspection, for instance:</p>
<pre class="literal-block">error directive: This file requires compiler and library support for the ISO C++
2011 standard. This support is currently experimental, and must be enabled with
the -std=c++11 or -std=gnu++11 compiler options</pre>
<p>I think it comes from the fact that I compile with std=c++1y and that Sonar
does not support C++14.</p>
</section><section id="inspections"><h2>Inspections</h2>
<p>Here is the results of inspection on my ETL project:</p>
<img alt="/images/etl_dashboard.png" src="images/etl_dashboard.png"><p>I really like the web interface of Sonar, it really sums well all the
information and the various plugins play quite nice with each other. Moreover,
when you check issues, you can see directly the source code very clearly. I
really think this is the strong point of Sonar.</p>
<p>Here is the Hotspots view for instance:</p>
<img alt="/images/etl_dashboard.png" src="images/etl_dashboard.png"><p>Or the Time Machine view:</p>
<img alt="/images/etl_dashboard.png" src="images/etl_dashboard.png"><p>The issues that are reported by Sonar are quite good. On this project there is a
lot of them related to naming conventions because I don't follow the conventions
configured by default. However, you can easily configure the inspections to give
your own naming regex or simple enable/disable some inspections.</p>
<p>There are some good inspections:</p>
<ul class="simple">
<li><p>Some missing explicit keyword</p></li>
<li><p>Some commented block of code that can be removed</p></li>
<li><p>An if-elseif construct that should have had a else</p></li>
<li><p>Files with too high complexity</p></li>
</ul>
<p>However, there are also some important false positives. For instance:</p>
<img alt="/images/etl_false_positive_1.png" src="images/etl_false_positive_1.png"><p>In here, there are no reasons to output this issue since the operator is
deleted. It proves that the C++11 support is rather incomplete. I have other
false positives of the same kind for <em>= default</em> operators and constructors.
Here is another example:</p>
<img alt="/images/etl_false_positive_2.png" src="images/etl_false_positive_2.png"><p>In this case, the varadic template support is mixed with the old ellipsis
notation, making it again a lack of C++11 support. There are also other false
positives for instance because of lambdas, but all of them were related to
C++11.</p>
</section><section id="various"><h2>Various</h2>
<p>If you don't think you have enough quality rules, you can also include the one
from cppcheck simply by givin the path to cppcheck in sonar-project.properties.
I think this is great, since it works all by itself. You can also create your
own rule, but you'll have to use XPath for path.</p>
<p>If you want, you can also include unit test reports inside Sonar. I haven't
tested this support since they only support cppunit test reports and I use only
Catch for my unit tests. It would have been great if JUnit format would have
been supported since many tool support it.</p>
<p>The last option that is supported by this plugin is the support of GCOV reports
for code coverage information. I haven't been able to make it work, I had errors
indicating that the source files were not found. I didn't figure this out. It
may come from the fact that I used llvm and clang to generate the GCOV reports
and not G++.</p>
</section><section id="conclusion-3"><h2>Conclusion</h2>
<p>First, here are some pros and cons for the C++ support in SonarQube.</p>
<p><strong>Pros</strong></p>
<ul class="simple">
<li><p>Good default inspections</p></li>
<li><p>Great web interface.</p></li>
<li><p>cppcheck very well integrated</p></li>
<li><p>Issues are easily configurable</p></li>
</ul>
<p><strong>Cons</strong></p>
<ul class="simple">
<li><p>C++11 support is incomplete and no C++14 support</p></li>
<li><p>build-wrapper support seems instable. It should be integrated directly into
sonar.</p></li>
<li><p>Unit tests support is limited to cppunit</p></li>
<li><p>Haven't been able to make Code Coverage work</p></li>
<li><p>Macro support not flexible enough</p></li>
<li><p>Too expensive</p></li>
<li><p>Quite complicated</p></li>
<li><p>No support for other static analyzer than cppcheck</p></li>
</ul>
<p>The general web interface feeling is quite good, everything looks great and the
report are really useful. However, the usage of the tool does not feel very
professional. I had a lot more problems than I expected to use it. I was also
really disappointed by the C++11. The syntax seems to be supported but not the
language feature in the inspections, making the C++11 support completely
useless. This is weird since they cite C+11 as supported. Moreover, there not
yet any C++14 support, but this is less dramatic. It is also a bit sad that they
limit the import to cppcheck and no other static analyzers and the same stands
for cppunit.</p>
<p>In my opinion, it is really an inferior product compared to the Java support.
I was expecting more from a 8500 dollars product.</p>
<p>For now, I won't probably use it anymore on my projects since all of them use at
least C++11, but I will probably retry Sonar for C++ in the future hoping that
it will become as the Sonar Java support.</p>
</section>
</div>
            
    
    <a href="posts/2014/10/sonarqube-inspections-for-cpp-projects.html#disqus_thread" data-disqus-identifier="cache/posts/2014/10/sonarqube-inspections-for-cpp-projects.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2014/10/linux-tip-force-systemd-networkd-to-wait-for-dhcp.html" class="u-url">Linux tip: Force systemd networkd to wait for DHCP</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2014-10-01T20:18:55+02:00">2014-10-01 20:18</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>Recently, I started using systemd-networkd to manage my network. It works really
good for static address configuration, but I experienced some problem with DHCP.
There is DHCP client support integrated into systemd, so I wanted to use this
instead of using another DHCP client.</p>
<p>(If you are not familiar with systemd-networkd, you can have a look at the last
section of this article)</p>
<p>The problem with that is that services are not waiting for DHCP leases to be
obtained. Most services (sshd for instance), are waiting for network.target,
however, network.target does not wait for the DHCP lease to be obtained from the
server. If you configured ssh on a specific IP and this IP is obtained with
DHCP, it will fail at startup. The same is true for NFS mounts for instance.</p>
<section id="force-services-to-wait-for-the-network-to-be-configured"><h2>Force services to wait for the network to be configured</h2>
<p>The solution is to make services like sshd waits for network-online.target
instead of network.target. There is a simple way in systemd to override default
service files. For a X.service, systemd will also parse all the
/etc/systemd/X.service.d/*.conf files.</p>
<p>For instance, to make sshd be started only after DHCP is finished</p>
<p>/etc/systemd/system/sshd.service.d/network.conf:</p>
<pre class="literal-block">[Unit]
Wants=network-online.target
After=network-online.target</pre>
<p>However, by default, network-online.target does not wait for anything. You'll
have to enable another service to make it work:</p>
<pre class="literal-block">systemctl enable systemd-networkd-wait-online</pre>
<p>And another note, at least on Gentoo, I had to use systemd-216 for it to work:</p>
<pre class="literal-block">emerge -a "=sys-apps/systemd-216"</pre>
<p>And after this, it worked like a charm at startup.</p>
</section><section id="force-nfs-mounts-to-wait-for-the-network"><h2>Force NFS mounts to wait for the network</h2>
<p>There is no service file for nfs mounts, but there is a target remote-fs.target
that groups the remote file systems mounts. You can override its configuration
in the same as a service:</p>
<p>/etc/systemd/system/remote-fs.target.d/network.conf:</p>
<pre class="literal-block">[Unit]
Wants=network-online.target
After=network-online.target</pre>
</section><section id="conclusion-2"><h2>Conclusion</h2>
<p>Here we are, I hope this tip will be useful to some of you ;)</p>
</section><section id="appendix-configure-interface-with-dhcp-with-systemd"><h2>Appendix. Configure interface with DHCP with systemd</h2>
<p>To configure an interface with DHCP, you have to create a .network file in
/etc/systemd/network/. For instance, here is my
/etc/systemd/network/local.network file:</p>
<div class="code"><pre class="code text"><a id="rest_code_fa28a670a7f44aa2b93f1d362fc76854-1" name="rest_code_fa28a670a7f44aa2b93f1d362fc76854-1" href="posts/2014/10/linux-tip-force-systemd-networkd-to-wait-for-dhcp.html#rest_code_fa28a670a7f44aa2b93f1d362fc76854-1"></a>[Match]
<a id="rest_code_fa28a670a7f44aa2b93f1d362fc76854-2" name="rest_code_fa28a670a7f44aa2b93f1d362fc76854-2" href="posts/2014/10/linux-tip-force-systemd-networkd-to-wait-for-dhcp.html#rest_code_fa28a670a7f44aa2b93f1d362fc76854-2"></a>Name=enp3s0
<a id="rest_code_fa28a670a7f44aa2b93f1d362fc76854-3" name="rest_code_fa28a670a7f44aa2b93f1d362fc76854-3" href="posts/2014/10/linux-tip-force-systemd-networkd-to-wait-for-dhcp.html#rest_code_fa28a670a7f44aa2b93f1d362fc76854-3"></a>
<a id="rest_code_fa28a670a7f44aa2b93f1d362fc76854-4" name="rest_code_fa28a670a7f44aa2b93f1d362fc76854-4" href="posts/2014/10/linux-tip-force-systemd-networkd-to-wait-for-dhcp.html#rest_code_fa28a670a7f44aa2b93f1d362fc76854-4"></a>[Network]
<a id="rest_code_fa28a670a7f44aa2b93f1d362fc76854-5" name="rest_code_fa28a670a7f44aa2b93f1d362fc76854-5" href="posts/2014/10/linux-tip-force-systemd-networkd-to-wait-for-dhcp.html#rest_code_fa28a670a7f44aa2b93f1d362fc76854-5"></a>DHCP=v4
</pre></div>
<p>and you have to enable systemd-networkd:</p>
<pre class="literal-block">systemctl enable systemd-networkd</pre>
</section>
</div>
            
    
    <a href="posts/2014/10/linux-tip-force-systemd-networkd-to-wait-for-dhcp.html#disqus_thread" data-disqus-identifier="cache/posts/2014/10/linux-tip-force-systemd-networkd-to-wait-for-dhcp.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2014/09/budgetwarrior-041-expense-templates-and-year-projection.html" class="u-url">budgetwarrior 0.4.1 - Expense templates and year projection</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2014-09-21T20:53:53+02:00">2014-09-21 20:53</time></small>
</h1>
        <hr>
<div class="p-summary">
        <p>I've been able to finish the version 0.4.1 of budgetwarrior before I though :)</p>
<section id="expense-templates"><h2>Expense templates</h2>
<p>The "most useful" new feature of this release is the ability to create template
for expenses.</p>
<p>For that, you can give an extra parameter to budget expense add:</p>
<pre class="literal-block">budget expense add template name</pre>
<p>This will works exactly the same as creating a new expense expect that it will
be saved as a template. Then, the next time you do:</p>
<pre class="literal-block">budget expense add template name</pre>
<p>A new expense will be created with the date of the day and with the name and
amount saved into the template. You can create as many templates as you want as
long as they have different names. You can see all the templates you have by
using 'budget expense template'. A template can be deleted the exact same as an
expense with 'budget expense delete id'.</p>
<p>I think this is very useful for expense that are made several times a month, for
instance a coffee at your workplace. The price should not change a lot and it is
faster to just use the template name rather than entering all the information
again.</p>
</section><section id="year-prediction"><h2>Year prediction</h2>
<p>You can now see what would be next year if you changed a bit your expenses. For
instance, how much would you still have at the end of the year if you increased
your house expenses by 20% and reduced your insurances by 5% ?</p>
<p>The 'budget predict' can be used for that purpose. You can enter a multiplier
for each account in your budget and a new year will be "predicted" based on
the expenses of the current year multiplied by the specified multiplier:</p>
<img alt="/images/budget_041_prediction.png" src="images/budget_041_prediction.png"><p>I think that this feature can be very useful if you want to estimate how your
budget will be for moving to a more expensive house or another insurance for
instance.</p>
</section><section id="various-changes"><h2>Various changes</h2>
<p>Two accounts can be merged together with the 'budget account migrate' command.
This command will move all expenses from an account to another and adapt the
amount of the target account. The source account will be deleted. This supports
migrated accounts.</p>
<p>The 'budget wish list' command will now display the mean accuracy of your
predictions.</p>
<p>You don't need Boost anymore for this project. The only remaining dependency is
libuuid. I will perhaps remove it in the next version since the UUID are not
used in the application for now.</p>
<p>The command 'budget gc' will clean the IDs of all your data in order to fill the
holes and make all the IDs contiguous. It is mostly a feature for order-freaks
like me who do not like to have holes in a sequence of identifiers ;)</p>
<p>There was a bug in the monthly report causing the scale to be displayed
completely moved, it is now fixed:</p>
<img alt="https://raw.githubusercontent.com/wichtounet/budgetwarrior/develop/screenshots/budget_report.png" src="https://raw.githubusercontent.com/wichtounet/budgetwarrior/develop/screenshots/budget_report.png"></section><section id="installation"><h2>Installation</h2>
<p>If you are on Gentoo, you can install it using layman:</p>
<pre class="literal-block">layman -a wichtounet
emerge -a budgetwarrior</pre>
<p>If you are on Arch Linux, you can use this <a class="reference external" href="https://github.com/StreakyCobra/aur">AUR repository</a>.</p>
<p>For other systems, you'll have to install from sources:</p>
<pre class="literal-block">git clone git://github.com/wichtounet/budgetwarrior.git
cd budgetwarrior
make
sudo make install</pre>
</section><section id="conclusion"><h2>Conclusion</h2>
<p>If you are interested by the sources, you can download them on Github:
<a class="reference external" href="https://github.com/wichtounet/budgetwarrior">budgetwarrior</a>.</p>
<p>If you have a suggestion for a new features or you found a bug, please post an
issue on Github, I'd be glad to help you.</p>
<p>If you have any comment, don't hesitate to contact me, either by letting a
comment on this post or by email.</p>
</section>
</div>
            
    
    <a href="posts/2014/09/budgetwarrior-041-expense-templates-and-year-projection.html#disqus_thread" data-disqus-identifier="cache/posts/2014/09/budgetwarrior-041-expense-templates-and-year-projection.html">Comments</a>


        </article><nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index-28.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-26.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div> <!-- col -->
    </div>
<!-- row  -->
</div>
<!-- container-fluid -->

<!-- End of Menubar -->

<!-- Footer -->

<footer>
    Contents © 2023         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         - License: 
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="assets/img/cc.png"></a>
        <ul class="footer_inline_ul"></ul></footer><!-- Late loading stuff  --><script src="assets/js/all-nocdn.js"></script><script type="text/javascript">
      $(document).ready(function() {
        $.getJSON("/assets/js/tx3_tag_cloud.json", function(data){
            var items = [];
            $.each(data, function(key, val){
                var count = val[0];
                var url = val[1];
                var posts = val[2];

                if(count > 9){
                    items.push("<li data-weight='" + count + "'><a href='" + url + "'>" + key + "</a></li>");
                }
            });

            $("<ul/>", {
                "id": "tag_cloud_left",
                html: items.join("")
            }).appendTo("#tag_cloud_left_container");

            $("#tag_cloud_left").tx3TagCloud({
                multiplier: 0.8 // default multiplier is "1"
            });
        });
      });
    </script><!-- Google platform JS -->
</body>
</html>