<!DOCTYPE html><html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Website about vtechnologies Java, Spring, OSGi, Hardware,...">
    <meta name="author" content="Baptiste Wicht">
    <title>@Blog("Baptiste Wicht") | @Blog("Baptiste Wicht")</title>
    
            <link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
      <link rel="canonical" href="http://wichtounet.github.io/index.html">
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
            <link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">

    
    
    
<link rel="stylesheet" type="text/css" href="assets/css/tipuesearch.css">
</head><body><div id="tipue_search_content" style="margin-left: auto; margin-right: auto; padding: 20px;"></div>



<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid"><!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://wichtounet.github.io/">@Blog("Baptiste Wicht")</a>
        </div><!-- /.navbar-header -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                
                <li><a href="stories/about.html">About</a>
                </li><li><a href="stories/publications.html">Publications</a>
                </li><li><a href="stories/donate.html">Donate</a>
                </li><li><a href="stories/faq.html">FAQ</a>
                </li><li><a href="stories/legal.html">Legal</a>
                </li><li><a href="archive.html">Archives</a>
                </li><li><a href="categories/index.html">Tags</a>
                </li><li><a href="rss.xml">RSS</a>

            </li></ul>
                
<span class="navbar-form pull-left">
<input type="text" id="tipue_search_input">
</span>

            <ul class="nav navbar-nav navbar-right">
                
                
                    
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>

<!-- End of Menubar -->

<div class="container">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2014/02/budgetwarrior-0-3-0-objective-wish-management.html" class="u-url">budgetwarrior 0.3.0 - Objective and wish management</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2014-02-03T09:21:29+00:00">2014-02-03 09:21</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>Hi, </p>
<p>I'm pleased to announce the release of another budgetwarrior release, the version 0.3.0.</p>
<h3>Changes</h3>
<p>This version contains several important changes.</p>
<p>The first one is the addition of a new module to manage objectives. You can add objective with <em>budget objective add). </em>For instance, you can add an objective saying you want to save 10000$ a year or 200$ a month. When you set your objectives, budget warrior computes how well you complete them. For instance, here is the status of my objectives:</p>
<p><a href="wp-content/uploads/2014/02/Screenshot-from-2014-02-02-113057-e1391337197470.png"><img alt="Objective Status" src="wp-content/uploads/2014/02/Screenshot-from-2014-02-02-113057-e1391337197470-300x83.png" title="Objective Status"></a></p>
<p>Another module has been added to manage wishes. You can add wishes to budgetwarrrior (<em>budget wish add</em>) and then budgetwarrior will tell you if it is a good time to buy them. Here is an example of wish status:</p>
<p><a href="http://www.baptiste-wicht.com/wp-content/uploads/2014/02/Screenshot-from-2014-02-02-113814.png"><img class="size-medium wp-image-2665" alt="Wish Status" src="wp-content/uploads/2014/02/Screenshot-from-2014-02-02-113814-e1391337576857-300x96.png" width="300" height="96"></a> Wish Status</p>
<p>The diagnostics tells you where the money will be taken: On savings, on year savings or on month savings (ideal case). It also checks the objectives to see if the payment doesn't break the fulfillment of some of them.</p>
<p>For complete diagnostics, it is necessary to you register your fortune (<em>budget fortune check</em>), ideally once a month.</p>
<p>Of course, this is only a tool, you should not only use that to decide when to buy something, but it may have a good point of view ;)</p>
<p>Moreover, the version also have other smaller changes:</p>
<ol>
<li>When you make an error when creating a new item (expense, earning, ...), the tool now lets you retry without losing what you typed before.</li>
<li>Confirmation messages are now shown after each modification command (delete, add and edit).</li>
<li>The license has been changed from Boost to MIT. The sense is almost the same, but the MIT is more well known and I thought it would be easier for people to know what this means.</li>
<li>There have several changes to the code base, but that doesn't impact the usage of the tool.</li>
</ol>
<h4>Conclusion</h4>

<p>I hope you'll found these changes interesting :)</p>
<p>If you are interested by the tool, you can download it on Github: <a title="budgetwarrior repository" href="https://github.com/wichtounet/budgetwarrior">budgetwarrior</a></p>
<ul>
<li>There is now Gentoo and Arch Linux installation packages available for ease of installation</li>
</ul>
<p>If you have a suggestion or you found a bug, please post an issue on the github project: <a title="https://github.com/wichtounet/budgetwarrior" href="https://github.com/wichtounet/budgetwarrior">https://github.com/wichtounet/budgetwarrior</a>.</p>
<p>If you have any comment, don't hesitate to contact me, either by letting a comment on this post or by email.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2014/02/budgetwarrior-0-3-0-objective-wish-management.html#disqus_thread" data-disqus-identifier="cache/posts/2014/02/budgetwarrior-0-3-0-objective-wish-management.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2014/01/budgetwarrior-0-2-1-minor-changes-gentoo-ebuild.html" class="u-url">budgetwarrior 0.2.1 - Minor changes and Gentoo ebuild</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2014-01-16T12:41:00+00:00">2014-01-16 12:41</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><p>I've released a new version of budgetwarrior, the release 0.2.1. budgetwarrior is a simple command line application to manage a personal budget.</p>
<p>The version 0.2.1 contains several bug fixes about archived accounts and bug fixes for budget across several years.</p>
<p>The application as well as the source code is available online: <a href="https://github.com/wichtounet/budgetwarrior">https://github.com/wichtounet/budgetwarrior</a></p>
<p>I've created Gentoo ebuilds for this application. They are available on my Portage overlay: <a href="https://github.com/wichtounet/portage-overlay">https://github.com/wichtounet/portage-overlay</a></p>
<p></p><h4>Gentoo Installation</h4>
<ul>
    <li>Edit overlays section of /etc/layman/layman.cfg. Here's an example:</li>
</ul>

<p><code>overlays: http://www.gentoo.org/proj/en/overlays/repositories.xml
           http://github.com/wichtounet/portage-overlay/raw/master/repository.xml</code>
</p><ul>
    <li>Sync layman</li>
</ul>
<p>layman -S</p>
<ul>
    <li>Add the overlay:</li>
</ul>

<p><code>layman -a wichtounet</code></p>
<ul>
    <li>Install budgetwarrior</li>
</ul>

<p><code>emerge budgetwarrior</code></p>
<h4>Conclusion</h4>

<p>If you find any issues with the tool, don't hesitate to post an issue on Github. If you have comments about it, you can post a comment on this post or contact me by email. </p></div>
        </div>
            
        
    <p>
        <a href="posts/2014/01/budgetwarrior-0-2-1-minor-changes-gentoo-ebuild.html#disqus_thread" data-disqus-identifier="cache/posts/2014/01/budgetwarrior-0-2-1-minor-changes-gentoo-ebuild.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2014/01/home-server-adventure-step-3.html" class="u-url">Home Server Adventure – Step 3</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2014-01-10T13:05:32+00:00">2014-01-10 13:05</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><p>Here are some news about my <a title="Home Server Adventure – Step 2" href="http://www.baptiste-wicht.com/2013/08/home-server-adventure-step-2/">home server installation project</a>.In the past, I already installed a server in a custom Norco case. I wanted to replace my QNAP NAS with a better server, the QNAP being too slow and not extensible enough for my needs.</p>
<p>Here is it how it looks right now (sorry about the photo qualitiy :( my phone does not seem to focus anymore...):</p>
<p><a href="wp-content/uploads/2014/01/asdf1.png"><img class="size-medium wp-image-2653" alt="My Home Rack of Server" src="wp-content/uploads/2014/01/asdf1-168x300.png" width="168" height="300"></a> My Home Rack of Server</p>
<p><span style="line-height: 1.5em;">So I replaced my QNAP NAS with a custom-built NAS. Again, I bought a NORCO case, the RPC-4220. This case has 20 SATA/SAS bays. I bought it with a replacement of the SAS backplane by a SATA one. I also ordered some fan replacement to make it less noisy. I installed my 6 hard disk in Raid 5, managed with mdadm, with LVM partitions on top of the array. </span></p>
<p>I also added an APC UPS which allows me to go through all the minor power issues that there is in my old apartment and which also me about 10 minutes of backup when there is a power outage.</p>
<p>I haven't added a lot of services on the server. I now run Owncloud on the server and that completely replaces my Dropbox account. I also improved by Sabnzbd installation with other newsgroup automation tools.</p>
<p>Not directly related to my rack, but I also installed a custom XBMC server for my TV. It reads from the NAS server. And of course, it runs Gentoo too.</p>
<p>In the future, I'll add a new simple server as a front firewall to manage security a bit more than here and avoid having to configure redirection in my shitty router (which I would like to replace, but there are not a lot of compatible rack router for my ISP unfortunately). It will probably use a Norco case too.</p>
<p>If you have any question about my build, don't hesitate ;)</p></div>
        </div>
            
        
    <p>
        <a href="posts/2014/01/home-server-adventure-step-3.html#disqus_thread" data-disqus-identifier="cache/posts/2014/01/home-server-adventure-step-3.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2013/12/zabbix-low-level-discovery-cores-cpus-hard-disk.html" class="u-url">Zabbix - Low Level Discovery of cores, CPUs and Hard Disk</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2013-12-30T09:12:31+00:00">2013-12-30 09:12</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><a href="wp-content/uploads/2013/12/Screenshot-from-2013-12-29-165743-e1388332859892.png"><img src="wp-content/uploads/2013/12/Screenshot-from-2013-12-29-165743-e1388332859892-300x151.png" alt="Zabbix SSD Status, configured with Low Level Discovery" width="300" height="151" class="size-medium wp-image-2644"></a> Zabbix SSD Status, configured with Low Level Discovery
<p>At home, I'm using Zabbix to monitor my servers, it has plenty of interesting features and can be extended a lot by using User Parameter.</p>
<p>In this post, I'm gonna talk about Low Level Discovery (LLD). If you are only interested in the final result, go the Conclusion section, you can download my template containing all the rules ;)</p>
<h4>Low Level Discovery (LLD)</h4>

<p>LLD is a feature to automatically discover some properties of the monitored host and create items, triggers and graphs.</p>
<p>By default, Zabbix support three types of item discovery:</p>
<ul>
    <li>Mounted filesystems</li>
    <li>Network interface</li>
    <li>SNMP's OIDs</li>
</ul>

<p>The first two are very useful, since they will give you by default, for instance, the free space of each mounted file system or the bandwith going in and out of each network interface. As I only monitor Linux servers, I don't use the last one, but it will eventually interest other people.</p>
<p>Another very interesting thing about this feature is that you can extend it by discovering more items. In this article, I will show how to discover CPUs, CPU Cores and Hard Disk.</p>
<p>The most important part of custom discovery is to create a script on the monitored machines that can "discover" something. It can be any executable, the only thing important is that it outputs data in the correct format. I have to say that the format is quite ugly, but that is probably not very important ;) Here is the output of my hard disk discovery script:</p>
<p>[javascript]</p>
<p>{</p>
<p>"data":[
    {"{#DISKNAME}":"/dev/sda","{#SHORTDISKNAME}":"sda"},
    {"{#DISKNAME}":"/dev/sdb","{#SHORTDISKNAME}":"sdb"},
    {"{#DISKNAME}":"/dev/sdc","{#SHORTDISKNAME}":"sdc"},
    {"{#DISKNAME}":"/dev/sdd","{#SHORTDISKNAME}":"sdd"},
    {"{#DISKNAME}":"/dev/sde","{#SHORTDISKNAME}":"sde"},
    {"{#DISKNAME}":"/dev/sdf","{#SHORTDISKNAME}":"sdf"},
    {"{#DISKNAME}":"/dev/sdg","{#SHORTDISKNAME}":"sdg"},
]</p>
<p>}[/javascript]</p>
<p>You can have as many keys for each discovered items, but the format must remains the same. In the item, trigger and graph prototypes, you will then use {#DISKNAME} or {#SHORTDISKNAME} to use the discovered values. </p>
<p>Once you have created your scripts, you have to register it in the zabbix configuration as a user parameter. For instance, if you use the zabbix daemon, you need these lines in /etc/zabbix/zabbix_agentd.conf: </p>
<p><code>EnableRemoteCommands=1</code></p>
<p>...</p>
<p>UnsafeUserParameters=1</p>
<p>...</p>
<p>UserParameter=discovery.hard_disk,/scripts/discover_hdd.sh</p>
<p>Now, when you will create the discovery rule, you can use discovery.hard_disk as the key. </p>
<p>A discovery rule in itself is useful without prototypes, you can create three types of prototypes: </p>
<ul>
    <li>Item Prototype: This will create a new item for each discovered entity</li>
    <li>Trigger Prototype: This will create a new trigger for each discovered entity. </li>
    <li>Graph Prototype: This will create a graph for each discovered entity. </li>
</ul>

<p>The most useful are by far the item and trigger prototypes. The biggest problem with graphs is that you cannot create an aggregate graph of each discovered items. For instance, if you record the temperature of your CPU cores, you cannot automatically create a graph with the temperature of each discovered cores. For that, you have to create the graph in each host. Which makes, imho, graph prototypes pretty useless. Anyway...</p>
<p>In the next section, I'll show how I have created discovery rules for Hard Disk, CPU and CPU cores. </p>
<h4>Discover Hard Disk</h4>

<p>The discovery script is really simple: </p>
<p>[bash]#!/bin/bash</p>
<p>disks=<code>ls -l /dev/sd* | awk '{print $NF}' | sed 's/[0-9]//g' | uniq</code></p>
<p>echo "{"</p>
<p>echo "\"data\":["</p>
<p>for disk in $disks</p>
<p>do
    echo "    {\"{#DISKNAME}\":\"$disk\",\"{#SHORTDISKNAME}\":\"${disk:5}\"},"
done</p>
<p>echo "]"</p>
<p>echo "}"[/bash]</p>
<p>It just lists all the /dev/sdX devices, remove the partition number and remove the duplicates, to have only the hard disk at the end. </p>
<p>I've created several item prototypes for each hard disk. Here are some examples using S.M.A.R.T. (you can download the template with all the items in the Conclusion section): </p>
<ul>
    <li>Raw Read Error Rate</li>
    <li>Spin Up Time</li>
    <li>SSD Life Left</li>
    <li>Temperature</li>
    <li>...</li>
</ul>

<p>You may notice that some of them only make sense for SSD (SSD Life Left) and some others do not make any sense for SSD (Spin Up Time). This is not a problem since they will just be marked as Not Supported by Zabbix. </p>
<p>All these datas are collected using the smartctl utility. </p>
<p>I've also created some trigger to indicate the coming failure of an hard disk: </p>
<ul>
    <li>SSD Life Left too low</li>
    <li>Reallocated Sector Count too low</li>
    <li>...</li>
</ul>

<p>I've just used the threshold reported by smartctl, they may be different from one disk manufacturers to another. I don't put a lot of faith on these values, since disk generally fail before going to threshold, but it could be a good indicator anyway. </p>
<h4>Discover CPUs</h4>

<p>Here is the script to discover CPUs: </p>
<p>[bash]#!/bin/bash</p>
<p>cpus=<code>lscpu | grep "CPU(s):" | head -1 | awk '{print $NF}'</code></p>
<p>cpus=$(($cpus-1))</p>
<p>echo "{"</p>
<p>echo "\"data\":["</p>
<p>for cpu in $(seq 0 $cpus)</p>
<p>do
    echo "    {\"{#CPUID}\":\"$cpu\"},"
done</p>
<p>echo "]"</p>
<p>echo "}"[/bash]</p>
<p>It just uses lscpu and parses its output to find the number of CPU and then create an entry for each CPUs. </p>
<p>I just have one item for each CPU: The CPU Utilization. </p>
<p>I haven't created any trigger here. </p>
<h4>Discover CPU Cores</h4>

<p>Just before, we discovered the CPUs, but it is also interesting to discover the cores. If you don't have Hyperthreading, the result will be the same. It is especially interesting to get the temperature of each core. Here is the script: </p>
<p>[bash]#!/bin/bash</p>
<p>cores=<code>lscpu | grep "Core(s) per socket:" | awk '{print $NF}'</code></p>
<p>cores=$(($cores-1))</p>
<p>echo "{"</p>
<p>echo "\"data\":["</p>
<p>for core in $(seq 0 $cores)</p>
<p>do
    echo "    {\"{#COREID}\":\"$core\"},"
done</p>
<p>echo "]"</p>
<p>echo "}"[/bash]</p>
<p>It works in the same way as the previous script. </p>
<p>I've only created one item prototype, to get the temperature of each core with lm_sensors. </p>
<h4>Wrap-Up</h4>

<p>Here are all the UserParameter necessary to make the discovery and the items works: </p>
<p><code>### System Temperature ###</code></p>
<p>UserParameter=system.temperature.core[*],sensors|grep Core\ $1 |cut -d "(" -f 1|cut -d "+" -f 2|cut -c 1-4</p>
<h4>DISK I/O</h4>
<p>UserParameter=custom.vfs.dev.read.ops[*],cat /proc/diskstats | egrep $1 | head -1 | awk '{print $$4}'</p>
<p>UserParameter=custom.vfs.dev.read.ms[*],cat /proc/diskstats | egrep $1 | head -1 | awk '{print $$7}'</p>
<p>UserParameter=custom.vfs.dev.write.ops[*],cat /proc/diskstats | egrep $1 | head -1 | awk '{print $$8}'</p>
<p>UserParameter=custom.vfs.dev.write.ms[*],cat /proc/diskstats | egrep $1 | head -1 | awk '{print $$11}'</p>
<p>UserParameter=custom.vfs.dev.io.active[*],cat /proc/diskstats | egrep $1 | head -1 | awk '{print $$12}'</p>
<p>UserParameter=custom.vfs.dev.io.ms[*],cat /proc/diskstats | egrep $1 | head -1 y| awk '{print $$13}'</p>
<p>UserParameter=custom.vfs.dev.read.sectors[*],cat /proc/diskstats | egrep $1 | head -1 | awk '{print $$6}'</p>
<p>UserParameter=custom.vfs.dev.write.sectors[*],cat /proc/diskstats | egrep $1 | head -1 | awk '{print $$10}'</p>
<p>UserParameter=system.smartd_raw[*],sudo smartctl -A $1| egrep $2| tail -1| xargs| awk '{print $$10}'</p>
<p>UserParameter=system.smartd_value[*],sudo smartctl -A $1| egrep $2| tail -1| xargs| awk '{print $$4}'</p>
<h4>Discovery</h4>
<p>UserParameter=discovery.hard_disk,/scripts/discover_hdd.sh</p>
<p>UserParameter=discovery.cpus,/scripts/discover_cpus.sh</p>
<p>UserParameter=discovery.cores,/scripts/discover_cores.sh</p>
<p>(it must be set in zabbix_agentd.conf)</p>
<p>You also need to give zabbix the right to use sudo with smartctl. For that, you have to edit your /etc/sudoers file and add this line: </p>
<p><code>ALL ALL=(ALL)NOPASSWD: /usr/sbin/smartctl</code></p>
<h4>Conclusion and Download</h4>

<p>I hope that this helps some people to use Low Level Discovery in their Zabbix Monitoring Installation. </p>
<p>LLD eases a lot the creation of multiple items discovery for hosts with different hardware or configuration. However, it has some problems for which I have not yet found a proper solution. First, you have to duplicate the client scripts on each host (or at least have them on a share available from each of them). Then, the configuration of each agent is also duplicated in the configuration of each host. The biggest problem I think is the fact that you cannot automatically create graph with the generated items of each discovered entities. For instance, I had to create a CPU Temperature graph in each of my host. If you have few hosts, like many, it is acceptable, but if you have hundreds of hosts, you just don't do it. </p>
<p>All the scripts and the template export file are available in the <a href="https://github.com/wichtounet/zabbix-lld" title="zabbix-lld repository">zabbix-lld</a> repository. For everything to work, you need the lscpu, lm_sensors and smartmontools utilities. </p>
<p>If you have any question or if something doesn't work (I don't offer any guarantee, but it should work on most recent Linux machines), don't hesitate to comment on this post. </p></div>
        </div>
            
        
    <p>
        <a href="posts/2013/12/zabbix-low-level-discovery-cores-cpus-hard-disk.html#disqus_thread" data-disqus-identifier="cache/posts/2013/12/zabbix-low-level-discovery-cores-cpus-hard-disk.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2013/12/thor-os-boot-process.html" class="u-url">Thor OS: Boot Process</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2013-12-23T09:18:01+00:00">2013-12-23 09:18</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><p>Some time ago, I started a hobby project: <a title="New hobby project: Thor-OS, 64bit Operating System in C++" href="http://www.baptiste-wicht.com/2013/12/new-hobby-project-thor-os-64bit-operating-system-c/">writing a new operating system</a>. I'm not trying to create a concurrent to Linux, I'm just trying to learn some more stuff about operating systems. I'm gonna try to write some posts about this kernel on this blog.</p>
<p>In this post, I'll describe the boot process I've written for this operating system.</p>
<p></p><h3>Bootloader Step</h3>
<p>The first step is of course the bootloader. The bootloader is in the MBR and is loaded by the system at 0x7C00.</p>
<p>I'm doing the bootloading in two stages. The first stage (one sector) print some messages and then load the second stage (one sector) from floppy at 0x900. The goal of doing it in two stages is just to be able to overwrite the bootloader memory by the stage. The second stage loads the kernel into memory from floppy. The kernel is loaded at 0x1000 and then run directly.</p>
<p>The bootloader stages are written in assembly.</p>
<h3>Real mode</h3>

<p>When the processor, it boots in real mode (16 bits) and you have to setup plenty of things before you can go into long mode (64 bits). So the first steps of the kernel are running in 16 bits. The kernel is mostly written in C++ with some inline assembly.</p>
<p>Here are all the things that are done in this mode:</p>
<ol>
    <li>The memory is inspected using BIOS E820 function. It is necessary to do that at this point since BIOS function calls are not available after going to protected mode. This function gives a map of the available memory. The map is used later by the dynamic memory allocator.</li>
    <li>The interrupts are disabled and a fake Interrupt Descriptor Table is configured to make sure no interrupt are thrown in protected mode</li>
    <li>The Global Descriptor Table is setup. This table describes the different portion of the memory and what each process can do with each portion of the memory. I have three descriptors: a 32bit code segment, a data segment and a 64bit code segment.</li>
    <li>Protected mode is activated by setting PE bit of CR0 control register.</li>
    <li>Disable paging</li>
    <li>Jump to the next step. It is necessary to use a far jump so that the code segment is changed.</li>
</ol>

<h3>Protected Mode</h3>

<p>At this point, the processor is running in protected mode (32 bits). BIOS interrupts are not available anymore.</p>
<p>Again, several steps are necessary:</p>
<ol>
    <li>To be able to use all memory, Physical Address Extensions are activated.</li>
    <li>Long Mode is enabled by setting the EFER.LME bit.</li>
    <li>Paging is setup, the first MiB of memory is mapped to the exact same virtual addresses.</li>
    <li>The address of the Page-Map Level 4 Table is set in the CR0 register.</li>
    <li>Finally paging is activated.</li>
    <li>Jump to the real mode kernel, again by using a far jump to change code segment.</li>
</ol>

<h3>Real Mode</h3>

<p>The kernel finally runs in 64 bits.</p>
<p>There are still some initialization steps that needs to be done:</p>
<ol>
    <li>SSE extensions are enabled.</li>
    <li>The final Interrupt Descriptor Table is setup.</li>
    <li>ISRs are created for each possible processor exception</li>
    <li>The IRQs are installed in the IDT</li>
    <li>Interrupts are enabled</li>
</ol>

<p>At this point, is kernel is fully loaded and starts initialization stuff like loading drivers, preparing memory, setting up timers...</p>
<p>If you want more information about this process, you can read the different source files involved (stage1.asm, stage2.asm, boot_16.cpp, boot_32.cpp and kernel.cpp) and if you have any question, you can comment on this post.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2013/12/thor-os-boot-process.html#disqus_thread" data-disqus-identifier="cache/posts/2013/12/thor-os-boot-process.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2013/12/new-hobby-project-thor-os-64bit-operating-system-c.html" class="u-url">New hobby project: Thor-OS, 64bit Operating System in C++</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2013-12-17T03:20:16+00:00">2013-12-17 03:20</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><p>It's been a long time since I haven't posted on this blog about a project. A bit more than two months ago, I started a new project: thor-os</p>
<p>This project is a simple 64bit operating system, written in C++. After having written a compiler, I decided it could be fun to try with an operating system. And it is fun indeed :) It is a really exciting project and there are plenty of things to do in every directions.</p>
<p>I've also written the bootloader myself, but it is a very simple one. It just reads the kernel from the floppy. loads it in memory and then jumps to it and nothing else.</p>
<p></p><h4>Features</h4>
<p>Right now, the project is fairly modest. Here are the features of the kernel:</p>
<ul>
    <li>Serial Text Console</li>
    <li>Keyboard driver</li>
    <li>Timer driver (PIT)</li>
    <li>Dynamic Memory Allocation</li>
    <li>ATA driver</li>
    <li>FAT32 driver (Work In progress)</li>
    <li>Draft of an ACPI support (only for shutdown)</li>
</ul>

<p>All the commands are accessible with a simple shell integrated directly in the kernel.</p>
<h4>Testing</h4>

<p>All the testing is made in Bochs and Qemu. I don't have any other computer available to test in real right now but that is something I really want to do. But for now, my bootloader only supports floppy, so it will need to be improved to load the kernel from a disk, since it is not likely that I will have a floppy disk to test :D</p>
<p>Here is a screenshot of the OS in action:</p>
<p><a href="wp-content/uploads/2013/12/Screenshot-from-2013-12-17-085810-e1387267703665.png"><img class="size-medium wp-image-2628" alt="Thor OS Screenshot" src="wp-content/uploads/2013/12/Screenshot-from-2013-12-17-085810-e1387267703665-300x204.png" width="300" height="204"></a> Thor OS Screenshot</p>
<h4>Future</h4>

<p>The next thing that I will improve is the FAT32 driver to have a complete implementation including creating and writing to files.</p>
<p>After that, I still don't know whether I will try to implement a simple Framebuffer or start implement user space.</p>
<p>As for all my projects, you can find the complete source code on Github: https://github.com/wichtounet/thor-os</p>
<p>Don't hesitate to comment if you have any question or suggestion for this project ;) I will try to write some posts about it on the future, again if you have idea of subject for these posts, don't hesitate. The first will probably be about the boot process.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2013/12/new-hobby-project-thor-os-64bit-operating-system-c.html#disqus_thread" data-disqus-identifier="cache/posts/2013/12/new-hobby-project-thor-os-64bit-operating-system-c.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2013/12/gentoo-tips-avoid-gnome-3-8-emerged-automatically.html" class="u-url">Gentoo Tips: Avoid Gnome 3.8 from being emerged automatically</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2013-12-07T06:24:17+00:00">2013-12-07 06:24</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><p>Since Gnome 3.8 has been out in the portage tree, a lot of problems arise when you try to emerge something. If it was only when you update the system, it would be OK, but this arises every time you try to install something.</p>
<p>For instance, if I try to update vim on my system, it tries to update empathy to version 3.8 and then pulls some other dependencies causing blocks and other USE problems. I personally don't think empathy should be emerged when emerging vim. Fortunately, you can disable this behavior by using emerge in this way:</p>
<p>[code]emerge --ignore-built-slot-operator-deps=y ...[/code]</p>
<p>With that, when you emerge vim, it doesn't emerge Gnome 3.8. It is very useful if you want to stay with Gnome 3.6 for the moment.</p>
<p>I already used this tip several times. I hope that this will be useful to other people.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2013/12/gentoo-tips-avoid-gnome-3-8-emerged-automatically.html#disqus_thread" data-disqus-identifier="cache/posts/2013/12/gentoo-tips-avoid-gnome-3-8-emerged-automatically.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2013/10/budgetwarrior-0-2-visual-reports-fortune-status-expenses-aggregates.html" class="u-url">budgetwarrior 0.2 - Visual reports, fortune status and expenses aggregates</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2013-10-25T16:10:50+00:00">2013-10-25 16:10</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><p>Hi,</p>
<p>I've released a new version of budgetwarrior the version 0.2.</p>
<p>I've several new features to the tool. First, I've added a graph of the expenses/earnings/balances of each month for a given year in the form of a bar plot. You can see an example in practice here:</p>
<p><a href="wp-content/uploads/2013/10/Screenshot-from-2013-10-25-215839.png"><img class="size-medium wp-image-2617" alt="budgetwarrior monthly report" src="wp-content/uploads/2013/10/Screenshot-from-2013-10-25-215839-300x266.png" width="300" height="266"></a> budgetwarrior monthly report</p>
<p>Nothing fancy, but it gives a good overview of the current state of your budget.</p>
<p>I've added a new module, called fortune, that lets you enter your total fortune and then computes the difference between the entered fortune statuses. For now, it doesn't do anything else with this data. But in the future, I want to correlate this data with the balances to check the difference between the filled expenses and earnings and the fortune evolution.</p>
<p>I've also added a more convenient way of creating expenses and earnings. Just type "budget expense add" and you'll be able to fill all the fields one by one. Of course, the command line commands are still available.</p>
<p>The last new feature I've added is an aggregate report (budget overview aggregate). This view simply groups all the expenses with the same name of a year together. If you always use the same expense title for your groceries, you'll see the total you spent in groceries for a year. You can also name your expenses with the format "Category/Expenses" and all the expenses with the same category will be grouped together in the aggregate view. That allows you to still have enough details in the monthly overview but to logically groups your expenses together in the aggregate view.</p>
<p>The other changes are minor. I've improved the monthly overview to sort the expenses and earnings by date. To facilitate the storage of the files in a service like Dropbox, the data and configuration files are now only written if they have been modified. The mean in the current overview has been changed to reflect only the months up to the current month and not the future (which was just ruining the means).</p>
<p>If you are interested by the tool, you can download it on Github: <a title="budgetwarrior repository" href="https://github.com/wichtounet/budgetwarrior">budgetwarrior</a></p>
<p>I hope this tool will be useful to some people. If you've any question, just let a comment on this post or contact me directly by email. I'll be glad to help.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2013/10/budgetwarrior-0-2-visual-reports-fortune-status-expenses-aggregates.html#disqus_thread" data-disqus-identifier="cache/posts/2013/10/budgetwarrior-0-2-visual-reports-fortune-status-expenses-aggregates.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2013/08/home-server-adventure-step-2.html" class="u-url">Home Server Adventure - Step 2</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2013-08-27T09:16:21+00:00">2013-08-27 09:16</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><p>If you remember, I talked about <a title="Home Server Adventure – Step 1" href="http://www.baptiste-wicht.com/2013/07/home-server-adventure-step-1/">my home server project</a> in a previous post. I had installed an old Dell Poweredge server, a 3com gigabit switch and a monitoring console. The problem with this configuration was that it was too noisy as the rack is installed in my apartment.</p>
<p>The first thing I did was to <a title="ZyXEL GS1910-24 Managed Gigabit Switch Review" href="http://www.baptiste-wicht.com/2013/07/zyxel-gs1910-managed-gigabit-switch-review/">replace my old 3Com switch with a Zyxel managed fanless switch</a>. Being fanless, this switch is completely silent which makes a good difference :)</p>
<p>After that, I have replaced the Dell server with <a title="Norco RPC 230 Case Review" href="http://www.baptiste-wicht.com/2013/08/norco-rpc-230-case-review/">a custom installation in a Norco-RPC 230 case</a>. The basic case comes with two 80mm fans in the front. These two fans are very powerful, but they are quite noisy. I replaced them with two Enermax T.B. Silence 80mm fans. They are almost silent, it is really great. It is probably not enough airflow for a large configuration, but in my case, I think that this will be largely enough.</p>
<p>I've already installed several services on my server:</p>
<p></p><ul>
    <li><span style="line-height: 16px;">Tiny Tiny RSS: a web-based news feed reader and aggregator. I use it to replace Feedly which I was getting less and less fond to. </span></li>
    <li>Sabnzbd: I already had this NZB download on my desktop, but now as it is on the server, it can download even when I'm not at home.</li>
    <li>Zabbix: a monitoring application that manages all my appliances and server (the new server, the NAS, the switch and the router). It is my first attempt with Zabbix. It is a bit cryptic to conigure, but the features are very numerous.</li>
    <li>Teamspeak and Mumble: They already were installed on the previous server.</li>
</ul>
<p>I plan to install new services on the future, but I have no plans for now.</p>
<p>Here is a picture of the rack in its current state:</p>
<p><a href="wp-content/uploads/2013/08/2013-08-23-15.31.45.jpg"><img class="size-medium wp-image-2610" alt='19" Rack' src="wp-content/uploads/2013/08/2013-08-23-15.31.45-168x300.jpg" width="168" height="300"></a> 19" Rack</p>
<p>I have also installed my router and the NAS on a layer in the rack.</p>
<p>You can't see it, but I have also added to rackable PDU on the back to have to organize a bit the cables. Even if it still not perfect, it is already better than before.</p>
<p>For now, I think that my system in in good shape. When I will have some more budget, I will replace QNAP NAS with a custom server, probably again with a Norco case.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2013/08/home-server-adventure-step-2.html#disqus_thread" data-disqus-identifier="cache/posts/2013/08/home-server-adventure-step-2.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2013/08/budgetwarrior-command-line-personal-budgeting.html" class="u-url">budgetwarrior 0.1.0 - command-line personal budgeting tool</a>
        <small>  
             Posted: <time class="published dt-published" datetime="2013-08-26T08:41:03+00:00">2013-08-26 08:41</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p></p><p>Being bored by using Google spreadsheets for my personal budgeting, I decided to write an application to do that. Being a huge fan of taskwarrior, I decided to write a kind of similar application for my personal budget, budgetwarrior was born. I use it since two months and I thought that it could be useful for other persons. The application is developed in C++. More information is available on Github: <a title="https://github.com/wichtounet/budgetwarrior" href="https://github.com/wichtounet/budgetwarrior">https://github.com/wichtounet/budgetwarrior</a>.</p>
<p>budgetwarrior 0.1.0 is a command-line only tool. It works on this principle: you create a set of accounts with a certain limit and then you declare your expenses in each of these accounts. You can also manage earnings that are not each month in each account. You can also keeps track of your debts via this application. It also supports automatic creation of recurring expenses, for instance when you pay the rent (for now, only monthly expenses are supported).</p>
<p>Once you've put all your data in the application, it provides you report on the state of your budget by month or by year. For instance, here is my current monthly report:</p>
<p><a href="wp-content/uploads/2013/08/Screenshot-from-2013-08-23-145358.png"><img class="size-medium wp-image-2601" title="Monthly Report" alt="Monthly Report" src="wp-content/uploads/2013/08/Screenshot-from-2013-08-23-145358-300x95.png" width="300" height="95"></a> Monthly Report</p>
<p>You can see directly which accounts are in a good shape and which are not.</p>
<p>Here is the current yearly report:</p>
<p><a href="wp-content/uploads/2013/08/Screenshot-from-2013-08-23-145911.png"><img class="size-medium wp-image-2602" alt="Yearly report" src="wp-content/uploads/2013/08/Screenshot-from-2013-08-23-145911-300x252.png" width="300" height="252"></a> Yearly report</p>
<p>In this view, you can see directly how your accounts evolve during the year and where are your biggest expenses and earnings.</p>
<p>As everything is displayed horizontally, the more accounts you have the larger the view become. With the 7 accounts I have, it takes about 1600 pixels of width to display it. I will try to improve that in the future if some people are interested in making it work on smaller screens.</p>
<p></p><h4>Installation</h4>
<p>You can install budgetwarrior directly from the sources:</p>
<p>[code]git clone -b master git://github.com/wichtounet/budgetwarrior.git</p>
<p>cd budgetwarrior</p>
<p>cmake .</p>
<p>make</p>
<p>sudo make install[/code]</p>
<p>After that, you can use budgetwarrior by using the command <em>budget</em>.</p>
<p>The usage is fairly simple, you can use <em>budget help</em> to have the list of the commands that you have to use to create expenses and earnings and display overviews.</p>
<h4>The project</h4>

<p>If you have any question on the project, don't hesitate to contact me or to post a comment to this post. If there are people interested, I can write a more complete help.</p>
<p>If you have a suggestion or you found a bug, please post an issue on the github project: <a title="https://github.com/wichtounet/budgetwarrior" href="https://github.com/wichtounet/budgetwarrior">https://github.com/wichtounet/budgetwarrior</a>.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2013/08/budgetwarrior-command-line-personal-budgeting.html#disqus_thread" data-disqus-identifier="cache/posts/2013/08/budgetwarrior-command-line-personal-budgeting.html">Comments</a>


        </p></article>
    
        <div>
        <ul class="pager">
            <li class="next">
                <a href="index-24.html" rel="next">Older posts →</a>
            </li>
        </ul>
        </div>

    
        
       <script>var disqus_shortname="nikolademo";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>


	


        </div>
        <!--End of body content-->

        <footer>
            Contents © 2014         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/4.0/88x31.png"></a>
        </footer>
    </div>
</div>


            <script src="assets/js/all-nocdn.js" type="text/javascript"></script>


    
<!-- Social buttons -->
<div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
<a class="addthis_button_more">Share</a>
<ul><li><a class="addthis_button_facebook"></a>
</li><li><a class="addthis_button_google_plusone_share"></a>
</li><li><a class="addthis_button_linkedin"></a>
</li><li><a class="addthis_button_twitter"></a>
</li></ul>
</div>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script>
<!-- End of social buttons -->


    <script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script>
    

<script type="text/javascript" src="assets/js/tipuesearch_set.js"></script>
<script type="text/javascript" src="assets/js/tipuesearch.js"></script>
<script type="text/javascript">
$(document).ready(function() {
  $('#tipue_search_input').tipuesearch({
      'mode': 'json',
      'contentLocation': '/assets/js/tipuesearch_content.json',
      'showUrl': false
  });
});
</script>


</body></html>