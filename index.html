<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang=en> <head><meta charset=utf-8><meta name=description content="Website about vtechnologies Java, Spring, OSGi, Hardware,..."><meta name=viewport content="width=device-width"><title>@Blog("Baptiste Wicht") | @Blog("Baptiste Wicht")</title><link href=assets/css/all-nocdn.css rel=stylesheet type=text/css><link rel=alternate type=application/rss+xml title=RSS href=rss.xml><link rel=canonical href=http://baptiste-wicht.com/index.html><script type=text/javascript>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2175227-7']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script><link href=favicon.ico rel=icon type=image/x-icon></head><body><div class=social_container> <div class=social_container_gplus> <a target=_blank title="Share on Google+" href="https://plusone.google.com/_/+1/confirm?hl=en&amp;url=http://baptiste-wicht.com/index.html"><img src=assets/img/google_plus.png></a> </div> <div class=social_container_facebook> <a target=_blank title="Share on Facebook" href="http://www.facebook.com/sharer/sharer.php?u=#url"><img src=assets/img/facebook.png></a> </div> <div class=social_container_twitter> <a target=_blank title="Tweet on Twitter" href="http://twitter.com/home?status=#url"><img src=assets/img/twitter.svg></a> </div></div><nav class="navbar navbar-inverse navbar-fixed-top" role=navigation> <div class=container-fluid> <div class=navbar-header> <button type=button class=navbar-toggle data-toggle=collapse data-target=.navbar-ex1-collapse> <span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span> </button> <a class=navbar-brand href=http://baptiste-wicht.com/> <span id=blog-title>@Blog("Baptiste Wicht")</span> </a> </div> <div class="collapse navbar-collapse navbar-ex1-collapse"> <ul class="nav navbar-nav"> <li><a href=stories/about.html>About</a> </li><li><a href=stories/publications.html>Publications</a> </li><li><a href=stories/donate.html>Donate</a> </li><li><a href=stories/contact.html>Contact</a> </li><li><a href=stories/faq.html>FAQ</a> </li><li><a href=stories/legal.html>Legal</a> </li><li><a href=categories/index.html>Tags</a> </li><li><a href=archive.html>Archives</a> </li><li><a href=http://feeds.feedburner.com/BaptisteWicht>RSS</a> </li></ul> <span class="navbar-form pull-left"> <form action=stories/search.html> <input type=text name=q id=tipue_search_input> </form> </span> <ul class="nav navbar-nav navbar-right"> <li> <a target=_blank title="Follow @wichtounet on Twitter" href=https://twitter.com/wichtounet> <img src=assets/img/twitter.svg alt="Follow @wichtounet on Twitter"> </a> </li> <li> <a target=_blank title="Follow +BaptisteWicht on Google+" href=https://plus.google.com/+BaptisteWicht> <img src=assets/img/google_plus.svg alt="Follow +BaptisteWicht on Google+"> </a> </li> </ul> </div> </div></nav><div class=body-container> <div class=left-sidebar> <div class=left-sidebar-widget> <h3>Welcome to my blog</h3> <div class=left-sidebar-widget-content> <div class=g-person data-width=275 data-href=//plus.google.com/u/0/103113673902796202116 data-theme=dark data-layout=landscape data-rel=author></div> </div> </div> <div class=left-sidebar-widget> <h3>Tags</h3> <div class=left-sidebar-widget-content> <div id=tags_container> <canvas width=275 height=250 id=tags_canvas> <p>Anything in here will be replaced on browsers that support the canvas element</p> </canvas> </div> </div> </div> <div class=left-sidebar-widget> <h3>Recent comments</h3> <div class=left-sidebar-widget-content> <div id=recentcomments class=dsq-widget> <script type=text/javascript src="http://blogwichtounet.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=0&amp;avatar_size=28&amp;excerpt_length=50"></script> </div> </div> </div> <div class=left-sidebar-widget> <h3>Blogroll</h3> <div class=left-sidebar-widget-content> <ul> <li><a target=_blank href=http://www.asjava.com/>AsJava.com : Java Tutorial</a></li> <li><a target=_blank href=http://www.mkyong.com/>Mkyong : Java Tutorials</a></li> </ul> </div> </div> </div> <div class=container> <div class=body-content> <div class=row> <article class="postbox h-entry post-text"> <h1 class=p-name><a href=posts/2015/03/named-optional-template-parameters-compile-time.html class=u-url>Named Optional Template parameters to configure a class at compile-time</a> <br><small>   Posted: <time class="published dt-published" datetime=2015-03-01T15:52:41+01:00>2015-03-01 15:52</time> </small></h1> <hr> <div class=p-summary> <p>In this post, I'll describe a technique that can be used to configure a class at compile-time when there are multiple, optional parameters, with default values to this class. I used this technique in my dll project to configure each instance of Restricted Boltzmann Machine.</p><p>The technique presented here will only work with C++11 because of the need for variadic template. This could be emulated without them by fixing a maximum number of parameters, but I won't go into this in this post.</p><div class=section id=the-problem><h2>The problem</h2><p>For this post, we'll take the case of a single class, let's call it configurable. This class has several parameters:</p><ul class=simple><li>A of type int</li><li>B of type char</li><li>C of an enum type</li><li>D of type bool</li><li>E is a type</li><li>F is a template type</li></ul><p>This class could simply be written as such:</p><pre class="code c++ literal-block">
<span class=k>enum</span> <span class=k>class</span> <span class=nc>type</span> <span class=p>{</span>
    <span class=n>AAA</span><span class=p>,</span>
    <span class=n>BBB</span><span class=p>,</span>
    <span class=n>CCC</span>
<span class=p>};</span>

<span class=k>template</span><span class=o>&lt;</span><span class=kt>int</span> <span class=n>T_A</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=kt>char</span> <span class=n>T_B</span> <span class=o>=</span> <span class=sc>'b'</span><span class=p>,</span> <span class=n>type</span> <span class=n>T_C</span> <span class=o>=</span> <span class=n>type</span><span class=o>::</span><span class=n>BBB</span><span class=p>,</span> <span class=kt>bool</span> <span class=n>T_D</span> <span class=o>=</span> <span class=nb>false</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T_E</span> <span class=o>=</span> <span class=n>watcher_1</span><span class=p>,</span> <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>T_F</span> <span class=o>=</span> <span class=n>trainer_1</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>configurable_v1</span> <span class=p>{</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=kt>int</span> <span class=n>A</span> <span class=o>=</span> <span class=n>T_A</span><span class=p>;</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=kt>char</span> <span class=n>B</span> <span class=o>=</span> <span class=n>T_B</span><span class=p>;</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=n>type</span> <span class=n>C</span> <span class=o>=</span> <span class=n>T_C</span><span class=p>;</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=kt>bool</span> <span class=n>D</span> <span class=o>=</span> <span class=n>T_D</span><span class=p>;</span>

    <span class=k>using</span> <span class=n>E</span> <span class=o>=</span> <span class=n>T_E</span><span class=p>;</span>

    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>C</span><span class=o>&gt;</span>
    <span class=k>using</span> <span class=n>F</span> <span class=o>=</span> <span class=n>T_F</span><span class=o>&lt;</span><span class=n>C</span><span class=o>&gt;</span><span class=p>;</span>

    <span class=c1>//Something useful
</span><span class=p>};</span>
</pre><p>and used simply as well:</p><pre class="code c++ literal-block">
<span class=k>using</span> <span class=kt>configurable_v1_t</span> <span class=o>=</span> <span class=n>configurable_v1</span><span class=o>&lt;</span><span class=mi>100</span><span class=p>,</span> <span class=sc>'z'</span><span class=p>,</span> <span class=n>type</span><span class=o>::</span><span class=n>CCC</span><span class=p>,</span> <span class=nb>true</span><span class=p>,</span> <span class=n>watcher_2</span><span class=p>,</span> <span class=n>trainer_2</span><span class=o>&gt;</span><span class=p>;</span>
</pre><p>This works well and nothing is wrong with this code. However, if you want all default values but the last one, you have to specify each and every one of the previous template parameters as well. The first disadvantage is that it is verbose and tedious. Secondly, instead of using directly the default values implicitly, you have specified them. This means that if the default values are changed by the library authors or even by you in the configurable_v1 class, either all the usages will be out of sync or you'll have to update them. And again, this is not practical. Moreover, if the author of the configurable_v1 template adds new template parameters before the last, you'll have to update all the instantiation points as well.</p><p>Moreover, here we only have 6 parameters, if you have more, the problem becomes even worse.</p></div><div class=section id=the-solution><h2>The solution</h2><p>What can we do to improve over these problems ? We are going to use variadic template parameters in the configurable class and use simple classes for each possible parameters. This will be done in the configurable_v2 class. At the end you could use the class as such:</p><pre class="code c++ literal-block">
<span class=k>using</span> <span class=n>configurable_v2_t1</span> <span class=o>=</span> <span class=n>configurable_v2</span><span class=o>&lt;</span><span class=n>a</span><span class=o>&lt;</span><span class=mi>100</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>b</span><span class=o>&lt;</span><span class=sc>'z'</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>c</span><span class=o>&lt;</span><span class=n>type</span><span class=o>::</span><span class=n>CCC</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>d</span><span class=p>,</span> <span class=n>e</span><span class=o>&lt;</span><span class=n>watcher_2</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>f</span><span class=o>&lt;</span><span class=n>trainer_2</span><span class=o>&gt;&gt;</span><span class=p>;</span>
<span class=k>using</span> <span class=n>configurable_v2_t2</span> <span class=o>=</span> <span class=n>configurable_v2</span><span class=o>&lt;</span><span class=n>f</span><span class=o>&lt;</span><span class=n>trainer_2</span><span class=o>&gt;&gt;</span><span class=p>;</span>
</pre><p>You can note, that on the second line, we only specified the value for the last parameter without specifiyng any other value :) This is also much more flexible since the order of the parameters has absolutely no impact. Here, for the sake of the example, the parameters are badly named, so it is not very clear what this do, but in practice, you can give better names to the parameters and make the types more clear. Here is an example from my dll library:</p><pre class="code c++ literal-block">
<span class=k>using</span> <span class=kt>rbm_t</span> <span class=o>=</span> <span class=n>dll</span><span class=o>::</span><span class=n>rbm_desc</span><span class=o>&lt;</span>
    <span class=mi>28</span> <span class=o>*</span> <span class=mi>28</span><span class=p>,</span> <span class=mi>200</span><span class=p>,</span>
   <span class=n>dll</span><span class=o>::</span><span class=n>batch_size</span><span class=o>&lt;</span><span class=mi>25</span><span class=o>&gt;</span><span class=p>,</span>
   <span class=n>dll</span><span class=o>::</span><span class=n>momentum</span><span class=p>,</span>
   <span class=n>dll</span><span class=o>::</span><span class=n>weight_decay</span><span class=o>&lt;&gt;</span><span class=p>,</span>
   <span class=n>dll</span><span class=o>::</span><span class=n>visible</span><span class=o>&lt;</span><span class=n>dll</span><span class=o>::</span><span class=n>unit_type</span><span class=o>::</span><span class=n>GAUSSIAN</span><span class=o>&gt;</span><span class=p>,</span>
   <span class=n>dll</span><span class=o>::</span><span class=n>shuffle</span><span class=p>,</span>
   <span class=n>dll</span><span class=o>::</span><span class=n>weight_type</span><span class=o>&lt;</span><span class=kt>float</span><span class=o>&gt;</span>
<span class=o>&gt;::</span><span class=kt>rbm_t</span><span class=p>;</span>
</pre><p>rbm_desc is class that is configurable with this technique, expect that the first two parameters are mandatory and not named. I personally thinks that this is quite clear, but of course I may be biased ;)</p><p>So let's code!</p><p>The class declaration is quite simple:</p><pre class="code c++ literal-block">
<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>configurable_v2</span> <span class=p>{</span>
    <span class=c1>//Coming
</span><span class=p>}</span>
</pre><p>We will now have to exact values and types from Args in order to get the 4 values, the type and the template type out of Args.</p></div><div class=section id=extracting-integral-values><h2>Extracting integral values</h2><p>We will start with the parameter <em>a</em> that holds a value of type int with a default value of 1. Here is one way of writing it:</p><pre class="code c++ literal-block">
<span class=k>struct</span> <span class=n>a_id</span><span class=p>;</span>

<span class=k>template</span><span class=o>&lt;</span><span class=kt>int</span> <span class=n>value</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>a</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>value</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=k>using</span> <span class=n>type_id</span> <span class=o>=</span> <span class=n>a_id</span><span class=p>;</span>
<span class=p>};</span>
</pre><p>So, <em>a</em> is simply an integral constant with another typedef <em>type_id</em>. Why do we need this id ? Because a is a type template, we cannot use std::is_same to compare it with other types, since its value is part of the type. If we had only int values, we could easily write a traits that indicates if the type is a specialization of a, but since will have several types, this would be a real pain to do and we would need such a traits for each possible type. Here the simple way to go is to add inner identifiers to each types.</p><p>We can now write a struct to extract the int value for a from <em>Args</em>. <em>Args</em> is a list of types in the form parameter_name&lt;parameter_value&gt;... . We have to find a specialization of a inside this list. If such a specialization is present, we'll take its integral constant value as the value for a, otherwise, we'll take the default values. Here is what we want to do:</p><pre class="code c++ literal-block">
<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>configurable_v2</span> <span class=p>{</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=kt>int</span> <span class=n>A</span> <span class=o>=</span> <span class=n>get_value_int</span><span class=o>&lt;</span><span class=n>a</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>

    <span class=c1>//Coming
</span><span class=p>}</span>
</pre><p>We specify directly into the class the default values (1) for a and we use the class <em>get_value_int</em> to get its value from the variadic type list. Here is the implementation:</p><pre class="code c++ literal-block">
<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>get_value_int</span><span class=p>;</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>get_value_int</span><span class=o>&lt;</span><span class=n>D</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>D</span><span class=o>::</span><span class=n>value</span><span class=o>&gt;</span> <span class=p>{};</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T2</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>get_value_int</span><span class=o>&lt;</span><span class=n>D</span><span class=p>,</span> <span class=n>T2</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D2</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T22</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Enable</span> <span class=o>=</span> <span class=kt>void</span><span class=o>&gt;</span>
    <span class=k>struct</span> <span class=n>impl</span>
        <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>get_value_int</span><span class=o>&lt;</span><span class=n>D</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=o>&gt;</span> <span class=p>{};</span>

    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D2</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T22</span><span class=o>&gt;</span>
    <span class=k>struct</span> <span class=n>impl</span> <span class=o>&lt;</span><span class=n>D2</span><span class=p>,</span> <span class=n>T22</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=kt>enable_if_t</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>is_same</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D2</span><span class=o>::</span><span class=n>type_id</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T22</span><span class=o>::</span><span class=n>type_id</span><span class=o>&gt;::</span><span class=n>value</span><span class=o>&gt;&gt;</span>
        <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>T22</span><span class=o>::</span><span class=n>value</span><span class=o>&gt;</span> <span class=p>{};</span>

    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=kt>int</span> <span class=n>value</span> <span class=o>=</span> <span class=n>impl</span><span class=o>&lt;</span><span class=n>D</span><span class=p>,</span> <span class=n>T2</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
<span class=p>};</span>
</pre><p>If you are not really familiar with Template Metaprogramming (TMP), this may seems very unfamiliar or even barbaric, but I'll try to explain into details what is going on here :)</p><p><em>get_value_int</em> is a template that takes a type D, representing the parameter we want to extract and its default, and the list of args. It has a first partial specialization for the case when Args is empty. In which case, its value is simply the value inside D (the default value). The second partial specialization handles the case when there are at least one type (T2) inside the list of args. This separation in two partial specialization is the standard way to works with variadic template parameters. This specialization is more complicated than the first one since it uses an inner class to get the value out of the list. The inner class (impl) takes the parameter type (D2), the type that is present in the list (T22) and a special parameter (Enable) that is used for SFINAE. If you're not familiar with SFINAE (you're probably not reading this article...), it is, put simply, a mean to activate or deactivate a template class or function based on its template parameters. Here, the partial specialization of <em>impl</em> is enabled if <em>T22</em> and <em>D2</em> have the same <em>type_id</em>, in which case, the value of <em>T22</em> is taken as the return of <em>impl</em>. In the basic case, template recursion is used to continue iterating over the list of types. The fact that this has to be done into two template classes is because we cannot add a new template parameter to a partial template specialization even without a name. We cannot either add a simple <em>Enable</em> parameter to get_value_int, we cannot put before Args since then it would be necessary to give it a value in the code that uses it which is not practical neither a good practice.</p><p>We can now do the same for b that is of type char. Here is the parameter definition for b:</p><pre class="code c++ literal-block">
<span class=k>struct</span> <span class=n>a_id</span><span class=p>;</span>

<span class=k>template</span><span class=o>&lt;</span><span class=kt>int</span> <span class=n>value</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>a</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>int</span><span class=p>,</span> <span class=n>value</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=k>using</span> <span class=n>type_id</span> <span class=o>=</span> <span class=n>a_id</span><span class=p>;</span>
<span class=p>};</span>
</pre><p>This code is highly similar to the code for a, so we can generalize a bit this with a base class:</p><pre class="code c++ literal-block">
<span class=k>struct</span> <span class=n>a_id</span><span class=p>;</span>
<span class=k>struct</span> <span class=n>b_id</span><span class=p>;</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>ID</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T</span><span class=p>,</span> <span class=n>T</span> <span class=n>value</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=kt>value_conf_t</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>T</span><span class=p>,</span> <span class=n>value</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=k>using</span> <span class=n>type_id</span> <span class=o>=</span> <span class=n>ID</span><span class=p>;</span>
<span class=p>};</span>

<span class=k>template</span><span class=o>&lt;</span><span class=kt>int</span> <span class=n>value</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>a</span> <span class=o>:</span> <span class=kt>value_conf_t</span><span class=o>&lt;</span><span class=n>a_id</span><span class=p>,</span> <span class=kt>int</span><span class=p>,</span> <span class=n>value</span><span class=o>&gt;</span> <span class=p>{};</span>

<span class=k>template</span><span class=o>&lt;</span><span class=kt>char</span> <span class=n>value</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>b</span> <span class=o>:</span> <span class=kt>value_conf_t</span><span class=o>&lt;</span><span class=n>b_id</span><span class=p>,</span> <span class=kt>char</span><span class=p>,</span> <span class=n>value</span><span class=o>&gt;</span> <span class=p>{};</span>
</pre><p>This make the next parameters easier to describe and avoids small mistakes.</p><p>Making <em>get_value_char</em> could be achieved by replacing each <em>int</em> by <em>char</em> but this would create a lot of duplicated code. So instead of writing <em>get_value_char</em>, we will replace <em>get_value_int</em> with a generic <em>get_value</em> that is able to extract any integral value type:</p><pre class="code c++ literal-block">
<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>get_value</span><span class=p>;</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T2</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>get_value</span><span class=o>&lt;</span><span class=n>D</span><span class=p>,</span> <span class=n>T2</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D2</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T22</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Enable</span> <span class=o>=</span> <span class=kt>void</span><span class=o>&gt;</span>
    <span class=k>struct</span> <span class=n>impl</span>
        <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>decltype</span><span class=p>(</span><span class=n>D</span><span class=o>::</span><span class=n>value</span><span class=p>),</span> <span class=n>get_value</span><span class=o>&lt;</span><span class=n>D</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=o>&gt;</span> <span class=p>{};</span>

    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D2</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T22</span><span class=o>&gt;</span>
    <span class=k>struct</span> <span class=n>impl</span> <span class=o>&lt;</span><span class=n>D2</span><span class=p>,</span> <span class=n>T22</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=kt>enable_if_t</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>is_same</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D2</span><span class=o>::</span><span class=n>type_id</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T22</span><span class=o>::</span><span class=n>type_id</span><span class=o>&gt;::</span><span class=n>value</span><span class=o>&gt;&gt;</span>
        <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>decltype</span><span class=p>(</span><span class=n>D</span><span class=o>::</span><span class=n>value</span><span class=p>),</span> <span class=n>T22</span><span class=o>::</span><span class=n>value</span><span class=o>&gt;</span> <span class=p>{};</span>

    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>value</span> <span class=o>=</span> <span class=n>impl</span><span class=o>&lt;</span><span class=n>D</span><span class=p>,</span> <span class=n>T2</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
<span class=p>};</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>get_value</span><span class=o>&lt;</span><span class=n>D</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=n>decltype</span><span class=p>(</span><span class=n>D</span><span class=o>::</span><span class=n>value</span><span class=p>),</span> <span class=n>D</span><span class=o>::</span><span class=n>value</span><span class=o>&gt;</span> <span class=p>{};</span>
</pre><p>This code is almost the same as get_value_int except that the return type is deduced from the value of the parameters. I used <em>decltype</em> and <em>auto</em> to automatically gets the correct types for the values. This is the only thing that changed.</p><p>With that we are ready the parameter c as well:</p><pre class="code c++ literal-block">
<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>configurable_v2</span> <span class=p>{</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>A</span> <span class=o>=</span> <span class=n>get_value</span><span class=o>&lt;</span><span class=n>a</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>B</span> <span class=o>=</span> <span class=n>get_value</span><span class=o>&lt;</span><span class=n>b</span><span class=o>&lt;</span><span class=sc>'b'</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>C</span> <span class=o>=</span> <span class=n>get_value</span><span class=o>&lt;</span><span class=n>c</span><span class=o>&lt;</span><span class=n>type</span><span class=o>::</span><span class=n>BBB</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>

    <span class=c1>//Coming
</span><span class=p>};</span>
</pre></div><div class=section id=extracting-boolean-flags><h2>Extracting boolean flags</h2><p>The parameter d is a bit different since it is a boolean flag that puts directly the value to true. We could simply make a integral boolean value (and this would work), but here I needed a boolean flag for activating a feature deactivated by default.</p><p>Defining the parameter is easy:</p><pre class="code c++ literal-block">
<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>ID</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=kt>basic_conf_t</span> <span class=p>{</span>
    <span class=k>using</span> <span class=n>type_id</span> <span class=o>=</span> <span class=n>ID</span><span class=p>;</span>
<span class=p>};</span>

<span class=k>struct</span> <span class=n>d_id</span><span class=p>;</span>
<span class=k>struct</span> <span class=n>d</span> <span class=o>:</span> <span class=kt>basic_conf_t</span><span class=o>&lt;</span><span class=n>d_id</span><span class=o>&gt;</span> <span class=p>{};</span>
</pre><p>It is similar to the other parameters, except that it has no value. You'll see later in this article why type_id is necessary here.</p><p>To check if the flag is present, we'll write the is_present template:</p><pre class="code c++ literal-block">
<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T1</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>is_present</span><span class=p>;</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T1</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T2</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>is_present</span><span class=o>&lt;</span><span class=n>T1</span><span class=p>,</span> <span class=n>T2</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>bool</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=n>is_same</span><span class=o>&lt;</span><span class=n>T1</span><span class=p>,</span> <span class=n>T2</span><span class=o>&gt;::</span><span class=n>value</span> <span class=o>||</span> <span class=n>is_present</span><span class=o>&lt;</span><span class=n>T1</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=o>&gt;</span> <span class=p>{};</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T1</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>is_present</span><span class=o>&lt;</span><span class=n>T1</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>false_type</span> <span class=p>{};</span>
</pre><p>This time, the template is much easier. We simply need to iterate through all the types from the variadic template parameter and test if the type is present somewhere. Again, you can see that we used two partial template specialization to handle the different cases.</p><p>With this we can now get the value for D:</p><pre class="code c++ literal-block">
<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>configurable_v2</span> <span class=p>{</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>A</span> <span class=o>=</span> <span class=n>get_value</span><span class=o>&lt;</span><span class=n>a</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>B</span> <span class=o>=</span> <span class=n>get_value</span><span class=o>&lt;</span><span class=n>b</span><span class=o>&lt;</span><span class=sc>'b'</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>C</span> <span class=o>=</span> <span class=n>get_value</span><span class=o>&lt;</span><span class=n>c</span><span class=o>&lt;</span><span class=n>type</span><span class=o>::</span><span class=n>BBB</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>D</span> <span class=o>=</span> <span class=n>is_present</span><span class=o>&lt;</span><span class=n>d</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>

    <span class=c1>//Coming
</span><span class=p>};</span>
</pre></div><div class=section id=extracting-types><h2>Extracting types</h2><p>The next parameter does not hold a value, but a type. It won't be an integral constant, but it will define a typedef value with the configured type:</p><pre class="code c++ literal-block">
<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>ID</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=kt>type_conf_t</span> <span class=p>{</span>
    <span class=k>using</span> <span class=n>type_id</span> <span class=o>=</span> <span class=n>ID</span><span class=p>;</span>
    <span class=k>using</span> <span class=n>value</span> <span class=o>=</span> <span class=n>T</span><span class=p>;</span>
<span class=p>};</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>e</span> <span class=o>:</span> <span class=kt>type_conf_t</span><span class=o>&lt;</span><span class=n>e_id</span><span class=p>,</span> <span class=n>T</span><span class=o>&gt;</span> <span class=p>{};</span>
</pre><p>You may think that the extracting will be very different, but in fact it very similar. And here it is:</p><pre class="code c++ literal-block">
<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>get_type</span><span class=p>;</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T2</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>get_type</span><span class=o>&lt;</span><span class=n>D</span><span class=p>,</span> <span class=n>T2</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D2</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T22</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Enable</span> <span class=o>=</span> <span class=kt>void</span><span class=o>&gt;</span>
    <span class=k>struct</span> <span class=n>impl</span> <span class=p>{</span>
        <span class=k>using</span> <span class=n>value</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>get_type</span><span class=o>&lt;</span><span class=n>D</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
    <span class=p>};</span>

    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D2</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T22</span><span class=o>&gt;</span>
    <span class=k>struct</span> <span class=n>impl</span> <span class=o>&lt;</span><span class=n>D2</span><span class=p>,</span> <span class=n>T22</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=kt>enable_if_t</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>is_same</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D2</span><span class=o>::</span><span class=n>type_id</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T22</span><span class=o>::</span><span class=n>type_id</span><span class=o>&gt;::</span><span class=n>value</span><span class=o>&gt;&gt;</span> <span class=p>{</span>
        <span class=k>using</span> <span class=n>value</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>T22</span><span class=o>::</span><span class=n>value</span><span class=p>;</span>
    <span class=p>};</span>

    <span class=k>using</span> <span class=n>value</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>impl</span><span class=o>&lt;</span><span class=n>D</span><span class=p>,</span> <span class=n>T2</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
<span class=p>};</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>get_type</span><span class=o>&lt;</span><span class=n>D</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=k>using</span> <span class=n>value</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>D</span><span class=o>::</span><span class=n>value</span><span class=p>;</span>
<span class=p>};</span>
</pre><p>Every integral constant has been replaced with alias declaration (with <em>using</em>) and we need to use the <em>typename</em> disambiguator in from of X::value, but that's it :) We could probably have created an integral_type struct to simplify it a bit further, but I don't think that would change a lot. The code of the class follows the same changes:</p><pre class="code c++ literal-block">
<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>configurable_v2</span> <span class=p>{</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>A</span> <span class=o>=</span> <span class=n>get_value</span><span class=o>&lt;</span><span class=n>a</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>B</span> <span class=o>=</span> <span class=n>get_value</span><span class=o>&lt;</span><span class=n>b</span><span class=o>&lt;</span><span class=sc>'b'</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>C</span> <span class=o>=</span> <span class=n>get_value</span><span class=o>&lt;</span><span class=n>c</span><span class=o>&lt;</span><span class=n>type</span><span class=o>::</span><span class=n>BBB</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>D</span> <span class=o>=</span> <span class=n>is_present</span><span class=o>&lt;</span><span class=n>d</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>

    <span class=k>using</span> <span class=n>E</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>get_type</span><span class=o>&lt;</span><span class=n>e</span><span class=o>&lt;</span><span class=n>watcher_1</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>

    <span class=c1>//Coming
</span><span class=p>};</span>
</pre></div><div class=section id=extracting-template-types><h2>Extracting template types</h2><p>The last parameter is not a type but a template, so there are some slight changes necessary to extract them. First, let's take a look at the parameter definition:</p><pre class="code c++ literal-block">
<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>ID</span><span class=p>,</span> <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=kt>template_type_conf_t</span> <span class=p>{</span>
    <span class=k>using</span> <span class=n>type_id</span> <span class=o>=</span> <span class=n>ID</span><span class=p>;</span>

    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>C</span><span class=o>&gt;</span>
    <span class=k>using</span> <span class=n>value</span> <span class=o>=</span> <span class=n>T</span><span class=o>&lt;</span><span class=n>C</span><span class=o>&gt;</span><span class=p>;</span>
<span class=p>};</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span><span class=o>&gt;</span> <span class=k>class</span> <span class=nc>T</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>f</span> <span class=o>:</span> <span class=kt>template_type_conf_t</span><span class=o>&lt;</span><span class=n>f_id</span><span class=p>,</span> <span class=n>T</span><span class=o>&gt;</span> <span class=p>{};</span>
</pre><p>Here instead of taking a simple type, we take a type template with one template parameter. This design has a great limitations. It won't be possible to use it for template that takes more than one template parameter. You have to create an extract template for each possible combination that you want to handle. In my case, I only had the case of a template with one template parameter, but if you have several combination, you'll have to write more code. It is quite simple code, since the adaptations are minor, but it is still tedious. Here is the <em>get_template_type</em> template:</p><pre class="code c++ literal-block">
<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>get_template_type</span><span class=p>;</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T2</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>get_template_type</span><span class=o>&lt;</span><span class=n>D</span><span class=p>,</span> <span class=n>T2</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D2</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T22</span><span class=p>,</span> <span class=k>typename</span> <span class=n>Enable</span> <span class=o>=</span> <span class=kt>void</span><span class=o>&gt;</span>
    <span class=k>struct</span> <span class=n>impl</span> <span class=p>{</span>
        <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>C</span><span class=o>&gt;</span>
        <span class=k>using</span> <span class=n>value</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>get_template_type</span><span class=o>&lt;</span><span class=n>D</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=k>template</span> <span class=n>value</span><span class=o>&lt;</span><span class=n>C</span><span class=o>&gt;</span><span class=p>;</span>
    <span class=p>};</span>

    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D2</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T22</span><span class=o>&gt;</span>
    <span class=k>struct</span> <span class=n>impl</span> <span class=o>&lt;</span><span class=n>D2</span><span class=p>,</span> <span class=n>T22</span><span class=p>,</span> <span class=n>std</span><span class=o>::</span><span class=kt>enable_if_t</span><span class=o>&lt;</span><span class=n>std</span><span class=o>::</span><span class=n>is_same</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D2</span><span class=o>::</span><span class=n>type_id</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T22</span><span class=o>::</span><span class=n>type_id</span><span class=o>&gt;::</span><span class=n>value</span><span class=o>&gt;&gt;</span> <span class=p>{</span>
        <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>C</span><span class=o>&gt;</span>
        <span class=k>using</span> <span class=n>value</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>T22</span><span class=o>::</span><span class=k>template</span> <span class=n>value</span><span class=o>&lt;</span><span class=n>C</span><span class=o>&gt;</span><span class=p>;</span>
    <span class=p>};</span>

    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>C</span><span class=o>&gt;</span>
    <span class=k>using</span> <span class=n>value</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>impl</span><span class=o>&lt;</span><span class=n>D</span><span class=p>,</span> <span class=n>T2</span><span class=o>&gt;::</span><span class=k>template</span> <span class=n>value</span><span class=o>&lt;</span><span class=n>C</span><span class=o>&gt;</span><span class=p>;</span>
<span class=p>};</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>D</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>get_template_type</span><span class=o>&lt;</span><span class=n>D</span><span class=o>&gt;</span> <span class=p>{</span>
    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>C</span><span class=o>&gt;</span>
    <span class=k>using</span> <span class=n>value</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>D</span><span class=o>::</span><span class=k>template</span> <span class=n>value</span><span class=o>&lt;</span><span class=n>C</span><span class=o>&gt;</span><span class=p>;</span>
<span class=p>};</span>
</pre><p>Again, there are only few changes. Every previous alias declaration is now a template alias declaration and we have to use <em>template</em> disambiguator in front of value. We now have the final piece to write the configurable_v2 class:</p><pre class="code c++ literal-block">
<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>configurable_v2</span> <span class=p>{</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>A</span> <span class=o>=</span> <span class=n>get_value</span><span class=o>&lt;</span><span class=n>a</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>B</span> <span class=o>=</span> <span class=n>get_value</span><span class=o>&lt;</span><span class=n>b</span><span class=o>&lt;</span><span class=sc>'b'</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>C</span> <span class=o>=</span> <span class=n>get_value</span><span class=o>&lt;</span><span class=n>c</span><span class=o>&lt;</span><span class=n>type</span><span class=o>::</span><span class=n>BBB</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>D</span> <span class=o>=</span> <span class=n>is_present</span><span class=o>&lt;</span><span class=n>d</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>

    <span class=k>using</span> <span class=n>E</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>get_type</span><span class=o>&lt;</span><span class=n>e</span><span class=o>&lt;</span><span class=n>watcher_1</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>

    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>C</span><span class=o>&gt;</span>
    <span class=k>using</span> <span class=n>F</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>get_template_type</span><span class=o>&lt;</span><span class=n>f</span><span class=o>&lt;</span><span class=n>trainer_1</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=k>template</span> <span class=n>value</span><span class=o>&lt;</span><span class=n>C</span><span class=o>&gt;</span><span class=p>;</span>
<span class=p>};</span>
</pre></div><div class=section id=validating-parameter-rules><h2>Validating parameter rules</h2><p>If you have more parameters and several classes that are configured in this manner, the user may use a wrong parameter in the list. In that case, nothing will happen, the parameter will simply be ignored. Sometimes, this behavior is acceptable, but sometimes it is better to make the code invalid. That's what we are going to do here by specifying a list of valid parameters and using static_assert to ensure this condition.</p><p>Here is the assertion:</p><pre class="code c++ literal-block">
<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>configurable_v2</span> <span class=p>{</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>A</span> <span class=o>=</span> <span class=n>get_value</span><span class=o>&lt;</span><span class=n>a</span><span class=o>&lt;</span><span class=mi>1</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>B</span> <span class=o>=</span> <span class=n>get_value</span><span class=o>&lt;</span><span class=n>b</span><span class=o>&lt;</span><span class=sc>'b'</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>C</span> <span class=o>=</span> <span class=n>get_value</span><span class=o>&lt;</span><span class=n>c</span><span class=o>&lt;</span><span class=n>type</span><span class=o>::</span><span class=n>BBB</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>
    <span class=k>static</span> <span class=n>constexpr</span> <span class=k>const</span> <span class=k>auto</span> <span class=n>D</span> <span class=o>=</span> <span class=n>is_present</span><span class=o>&lt;</span><span class=n>d</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>

    <span class=k>using</span> <span class=n>E</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>get_type</span><span class=o>&lt;</span><span class=n>e</span><span class=o>&lt;</span><span class=n>watcher_1</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>;</span>

    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>C</span><span class=o>&gt;</span>
    <span class=k>using</span> <span class=n>F</span> <span class=o>=</span> <span class=k>typename</span> <span class=n>get_template_type</span><span class=o>&lt;</span><span class=n>f</span><span class=o>&lt;</span><span class=n>trainer_1</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=k>template</span> <span class=n>value</span><span class=o>&lt;</span><span class=n>C</span><span class=o>&gt;</span><span class=p>;</span>

    <span class=n>static_assert</span><span class=p>(</span>
        <span class=n>is_valid</span><span class=o>&lt;</span><span class=n>tmp_list</span><span class=o>&lt;</span><span class=n>a_id</span><span class=p>,</span> <span class=n>b_id</span><span class=p>,</span> <span class=n>c_id</span><span class=p>,</span> <span class=n>d_id</span><span class=p>,</span> <span class=n>e_id</span><span class=p>,</span> <span class=n>f_id</span><span class=o>&gt;</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=p>,</span>
        <span class=s>"Invalid parameters type"</span><span class=p>);</span>

    <span class=c1>//Something useful
</span><span class=p>};</span>
</pre><p>Since the is_valid traits needs two variadic list of parameters, we have to encapsulate list of valid types in another structure (<em>tmp_list</em>) to separate the two sets. Here is the implementation of the validation:</p><pre class="code c++ literal-block">
<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span><span class=p>...</span> <span class=n>Valid</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>tmp_list</span> <span class=p>{</span>
    <span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>&gt;</span>
    <span class=k>struct</span> <span class=n>contains</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>bool</span><span class=p>,</span> <span class=n>is_present</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>T</span><span class=o>::</span><span class=n>type_id</span><span class=p>,</span> <span class=n>Valid</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=o>&gt;</span> <span class=p>{};</span>
<span class=p>};</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>L</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>is_valid</span><span class=p>;</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>L</span><span class=p>,</span> <span class=k>typename</span> <span class=n>T1</span><span class=p>,</span> <span class=k>typename</span><span class=p>...</span> <span class=n>Args</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>is_valid</span> <span class=o>&lt;</span><span class=n>L</span><span class=p>,</span> <span class=n>T1</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>integral_constant</span><span class=o>&lt;</span><span class=kt>bool</span><span class=p>,</span> <span class=n>L</span><span class=o>::</span><span class=k>template</span> <span class=n>contains</span><span class=o>&lt;</span><span class=n>T1</span><span class=o>&gt;::</span><span class=n>value</span> <span class=o>&amp;&amp;</span> <span class=n>is_valid</span><span class=o>&lt;</span><span class=n>L</span><span class=p>,</span> <span class=n>Args</span><span class=p>...</span><span class=o>&gt;::</span><span class=n>value</span><span class=o>&gt;</span> <span class=p>{};</span>

<span class=k>template</span><span class=o>&lt;</span><span class=k>typename</span> <span class=n>L</span><span class=o>&gt;</span>
<span class=k>struct</span> <span class=n>is_valid</span> <span class=o>&lt;</span><span class=n>L</span><span class=o>&gt;</span> <span class=o>:</span> <span class=n>std</span><span class=o>::</span><span class=n>true_type</span> <span class=p>{};</span>
</pre><p>The struct tmp_list has a single inner class (<em>contains</em>) that test if a given type is present in the list. For this, we reuse the is_present template that we created when extracting boolean flag. The <em>is_valid</em> template simply test that each parameter is present in the <em>tmp_list</em>.</p><p>Validation could also be made so that no parameters could be present twice, but I will put that aside for now.</p></div><div class=section id=conclusion><h2>Conclusion</h2><p>Here it is :)</p><p>We now have a set of template that allow us to configure a class at compile-time with named, optional, template parameters, with default and in any order. I personally thinks that this is a great way to configure a class at compile-time and it is also another proof of the power of C++. If you think that the code is complicated, don't forget that this is only the library code, the client code on contrary is at least as clear as the original version and even has several advantages.</p><p>I hope that this article interested you and that you learned something.</p><p>The code of this article is available on Github: <a class="reference external" href=https://github.com/wichtounet/articles/blob/master/src/named_template_par/configurable.cpp>https://github.com/wichtounet/articles/blob/master/src/named_template_par/configurable.cpp</a>It has been tested on Clang 3.5 and GCC 4.9.1.</p></div> </div> <a href=posts/2015/03/named-optional-template-parameters-compile-time.html#disqus_thread data-disqus-identifier=cache/posts/2015/03/named-optional-template-parameters-to-configure-a-class-at-compile-time.html>Comments</a> </article> <article class="postbox h-entry post-text"> <h1 class=p-name><a href=posts/2014/10/sonarqube-inspections-for-cpp-projects.html class=u-url>SonarQube inspections for C++ projects</a> <br><small>   Posted: <time class="published dt-published" datetime=2014-10-05T14:55:46+02:00>2014-10-05 14:55</time> </small></h1> <hr> <div class=p-summary> <p>Back in the days, when I used to develop in Java (I hadn't discovered the wonders of C++ :) ), I used Sonar a lot for my projects. Sonar is a great tool for quality inspections of a project. Sonar has been made for Java and is mostly free and opensource (some plugins are commercial) to inspect Java projects. Unfortunately, this is not the case for C++ inspection. Indeed, the C++ plugin cost 7000 euros (more than 8500$). As I mostly work on C++ for opensource and school projects, I'm definitely not able to buy it. I wanted for a long time to test the commercial C++ plugin. For this article, sonarsource provided me with a short (very short) time license for the C++ plugin.</p><p>There is also another option for C++ which is the C++ community plugin: <a class="reference external" href=https://github.com/wenns/sonar-cxx>https://github.com/wenns/sonar-cxx</a>. I have tested it some time ago, but I was not satisfied with it, I had several errors and had to use a dev version to make it work a bit. Moreover, the C++11 support is inexistant and management of parsing error is not really satisfying. But maybe it is good for you. This article will only focus on the commercial plugin.</p><div class=section id=usage><h2>Usage</h2><p>For each project that you want to analyze with Sonar, you have to create a sonar-project.properties files describing some basic information about your project.</p><p>Then, there are two ways to inspect a C++ project. The first one and recommended one is to use the <em>build-wrapper</em> executable. It is a sub project that you have to download and install alongside Sonar. It works by wrapping the commands to your build systems:</p><pre class=literal-block>
build-wrapper make all
</pre><p>and this should generate enough informations for not having to fill each field in the project configuration. The, you have to use the <em>sonar-runner</em> program to upload to Sonar.</p><p>I tried it on several projects and there seems to be a problem with the includes. It didn't include the header files in the Sonar inspections.</p><p>I finally ended up using manual configuration of the Sonar project and the header files were included correctly. However, you normally have to include many information in the configuration including all macros for instance. For now, I haven't bothered generating them and it doesn't seem to impact too much the results.</p><p>When I look in the log, it seems that there are still a lot of parsing errors. They seem mostly related to some compiler macro, especially the __has_feature__ macro of clang. This is the same problem with the build-wrapper. When I don't use the build-wrapper I also have other problems with macros for unit testing.</p><p>I also have other errors coming during the inspection, for instance:</p><pre class=literal-block>
error directive: This file requires compiler and library support for the ISO C++
2011 standard. This support is currently experimental, and must be enabled with
the -std=c++11 or -std=gnu++11 compiler options
</pre><p>I think it comes from the fact that I compile with std=c++1y and that Sonar does not support C++14.</p></div><div class=section id=inspections><h2>Inspections</h2><p>Here is the results of inspection on my ETL project:</p><img alt=/images/etl_dashboard.png src=images/etl_dashboard.png><p>I really like the web interface of Sonar, it really sums well all the information and the various plugins play quite nice with each other. Moreover, when you check issues, you can see directly the source code very clearly. I really think this is the strong point of Sonar.</p><p>Here is the Hotspots view for instance:</p><img alt=/images/etl_dashboard.png src=images/etl_dashboard.png><p>Or the Time Machine view:</p><img alt=/images/etl_dashboard.png src=images/etl_dashboard.png><p>The issues that are reported by Sonar are quite good. On this project there is a lot of them related to naming conventions because I don't follow the conventions configured by default. However, you can easily configure the inspections to give your own naming regex or simple enable/disable some inspections.</p><p>There are some good inspections:</p><ul class=simple><li>Some missing explicit keyword</li><li>Some commented block of code that can be removed</li><li>An if-elseif construct that should have had a else</li><li>Files with too high complexity</li></ul><p>However, there are also some important false positives. For instance:</p><img alt=/images/etl_false_positive_1.png src=images/etl_false_positive_1.png><p>In here, there are no reasons to output this issue since the operator is deleted. It proves that the C++11 support is rather incomplete. I have other false positives of the same kind for <em>= default</em> operators and constructors. Here is another example:</p><img alt=/images/etl_false_positive_2.png src=images/etl_false_positive_2.png><p>In this case, the varadic template support is mixed with the old ellipsis notation, making it again a lack of C++11 support. There are also other false positives for instance because of lambdas, but all of them were related to C++11.</p></div><div class=section id=various><h2>Various</h2><p>If you don't think you have enough quality rules, you can also include the one from cppcheck simply by givin the path to cppcheck in sonar-project.properties. I think this is great, since it works all by itself. You can also create your own rule, but you'll have to use XPath for path.</p><p>If you want, you can also include unit test reports inside Sonar. I haven't tested this support since they only support cppunit test reports and I use only Catch for my unit tests. It would have been great if JUnit format would have been supported since many tool support it.</p><p>The last option that is supported by this plugin is the support of GCOV reports for code coverage information. I haven't been able to make it work, I had errors indicating that the source files were not found. I didn't figure this out. It may come from the fact that I used llvm and clang to generate the GCOV reports and not G++.</p></div><div class=section id=conclusion><h2>Conclusion</h2><p>First, here are some pros and cons for the C++ support in SonarQube.</p><p><strong>Pros</strong></p><ul class=simple><li>Good default inspections</li><li>Great web interface.</li><li>cppcheck very well integrated</li><li>Issues are easily configurable</li></ul><p><strong>Cons</strong></p><ul class=simple><li>C++11 support is incomplete and no C++14 support</li><li>build-wrapper support seems instable. It should be integrated directly into sonar.</li><li>Unit tests support is limited to cppunit</li><li>Haven't been able to make Code Coverage work</li><li>Macro support not flexible enough</li><li>Too expensive</li><li>Quite complicated</li><li>No support for other static analyzer than cppcheck</li></ul><p>The general web interface feeling is quite good, everything looks great and the report are really useful. However, the usage of the tool does not feel very professional. I had a lot more problems than I expected to use it. I was also really disappointed by the C++11. The syntax seems to be supported but not the language feature in the inspections, making the C++11 support completely useless. This is weird since they cite C+11 as supported. Moreover, there not yet any C++14 support, but this is less dramatic. It is also a bit sad that they limit the import to cppcheck and no other static analyzers and the same stands for cppunit.</p><p>In my opinion, it is really an inferior product compared to the Java support. I was expecting more from a 8500 dollars product.</p><p>For now, I won't probably use it anymore on my projects since all of them use at least C++11, but I will probably retry Sonar for C++ in the future hoping that it will become as the Sonar Java support.</p></div> </div> <a href=posts/2014/10/sonarqube-inspections-for-cpp-projects.html#disqus_thread data-disqus-identifier=cache/posts/2014/10/sonarqube-inspections-for-cpp-projects.html>Comments</a> </article> <article class="postbox h-entry post-text"> <h1 class=p-name><a href=posts/2014/10/linux-tip-force-systemd-networkd-to-wait-for-dhcp.html class=u-url>Linux tip: Force systemd networkd to wait for DHCP</a> <br><small>   Posted: <time class="published dt-published" datetime=2014-10-01T20:18:55+02:00>2014-10-01 20:18</time> </small></h1> <hr> <div class=p-summary> <p>Recently, I started using systemd-networkd to manage my network. It works really good for static address configuration, but I experienced some problem with DHCP. There is DHCP client support integrated into systemd, so I wanted to use this instead of using another DHCP client.</p><p>(If you are not familiar with systemd-networkd, you can have a look at the last section of this article)</p><p>The problem with that is that services are not waiting for DHCP leases to be obtained. Most services (sshd for instance), are waiting for network.target, however, network.target does not wait for the DHCP lease to be obtained from the server. If you configured ssh on a specific IP and this IP is obtained with DHCP, it will fail at startup. The same is true for NFS mounts for instance.</p><div class=section id=force-services-to-wait-for-the-network-to-be-configured><h2>Force services to wait for the network to be configured</h2><p>The solution is to make services like sshd waits for network-online.target instead of network.target. There is a simple way in systemd to override default service files. For a X.service, systemd will also parse all the /etc/systemd/X.service.d/*.conf files.</p><p>For instance, to make sshd be started only after DHCP is finished</p><p>/etc/systemd/systemd/sshd.service.d/network.conf:</p><pre class=literal-block>
[Unit]
Wants=network-online.target
After=network-online.target
</pre><p>However, by default, network-online.target does not wait for anything. You'll have to enable another service to make it work:</p><pre class=literal-block>
systemctl enable systemd-networkd-wait-online
</pre><p>And another note, at least on Gentoo, I had to use systemd-216 for it to work:</p><pre class=literal-block>
emerge -a "=sys-apps/systemd-216"
</pre><p>And after this, it worked like a charm at startup.</p></div><div class=section id=force-nfs-mounts-to-wait-for-the-network><h2>Force NFS mounts to wait for the network</h2><p>There is no service file for nfs mounts, but there is a target remote-fs.target that groups the remote file systems mounts. You can override its configuration in the same as a service:</p><p>/etc/systemd/systemd/remote-fs.target.d/network.conf:</p><pre class=literal-block>
[Unit]
Wants=network-online.target
After=network-online.target
</pre></div><div class=section id=conclusion><h2>Conclusion</h2><p>Here we are, I hope this tip will be useful to some of you ;)</p></div><div class=section id=appendix-configure-interface-with-dhcp-with-systemd><h2>Appendix. Configure interface with DHCP with systemd</h2><p>To configure an interface with DHCP, you have to create a .network file in /etc/systemd/network/. For instance, here is my /etc/systemd/network/local.network file:</p><pre class="code literal-block">
[Match]
Name=enp3s0

[Network]
DHCP=v4
</pre><p>and you have to enable systemd-networkd:</p><pre class=literal-block>
systemctl enable systemd-networkd
</pre></div> </div> <a href=posts/2014/10/linux-tip-force-systemd-networkd-to-wait-for-dhcp.html#disqus_thread data-disqus-identifier=cache/posts/2014/10/linux-tip-force-systemd-networkd-to-wait-for-dhcp.html>Comments</a> </article> <article class="postbox h-entry post-text"> <h1 class=p-name><a href=posts/2014/09/budgetwarrior-041-expense-templates-and-year-projection.html class=u-url>budgetwarrior 0.4.1 - Expense templates and year projection</a> <br><small>   Posted: <time class="published dt-published" datetime=2014-09-21T20:53:53+02:00>2014-09-21 20:53</time> </small></h1> <hr> <div class=p-summary> <p>I've been able to finish the version 0.4.1 of budgetwarrior before I though :)</p><div class=section id=expense-templates><h2>Expense templates</h2><p>The "most useful" new feature of this release is the ability to create template for expenses.</p><p>For that, you can give an extra parameter to budget expense add:</p><pre class=literal-block>
budget expense add template name
</pre><p>This will works exactly the same as creating a new expense expect that it will be saved as a template. Then, the next time you do:</p><pre class=literal-block>
budget expense add template name
</pre><p>A new expense will be created with the date of the day and with the name and amount saved into the template. You can create as many templates as you want as long as they have different names. You can see all the templates you have by using 'budget expense template'. A template can be deleted the exact same as an expense with 'budget expense delete id'.</p><p>I think this is very useful for expense that are made several times a month, for instance a coffee at your workplace. The price should not change a lot and it is faster to just use the template name rather than entering all the information again.</p></div><div class=section id=year-prediction><h2>Year prediction</h2><p>You can now see what would be next year if you changed a bit your expenses. For instance, how much would you still have at the end of the year if you increased your house expenses by 20% and reduced your insurances by 5% ?</p><p>The 'budget predict' can be used for that purpose. You can enter a multiplier for each account in your budget and a new year will be "predicted" based on the expenses of the current year multiplied by the specified multiplier:</p><img alt=/images/budget_041_prediction.png src=images/budget_041_prediction.png><p>I think that this feature can be very useful if you want to estimate how your budget will be for moving to a more expensive house or another insurance for instance.</p></div><div class=section id=various-changes><h2>Various changes</h2><p>Two accounts can be merged together with the 'budget account migrate' command. This command will move all expenses from an account to another and adapt the amount of the target account. The source account will be deleted. This supports migrated accounts.</p><p>The 'budget wish list' command will now display the mean accuracy of your predictions.</p><p>You don't need Boost anymore for this project. The only remaining dependency is libuuid. I will perhaps remove it in the next version since the UUID are not used in the application for now.</p><p>The command 'budget gc' will clean the IDs of all your data in order to fill the holes and make all the IDs contiguous. It is mostly a feature for order-freaks like me who do not like to have holes in a sequence of identifiers ;)</p><p>There was a bug in the monthly report causing the scale to be displayed completely moved, it is now fixed:</p><img alt=https://raw.githubusercontent.com/wichtounet/budgetwarrior/develop/screenshots/budget_report.png src=https://raw.githubusercontent.com/wichtounet/budgetwarrior/develop/screenshots/budget_report.png></div><div class=section id=installation><h2>Installation</h2><p>If you are on Gentoo, you can install it using layman:</p><pre class=literal-block>
layman -a wichtounet
emerge -a budgetwarrior
</pre><p>If you are on Arch Linux, you can use this <a class="reference external" href=https://github.com/StreakyCobra/aur>AUR repository</a>.</p><p>For other systems, you'll have to install from sources:</p><pre class=literal-block>
git clone git://github.com/wichtounet/budgetwarrior.git
cd budgetwarrior
make
sudo make install
</pre></div><div class=section id=conclusion><h2>Conclusion</h2><p>If you are interested by the sources, you can download them on Github: <a class="reference external" href=https://github.com/wichtounet/budgetwarrior>budgetwarrior</a>.</p><p>If you have a suggestion for a new features or you found a bug, please post an issue on Github, I'd be glad to help you.</p><p>If you have any comment, don't hesitate to contact me, either by letting a comment on this post or by email.</p></div> </div> <a href=posts/2014/09/budgetwarrior-041-expense-templates-and-year-projection.html#disqus_thread data-disqus-identifier=cache/posts/2014/09/budgetwarrior-041-expense-templates-and-year-projection.html>Comments</a> </article> <article class="postbox h-entry post-text"> <h1 class=p-name><a href=posts/2014/09/short-introduction-to-deep-learning.html class=u-url>Short introduction to deep learning</a> <br><small>   Posted: <time class="published dt-published" datetime=2014-09-12T20:41:58+02:00>2014-09-12 20:41</time> </small></h1> <hr> <div class=p-summary> <p>At my school, I gave a short presentation about Deep Learning and the implementation I made in C++.</p><p>It is nothing fancy, but it could be interesting to someone.</p><div style=text-align:center;><iframe src=//www.slideshare.net/slideshow/embed_code/39024941 width=476 height=400 frameborder=0 marginwidth=0 marginheight=0 scrolling=no></iframe></div><p>Don't hesitate if you have any comments or questions about the presentation ;)</p><p>The implementation is here: <a class="reference external" href=https://github.com/wichtounet/dll>https://github.com/wichtounet/dll</a></p> </div> <a href=posts/2014/09/short-introduction-to-deep-learning.html#disqus_thread data-disqus-identifier=cache/posts/2014/09/short-introduction-to-deep-learning.html>Comments</a> </article> <article class="postbox h-entry post-text"> <h1 class=p-name><a href=posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html class=u-url>A Mutt journey: Search mails with notmuch</a> <br><small>   Posted: <time class="published dt-published" datetime=2014-08-02T17:24:12+02:00>2014-08-02 17:24</time> </small></h1> <hr> <div class=p-summary> <p>In the previous installment in the Mutt series, <a class="reference external" href=http://baptiste-wicht.com/posts/2014/07/a-mutt-journey-my-mutt-configuration.html>I've talked about my Mutt configuration</a>. In this post, I'll talk about notmuch and how to use it to search through mails.</p><p>By default, you can search mails in Mutt by using the / key. By doing that, you can only search in the current folder. This is very fast, but this is not always what you want. When you don't know in which folder the mail you are looking for is, you don't want to test each folder. By default, there are no feature to achieve global searching in Mutt.</p><p>That is where notmuch comes to the rescue. notmuch is a very simple tool that allows you to search through your mail. As its name indicates, it does not do much. It doesn't download your mails, you have to have them locally, which is perfect <a class="reference external" href=http://baptiste-wicht.com/posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html>if you use offlineimap</a>. It does not provide a user interface, but you can query it from the command line and it can be used from other tools. It should be available in most of the distributions.</p><div class=section id=configuration><h2>Configuration</h2><p>The configuration of notmuch is fairly simple. You can write your <code>.notmuch-config</code> directly or run <code>notmuch setup</code> that will interactively help you to fill the configuration.</p><p>Here is my configuration:</p><pre class="code literal-block">
[database]
path=/data/oi/Gmail/

[user]
name=Baptiste Wicht
primary_email=baptiste.wicht@gmail.com

[new]
tags=inbox
ignore=

[search]
exclude_tags=deleted;

[maildir]
synchronize_flags=true
</pre><p>It needs of cours the place where your mails are stored. Then, some information about you. The next section is to specify which tags you want to add to new mails. Here, I specified that each new mail must be tagged with <cite>inbox</cite>. You can add several tags to new mails. In the <cite>[search]</cite> section, the excluded tags are specified.</p></div><div class=section id=usage><h2>Usage</h2><p>Once you have configured notmuch, you can run <cite>notmuch new</cite> to process all existing mails. The first run may take some time (in minutes, it is still quite fast), but the subsequent runs will be very fast. You should run notmuch after each offlineimap run. I personally run it in a shell script that is run by cron. You could also use one of the hooks of offlineimap to run notmuch.</p><p>Once indexing has been done, you can start searching your mails. The first option to search mail is simply to use <cite>notmuch search &lt;query&gt;</cite> from the command line. This will directly displays the results. Search is instant on my mails.</p><p>If you use mutt-kz like me, notmuch support is directly integrated. You can type X, and then type your query like <code>notmuch://?query=X</code> and the results will be displayed as a normal Mutt folder. You can open mails directly from here and you can also edit the mails as if you were in their source folders. This is really practical.</p><p>If you use mutt, you can have the same experience, by using the <cite>notmuch-mutt</cite>patch (<cite>here &lt;http://notmuchmail.org/notmuch-mutt/&gt;</cite>). In several distributions, there is an option to build it with this support or another package to add the feature.</p><p>Another feature of notmuch is its ability to tag mails. It automatically tags new mails and deleted mails. But you can also explicitely tag messages by using <code>notmuch tag</code>. For instance, to tag all messages from the notmuch mailing list:</p><pre class="code literal-block">
notmuch tag +notmuch -- tag:new and to:notmuch@notmuchmail.org
</pre><p>I personally don't use this feature since I use imapfilter and IMAP folders to sort my mail, but it can be very useful. You can run these commands in the cronjob and always have you tags up to date. Tags can then be used in notmuch to search or to create virtual folder in Mutt.</p></div><div class=section id=conclusion><h2>Conclusion</h2><p>That is already more or less everything that there is to know about notmuch. It does not do a lot of thing, but it does them really well.</p><p>That concludes the series of posts on Mutt. If you have any question on my Mutt configuration, I'd be glad to extend on the comments.</p></div> </div> <a href=posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html#disqus_thread data-disqus-identifier=cache/posts/2014/08/a-mutt-journey-search-mails-with-notmuch.html>Comments</a> </article> <article class="postbox h-entry post-text"> <h1 class=p-name><a href=posts/2014/07/catch-powerful-yet-simple-cpp-test-framework.html class=u-url>Catch: A powerful yet simple C++ test framework</a> <br><small>   Posted: <time class="published dt-published" datetime=2014-07-28T13:21:49+02:00>2014-07-28 13:21</time> </small></h1> <hr> <div class=p-summary> <p>Recently, I came accross a new test framework for C++ program: Catch.</p><p>Until I found Catch, I was using Boost Test Framework. It is working quite well, but the problem is that you need to build Boost and link to the Boost Test Framework, which is not highly convenient. I wanter something lighter and easier to integrate.</p><p>Catch is header only, you only have to include one header for each test file. Moreover, it is very easy to combine several source files without linking problems.</p><div class=section id=usage><h2>Usage</h2><p>The usage is really simple. Here is a basic example:</p><pre class="code cpp literal-block">
<span class=cp>#define CATCH_CONFIG_MAIN
#include "catch.hpp"
</span>
<span class=n>TEST_CASE</span><span class=p>(</span> <span class=s>"stupid/1=2"</span><span class=p>,</span> <span class=s>"Prove that one equals 2"</span> <span class=p>){</span>
    <span class=kt>int</span> <span class=n>one</span> <span class=o>=</span> <span class=mi>1</span><span class=p>;</span>
    <span class=n>REQUIRE</span><span class=p>(</span> <span class=n>one</span> <span class=o>==</span> <span class=mi>2</span> <span class=p>);</span>
<span class=p>}</span>
</pre><p>The define is made to ensure that Catch will generate a main for you. This should only defined in one of your tests files if you have several. You define a new test case using the <code>TEST_CASE</code> macro. There are two parameters, the first one is the name of the test case, you can use any name, you don't have to use a valid C++ name. The second parameter is a longer description of the test case.</p><p>You then use <code>REQUIRE</code> to verify a condition. You can also use <code>CHECK</code> to verify a condition, the difference being that it does not stop if the condition is not true. <code>CHECK</code> is a good tool to put together some conditions that are related. There also exists <code>REQUIRE_FALSE</code> and <code>CHECK_FALSE</code> versions.</p><p>As you can see, there are no <code>REQUIRE_EQUALS</code> or things like that, you can use any comparison operator you want in the <code>REQUIRE</code>.</p><p>This produces an executable that will, by default, run every test contained in the executable. You can also configure the output report to be XML or JUnit if you want or run a subset of your tests. Take a look at the command line usage by running the executable with the -h option if you want more information.</p><p>Here is the result of the previous test:</p><pre class=literal-block>
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
catch_test_1 is a Catch v1.0 b52 host application.
Run with -? for options

-------------------------------------------------------------------------------
stupid/1=2
-------------------------------------------------------------------------------
src/catch/test1.cpp:4
...............................................................................

src/catch/test1.cpp:6: FAILED:
  REQUIRE( one == 2 )
with expansion:
  1 == 2

===============================================================================
test cases: 1 | 1 failed
assertions: 1 | 1 failed
</pre><p>For each failed condition, the source location is printed as well as some information on the test that failed. What is also interesting is the "with expansion" information that shows LHS and RHS of the comparison operator.</p><p>You can also check for exceptions with several macros:</p><ul class=simple><li><code>REQUIRE_THROWS(expression)</code> and <code>CHECK_THROWS(expression)</code>verify that an exception is thrown when the given expresssion is evaluated.</li><li><code>REQUIRE_THROWS_AS(expression, exception_type)</code> and <code>CHECK_THROWS_AS(expression, exception_type)</code> verify the the given exception is thrown.</li><li><code>REQUIRE_NOTHROW(expression)</code> and <code>CHECK_NOTHROW(expression)</code>verify that no exception is thrown.</li></ul></div><div class=section id=conclusion><h2>Conclusion</h2><p>I have only covered the most basic features, there is more that you can do with Catch: fixtures, logging and BDD-style test cases for instance. For more information you can read the <a class="reference external" href=https://github.com/philsquared/Catch/blob/master/docs/reference-index.md>reference documentation</a>.</p><p>I'm really satisfied with this framework. It also can be used for Objective-C if you are interested. You can download Catch <a class="reference external" href=https://github.com/philsquared/Catch>on Github</a>.</p><p>If you want more examples, you can take a look at the <a class="reference external" href=https://github.com/wichtounet/etl/tree/master/test>ETL</a> tests that are all made with Catch.</p></div> </div> <a href=posts/2014/07/catch-powerful-yet-simple-cpp-test-framework.html#disqus_thread data-disqus-identifier=cache/posts/2014/07/catch-powerful-yet-simple-cpp-test-framework.html>Comments</a> </article> <article class="postbox h-entry post-text"> <h1 class=p-name><a href=posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html class=u-url>ETL - C++ library for vector and matrix computations</a> <br><small>   Posted: <time class="published dt-published" datetime=2014-07-25T10:46:33+02:00>2014-07-25 10:46</time> </small></h1> <hr> <div class=p-summary> <p>When working on Machine Learning algorithms, I was in need of a simple library to ease working with vectors and matrix. This is the reason why I started developing ETL (Expression Template Library).</p><p>ETL is a small header only library for C++ that provides vector and matrix classes with support for Expression Templates to perform very efficient operations on them.</p><p>The library supports statically sized and dynamically sized vector and matrix structures with efficient element-wise operations. All the operations are implemented lazily with Expression Templates, they are only implemented once the expression is assigned to a concrete structure.</p><div class=section id=data-structures><h2>Data structures</h2><p>Several structures are available:</p><ul class=simple><li><code>fast_vector&lt;T, Rows&gt;</code>: A vector of size Rows with elements of type T. This must be used when you know the size of the vector at compile-time.</li><li><code>dyn_vector&lt;T&gt;</code>: A vector with element of type T. The size of the vector can be set at runtime.</li><li><code>fast_matrix&lt;T, Rows,Columns&gt;</code>: A matrix of size Rows x Columns with elements of type T. This must be used when you know the size of the matrix at compile-time.</li><li><code>dyn_matrix&lt;T&gt;</code>: A matrix with element of type T. The size of the matrix can be set at runtime.</li></ul><p>All the structures are size-invariant, once set they cannot be grown or shrinked.</p><p>In every operations that involves fast version of the structures, all the sizes are known at compile-time, this gives the compiler a lot of opportunities for optimization.</p></div><div class=section id=element-wise-operations><h2>Element-wise operations</h2><p>Classic element-wise operations can be done on vector and matrix as if it was done on scalars. Matrices and vectors can also be added, subtracted, divided, ... by scalars.</p><p>Here is an example of what can be done:</p><pre class="code cpp literal-block">
<span class=n>etl</span><span class=o>::</span><span class=n>dyn_vector</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span> <span class=n>a</span><span class=p>({</span><span class=mf>1.0</span><span class=p>,</span><span class=mf>2.0</span><span class=p>,</span><span class=mf>3.0</span><span class=p>});</span>
<span class=n>etl</span><span class=o>::</span><span class=n>dyn_vector</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span> <span class=n>b</span><span class=p>({</span><span class=mf>3.0</span><span class=p>,</span><span class=mf>2.0</span><span class=p>,</span><span class=mf>1.0</span><span class=p>});</span>

<span class=n>etl</span><span class=o>::</span><span class=n>dyn_vector</span><span class=o>&lt;</span><span class=kt>double</span><span class=o>&gt;</span> <span class=n>c</span><span class=p>(</span><span class=mf>1.4</span> <span class=o>*</span> <span class=p>(</span><span class=n>a</span> <span class=o>+</span> <span class=n>b</span><span class=p>)</span> <span class=o>/</span> <span class=n>b</span> <span class=o>+</span> <span class=n>b</span> <span class=o>+</span> <span class=n>a</span> <span class=o>/</span> <span class=mf>1.2</span><span class=p>);</span>
</pre><p>All the operations are only executed once the expression is evaluated to construct the dyn_vector. No temporaries are involved. This is as efficient as if a single for loop was used and each element was computed directly.</p><p>You can easily assign the same value to a structure by using the operator = on it.</p></div><div class=section id=unary-operators><h2>Unary operators</h2><p>Several unary operators are available. Each operation is performed on every element of the vector or the matrix.</p><p>Available operators:</p><ul class=simple><li><code>log</code></li><li><code>abs</code></li><li><code>sign</code></li><li><code>max/min</code></li><li><code>sigmoid</code></li><li><code>noise</code>: Add standard normal noise to each element</li><li><code>logistic_noise</code>: Add normal noise of mean zero and variance sigmoid(x) to each element</li><li><code>exp</code></li><li><code>softplus</code></li><li><code>bernoulli</code></li></ul><p>Several transformations are also available:</p><ul class=simple><li><code>hflip</code>: Flip the vector or the matrix horizontally</li><li><code>vflip</code>: Flip the vector or the matrix vertically</li><li><code>fflip</code>: Flip the vector or the matrix horizontally and vertically. It is the equivalent of <code>hflip(vflip(x))</code></li><li><code>dim/row/col</code>: Return a vector representing a sub part of a matrix (a row or a col)</li><li><code>reshape</code>: Interpret a vector as a matrix</li></ul><p>Again, all these operations are performed lazily, they are only executed when the expression is assigned to something.</p></div><div class=section id=lazy-evaluation><h2>Lazy evaluation</h2><p>All binary and unary operations are applied lazily, only when they are assigned to a concrete vector or matrix class.</p><p>The expression can be evaluated using the <code>s(x)</code> function that returns a concrete class (fast_vector,fast_matrix,dyn_vector,dyn_matrix) based on the expression.</p></div><div class=section id=reduction><h2>Reduction</h2><p>Several reduction functions are available:</p><ul class=simple><li>sum: Return the sum of a vector or matrix</li><li>mean: Return the sum of a vector or matrix</li><li>dot: Return the dot product of two vector or matrices</li></ul></div><div class=section id=functions><h2>Functions</h2><p>The header <em>convolution.hpp</em> provides several convolution operations both in 1D (vector) and 2D (matrix). All the convolution are available in valid, full and same versions.</p><p>The header <em>mutiplication.hpp</em> provides the matrix multiplication operation (<code>mmult</code>). For now on, only the naive algorithm is available. I'll probably add support for Strassen algorithm in the near future.</p><p>It is possible to pass an expression rather than an data structure to functions. You have to keep in mind that expression are lazy, therefore if you pass a + b to a matrix multiplication, an addition will be run each time an element is accessed (n^3 times), therefore, it is rarely efficient.</p></div><div class=section id=examples><h2>Examples</h2><p>Here are some examples of these operators (taken from my Machine Learning Library):</p><pre class="code cpp literal-block">
<span class=n>h_a</span> <span class=o>=</span> <span class=n>sigmoid</span><span class=p>(</span><span class=n>b</span> <span class=o>+</span> <span class=n>mmul</span><span class=p>(</span><span class=n>reshape</span><span class=o>&lt;</span><span class=mi>1</span><span class=p>,</span> <span class=n>num_visible</span><span class=o>&gt;</span><span class=p>(</span><span class=n>v_a</span><span class=p>),</span> <span class=n>w</span><span class=p>,</span> <span class=n>t</span><span class=p>));</span>
<span class=n>h_s</span> <span class=o>=</span> <span class=n>bernoulli</span><span class=p>(</span><span class=n>h_a</span><span class=p>);</span>
</pre><pre class="code cpp literal-block">
<span class=n>h_a</span> <span class=o>=</span> <span class=n>min</span><span class=p>(</span><span class=n>max</span><span class=p>(</span><span class=n>b</span> <span class=o>+</span> <span class=n>mmul</span><span class=p>(</span><span class=n>reshape</span><span class=o>&lt;</span><span class=mi>1</span><span class=p>,</span> <span class=n>num_visible</span><span class=o>&gt;</span><span class=p>(</span><span class=n>v_a</span><span class=p>),</span> <span class=n>w</span><span class=p>,</span> <span class=n>t</span><span class=p>),</span> <span class=mf>0.0</span><span class=p>),</span> <span class=mf>6.0</span><span class=p>);</span>
<span class=n>h_s</span> <span class=o>=</span> <span class=n>ranged_noise</span><span class=p>(</span><span class=n>h_a</span><span class=p>,</span> <span class=mf>6.0</span><span class=p>);</span>
</pre><pre class="code cpp literal-block">
<span class=n>weight</span> <span class=n>exp_sum</span> <span class=o>=</span> <span class=n>sum</span><span class=p>(</span><span class=n>exp</span><span class=p>(</span><span class=n>b</span> <span class=o>+</span> <span class=n>mmul</span><span class=p>(</span><span class=n>reshape</span><span class=o>&lt;</span><span class=mi>1</span><span class=p>,</span> <span class=n>num_visible</span><span class=o>&gt;</span><span class=p>(</span><span class=n>v_a</span><span class=p>),</span> <span class=n>w</span><span class=p>,</span> <span class=n>t</span><span class=p>)));</span>

<span class=n>h_a</span> <span class=o>=</span> <span class=n>exp</span><span class=p>(</span><span class=n>b</span> <span class=o>+</span> <span class=n>mmul</span><span class=p>(</span><span class=n>reshape</span><span class=o>&lt;</span><span class=mi>1</span><span class=p>,</span> <span class=n>num_visible</span><span class=o>&gt;</span><span class=p>(</span><span class=n>v_a</span><span class=p>),</span> <span class=n>w</span><span class=p>,</span> <span class=n>t</span><span class=p>))</span> <span class=o>/</span> <span class=n>exp_sum</span><span class=p>;</span>

<span class=k>auto</span> <span class=n>max</span> <span class=o>=</span> <span class=n>std</span><span class=o>::</span><span class=n>max_element</span><span class=p>(</span><span class=n>h_a</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span> <span class=n>h_a</span><span class=p>.</span><span class=n>end</span><span class=p>());</span>

<span class=n>h_s</span> <span class=o>=</span> <span class=mf>0.0</span><span class=p>;</span>
<span class=n>h_s</span><span class=p>(</span><span class=n>std</span><span class=o>::</span><span class=n>distance</span><span class=p>(</span><span class=n>h_a</span><span class=p>.</span><span class=n>begin</span><span class=p>(),</span> <span class=n>max</span><span class=p>))</span> <span class=o>=</span> <span class=mf>1.0</span><span class=p>;</span>
</pre></div><div class=section id=conclusion><h2>Conclusion</h2><p>This library is available on Github: <a class="reference external" href=https://github.com/wichtounet/etl>etl</a>. It is licensed under MIT license.</p><p>It is header-only, therefore you don't have to build it. However, it uses some recent C++14 stuff, you'll need a recent version of Clang or G++ to be able to use it.</p><p>If you find an issue or have an idea to improve it, just post it on Github or as a comment here and I'll do my best to work on that. If you have any question on the usage of the library, I'd be glad to answer them.</p></div> </div> <a href=posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html#disqus_thread data-disqus-identifier=cache/posts/2014/07/etl-cpp-library-for-vector-and-matrix-computations.html>Comments</a> </article> <article class="postbox h-entry post-text"> <h1 class=p-name><a href=posts/2014/07/a-mutt-journey-my-mutt-configuration.html class=u-url>A Mutt journey: Mutt configuration</a> <br><small>   Posted: <time class="published dt-published" datetime=2014-07-22T22:14:32+02:00>2014-07-22 22:14</time> </small></h1> <hr> <div class=p-summary> <p>If you've followed my Mutt posts, you'll know that I'm <a class="reference external" href=posts/2014/07/a-mutt-journey-filter-mails-with-imapfilter.html>filtering my mails with imapfilter</a> and <a class="reference external" href=posts/2014/07/a-mutt-journey-download-mails-with-offlineimap.html>downloading them with offlineimap</a>.</p><p>In this post, I'll share my Mutt configuration. I'm not using Mutt directly, but mutt-kz which is a fork with good notmuch integration. For this post, it won't change anything.</p><div class=section id=configuration><h2>Configuration</h2><p>The complete configuration is made in the .muttrc file. Mutt configuration supports the source command so that you can put some of your settings in another files and source them from the .muttrc file. You'll see that the configuration can soon grow large and therefore, splitting it in several files will save you a lot of maintenance issues ;)</p><p>First, let's tell Mutt who we are:</p><pre class=literal-block>
set from = "baptiste.wicht@gmail.com"
set realname = "Baptiste Wicht"
</pre></div><div class=section id=receive-mail><h2>Receive mail</h2><p>As I'm using offlineimap to get my mails, there is no IMAP settings in my configuration. But you need to tell Mutt where the mails are:</p><pre class=literal-block>
set folder = /data/oi/

set spoolfile = "+Gmail/INBOX"
set postponed = "+Gmail/drafts"

source ~/.mutt/mailboxes
</pre><p>The spoolfile and postponed are specifying the inbox and draft mailboxes. The .mutt/mailboxes file is generated by offlineimap.</p><p>By default, Mutt will ask you to move read messages from INBOX to another mailbox (set by mbox). I personally let my read messages in my inbox and move them myself in a folder. For that, you have to disable the move:</p><pre class=literal-block>
set move = no
</pre><p>If you move a mail from a mailbox to another, Mutt will ask for confirmation, you can disable this confirmation:</p><pre class=literal-block>
set confirmappend = no
</pre><p>If you use Mutt, you want to read plaintext messages rather than monstruous HTML. You can tell Mutt to always open text plain if any:</p><pre class=literal-block>
alternative_order text/plain text/html
</pre><p>If the mail has no text/plain part, you can manage to read HTML in Mutt in an almost sane format. First, you need to tell Mutt to open html messages:</p><pre class=literal-block>
auto_view text/html
</pre><p>And then, you need to tell it how to open it. Mutt reads a mailcap file to know how to open content. You can tell Mutt where it is:</p><pre class=literal-block>
set mailcap_path = ~/.mailcap
</pre><p>And then, you have to edit the .mailcap file:</p><pre class=literal-block>
text/html; w3m -I %{charset} -T text/html; copiousoutput;
</pre><p>That will use w3m to output the message inside Mutt. It works quite well. You can also use linx if you prefer.</p></div><div class=section id=send-mail><h2>Send mail</h2><p>You need to indicate Mutt how to send mail:</p><pre class=literal-block>
set smtp_url = "smtp://baptistewicht@smtp.gmail.com:587/"
set smtp_pass = "SECRET"
</pre><p>Some people prefer to use another SMTP client instead of Mutt builtin SMTP support, you can also do that by setting sendmail to the mailer program.</p><p>It is generally a good idea to enforce the charset of sent mail:</p><pre class=literal-block>
set send_charset="utf-8"
</pre><p>You can choose another charset if you prefer ;)</p><p>You need to configure vim to correctly handle mail editing:</p><pre class=literal-block>
set editor='vim + -c "set textwidth=72" -c "set wrap" -c "set spell spelllang=en"'
</pre><p>It sets the width of the text, enable wrap and configure spelling.</p><p>By default, Mutt will ask you if you want to include the body of the message you reply to in your answer and the reply subject. You can make that faster by using these two lines:</p><pre class=literal-block>
set include=yes
set fast_reply
</pre><p>Once mail are sent, they are copied in your outgoing mailbox. If you use GMail, the STMP server already does that for you, therefore you should disable this behavior:</p><pre class=literal-block>
set copy = no
</pre></div><div class=section id=appearance><h2>Appearance</h2><p>Many things can also be configured in the appearance of Mutt. If you like the threaded view of GMail, you want to configure Mutt in a similar way:</p><pre class=literal-block>
set sort = 'threads'
set sort_aux = 'reverse-last-date-received'
</pre><p>It is not as good as the GMail view, but it does the job :)</p><p>You can make reading mail more comfortable using smart wrapping:</p><pre class=literal-block>
set smart_wrap
</pre><p>A mail has many many headers and you don't want to see them all:</p><pre class=literal-block>
ignore *
unignore From To Reply-To Cc Bcc Subject Date Organization X-Label X-Mailer User-Agent
</pre><p>With that, you just configure which headers you're interested in.</p><p>If you're using the sidebar patch (and you should be ;), you can configure the sidebar:</p><pre class=literal-block>
set sidebar_visible = yes
set sidebar_width = 35
set sort_sidebar = desc

color sidebar_new yellow default
</pre><p>It makes the sidebar always visible with a width of 35 and sort the mailboxes. The last line makes yellow the mailboxes that have unread mails.</p><p>The index_format allows you to set what will shown for every mail in the index view:</p><pre class=literal-block>
set index_format = "%4C %Z %{%b %d} %-15.15L %?M?(#%03M)&amp;(%4l)? %?y?{%.20y}? %?g?{%.20g} ?%s (%c)"
</pre><p>This is a classical example that display the sender, the flags, the date, the subject, the size of the mail and so on. You will need to look at the <a class="reference external" href=http://www.mutt.org/doc/manual/manual-6.html>Reference</a> to have more information on what you can do with the format variables. There are plenty of information that can be shown.</p><p>You can also configure the text that is present on the status bar:</p><pre class=literal-block>
set status_chars  = " *%A"
set status_format = "───[ Folder: %f ]───[%r%m messages%?n? (%n new)?%?d? (%d to delete)?%?t? (%t tagged)? ]───%&gt;─%?p?( %p postponed )?───"
</pre><p>The example here displays the current folder, the number of mails in it with some details on deleted and unread mails and finally the number of postponed mail. Again, if you want more information, you can read the reference.</p><p>You can configure Mutt so that the index view is always visible when you read mails. For instance, to always show 8 mails in the index:</p><pre class=literal-block>
set pager_index_lines=8
</pre><p>Another important thing you can configure is the colors of Mutt. I'm not gonna cover everything, since Mutt is very powerful on this part. For instance, here are some examples from my configuration:</p><p>color index red white "~v~(~F)!~N" # collapsed thread with flagged, no unread color index yellow white "~v~(~F~N)" # collapsed thread with some unread &amp; flagged color index_subject brightred default "~z &gt;100K" color header blue default "^(Subject)"</p><p>Unless you are really wanting to spend time on this part, I recommend to pick an existing theme. I took a Solarized theme <a class="reference external" href=https://github.com/altercation/mutt-colors-solarized>here</a>. It looks quite good and works well. There other themes available, you'll surely find the one that looks best for you.</p></div><div class=section id=bindings><h2>Bindings</h2><p>Bindings are always very important. If like me, you're a vim aficionado, you'll want your Mutt bindings to be as close as possible to vim. The default settings are quite good, but not always close to vim.</p><p>Something that is important to know when you configure Mutt bindings is that they are relative to the current view open (index, pager,browser,attach, ...). You can bind a keystroke to a different action in each view. You can also select several views in which the keystroke is valid.</p><p>If you are using the sidebar patch (and again, you should ;) ), you'll want to configure fast bindings for it. Here are mine:</p><pre class=literal-block>
bind index,pager \Ck sidebar-prev
bind index,pager \Cj sidebar-next
bind index,pager \Cl sidebar-open
bind index,pager \Cn sidebar-scroll-up
bind index,pager \Cv sidebar-scroll-down
bind index,pager \Ct sidebar-toggle
</pre><p>I use Ctrl+j,k to move inside the sidebar. I use Ctrl+l to open a folder and Ctrl+n,v to scroll up and down. The last one is to toggle between multiple sidebars for instance if you use notmuch.</p><p>I find l very good to open messages in the index too:</p><pre class=literal-block>
bind index l display-message
bind index gg first-entry
bind index G last-entry
bind index h noop               # Disable h
</pre><p>gg and G are used to go to the first and last element. Here I disabled h which had a not often used command.</p><p>The pager is the view where you read mail:</p><pre class=literal-block>
bind pager h exit
bind pager gg top
bind pager G bottom
bind pager J next-line
bind pager K previous-line
</pre><p>In this view, I use h to get out of the pager, gg and G as usual. As I always let the index open, I already use j and k to move in the index, so I chose J and K to move in the pager.</p><p>The browser is the view where you select folders for instance:</p><pre class=literal-block>
bind browser l select-entry
bind browser L view-file
bind browser gg first-entry
bind browser G last-entry
bind browser h exit
</pre><p>Again, I use l and h to go back and forth and gg and G to go first and last. j and k are already used here to go up and down.</p><p>In the attach view:</p><pre class=literal-block>
bind attach h exit
bind attach e edit-type # Edit MIME Types
bind attach l view-attach
</pre><p>I use h to exit and l to view an attachment.</p><p>That is it for my bindings, but you configure a lot more of them.</p></div><div class=section id=conclusion><h2>Conclusion</h2><p>This is the end of this post. I have covered my complete Mutt configuration here. My .muttrc is available <a class="reference external" href=https://github.com/wichtounet/dotfiles/blob/master/.muttrc>online</a>.</p><p>If you have comments on my configuration, you're welcome to let a comment on this post ;)</p><p>In the next blog post about my "Mutt journey", I'll talk about notmuch and this will likely be the last post on this series.</p></div> </div> <a href=posts/2014/07/a-mutt-journey-my-mutt-configuration.html#disqus_thread data-disqus-identifier=cache/posts/2014/07/a-mutt-journey-my-mutt-configuration.html>Comments</a> </article> <article class="postbox h-entry post-text"> <h1 class=p-name><a href=posts/2014/07/pm-011-a-simple-workspace-manager-for-git-projects.html class=u-url>pm 0.1.1 - A simple workspace manager for Git projects</a> <br><small>   Posted: <time class="published dt-published" datetime=2014-07-20T20:52:18+02:00>2014-07-20 20:52</time> </small></h1> <hr> <div class=p-summary> <p>In the last month, I've developped a very simple tool in Python: <em>pm</em>. This tool allows to check the status of all the Git repositories inside a repository. I've just released the first version of this tool: pm-0.1.1</p><p>Those who are following this blog will perhaps wonder why Python and not C++ :) The reason is quite simple, I wanted to improve my skills in Python. And what is better than to develop a project from scratch.</p><div class=section id=features><h2>Features</h2><p>The main feature of this application is to show the status of every projects in a directory. The status of your projects can be queried by using <code>pm status</code>. On my computer this gives something like that:</p><img alt=/images/pm_status.png src=images/pm_status.png><p>The state of each branch of each project is shown. There different possible status (they are cumulative): * Behind remote: Commits are available on the remote repository * Ahead of remote: Some local commits are no pushed * Diverged: Behind and Ahead * Uncomitted changes: Some changes are not committed * Clean: Indicates that everything is committed, pushed and pull.</p><p>By default, the directory is ~/dev/ but you can change it by passing the repository to the command, if you pass a relative directory, it will be relative to home. For instance, here is the status of my doc repositories:</p><img alt=/images/pm_status_2.png src=images/pm_status_2.png><p>Another feature that can be useful is that it is able to check the status of submodules with the -s option:</p><img alt=/images/pm_status_sm.png src=images/pm_status_sm.png><p>As you can see it supports recursive submodules. For each submodule it will indicate if there are new commits available or not.</p><p>pm is not only able to show status of the projects, it can also fetch the status of branches from remote by using <code>pm fetch</code>. All the remote branches are fetched from remote. It can also automatically update the projects that are behind remote (equivalent of git pull) with <code>pm update</code>. Only projects that can be fast-forwarded are updated.</p></div><div class=section id=installation><h2>Installation</h2><p>Thanks to <em>pip</em>, installation of pm is quite simple:</p><pre class=literal-block>
pip install pm
</pre><p>If you don't want to use pip, you can install it by hand:</p><pre class=literal-block>
wget https://github.com/wichtounet/pm/archive/0.1.1.tar.gz
tar xf 0.1.1.tar.gz
cd 0.1.1
python setup.py install
</pre><p>For those interested, source code is available <a class="reference external" href=https://github.com/wichtounet/pm>on Github</a>.</p><p>If you have any suggestion for the tool or on the source code, post a comment to this post ;)</p></div> </div> <a href=posts/2014/07/pm-011-a-simple-workspace-manager-for-git-projects.html#disqus_thread data-disqus-identifier=cache/posts/2014/07/pm-011-a-simple-workspace-manager-for-git-projects.html>Comments</a> </article> <nav class=postindexpager> <ul class=pager> <li class=next> <a href=index-26.html rel=next>Older posts</a> </li> </ul> </nav> <script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script> </div> </div> </div></div><footer> Contents © 2015 <a href=mailto:baptistewicht@gmail.com>Baptiste Wicht</a> - Powered by <a href=http://getnikola.com rel=nofollow>Nikola</a><a rel=license href=http://creativecommons.org/licenses/by/4.0/><img alt="Creative Commons License" style=padding-left:5px;border-width:0 src=assets/img/cc.png></a> <ul class=footer_inline_ul> </ul></footer> <script src=assets/js/all-nocdn.js></script> <script type=text/javascript>
      $(document).ready(function() {
        jQuery.getJSON('/assets/js/tag_cloud_data.json', function(data) {
            var items = [];

            $.each(data, function(key, val) {
                items.push('<li><a href="' + val[1] +'" '+'data-weight="'+val[0]+'"'+'>' + key + '</a></li>');
            });

            $('<div/>', {
                'id': 'tags',
                html: '<ul>' + items.join('') + '</ul>'
            }).appendTo('body');

            if(!$('#tags_canvas').tagcanvas({
                textColour: '#FFFFFF',
                outlineColour: '#ff00ff',
                reverse: true,
                depth: 0.8,
                maxSpeed: 0.05,
                weight: true,
                weightFrom: "data-weight",
                weightSizeMin: 8,
                weightSizeMax: 24
            },'tags')) {
                //something went wrong, hide the canvas container
                $('#tags_container').hide();
            }});
        });
    </script><script type=text/javascript src=https://apis.google.com/js/platform.js></script></body></html>