<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Tutorials and short posts about programming, C++, Java, Assembly, Operating Systems Development, Compilers, ...">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Blog blog("Baptiste Wicht");</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="rss.xml">
<link rel="canonical" href="https://baptiste-wicht.com/">
<link rel="next" href="index-33.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="prefetch" href="posts/2023/12/c%2B%2B-refresh-and-new-technos-fp16-and-avx512.html" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="https://baptiste-wicht.com/">

                <span id="blog-title">Blog blog("Baptiste Wicht");</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="stories/about.html">About</a>
                </li>
<li>
<a href="stories/publications.html">Publications</a>
                </li>
<li>
<a href="stories/projects.html">Projects</a>
                </li>
<li>
<a href="categories/index.html">Tags</a>
                </li>
<li>
<a href="archive.html">Archives</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2023/12/c%2B%2B-refresh-and-new-technos-fp16-and-avx512.html" class="u-url">C++ Refresh and new technos: FP16 and AVX512</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baptiste Wicht
            </span></p>
            <p class="dateline">
            <a href="posts/2023/12/c%2B%2B-refresh-and-new-technos-fp16-and-avx512.html" rel="bookmark">
            <time class="published dt-published" datetime="2023-12-17T09:20:55+01:00" itemprop="datePublished" title="2023-12-17 09:20">2023-12-17 09:20</time></a>
            </p>
                <p class="commentline">
    
    <a href="posts/2023/12/c%2B%2B-refresh-and-new-technos-fp16-and-avx512.html#disqus_thread" data-disqus-identifier="cache/posts/2023/12/c++-refresh-and-new-technos-fp16-and-avx512.html">Comments</a>


        </p>
</div>
    </header><div class="p-summary entry-summary">
    <p>In the last few months, I have been working on refreshing my Expression Templates Library (ETL) project with modern
C++. I am happy to report that I have now finished the refresh. It took me longer than I expected and I also had less
time than I expected. But I am very happy about the result.</p>
<p>The main change in etl is the use of concepts. Expression Templates are making heavy use of SFINAE. And I was able to
replace every single usage of SFINAE with concepts. I was also able to replace many assertions with concepts instead.</p>
<p>In most cases, I am using concepts instead of the <cite>typename</cite> declaration. For instance</p>
<div class="code"><pre class="code cpp"><a id="rest_code_04f0222c864e4ed98208a9b77576e9cf-1" name="rest_code_04f0222c864e4ed98208a9b77576e9cf-1" href="posts/2023/12/c%2B%2B-refresh-and-new-technos-fp16-and-avx512.html#rest_code_04f0222c864e4ed98208a9b77576e9cf-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">A</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">M</span><span class="p">,</span><span class="w"> </span><span class="n">cpp_enable_iff</span><span class="p">(</span><span class="n">is_4d</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="p">)</span><span class="o">&gt;</span>
<a id="rest_code_04f0222c864e4ed98208a9b77576e9cf-2" name="rest_code_04f0222c864e4ed98208a9b77576e9cf-2" href="posts/2023/12/c%2B%2B-refresh-and-new-technos-fp16-and-avx512.html#rest_code_04f0222c864e4ed98208a9b77576e9cf-2"></a><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">A</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">c2</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">c3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</pre></div>
<p>becomes</p>
<div class="code"><pre class="code cpp"><a id="rest_code_e87603232a6e4ed3a331cd7ed8895bf9-1" name="rest_code_e87603232a6e4ed3a331cd7ed8895bf9-1" href="posts/2023/12/c%2B%2B-refresh-and-new-technos-fp16-and-avx512.html#rest_code_e87603232a6e4ed3a331cd7ed8895bf9-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="n">etl_4d</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">M</span><span class="o">&gt;</span>
<a id="rest_code_e87603232a6e4ed3a331cd7ed8895bf9-2" name="rest_code_e87603232a6e4ed3a331cd7ed8895bf9-2" href="posts/2023/12/c%2B%2B-refresh-and-new-technos-fp16-and-avx512.html#rest_code_e87603232a6e4ed3a331cd7ed8895bf9-2"></a><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">apply</span><span class="p">(</span><span class="n">A</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">in</span><span class="p">,</span><span class="w"> </span><span class="n">M</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">m</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">c1</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">c2</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">c3</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</pre></div>
<p>This makes the declaration much simpler to read. In some cases, I had to use <cite>requires</cite>. For instance, here is the old definition of sub_view:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_0642f43cc0044d628370323fa7ac20bd-1" name="rest_code_0642f43cc0044d628370323fa7ac20bd-1" href="posts/2023/12/c%2B%2B-refresh-and-new-technos-fp16-and-avx512.html#rest_code_0642f43cc0044d628370323fa7ac20bd-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">Aligned</span><span class="o">&gt;</span>
<a id="rest_code_0642f43cc0044d628370323fa7ac20bd-2" name="rest_code_0642f43cc0044d628370323fa7ac20bd-2" href="posts/2023/12/c%2B%2B-refresh-and-new-technos-fp16-and-avx512.html#rest_code_0642f43cc0044d628370323fa7ac20bd-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">sub_view</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">Aligned</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">enable_if_t</span><span class="o">&lt;!</span><span class="n">fast_sub_view_able</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="k">final</span><span class="w"> </span><span class="p">{</span>
</pre></div>
<p>and here is the new one:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_f9b5f8ff31f14ef5a4d1716075702ce2-1" name="rest_code_f9b5f8ff31f14ef5a4d1716075702ce2-1" href="posts/2023/12/c%2B%2B-refresh-and-new-technos-fp16-and-avx512.html#rest_code_f9b5f8ff31f14ef5a4d1716075702ce2-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">Aligned</span><span class="o">&gt;</span>
<a id="rest_code_f9b5f8ff31f14ef5a4d1716075702ce2-2" name="rest_code_f9b5f8ff31f14ef5a4d1716075702ce2-2" href="posts/2023/12/c%2B%2B-refresh-and-new-technos-fp16-and-avx512.html#rest_code_f9b5f8ff31f14ef5a4d1716075702ce2-2"></a><span class="k">requires</span><span class="p">(</span><span class="o">!</span><span class="n">fast_sub_view_able</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span>
<a id="rest_code_f9b5f8ff31f14ef5a4d1716075702ce2-3" name="rest_code_f9b5f8ff31f14ef5a4d1716075702ce2-3" href="posts/2023/12/c%2B%2B-refresh-and-new-technos-fp16-and-avx512.html#rest_code_f9b5f8ff31f14ef5a4d1716075702ce2-3"></a><span class="k">struct</span><span class="w"> </span><span class="nc">sub_view</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span><span class="w"> </span><span class="n">Aligned</span><span class="o">&gt;</span><span class="w"> </span><span class="k">final</span><span class="w"> </span><span class="p">{</span>
</pre></div>
<p>This also explains the requirements much better than using SFINAE. In most cases, concepts should be faster to compile
than the old enable-if stuff. However, I have not yet had time to measure that.</p>
<p>I also made many small cleanups to the code, but they are probably not worth discussing.</p>
<section id="avx-512"><h2>AVX-512</h2>
<p>What is worth discussing is that I finally added support for AVX-512 into etl. Before, I was waiting until Intel would
give AVX-512F support to desktop CPU, but this is still not the case unfortunately. So I rented a VPS with AVX-512F
support.</p>
<p>AVX512-F is able to process 512b vector operations at once, twice more than AVX-2. This makes it twice faster in theory.
I have completed the support in etl and did some extra testing as well. I wish I had a machine where to test that on
a regular basis (the VPS is pretty expensive to keep running). If I start working a lot on this project again, I will
consider having a Xeon CPU at hone.</p>
</section><section id="fp16-and-bf16"><h2>FP16 and BF16</h2>
<p>Another thing I had been wanting to work on for many years is FP16 operations on GPU. FP16 is a floating point type with
only 16b instead of the standard 32b for <cite>float</cite>. With my new computer and new versions of CUDA, I now got a working
system to do FP16.</p>
<p>So, I implemented support for many FP16 operations on my <cite>etl-gpu-blas</cite> project that is used by <cite>etl</cite> to provide GPU
operations. Thanks to operator overloading in CUDA, there is really nothing complicated about doing that.</p>
<p>Doing so, I also added support for BF16. This is another half-precision floating point type, but the mantissa and
exponent part are different, apparently better tuned for machine learning. The support is more or less the same in CUDA,
only a different type.</p>
<p>Currently, it is only used in etl-gpu-blas, not yet in DLL. Indeed, the problem with FP16 and BF16 is that there is no
CPU support, so it is not as easy to use. I plan to improve that support in the future so that I can use it on DLL
without even going to the CPU.</p>
</section><section id="next-steps"><h2>Next steps</h2>
<p>Another thing I want to explore in the future is FP8, which is a quarter-precision floating point. However, FP8 can only
be used for some tensor operations, through the use of tensor cores. So, I will likely only use it through CUDNN
for convolution operations.</p>
<p>Finally, I also want to explore INT8 for neural networks. INT8 is easy to do on both CPU and GPU, but you cannot replace
all types in a neural network with INT8, a certain level of quantization is necessary and storage should still be done
in INT16 and INT32. But, that's not for tomorrow.</p>
<p>The next immediate projec is to refresh the code of dll, with C++23. Then, I want to run some more benchmarks and see
what are my next steps to make dll faster on CPU and GPU.</p>
</section>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2023/09/switching-from-vim-to-neovim.html" class="u-url">Switching from vim to neovim</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baptiste Wicht
            </span></p>
            <p class="dateline">
            <a href="posts/2023/09/switching-from-vim-to-neovim.html" rel="bookmark">
            <time class="published dt-published" datetime="2023-09-20T19:25:24+02:00" itemprop="datePublished" title="2023-09-20 19:25">2023-09-20 19:25</time></a>
            </p>
                <p class="commentline">
    
    <a href="posts/2023/09/switching-from-vim-to-neovim.html#disqus_thread" data-disqus-identifier="cache/posts/2023/09/switching-from-vim-to-neovim.html">Comments</a>


        </p>
</div>
    </header><div class="p-summary entry-summary">
    <p>As mentioned in my last article, I am now using neovim instead of vim. I just wanted to comment shortly on this change.</p>
<p>I have been using vim as my IDE for many years now (more than 10 years at least). But at the beginning of the year,
I switched to neovim instead.</p>
<p>neovim is a fork of vim, so it is quite similar, but it has some very important differences. It started in 2015, after
a multithreading patch was rejected from vim.</p>
<p>Here are some of the advantages:</p>
<ul class="simple">
<li><p>Very powerful Builtin Langauge Server Protocol (LSP)</p></li>
<li><p>Faster startup</p></li>
<li><p>Builtin LUA support (the configuration can be written entirely in LUA)</p></li>
<li><p>Asynchronous tasks (was later added to vim)</p></li>
</ul>
<p>A lot of things are compatible between both editors. When I started with neovim, I simply copied over my vim
configuration and started using neovim with only very minor changes.</p>
<p>But what really convinced me to keep using neovim was the LSP. This feature and the great plugins that make use of it
greatly simplify how to deeply integrate C++ into neovim. I am now taking advantage of the clang tooling to analyze C++
code on the fly. And I get great autocompletion as well.</p>
<p>All of this is doable with vim as well, but the last time I tried with vim, it was a nightmware to configure. With the
help of (quite a few) plugins, I could setup automcompletion in a great way. This allows me to jump to declarations and
definitions very easily.</p>
<p>I am far from being a neovim expert, but I am very happy with this tool. It definitely makes my life easier for
configuring complex features, compared to vim.</p>
<p>If you are interested, you can find my neovim configuration in my <cite>dotfiles repository&lt;https://github.com/wichtounet/dotfiles&gt;</cite>. It's very fresh because it was previously saved on another place and was recently copied there. I plan to improve it and little by little rewrite it in LUA. There are still some experimental stuff and it could be improved significantly. But I am really happy with the features configured.</p>
<p>What about you? What do you think of neovim?</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2023/09/c%2B%2B23-refresh-and-budgetwarrior-110.html" class="u-url">C++23 Refresh and budgetwarrior 1.1.0</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baptiste Wicht
            </span></p>
            <p class="dateline">
            <a href="posts/2023/09/c%2B%2B23-refresh-and-budgetwarrior-110.html" rel="bookmark">
            <time class="published dt-published" datetime="2023-09-10T06:50:28+02:00" itemprop="datePublished" title="2023-09-10 06:50">2023-09-10 06:50</time></a>
            </p>
                <p class="commentline">
    
    <a href="posts/2023/09/c%2B%2B23-refresh-and-budgetwarrior-110.html#disqus_thread" data-disqus-identifier="cache/posts/2023/09/c++23-refresh-and-budgetwarrior-110.html">Comments</a>


        </p>
</div>
    </header><div class="p-summary entry-summary">
    <p>I am happy to announce the release of budgetwarrior 1.1.0.</p>
<p>The last release of budgetwarrior was more than 5 years ago. So, once I finished my C++20/C++23 refresh of the code,
I decided it was a good time to generate a new release. There has been many improvements in this new version:</p>
<ul class="simple">
<li><p>Many new graphs on the web interface</p></li>
<li><p>Add support for tracking stock values</p></li>
<li><p>Significant speed improvements if you have a lot of data in the tool</p></li>
<li><p>Assets can be set as inactive to be hidden</p></li>
<li><p>Introduction of the FI Net Worth</p></li>
<li><p>Better support of asset classes</p></li>
<li><p>Many small bug fixes</p></li>
</ul>
<p>If you want to use the latest version, you can now use the docker image that I am publishing frequently. This docker
image is what I use, so it should be fairly up-to-date.
* <cite>budgetwarrior on docker hub &lt;https://hub.docker.com/r/wichtounet/budgetwarrior&gt;</cite></p>
<p>Otherwise, you can of course compile it from the sources (another docker image is available as a build image). For this,
you will need a very recent GCC (13+) or Clang (16+) compiler.</p>
<p>Most of the new features have been implemented a while ago, for my personal usage. The main recent changes are
improvements in the code, related to using C++20 and C++23. I plan for all my projects to be compiled with C++23 by
default. The reason is mostly so I can really learn about these features, since I cannot use them all at work. On that
note, I was a bit disappointed by the support in clang, especially in libc++. I had to work around a few limitations in
order to support clang.</p>
<p>The main C++20 feature that I am using in budgetwarrior is ranges. I have been able to improve many pieces of code from
using loops and multiple ifs, to using a range. I have implemented many transforms and filters for budgetwarrior. And
I am quite happy about the result. For instance:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_a5ffdf17c74747789d1abeed7d39e15d-1" name="rest_code_a5ffdf17c74747789d1abeed7d39e15d-1" href="posts/2023/09/c%2B%2B23-refresh-and-budgetwarrior-110.html#rest_code_a5ffdf17c74747789d1abeed7d39e15d-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">budget::account_exists</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">){</span>
<a id="rest_code_a5ffdf17c74747789d1abeed7d39e15d-2" name="rest_code_a5ffdf17c74747789d1abeed7d39e15d-2" href="posts/2023/09/c%2B%2B23-refresh-and-budgetwarrior-110.html#rest_code_a5ffdf17c74747789d1abeed7d39e15d-2"></a><span class="w">        </span><span class="k">for</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">account</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">all_accounts</span><span class="p">()){</span>
<a id="rest_code_a5ffdf17c74747789d1abeed7d39e15d-3" name="rest_code_a5ffdf17c74747789d1abeed7d39e15d-3" href="posts/2023/09/c%2B%2B23-refresh-and-budgetwarrior-110.html#rest_code_a5ffdf17c74747789d1abeed7d39e15d-3"></a><span class="w">                </span><span class="k">if</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="n">name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">name</span><span class="p">){</span>
<a id="rest_code_a5ffdf17c74747789d1abeed7d39e15d-4" name="rest_code_a5ffdf17c74747789d1abeed7d39e15d-4" href="posts/2023/09/c%2B%2B23-refresh-and-budgetwarrior-110.html#rest_code_a5ffdf17c74747789d1abeed7d39e15d-4"></a><span class="w">                        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="rest_code_a5ffdf17c74747789d1abeed7d39e15d-5" name="rest_code_a5ffdf17c74747789d1abeed7d39e15d-5" href="posts/2023/09/c%2B%2B23-refresh-and-budgetwarrior-110.html#rest_code_a5ffdf17c74747789d1abeed7d39e15d-5"></a><span class="w">                </span><span class="p">}</span>
<a id="rest_code_a5ffdf17c74747789d1abeed7d39e15d-6" name="rest_code_a5ffdf17c74747789d1abeed7d39e15d-6" href="posts/2023/09/c%2B%2B23-refresh-and-budgetwarrior-110.html#rest_code_a5ffdf17c74747789d1abeed7d39e15d-6"></a><span class="w">        </span><span class="p">}</span>
<a id="rest_code_a5ffdf17c74747789d1abeed7d39e15d-7" name="rest_code_a5ffdf17c74747789d1abeed7d39e15d-7" href="posts/2023/09/c%2B%2B23-refresh-and-budgetwarrior-110.html#rest_code_a5ffdf17c74747789d1abeed7d39e15d-7"></a>
<a id="rest_code_a5ffdf17c74747789d1abeed7d39e15d-8" name="rest_code_a5ffdf17c74747789d1abeed7d39e15d-8" href="posts/2023/09/c%2B%2B23-refresh-and-budgetwarrior-110.html#rest_code_a5ffdf17c74747789d1abeed7d39e15d-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="rest_code_a5ffdf17c74747789d1abeed7d39e15d-9" name="rest_code_a5ffdf17c74747789d1abeed7d39e15d-9" href="posts/2023/09/c%2B%2B23-refresh-and-budgetwarrior-110.html#rest_code_a5ffdf17c74747789d1abeed7d39e15d-9"></a><span class="p">}</span>
</pre></div>
<p>became:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_98a4729b3a9345b29db015e446b85c56-1" name="rest_code_98a4729b3a9345b29db015e446b85c56-1" href="posts/2023/09/c%2B%2B23-refresh-and-budgetwarrior-110.html#rest_code_98a4729b3a9345b29db015e446b85c56-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">budget::account_exists</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">){</span>
<a id="rest_code_98a4729b3a9345b29db015e446b85c56-2" name="rest_code_98a4729b3a9345b29db015e446b85c56-2" href="posts/2023/09/c%2B%2B23-refresh-and-budgetwarrior-110.html#rest_code_98a4729b3a9345b29db015e446b85c56-2"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="o">!</span><span class="n">ranges</span><span class="o">::</span><span class="n">empty</span><span class="p">(</span><span class="n">all_accounts</span><span class="p">()</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filter_by_name</span><span class="p">(</span><span class="n">name</span><span class="p">));</span>
<a id="rest_code_98a4729b3a9345b29db015e446b85c56-3" name="rest_code_98a4729b3a9345b29db015e446b85c56-3" href="posts/2023/09/c%2B%2B23-refresh-and-budgetwarrior-110.html#rest_code_98a4729b3a9345b29db015e446b85c56-3"></a><span class="p">}</span>
</pre></div>
<p>or here is another example of using ranges:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_7be85ce34e424d28818c9e683edbe9a4-1" name="rest_code_7be85ce34e424d28818c9e683edbe9a4-1" href="posts/2023/09/c%2B%2B23-refresh-and-budgetwarrior-110.html#rest_code_7be85ce34e424d28818c9e683edbe9a4-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">accounts</span><span class="p">.</span><span class="n">data</span><span class="p">()</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">not_id</span><span class="p">(</span><span class="n">id</span><span class="p">)</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">active_today</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">filter_by_name</span><span class="p">(</span><span class="n">account</span><span class="p">.</span><span class="n">name</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_7be85ce34e424d28818c9e683edbe9a4-2" name="rest_code_7be85ce34e424d28818c9e683edbe9a4-2" href="posts/2023/09/c%2B%2B23-refresh-and-budgetwarrior-110.html#rest_code_7be85ce34e424d28818c9e683edbe9a4-2"></a><span class="w">    </span><span class="k">throw</span><span class="w"> </span><span class="n">budget_exception</span><span class="p">(</span><span class="s">"There is already an account with the name "</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">account</span><span class="p">.</span><span class="n">name</span><span class="p">);</span>
<a id="rest_code_7be85ce34e424d28818c9e683edbe9a4-3" name="rest_code_7be85ce34e424d28818c9e683edbe9a4-3" href="posts/2023/09/c%2B%2B23-refresh-and-budgetwarrior-110.html#rest_code_7be85ce34e424d28818c9e683edbe9a4-3"></a><span class="p">}</span>
</pre></div>
<p>This is likely the biggest change, but I have made other improvements based on recent versions of C++:</p>
<ul class="simple">
<li><p>Use of std::format</p></li>
<li><p>Use of the spaceship operator</p></li>
<li><p>Use of template lambdas</p></li>
<li><p>Use of std::string_view</p></li>
<li><p>Use of std::filesystem</p></li>
<li><p>Use of std::map::contains (and other such functions)</p></li>
</ul>
<p>Overall, it was a lot of fun and I could significantly improve the code by using these new features (and more).</p>
<p>I am also taking advantage of clang-tidy now. I have added a clang-tidy configuration to my projects so that I can
quickly check everything. I have also integrated clang-tidy in neovim (yes, I switched from vim to neovim, more on that
later maybe) and this shows in real time where I could improve the code.</p>
<p>Finally, another change is that I am now taking advantage of Github Workflows. Every time I push to the repo, everything is
compiled with the two compilers I support. This allows me to keep compatibility between both. In the future, I plan to
add a few more tools to the workflows for code analysis. This is also an opportunity for me to learn about these
workflows, which I never used before.</p>
<p>I am quite glad to be working on these projects again eve though I do not have much time. It was really fun to use all
these new features in budgetwarrior. Next, I plan to refresh the code of ETL. And since I want to refresh my GPU skills
as well, I will also work on etl_gpu_blas.</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2023/08/a-short-update.html" class="u-url">A short update</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baptiste Wicht
            </span></p>
            <p class="dateline">
            <a href="posts/2023/08/a-short-update.html" rel="bookmark">
            <time class="published dt-published" datetime="2023-08-13T08:55:40+02:00" itemprop="datePublished" title="2023-08-13 08:55">2023-08-13 08:55</time></a>
            </p>
                <p class="commentline">
    
    <a href="posts/2023/08/a-short-update.html#disqus_thread" data-disqus-identifier="cache/posts/2023/08/a-short-update.html">Comments</a>


        </p>
</div>
    </header><div class="p-summary entry-summary">
    <p>I can't believe it's been about 5 years since the last update on this blog. For those, who are wondering what is
happening, here is a short update.</p>
<p>About 6 years ago, I have finished my Ph.D. and about 5 years, I started to work as a software engineer, at Verisign.
I am now a Senior Software Engineer, still at Verisign. After I started working professionally, I did not spend much
time on my personal projects anymore. Before, my personal projects were part of my Ph.D., so it made sense to posts some
updates on this blog and I had time to also post other articles.</p>
<p>But probably another bigger factor is that I started another blog in 2017, <cite>The Poor Swiss &lt;https://thepoorswiss.com&gt;</cite>.
This is not a technical blog but a blog on personal finance, related to Switzerland. I have written more than 400
articles on this blog and I am still writing about one article a week these days. This takes a lot of time and made me
scale down even more on my personal projects. The only project that continued getting some improvements was budgetwarrior
since I am using it almost every day.</p>
<p>It's obviously worth mentioning that I got married about 5 years ago and that we now have a son, almost two years old.
This obviously takes a lot of time!</p>
<p>So, why am I posting this short update today? I recently started missing working on personal projects. And I realized
I had gotten out of touch with recent C++. It is a bit disappointing but my C++ level is becoming worse since I have
started working professionally on C++. So, I learned in details about C++20 and C++23 and decided to apply some of it to
my personal projects.</p>
<p>I have made significant cleanups to budgetwarrior, using C++23 by default now and switching to GCC 15 and Clang 16 as
the default compilers. I plan to continue working on budgetwarrior_web, the web interface for budgetwarrior next. This
project will also be converted to C++23. After that, I will probably continue with ETL and DLL. And hopefully, I plan to
dedicate some time to adding more features to ETL and DLL as well. Thor OS is currently not on my list because I don't
have the kind of energy and time this project requires.</p>
<p>I also hope I will be posting some more updates on this blog, but I will not adhere to any posting schedule. At least,
I will not let five years go by before the next update!</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2018/04/budgetwarrior-101-allocation-tracking-retirement-calculator-bug-fixes.html" class="u-url">budgetwarrior 1.0.1: Allocation tracking, Retirement calculator and bug fixes</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baptiste Wicht
            </span></p>
            <p class="dateline">
            <a href="posts/2018/04/budgetwarrior-101-allocation-tracking-retirement-calculator-bug-fixes.html" rel="bookmark">
            <time class="published dt-published" datetime="2018-04-03T10:58:47+02:00" itemprop="datePublished" title="2018-04-03 10:58">2018-04-03 10:58</time></a>
            </p>
                <p class="commentline">
    
    <a href="posts/2018/04/budgetwarrior-101-allocation-tracking-retirement-calculator-bug-fixes.html#disqus_thread" data-disqus-identifier="cache/posts/2018/04/budgetwarrior-101-allocation-tracking-retirement-calculator-bug-fixes.html">Comments</a>


        </p>
</div>
    </header><div class="p-summary entry-summary">
    <p>I'm happy to announce the release of budgetwarrior 1.0.1. This new version
contains a series of improvement over the 1.0 version and some new features.</p>
<p>I haven't been very active this last month. I have been working a bit on
budgetwarrior for features I needed for my budget. I've also been contacted with
questions on my thor operating system and since that point I've doing some
work on thor as well.</p>
<p>This new version of budgetwarrior has quite a few new features even though it's
a minor version.</p>
<p>Note: The data from all the views is totally randomized and does not make
sense ;)</p>
<section id="retirement-calculator"><h2>Retirement Calculator</h2>
<p>The biggest novelty in this version is the addition of a retirement calculator.
This is still very basic, but it may give information on how close (or far) you
are from early retirement. Here is what the view gives you:</p>
<img alt="Retirement Status" src="images/budgetwarrior_101_retirement_status.png"><p>Using your annual withdrawal rate and expected Rate Of Return, it can compute
how many years you will need to reach your goals Financial Independence (FI). It
will also gives you your FI ratio and a few more information about your savings
rate, income, expenses and so on. It's nothing very fancy but it can be very
useful.</p>
</section><section id="new-features"><h2>New features</h2>
<p>I've also added a few graphs based on the budget information. The first is the
visualization of the expenses over time:</p>
<img alt="Expenses over time graph" src="images/budgetwarrior_101_expenses_over_time.png"><p>This can be pretty useful to see how are your expenses going. Even if your
income is going, expenses should not necessarily go up (you should save more!).</p>
<p>Another new view can show your asset allocation over time and the current asset
allocation of your entire net worth or specifically for your portfolio.</p>
<img alt="Asset allocation" src="images/budgetwarrior_101_allocation.png"><p>This is also really useful if you want to have a global view of your asset
allocation into bonds, stocks and such.</p>
<p>There are also two other new minor features. You can now search expenses by
name. This is really useful once you start having many expenses. Another new
view is the Full aggregate view. Before, you could aggregate your expenses by
month or year, now they can be aggregate since the beginning of the budget. With
this, you can see how much you spend on coffee since you started keeping track
of your budget. For me, it's a lot! Both these features are available both in
command line and in the web interface.</p>
</section><section id="improvements"><h2>Improvements</h2>
<p>There are also a few improvements with this new version. You can now set
a default account (in the configuration file with default_account=X). It will be
set by default in both the web view and the console view. The rebalance view has
been made more clear. I've added a second batch update view with only the assets
that are being used (amount &gt; 0). And lastly, the yearly overview is now
displaying correctly the previous year savings rate.</p>
<p>Finally, there are also a few bug fixes. That is is the main reason I decided to
release now. If you were using asset with different currency, several views
where not correctly using the exchange rate to display them. Moreover, the
average expenses in the monthly overview was not correct. Finally, if you were
editing old expenses after having archived the accounts, it could be edited with
the wrong account.</p>
</section><section id="installation-2"><h2>Installation</h2>
<p>If you are on Gentoo, you can install it using layman:</p>
<pre class="literal-block">layman -a wichtounet
emerge -a budgetwarrior</pre>
<p>If you are on Arch Linux, you can use this <cite>AUR repository
&lt;https://github.com/StreakyCobra/aur&gt;</cite> (wait a few days for the new version to be
updated)_</p>
<p>For other systems, you'll have to install from sources:</p>
<pre class="literal-block">git clone --recursive git://github.com/wichtounet/budgetwarrior.git
cd budgetwarrior
git checkout 1.0.1
make
sudo make install</pre>
<p>If you want to test the server mode, the default username is admin and the
default password is 1234. You can change them in the configuration file with
web_user and web_password.</p>
</section><section id="conclusion-4"><h2>Conclusion</h2>
<p>Although it's a minor version, it improves and fixes quite a few things,
especially for the web view. I encourage you to try it out. Don't hesitate to
let me a comment if you fail to use it or don't understand something ;)</p>
<p>There are still a few things that I want to do, as I said when
<a class="reference external" href="https://baptiste-wicht.com/posts/2018/01/budgetwarrior-10-web-interface-and-asset-tracking.html">I introduced the web version</a>. The website still needs to be
made faster. And the communication between the console and the server can also
be improved.</p>
<p>If you are interested by the sources, you can download them on Github:
<a class="reference external" href="https://github.com/wichtounet/budgetwarrior">budgetwarrior</a>.</p>
<p>If you have a suggestion or you found a bug, please post an issue on Github.</p>
<p>If you have any comment, don't hesitate to contact me, either by letting a
comment on this post or by email.</p>
</section>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2018/03/i-got-rid-of-vivaldi-browser-for-google-chrome.html" class="u-url">I got rid of Vivaldi browser for Google Chrome</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baptiste Wicht
            </span></p>
            <p class="dateline">
            <a href="posts/2018/03/i-got-rid-of-vivaldi-browser-for-google-chrome.html" rel="bookmark">
            <time class="published dt-published" datetime="2018-03-16T08:31:45+01:00" itemprop="datePublished" title="2018-03-16 08:31">2018-03-16 08:31</time></a>
            </p>
                <p class="commentline">
    
    <a href="posts/2018/03/i-got-rid-of-vivaldi-browser-for-google-chrome.html#disqus_thread" data-disqus-identifier="cache/posts/2018/03/i-got-rid-of-vivaldi-browser-for-google-chrome.html">Comments</a>


        </p>
</div>
    </header><div class="p-summary entry-summary">
    <p>About a year ago, <a class="reference external" href="https://baptiste-wicht.com/posts/2017/01/vivaldi-vimium-finally-no-more-firefox.html">I switched from Firefox to Vivaldi</a>. This week, I decided to get rid of Vivaldi and replaced with Google Chrome. In this post, I'm going to outline the reasons why I got rid of it.</p>
<p>Before, I switched to Vivaldi because Firefox was dropping support for XUL/XPCOM
extensions and I was using Pentadactyl. In fact, Pentadactyl was the only reason
I was using Firefox. It was slow and bloated and a bit unstable, but the
extension was making it worth. Since they are dropping support for such
extensions, I did not want to use Firefox anymore. So I switched to Vivaldi with
Vimium. It's not as great as Firefox plus Pentadactyl. But it's a more
customizable version of Google Chrome on which it's based.</p>
<p>But, in that year or so of using Vivaldi, I have had many issues. Some of them
were not too bad and there was some workarounds. But they continued to pile up
and they did not fix any of them so now, I decided it's too much.</p>
<p>Since the beginning, it always has been slow. It's not really bad, but still
noticeable compared to Chrome. Especially opening Vivaldi is pretty bad. This is
something I can live with, but they should really do something to make it
faster.</p>
<p>The thing that I had the most issues with is multimedia. For instance Youtube
(but all the other platforms have the same issues).</p>
<p>The first problem with media is to get a video in fullscreen. Most of the time,
when I press the fullscreen button on Youtube, it grays out the screen and
I have to press ESC. If I do that around five to ten times, it finally goes
fullscreen. It may be because of my multi-monitor setup but Google Chrome has no
issues whatsoever with that. It's pretty painful to do, but again I could live
for since I don't use full screen a lot.</p>
<p>A second problem I had with media is they were running too fast. I'm not
kidding, really too fast, not too slow. The media was running about twice too
fast, you could see the seconds going fast on Youtube. I never seen this issue
in any other tool, but it was happening at every start of Vivaldi. The fix was
to restart Vivaldi every time this happened and the video played normally.</p>
<p>Another problem I had from the beginning is to make all HTML5 videos work. You
have to download the binary plugins from Chrome to let Vivaldi play all HTML5
videos. It's not a big deal, but the problem is that they are overwritten after
each update of Vivaldi. So you have to do it all the time.</p>
<p>A new media issue I had on the last update of Vivaldi is with Flash. At the
beginning it was working even if it was outdated. I just had to confirm to run
it with a warning. But, since the last update, I only had the warning that it
was outdated. But I could not confirm to use it, the option was not here
anymore. And it was still happening after I updated Flash... The only option to
run Flash was to use a private navigation window...</p>
<p>And finally, I had another big issue with the last version of Vivaldi as well.
The browser keeps crashing on my work computer. It can stay up a few minutes and
then crash. The complete interface is not updated. I can still press the tabs
and I can see the title of the window change, but the interface does not update.
Again, it may come from my special window manager (I use awesome), but it's the
only application not working...</p>
<p>With all these issues and especially the last two new problems, I decided it was
time to cut the losses. So I reinstalled Google Chrome, transferred my plugins
and everything worked like a charm. I still use Vimium to use vim bindings so my
usage of the browser does not change. Of course, I don't have the customization
that I had with Vivaldi. I would really really like to get rid of the address
bar in the browser. I would also like to significantly reduce the size of the
tab bar. But I prefer to live without these improvements than with so many bugs.
I think Vivaldi is a good idea, but with a terrible implementation.</p>
<p>I also considered qutebrowser as an alternative. But for now it's still missing
many features that I don't want to get rid of. So I will stay with Google Chrome
for the time being.</p>
<p>What about you ? Do you have any experience with Vivaldi ?</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2018/02/decrease-dll-neural-network-compilation-time-with-c%2B%2B17.html" class="u-url">Decrease DLL neural network compilation time with C++17</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baptiste Wicht
            </span></p>
            <p class="dateline">
            <a href="posts/2018/02/decrease-dll-neural-network-compilation-time-with-c%2B%2B17.html" rel="bookmark">
            <time class="published dt-published" datetime="2018-02-07T11:39:02+01:00" itemprop="datePublished" title="2018-02-07 11:39">2018-02-07 11:39</time></a>
            </p>
                <p class="commentline">
    
    <a href="posts/2018/02/decrease-dll-neural-network-compilation-time-with-c%2B%2B17.html#disqus_thread" data-disqus-identifier="cache/posts/2018/02/decrease-dll-neural-network-compilation-time-with-c++17.html">Comments</a>


        </p>
</div>
    </header><div class="p-summary entry-summary">
    <p>Just last week, <a class="reference external" href="https://baptiste-wicht.com/posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html">I've migrated my Expression Templates Library (ETL) library to C++17</a>,
it is now also done in my Deep Learning Library (DLL) library. In ETL, this
resulted in a <em>much nicer code overall</em>, but no real improvement in compilation
time.</p>
<p>The objective of the migration of DLL was two-fold. First, I also wanted to
simplify some code, especially with <code>if constexpr</code>. But I also especially
wanted to try to reduce the compilation time. In the past,
<a class="reference external" href="https://baptiste-wicht.com/posts/2017/09/how-i-made-deep-learning-library-38-faster-to-compile-optimization-and-cpp17-if-constexpr.html">I've already tried a few changes with C++17</a>, with good results on the compilation of the entire test suite.
While this is very good, this is not very representative of users of the library.
Indeed, normally you'll have only one network in your source file not several.
The new changes will especially help in the case of many networks, but less in
the case of a single network per source file.</p>
<p>This time, I decided to test the compilation on the examples. I've tested the
eight official examples from the DLL library:</p>
<ol class="arabic simple" start="0">
<li><p>mnist_dbn: A fully-connected Deep Belief Network (DBN) on the MNIST data set
with three layers</p></li>
<li><p>char_cnn: A special CNN with embeddings and merge and group layers for text
recognition</p></li>
<li><p>imagenet_cnn: A 12 layers Convolutional Neural Network (CNN) for Imagenet</p></li>
<li><p>mnist_ae: A simple two-layers auto-encoder for MNIST</p></li>
<li><p>mnist_cnn: A simple 6 layers CNN for MNIST</p></li>
<li><p>mnist_deep_ae: A deep auto-encoder for MNIST, only fully-connected</p></li>
<li><p>mnist_lstm: A Recurrent Neural Network (RNN) with Long Short Term Memory
(LSTM) cells</p></li>
<li><p>mnist_mlp: A simple fully-connected network for MNIST, with dropout</p></li>
<li><p>mnist_rnn: A simple RNN with simple cells for MNIST</p></li>
</ol>
<p>This is really representative of what users can do with the library and I think
it's a much better for compilation time.</p>
<p>For reference, you can find <a class="reference external" href="https://github.com/wichtounet/dll/tree/master/examples/src">the source code of all the examples online</a>.</p>
<section id="results"><h2>Results</h2>
<p>Let's start with the results. I've tested this at different stages of the
migration with clang 5 and GCC 7.2. I tested the following steps:</p>
<ol class="arabic simple">
<li><p>The original C++14 version</p></li>
<li><p>Simply compiling in c++17 mode (-std=c++17)</p></li>
<li><p>Using the C++17 version of the ETL library</p></li>
<li><p>Upgrading DLL to C++17 (without ETL)</p></li>
<li><p>ETL and DLL in C++17 versions</p></li>
</ol>
<p>I've compiled each example independently in release_debug mode. Here are the
results for G++ 7.2:</p>
<table class="align-center">
<thead><tr>
<th class="head"><p>Example</p></th>
<th class="head"><p>0</p></th>
<th class="head"><p>1</p></th>
<th class="head"><p>2</p></th>
<th class="head"><p>3</p></th>
<th class="head"><p>4</p></th>
<th class="head"><p>5</p></th>
<th class="head"><p>6</p></th>
<th class="head"><p>7</p></th>
<th class="head"><p>8</p></th>
</tr></thead>
<tbody>
<tr>
<td><p>C++14</p></td>
<td><p>37.818</p></td>
<td><p>32.944</p></td>
<td><p>33.511</p></td>
<td><p>15.403</p></td>
<td><p>29.998</p></td>
<td><p>16.911</p></td>
<td><p>24.745</p></td>
<td><p>18.974</p></td>
<td><p>19.006</p></td>
</tr>
<tr>
<td><p>-std=c++17</p></td>
<td><p>38.358</p></td>
<td><p>32.409</p></td>
<td><p>32.707</p></td>
<td><p>15.810</p></td>
<td><p>30.042</p></td>
<td><p>16.896</p></td>
<td><p>24.635</p></td>
<td><p>19.134</p></td>
<td><p>19.027</p></td>
</tr>
<tr>
<td><p>ETL C++17</p></td>
<td><p>36.045</p></td>
<td><p>31.000</p></td>
<td><p>30.942</p></td>
<td><p>15.322</p></td>
<td><p>28.840</p></td>
<td><p>16.747</p></td>
<td><p>24.151</p></td>
<td><p>18.208</p></td>
<td><p>18.939</p></td>
</tr>
<tr>
<td><p>DLL C++17</p></td>
<td><p>35.251</p></td>
<td><p>32.577</p></td>
<td><p>32.854</p></td>
<td><p>15.653</p></td>
<td><p>29.758</p></td>
<td><p>16.851</p></td>
<td><p>24.606</p></td>
<td><p>19.098</p></td>
<td><p>19.146</p></td>
</tr>
<tr>
<td><p>Final C++17</p></td>
<td><p>32.289</p></td>
<td><p>31.133</p></td>
<td><p>30.939</p></td>
<td><p>15.232</p></td>
<td><p>28.753</p></td>
<td><p>16.526</p></td>
<td><p>24.326</p></td>
<td><p>18.116</p></td>
<td><p>17.819</p></td>
</tr>
<tr>
<td><p>Final Improvement</p></td>
<td><p>14.62%</p></td>
<td><p>5.49%</p></td>
<td><p>7.67%</p></td>
<td><p>1.11%</p></td>
<td><p>4.15%</p></td>
<td><p>2.27%</p></td>
<td><p>1.69%</p></td>
<td><p>4.52%</p></td>
<td><p>6.24%</p></td>
</tr>
</tbody>
</table>
<p>The difference by just enabling c++17 is not significant. On the other hand,
some significant gain can be obtained by using the C++17 version of ETL,
especially for the DBN version and for the CNN versions. Except for the DBN
case, the migration of DLL to C++17 did not bring any significant advantage.
When everything is combined, the gains are more important :) In the best case,
the example is 14.6% faster to compile.</p>
<p>Let's see if it's the same with clang++ 5.0:</p>
<table class="align-center">
<thead><tr>
<th class="head"><p>Example</p></th>
<th class="head"><p>0</p></th>
<th class="head"><p>1</p></th>
<th class="head"><p>2</p></th>
<th class="head"><p>3</p></th>
<th class="head"><p>4</p></th>
<th class="head"><p>5</p></th>
<th class="head"><p>6</p></th>
<th class="head"><p>7</p></th>
<th class="head"><p>8</p></th>
</tr></thead>
<tbody>
<tr>
<td><p>C++14</p></td>
<td><p>40.690</p></td>
<td><p>34.753</p></td>
<td><p>35.488</p></td>
<td><p>16.146</p></td>
<td><p>31.926</p></td>
<td><p>17.708</p></td>
<td><p>29.806</p></td>
<td><p>19.207</p></td>
<td><p>20.858</p></td>
</tr>
<tr>
<td><p>-std=c++17</p></td>
<td><p>40.502</p></td>
<td><p>34.664</p></td>
<td><p>34.990</p></td>
<td><p>16.027</p></td>
<td><p>31.510</p></td>
<td><p>17.630</p></td>
<td><p>29.465</p></td>
<td><p>19.161</p></td>
<td><p>20.860</p></td>
</tr>
<tr>
<td><p>ETL C++17</p></td>
<td><p>37.386</p></td>
<td><p>33.008</p></td>
<td><p>33.896</p></td>
<td><p>15.519</p></td>
<td><p>30.269</p></td>
<td><p>16.995</p></td>
<td><p>28.897</p></td>
<td><p>18.383</p></td>
<td><p>19.809</p></td>
</tr>
<tr>
<td><p>DLL C++17</p></td>
<td><p>37.252</p></td>
<td><p>34.592</p></td>
<td><p>35.250</p></td>
<td><p>16.131</p></td>
<td><p>31.782</p></td>
<td><p>17.606</p></td>
<td><p>29.595</p></td>
<td><p>19.126</p></td>
<td><p>20.782</p></td>
</tr>
<tr>
<td><p>Final C++17</p></td>
<td><p>34.470</p></td>
<td><p>33.154</p></td>
<td><p>33.881</p></td>
<td><p>15.415</p></td>
<td><p>30.279</p></td>
<td><p>17.078</p></td>
<td><p>28.808</p></td>
<td><p>18.497</p></td>
<td><p>19.761</p></td>
</tr>
<tr>
<td><p>Final Improvement</p></td>
<td><p>15.28%</p></td>
<td><p>4.60%</p></td>
<td><p>4.52%</p></td>
<td><p>4.52%</p></td>
<td><p>5.15%</p></td>
<td><p>3.55%</p></td>
<td><p>3.34%</p></td>
<td><p>3.69%</p></td>
<td><p>5.25%</p></td>
</tr>
</tbody>
</table>
<p>First of all, as I have seen time after time, clang is still slower than GCC.
It's a not a big difference, but still significant. Overall, the gains are a bit
higher on clang than on GCC, but not by much. Interestingly, the migration of
DLL to C++17 is less interesting in terms of compilation time for clang. It
seems even to slow down compilation on some examples. On the other hand, the
migration of ETL is more important than on GCC.</p>
<p>Overall, every example is faster to compile using both libraries in C++17, but
we don't have spectacular speed-ups. With clang, we have speedups from 3.3% to
15.3%. With GCC, we have speedup  from 1.1% to 14.6%. It's not very high, but
I'm already satisfied with these results.</p>
</section><section id="c-17-in-dll"><h2>C++17 in DLL</h2>
<p>Overall, the migration of DLL to C++17 was quite similar to that of ETL. You can
take a look at my <a class="reference external" href="https://baptiste-wicht.com/posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html">previous article</a>
if you want more details on C++17 features I've used.</p>
<p>I've <em>replaced a lot of SFINAE functions</em> with <code>if constexpr</code>. I've also
replaced a lot of <code>statif_if</code> with <code>if constexpr</code>. There was a large
number of these in DLL's code. I also enabled all the <code>constexpr</code> that
were commented for this exact time :)</p>
<p>I was also thinking that I could replace a lot of meta-programming stuff with
<em>fold expressions</em>. While I was able to replace a few of them, most of them were
harder to replace with fold expressions. Indeed, the variadic pack is often
hidden behind another class and therefore the pack is not directly usable from
the network class or the group and merge layers classes. I didn't want to start
a big refactoring just to use a C++17 feature, the current state of this code is
fine.</p>
<p>I made some use of structured bindings as well, but again not as much as I was
thinking. In fact, a lot of time, I'm assigning the elements of a pair or tuple
to existing variables not declaring new variables and unfortunately, you can
only use structured bindings with <code>auto</code> declaration.</p>
<p>Overall, the <em>code is significantly better now</em>, but there was less impact than
there was on ETL. It's also a smaller code base, so maybe this is normal and my
expectations were too high ;)</p>
</section><section id="conclusion-3"><h2>Conclusion</h2>
<p>The trunk of DLL is now a C++17 library :) I think this improve the quality of
the code by a nice margin! Even though, there is still some work to be done to
improve the code, especially for the DBN pretraining code, the quality is quite
good now. Moreover, the switch to C++17 made the compilation of neural networks
using the DLL library <em>faster to compile</em>, from 1.1% in the worst case to 15.3% in
the best case! I don't know when I will release the next version of DLL, but it
will take some time. I'll especially have to polish the RNN support and add
a sequence to sequence loss before I will release the 1.1 version of DLL.</p>
<p>I'm quite satisfied with C++17 even if I would have liked a bit more features to
play with! I'm already a big fan of <code>if constexpr</code>, this can make the code
much nicer and fold expressions are much more intuitive than their previous
recursive template counterpart.</p>
<p>I may also consider migrating some parts of the cpp-utils library, but if I do,
it will only be through the use of conditionals in order not to break the other
projects that are based on the library.</p>
</section>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html" class="u-url">C++17 Migration of Expression Templates Library (ETL)</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baptiste Wicht
            </span></p>
            <p class="dateline">
            <a href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html" rel="bookmark">
            <time class="published dt-published" datetime="2018-02-02T14:03:26+01:00" itemprop="datePublished" title="2018-02-02 14:03">2018-02-02 14:03</time></a>
            </p>
                <p class="commentline">
    
    <a href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#disqus_thread" data-disqus-identifier="cache/posts/2018/02/c++17-migration-of-expression-templates-library-etl.html">Comments</a>


        </p>
</div>
    </header><div class="p-summary entry-summary">
    <p>I've finally decided to migrate my Expression Templates Library (ETL) project to
C++17. I've talking about doing that for a long time and I've released several
releases without doing the change, but the next version will be a C++17 library.
The reason why I didn't want to rush the change was that this means the library
needs a very recent compiler that may not be available to everybody. Indeed,
after this change, the ETL library now needs at least GCC 7.1 or Clang 4.0.</p>
<p>I've already made some previous experiments in the past. For instance,
<a class="reference external" href="https://baptiste-wicht.com/posts/2017/09/how-i-made-deep-learning-library-38-faster-to-compile-optimization-and-cpp17-if-constexpr.html">by using if constexpr, I've managed to speed up compilation by 38%</a> and I've also written an article about <a class="reference external" href="https://baptiste-wicht.com/posts/2015/05/cpp17-fold-expressions.html">the fold expressions introduced in C++17</a>. But I haven't migrated a full library yet. This is now done with ETL. In this article, I'll try to give some example of improvements by using C++17.</p>
<p>This will only cover the C++17 features I'm using in the updated ETL library,
I won't cover all of the new C++17 features.</p>
<section id="if-constexpr"><h2>if constexpr</h2>
<p>The most exciting new thing in C++17 for me is the <code>if constexpr</code>
statement. This is a really really great thing. In essence, it's a normal
<code>if</code> statement, but with one very important difference. The statement that
is not taken (the <code>else</code> if the condition is true, or the <code>if
constexpr</code> if the condition is false) is <em>discarded</em>. And what is interesting
is what happens to <em>discarded</em> statements:</p>
<ol class="arabic simple">
<li><p>The body of a <em>discarded</em> statement does not participate in return type
deduction.</p></li>
<li><p>The discarded statement is not instantiated</p></li>
<li><p>The discarded statement can <em>odr-use</em> a variable that is not defined</p></li>
</ol>
<p>Personally, I'm especially interested by points 1 and 2. Let's start with an
example where point 1 is useful. In ETL, I have a make_temporary function. This
function either forwards an ETL container or creates a temporary container from
an ETL expression. This is based on a compile-time traits. The return type of
the function is the not the same in both cases. What you did in those case
before C++17, is use SFINAE and make two functions:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_e3e71792a96945eca3906adc21ee5ae1-1" name="rest_code_e3e71792a96945eca3906adc21ee5ae1-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e3e71792a96945eca3906adc21ee5ae1-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">E</span><span class="p">,</span><span class="w"> </span><span class="n">cpp_enable_iff</span><span class="p">(</span><span class="n">is_dma</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="p">)</span><span class="o">&gt;</span>
<a id="rest_code_e3e71792a96945eca3906adc21ee5ae1-2" name="rest_code_e3e71792a96945eca3906adc21ee5ae1-2" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e3e71792a96945eca3906adc21ee5ae1-2"></a><span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span><span class="w"> </span><span class="n">make_temporary</span><span class="p">(</span><span class="n">E</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">expr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_e3e71792a96945eca3906adc21ee5ae1-3" name="rest_code_e3e71792a96945eca3906adc21ee5ae1-3" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e3e71792a96945eca3906adc21ee5ae1-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="p">(</span><span class="n">expr</span><span class="p">);</span>
<a id="rest_code_e3e71792a96945eca3906adc21ee5ae1-4" name="rest_code_e3e71792a96945eca3906adc21ee5ae1-4" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e3e71792a96945eca3906adc21ee5ae1-4"></a><span class="p">}</span>
<a id="rest_code_e3e71792a96945eca3906adc21ee5ae1-5" name="rest_code_e3e71792a96945eca3906adc21ee5ae1-5" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e3e71792a96945eca3906adc21ee5ae1-5"></a>
<a id="rest_code_e3e71792a96945eca3906adc21ee5ae1-6" name="rest_code_e3e71792a96945eca3906adc21ee5ae1-6" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e3e71792a96945eca3906adc21ee5ae1-6"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">E</span><span class="p">,</span><span class="w"> </span><span class="n">cpp_enable_iff</span><span class="p">(</span><span class="o">!</span><span class="n">is_dma</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="p">)</span><span class="o">&gt;</span>
<a id="rest_code_e3e71792a96945eca3906adc21ee5ae1-7" name="rest_code_e3e71792a96945eca3906adc21ee5ae1-7" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e3e71792a96945eca3906adc21ee5ae1-7"></a><span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span><span class="w"> </span><span class="n">make_temporary</span><span class="p">(</span><span class="n">E</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">expr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_e3e71792a96945eca3906adc21ee5ae1-8" name="rest_code_e3e71792a96945eca3906adc21ee5ae1-8" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e3e71792a96945eca3906adc21ee5ae1-8"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">force_temporary</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="p">(</span><span class="n">expr</span><span class="p">));</span>
<a id="rest_code_e3e71792a96945eca3906adc21ee5ae1-9" name="rest_code_e3e71792a96945eca3906adc21ee5ae1-9" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e3e71792a96945eca3906adc21ee5ae1-9"></a><span class="p">}</span>
</pre></div>
<p>One version of the function will forward and the other version will force
a temporary and the return type can be different since these are two different
functions. This is not bad, but still requires two functions where you only want
to write one. However, in C++17, we can do much better using <code>if constexpr</code>:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_b786d5092e014197b3fafa7158da5300-1" name="rest_code_b786d5092e014197b3fafa7158da5300-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_b786d5092e014197b3fafa7158da5300-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">E</span><span class="o">&gt;</span>
<a id="rest_code_b786d5092e014197b3fafa7158da5300-2" name="rest_code_b786d5092e014197b3fafa7158da5300-2" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_b786d5092e014197b3fafa7158da5300-2"></a><span class="k">decltype</span><span class="p">(</span><span class="k">auto</span><span class="p">)</span><span class="w"> </span><span class="n">make_temporary</span><span class="p">(</span><span class="n">E</span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">expr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_b786d5092e014197b3fafa7158da5300-3" name="rest_code_b786d5092e014197b3fafa7158da5300-3" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_b786d5092e014197b3fafa7158da5300-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">is_dma</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_b786d5092e014197b3fafa7158da5300-4" name="rest_code_b786d5092e014197b3fafa7158da5300-4" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_b786d5092e014197b3fafa7158da5300-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="p">(</span><span class="n">expr</span><span class="p">);</span>
<a id="rest_code_b786d5092e014197b3fafa7158da5300-5" name="rest_code_b786d5092e014197b3fafa7158da5300-5" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_b786d5092e014197b3fafa7158da5300-5"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_b786d5092e014197b3fafa7158da5300-6" name="rest_code_b786d5092e014197b3fafa7158da5300-6" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_b786d5092e014197b3fafa7158da5300-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">force_temporary</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="p">(</span><span class="n">expr</span><span class="p">));</span>
<a id="rest_code_b786d5092e014197b3fafa7158da5300-7" name="rest_code_b786d5092e014197b3fafa7158da5300-7" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_b786d5092e014197b3fafa7158da5300-7"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_b786d5092e014197b3fafa7158da5300-8" name="rest_code_b786d5092e014197b3fafa7158da5300-8" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_b786d5092e014197b3fafa7158da5300-8"></a><span class="p">}</span>
</pre></div>
<p>I think this version is really superior to the previous one. We only have one
function and the logic is much clearer!</p>
<p>Let's now see an advantage of the point 2. In ETL, there are two kinds of
matrices, matrices with compile-time dimensions (fast matrices) and matrices
with runtime dimensions (dynamic matrices). When they are used, for instance for
a matrix-multiplication, I use static assertions for fast matrices and runtime
assertions for dynamic matrices. Here is an example for the validation of the
matrix-matrix multiplication:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_baede58052f844a69063409ab94cfc6e-1" name="rest_code_baede58052f844a69063409ab94cfc6e-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">C</span><span class="p">,</span><span class="w"> </span><span class="n">cpp_disable_iff</span><span class="p">(</span><span class="n">all_fast</span><span class="o">&lt;</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="o">&gt;</span><span class="p">)</span><span class="o">&gt;</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-2" name="rest_code_baede58052f844a69063409ab94cfc6e-2" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-2"></a><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">check</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">A</span><span class="o">&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">B</span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">C</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-3" name="rest_code_baede58052f844a69063409ab94cfc6e-3" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-3"></a><span class="w">    </span><span class="k">static_assert</span><span class="p">(</span><span class="n">all_2d</span><span class="o">&lt;</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="s">"Matrix multiplication needs matrices"</span><span class="p">);</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-4" name="rest_code_baede58052f844a69063409ab94cfc6e-4" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-4"></a><span class="w">    </span><span class="n">cpp_assert</span><span class="p">(</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-5" name="rest_code_baede58052f844a69063409ab94cfc6e-5" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-5"></a><span class="w">        </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w">         </span><span class="c1">//interior dimensions</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-6" name="rest_code_baede58052f844a69063409ab94cfc6e-6" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-6"></a><span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w">  </span><span class="c1">//exterior dimension 1</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-7" name="rest_code_baede58052f844a69063409ab94cfc6e-7" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-7"></a><span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="w"> </span><span class="c1">//exterior dimension 2</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-8" name="rest_code_baede58052f844a69063409ab94cfc6e-8" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-8"></a><span class="w">        </span><span class="s">"Invalid sizes for multiplication"</span><span class="p">);</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-9" name="rest_code_baede58052f844a69063409ab94cfc6e-9" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-9"></a><span class="w">    </span><span class="n">cpp_unused</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-10" name="rest_code_baede58052f844a69063409ab94cfc6e-10" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-10"></a><span class="w">    </span><span class="n">cpp_unused</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-11" name="rest_code_baede58052f844a69063409ab94cfc6e-11" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-11"></a><span class="w">    </span><span class="n">cpp_unused</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-12" name="rest_code_baede58052f844a69063409ab94cfc6e-12" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-12"></a><span class="p">}</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-13" name="rest_code_baede58052f844a69063409ab94cfc6e-13" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-13"></a>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-14" name="rest_code_baede58052f844a69063409ab94cfc6e-14" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-14"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">C</span><span class="p">,</span><span class="w"> </span><span class="n">cpp_enable_iff</span><span class="p">(</span><span class="n">all_fast</span><span class="o">&lt;</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="o">&gt;</span><span class="p">)</span><span class="o">&gt;</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-15" name="rest_code_baede58052f844a69063409ab94cfc6e-15" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-15"></a><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">check</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">A</span><span class="o">&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">B</span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">C</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-16" name="rest_code_baede58052f844a69063409ab94cfc6e-16" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-16"></a><span class="w">    </span><span class="k">static_assert</span><span class="p">(</span><span class="n">all_2d</span><span class="o">&lt;</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="s">"Matrix multiplication needs matrices"</span><span class="p">);</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-17" name="rest_code_baede58052f844a69063409ab94cfc6e-17" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-17"></a><span class="w">    </span><span class="k">static_assert</span><span class="p">(</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-18" name="rest_code_baede58052f844a69063409ab94cfc6e-18" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-18"></a><span class="w">        </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span><span class="p">()</span><span class="w">         </span><span class="c1">//interior dimensions</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-19" name="rest_code_baede58052f844a69063409ab94cfc6e-19" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-19"></a><span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="o">&gt;</span><span class="p">()</span><span class="w">  </span><span class="c1">//exterior dimension 1</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-20" name="rest_code_baede58052f844a69063409ab94cfc6e-20" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-20"></a><span class="w">            </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="o">&gt;</span><span class="p">(),</span><span class="w"> </span><span class="c1">//exterior dimension 2</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-21" name="rest_code_baede58052f844a69063409ab94cfc6e-21" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-21"></a><span class="w">        </span><span class="s">"Invalid sizes for multiplication"</span><span class="p">);</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-22" name="rest_code_baede58052f844a69063409ab94cfc6e-22" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-22"></a><span class="w">    </span><span class="n">cpp_unused</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-23" name="rest_code_baede58052f844a69063409ab94cfc6e-23" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-23"></a><span class="w">    </span><span class="n">cpp_unused</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-24" name="rest_code_baede58052f844a69063409ab94cfc6e-24" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-24"></a><span class="w">    </span><span class="n">cpp_unused</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<a id="rest_code_baede58052f844a69063409ab94cfc6e-25" name="rest_code_baede58052f844a69063409ab94cfc6e-25" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_baede58052f844a69063409ab94cfc6e-25"></a><span class="p">}</span>
</pre></div>
<p>Again, we use SFINAE to distinguish the two different cases. In that case, we
cannot use a normal <code>if</code> since the value of the dimensions cannot be taken
at compile-time for dynamic matrices, more precisely, some templates cannot be
instantiated for dynamic matrices. As for the cpp_unused, we have to use for the
static version because we don't use them and for the dynamic version because
they won't be used if the assertions are not enabled. Let's use <code>if constexpr</code> to avoid having two functions:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_5859461d13884ec58c29ed6ea6505137-1" name="rest_code_5859461d13884ec58c29ed6ea6505137-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">C</span><span class="o">&gt;</span>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-2" name="rest_code_5859461d13884ec58c29ed6ea6505137-2" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-2"></a><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">check</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">A</span><span class="o">&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">B</span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">C</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-3" name="rest_code_5859461d13884ec58c29ed6ea6505137-3" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-3"></a><span class="w">    </span><span class="k">static_assert</span><span class="p">(</span><span class="n">all_2d</span><span class="o">&lt;</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="s">"Matrix multiplication needs matrices"</span><span class="p">);</span>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-4" name="rest_code_5859461d13884ec58c29ed6ea6505137-4" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-4"></a>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-5" name="rest_code_5859461d13884ec58c29ed6ea6505137-5" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">all_fast</span><span class="o">&lt;</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-6" name="rest_code_5859461d13884ec58c29ed6ea6505137-6" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-6"></a><span class="w">        </span><span class="k">static_assert</span><span class="p">(</span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span><span class="p">()</span><span class="w">         </span><span class="c1">//interior dimensions</span>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-7" name="rest_code_5859461d13884ec58c29ed6ea6505137-7" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-7"></a><span class="w">                          </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="o">&gt;</span><span class="p">()</span><span class="w">  </span><span class="c1">//exterior dimension 1</span>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-8" name="rest_code_5859461d13884ec58c29ed6ea6505137-8" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-8"></a><span class="w">                          </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="o">&gt;</span><span class="p">(),</span><span class="w"> </span><span class="c1">//exterior dimension 2</span>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-9" name="rest_code_5859461d13884ec58c29ed6ea6505137-9" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-9"></a><span class="w">                      </span><span class="s">"Invalid sizes for multiplication"</span><span class="p">);</span>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-10" name="rest_code_5859461d13884ec58c29ed6ea6505137-10" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-10"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-11" name="rest_code_5859461d13884ec58c29ed6ea6505137-11" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-11"></a><span class="w">        </span><span class="n">cpp_assert</span><span class="p">(</span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w">         </span><span class="c1">//interior dimensions</span>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-12" name="rest_code_5859461d13884ec58c29ed6ea6505137-12" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-12"></a><span class="w">                       </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w">  </span><span class="c1">//exterior dimension 1</span>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-13" name="rest_code_5859461d13884ec58c29ed6ea6505137-13" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-13"></a><span class="w">                       </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="w"> </span><span class="c1">//exterior dimension 2</span>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-14" name="rest_code_5859461d13884ec58c29ed6ea6505137-14" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-14"></a><span class="w">                   </span><span class="s">"Invalid sizes for multiplication"</span><span class="p">);</span>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-15" name="rest_code_5859461d13884ec58c29ed6ea6505137-15" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-15"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-16" name="rest_code_5859461d13884ec58c29ed6ea6505137-16" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-16"></a>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-17" name="rest_code_5859461d13884ec58c29ed6ea6505137-17" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-17"></a><span class="w">    </span><span class="n">cpp_unused</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-18" name="rest_code_5859461d13884ec58c29ed6ea6505137-18" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-18"></a><span class="w">    </span><span class="n">cpp_unused</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-19" name="rest_code_5859461d13884ec58c29ed6ea6505137-19" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-19"></a><span class="w">    </span><span class="n">cpp_unused</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
<a id="rest_code_5859461d13884ec58c29ed6ea6505137-20" name="rest_code_5859461d13884ec58c29ed6ea6505137-20" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_5859461d13884ec58c29ed6ea6505137-20"></a><span class="p">}</span>
</pre></div>
<p>Since the <em>discarded</em> won't be instantiated, we can now use a single function!
We also avoid some duplications of the first static assertion of the unused
statements. Pretty great, right ? But we can do better with C++17. Indeed, it
added a nice new attribute <code>[[maybe_unused]]</code>. Let's see what this gives
us:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_3b76273ad93e4e788aac3b7e0edc0980-1" name="rest_code_3b76273ad93e4e788aac3b7e0edc0980-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_3b76273ad93e4e788aac3b7e0edc0980-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">C</span><span class="o">&gt;</span>
<a id="rest_code_3b76273ad93e4e788aac3b7e0edc0980-2" name="rest_code_3b76273ad93e4e788aac3b7e0edc0980-2" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_3b76273ad93e4e788aac3b7e0edc0980-2"></a><span class="k">static</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">check</span><span class="p">([[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">A</span><span class="o">&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">B</span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="p">[[</span><span class="n">maybe_unused</span><span class="p">]]</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">C</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_3b76273ad93e4e788aac3b7e0edc0980-3" name="rest_code_3b76273ad93e4e788aac3b7e0edc0980-3" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_3b76273ad93e4e788aac3b7e0edc0980-3"></a><span class="w">    </span><span class="k">static_assert</span><span class="p">(</span><span class="n">all_2d</span><span class="o">&lt;</span><span class="n">A</span><span class="p">,</span><span class="n">B</span><span class="p">,</span><span class="n">C</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="s">"Matrix multiplication needs matrices"</span><span class="p">);</span>
<a id="rest_code_3b76273ad93e4e788aac3b7e0edc0980-4" name="rest_code_3b76273ad93e4e788aac3b7e0edc0980-4" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_3b76273ad93e4e788aac3b7e0edc0980-4"></a>
<a id="rest_code_3b76273ad93e4e788aac3b7e0edc0980-5" name="rest_code_3b76273ad93e4e788aac3b7e0edc0980-5" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_3b76273ad93e4e788aac3b7e0edc0980-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="p">(</span><span class="n">all_fast</span><span class="o">&lt;</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="o">&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_3b76273ad93e4e788aac3b7e0edc0980-6" name="rest_code_3b76273ad93e4e788aac3b7e0edc0980-6" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_3b76273ad93e4e788aac3b7e0edc0980-6"></a><span class="w">        </span><span class="k">static_assert</span><span class="p">(</span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span><span class="p">()</span><span class="w">         </span><span class="c1">//interior dimensions</span>
<a id="rest_code_3b76273ad93e4e788aac3b7e0edc0980-7" name="rest_code_3b76273ad93e4e788aac3b7e0edc0980-7" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_3b76273ad93e4e788aac3b7e0edc0980-7"></a><span class="w">                          </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="o">&gt;</span><span class="p">()</span><span class="w">  </span><span class="c1">//exterior dimension 1</span>
<a id="rest_code_3b76273ad93e4e788aac3b7e0edc0980-8" name="rest_code_3b76273ad93e4e788aac3b7e0edc0980-8" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_3b76273ad93e4e788aac3b7e0edc0980-8"></a><span class="w">                          </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="o">&gt;</span><span class="p">(),</span><span class="w"> </span><span class="c1">//exterior dimension 2</span>
<a id="rest_code_3b76273ad93e4e788aac3b7e0edc0980-9" name="rest_code_3b76273ad93e4e788aac3b7e0edc0980-9" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_3b76273ad93e4e788aac3b7e0edc0980-9"></a><span class="w">                      </span><span class="s">"Invalid sizes for multiplication"</span><span class="p">);</span>
<a id="rest_code_3b76273ad93e4e788aac3b7e0edc0980-10" name="rest_code_3b76273ad93e4e788aac3b7e0edc0980-10" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_3b76273ad93e4e788aac3b7e0edc0980-10"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_3b76273ad93e4e788aac3b7e0edc0980-11" name="rest_code_3b76273ad93e4e788aac3b7e0edc0980-11" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_3b76273ad93e4e788aac3b7e0edc0980-11"></a><span class="w">        </span><span class="n">cpp_assert</span><span class="p">(</span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w">         </span><span class="c1">//interior dimensions</span>
<a id="rest_code_3b76273ad93e4e788aac3b7e0edc0980-12" name="rest_code_3b76273ad93e4e788aac3b7e0edc0980-12" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_3b76273ad93e4e788aac3b7e0edc0980-12"></a><span class="w">                       </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="w">  </span><span class="c1">//exterior dimension 1</span>
<a id="rest_code_3b76273ad93e4e788aac3b7e0edc0980-13" name="rest_code_3b76273ad93e4e788aac3b7e0edc0980-13" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_3b76273ad93e4e788aac3b7e0edc0980-13"></a><span class="w">                       </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">dim</span><span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">c</span><span class="p">),</span><span class="w"> </span><span class="c1">//exterior dimension 2</span>
<a id="rest_code_3b76273ad93e4e788aac3b7e0edc0980-14" name="rest_code_3b76273ad93e4e788aac3b7e0edc0980-14" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_3b76273ad93e4e788aac3b7e0edc0980-14"></a><span class="w">                   </span><span class="s">"Invalid sizes for multiplication"</span><span class="p">);</span>
<a id="rest_code_3b76273ad93e4e788aac3b7e0edc0980-15" name="rest_code_3b76273ad93e4e788aac3b7e0edc0980-15" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_3b76273ad93e4e788aac3b7e0edc0980-15"></a><span class="w">    </span><span class="p">}</span>
<a id="rest_code_3b76273ad93e4e788aac3b7e0edc0980-16" name="rest_code_3b76273ad93e4e788aac3b7e0edc0980-16" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_3b76273ad93e4e788aac3b7e0edc0980-16"></a><span class="p">}</span>
</pre></div>
<p>No more need for <code>cpp_unused</code> trick :) This attribute tells the compiler
that a variable or parameter can be sometimes unused and therefore does not lead
to a warning for it. Only one thing that is not great with this attribute is
that it's too long, 16 characters. It almost double the width of my check
function signature. Imagine if you have more parameters, you'll soon have to use
several lines. I wish there was a way to set an attribute for all parameters
together or a shortcut. I'm considering whether to use a short macro to use in
place of it, but haven't yet decided.</p>
<p>Just a note, if you have <code>else if</code> statements, you need to set them as
<code>constexpr</code> as well! This was a bit weird for me, but you can figure it as
if the condition is <code>constexpr</code>, then the <code>if</code> (or <code>else if</code>)
is <code>constexpr</code> as well.</p>
<p>Overall, I'm really satisfied with the new <cite>if constexpr</cite>! This really makes the
code much nicer in many cases, especially if you abuse metaprogramming like
I do.</p>
<p>You may remember that I've <a class="reference external" href="https://baptiste-wicht.com/posts/2015/07/simulate-static_if-with-c11c14.html">coded a version of static if in the past with C++14</a> in the past. This was able to solve point 2, but not point 1 and was much uglier. Now we have a good solution to it. I've replaced two of these in the current code with the new <code>if constexpr</code>.</p>
</section><section id="fold-expressions"><h2>Fold expressions</h2>
<p>For me, fold expressions is the second major feature of C++17. I wont' go into
too much details here, since
<a class="reference external" href="https://baptiste-wicht.com/posts/2015/05/cpp17-fold-expressions.html">I've already talked about fold expression in the past</a>
. But I'll show two examples of refactorings I've been able to do with this.</p>
<p>Here was the size() function of a static matrix in ETL before:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_79178b4c5a76483c8181f604e6ee1fbb-1" name="rest_code_79178b4c5a76483c8181f604e6ee1fbb-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_79178b4c5a76483c8181f604e6ee1fbb-1"></a><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="nf">size</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_79178b4c5a76483c8181f604e6ee1fbb-2" name="rest_code_79178b4c5a76483c8181f604e6ee1fbb-2" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_79178b4c5a76483c8181f604e6ee1fbb-2"></a><span class="w">   </span><span class="k">return</span><span class="w"> </span><span class="n">mul_all</span><span class="o">&lt;</span><span class="n">Dims</span><span class="p">...</span><span class="o">&gt;</span><span class="p">;</span>
<a id="rest_code_79178b4c5a76483c8181f604e6ee1fbb-3" name="rest_code_79178b4c5a76483c8181f604e6ee1fbb-3" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_79178b4c5a76483c8181f604e6ee1fbb-3"></a><span class="p">}</span>
</pre></div>
<p>The Dims parameter pack from the declaration of fast_matrix:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_d3a1af78df464689b3881a75cc0e1bdd-1" name="rest_code_d3a1af78df464689b3881a75cc0e1bdd-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_d3a1af78df464689b3881a75cc0e1bdd-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="p">,</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">ST</span><span class="p">,</span><span class="w"> </span><span class="n">order</span><span class="w"> </span><span class="n">SO</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="p">...</span><span class="w"> </span><span class="n">Dims</span><span class="o">&gt;</span>
<a id="rest_code_d3a1af78df464689b3881a75cc0e1bdd-2" name="rest_code_d3a1af78df464689b3881a75cc0e1bdd-2" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_d3a1af78df464689b3881a75cc0e1bdd-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">fast_matrix_impl</span><span class="p">;</span>
</pre></div>
<p>And the mul_all is a simple helper that multiplies each value of the variadic
parameter pack:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_08ce616ece7643f781b4ebb32e38a7bc-1" name="rest_code_08ce616ece7643f781b4ebb32e38a7bc-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_08ce616ece7643f781b4ebb32e38a7bc-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">size_t</span><span class="w"> </span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="p">...</span><span class="w"> </span><span class="n">Dims</span><span class="o">&gt;</span>
<a id="rest_code_08ce616ece7643f781b4ebb32e38a7bc-2" name="rest_code_08ce616ece7643f781b4ebb32e38a7bc-2" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_08ce616ece7643f781b4ebb32e38a7bc-2"></a><span class="k">struct</span><span class="w"> </span><span class="nc">mul_all_impl</span><span class="w"> </span><span class="k">final</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">mul_all_impl</span><span class="o">&lt;</span><span class="n">Dims</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
<a id="rest_code_08ce616ece7643f781b4ebb32e38a7bc-3" name="rest_code_08ce616ece7643f781b4ebb32e38a7bc-3" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_08ce616ece7643f781b4ebb32e38a7bc-3"></a>
<a id="rest_code_08ce616ece7643f781b4ebb32e38a7bc-4" name="rest_code_08ce616ece7643f781b4ebb32e38a7bc-4" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_08ce616ece7643f781b4ebb32e38a7bc-4"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">size_t</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span>
<a id="rest_code_08ce616ece7643f781b4ebb32e38a7bc-5" name="rest_code_08ce616ece7643f781b4ebb32e38a7bc-5" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_08ce616ece7643f781b4ebb32e38a7bc-5"></a><span class="k">struct</span><span class="w"> </span><span class="nc">mul_all_impl</span><span class="o">&lt;</span><span class="n">F</span><span class="o">&gt;</span><span class="w"> </span><span class="k">final</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">integral_constant</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="p">,</span><span class="w"> </span><span class="n">F</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{};</span>
<a id="rest_code_08ce616ece7643f781b4ebb32e38a7bc-6" name="rest_code_08ce616ece7643f781b4ebb32e38a7bc-6" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_08ce616ece7643f781b4ebb32e38a7bc-6"></a>
<a id="rest_code_08ce616ece7643f781b4ebb32e38a7bc-7" name="rest_code_08ce616ece7643f781b4ebb32e38a7bc-7" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_08ce616ece7643f781b4ebb32e38a7bc-7"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">size_t</span><span class="w"> </span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="p">...</span><span class="w"> </span><span class="n">Dims</span><span class="o">&gt;</span>
<a id="rest_code_08ce616ece7643f781b4ebb32e38a7bc-8" name="rest_code_08ce616ece7643f781b4ebb32e38a7bc-8" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_08ce616ece7643f781b4ebb32e38a7bc-8"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">mul_all</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mul_all_impl</span><span class="o">&lt;</span><span class="n">F</span><span class="p">,</span><span class="w"> </span><span class="n">Dims</span><span class="p">...</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">;</span>
</pre></div>
<p>Before C++17, the only way to compute this result at compilation time was to use
template recursion, either with types or with constexpr functions. I think this
is pretty heavy only for doing a multiplication sum. Now, with fold expressions,
we can manipulate the parameter pack directly and rewrite our size function:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_4410e538aad343eb8392f2659bcfe8d1-1" name="rest_code_4410e538aad343eb8392f2659bcfe8d1-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_4410e538aad343eb8392f2659bcfe8d1-1"></a><span class="k">static</span><span class="w"> </span><span class="k">constexpr</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="nf">size</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_4410e538aad343eb8392f2659bcfe8d1-2" name="rest_code_4410e538aad343eb8392f2659bcfe8d1-2" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_4410e538aad343eb8392f2659bcfe8d1-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">Dims</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">...);</span>
<a id="rest_code_4410e538aad343eb8392f2659bcfe8d1-3" name="rest_code_4410e538aad343eb8392f2659bcfe8d1-3" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_4410e538aad343eb8392f2659bcfe8d1-3"></a><span class="p">}</span>
</pre></div>
<p>This is much better! This clearly states that each value of the parameter should
be multiplied together. For instance <code>1,2,3</code> will become <code>(1*2)*3</code>.</p>
<p>Another place where I was using this was to code a traits that tests if a set of
boolean are all true at compilation-time:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_e46e814c1dff485d93f642825bb09956-1" name="rest_code_e46e814c1dff485d93f642825bb09956-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e46e814c1dff485d93f642825bb09956-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="kt">bool</span><span class="p">...</span><span class="w"> </span><span class="n">B</span><span class="o">&gt;</span>
<a id="rest_code_e46e814c1dff485d93f642825bb09956-2" name="rest_code_e46e814c1dff485d93f642825bb09956-2" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e46e814c1dff485d93f642825bb09956-2"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">and_v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">is_same</span><span class="o">&lt;</span>
<a id="rest_code_e46e814c1dff485d93f642825bb09956-3" name="rest_code_e46e814c1dff485d93f642825bb09956-3" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e46e814c1dff485d93f642825bb09956-3"></a><span class="w">    </span><span class="n">cpp</span><span class="o">::</span><span class="n">tmp_detail</span><span class="o">::</span><span class="n">bool_list</span><span class="o">&lt;</span><span class="nb">true</span><span class="p">,</span><span class="w"> </span><span class="n">B</span><span class="p">...</span><span class="o">&gt;</span><span class="p">,</span>
<a id="rest_code_e46e814c1dff485d93f642825bb09956-4" name="rest_code_e46e814c1dff485d93f642825bb09956-4" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e46e814c1dff485d93f642825bb09956-4"></a><span class="w">    </span><span class="n">cpp</span><span class="o">::</span><span class="n">tmp_detail</span><span class="o">::</span><span class="n">bool_list</span><span class="o">&lt;</span><span class="n">B</span><span class="p">...,</span><span class="w"> </span><span class="nb">true</span><span class="o">&gt;&gt;::</span><span class="n">value</span><span class="p">;</span>
</pre></div>
<p>I was using a nice trick here to test if all booleans are true. I don't remember
where I picked it up, but it's quite nice and very fast to compile.</p>
<p>This was used for instance to test that a set of expressions are all
single-precision floating points:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_be1ad6fa295f4daf8c8e82e66bcf4bdd-1" name="rest_code_be1ad6fa295f4daf8c8e82e66bcf4bdd-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_be1ad6fa295f4daf8c8e82e66bcf4bdd-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">E</span><span class="o">&gt;</span>
<a id="rest_code_be1ad6fa295f4daf8c8e82e66bcf4bdd-2" name="rest_code_be1ad6fa295f4daf8c8e82e66bcf4bdd-2" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_be1ad6fa295f4daf8c8e82e66bcf4bdd-2"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">all_single_precision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">and_v</span><span class="o">&lt;</span><span class="p">(</span><span class="n">is_single_precision</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="p">)...</span><span class="o">&gt;</span><span class="p">;</span>
</pre></div>
<p>Now, we can get rid of the and_v traits and use directly the parameter pack
directly:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_7a8483cd229d44ed8750f1aa247e661a-1" name="rest_code_7a8483cd229d44ed8750f1aa247e661a-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_7a8483cd229d44ed8750f1aa247e661a-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span><span class="w"> </span><span class="n">E</span><span class="o">&gt;</span>
<a id="rest_code_7a8483cd229d44ed8750f1aa247e661a-2" name="rest_code_7a8483cd229d44ed8750f1aa247e661a-2" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_7a8483cd229d44ed8750f1aa247e661a-2"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">all_single_precision</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">is_single_precision</span><span class="o">&lt;</span><span class="n">E</span><span class="o">&gt;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">...);</span>
</pre></div>
<p>I think using fold expressions results in much clearer syntax and better code
and it's a pretty nice feature overall :)</p>
<p>As a note here, I'd like to mention, that you can also use this syntax to call
a function on each argument that you have, which makes for much nicer syntax as
well and I'll be using that in DLL once I migrate it to C++17.</p>
</section><section id="miscellaneous"><h2>Miscellaneous</h2>
<p>There are also a few more C++17 features that I've used to improve ETL, but that
have a bit less impact.</p>
<p>A very nice feature of C++17 is the support for structured bindings. Often you
end up with a function that returns several parts of information in the form of
a pair or a tuple or even a fixed-size array. You can use an object for this,
but if you don't, you end up with code that is not terribly nice:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_4ad20eed5ed44563b8f728b8d7517301-1" name="rest_code_4ad20eed5ed44563b8f728b8d7517301-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_4ad20eed5ed44563b8f728b8d7517301-1"></a><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">;</span>
<a id="rest_code_4ad20eed5ed44563b8f728b8d7517301-2" name="rest_code_4ad20eed5ed44563b8f728b8d7517301-2" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_4ad20eed5ed44563b8f728b8d7517301-2"></a><span class="kt">bool</span><span class="w"> </span><span class="n">result</span><span class="p">;</span>
<a id="rest_code_4ad20eed5ed44563b8f728b8d7517301-3" name="rest_code_4ad20eed5ed44563b8f728b8d7517301-3" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_4ad20eed5ed44563b8f728b8d7517301-3"></a><span class="kt">float</span><span class="w"> </span><span class="n">alpha</span><span class="p">;</span>
<a id="rest_code_4ad20eed5ed44563b8f728b8d7517301-4" name="rest_code_4ad20eed5ed44563b8f728b8d7517301-4" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_4ad20eed5ed44563b8f728b8d7517301-4"></a><span class="n">std</span><span class="o">::</span><span class="n">tie</span><span class="p">(</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my_function</span><span class="p">();</span>
</pre></div>
<p>It's not terribly bad, but in these cases, you should be be hoping for something
better. With c++17, you can do better:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_60ffffd7e4934483955aa1302c2ed55a-1" name="rest_code_60ffffd7e4934483955aa1302c2ed55a-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_60ffffd7e4934483955aa1302c2ed55a-1"></a><span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">index</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">my_function</span><span class="p">();</span>
</pre></div>
<p>Now you can directly use auto to deduce the types of the three variables at once
and you can get all the results in the variables at once as well :) I think this
is really nice and can really profit some projects. In ETL, I've almost no use
for this, but I'm going to be using that a bit more in DLL.</p>
<p>Something really nice to clean up the code in C++17 is the ability to declared
nested namespaces in one line. Before, you have a nested namespace
etl::impl::standard for instance, you would do:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_e0144fd432d847adb5e37595eafb2a1b-1" name="rest_code_e0144fd432d847adb5e37595eafb2a1b-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e0144fd432d847adb5e37595eafb2a1b-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">etl</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_e0144fd432d847adb5e37595eafb2a1b-2" name="rest_code_e0144fd432d847adb5e37595eafb2a1b-2" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e0144fd432d847adb5e37595eafb2a1b-2"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">impl</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_e0144fd432d847adb5e37595eafb2a1b-3" name="rest_code_e0144fd432d847adb5e37595eafb2a1b-3" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e0144fd432d847adb5e37595eafb2a1b-3"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">standard</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_e0144fd432d847adb5e37595eafb2a1b-4" name="rest_code_e0144fd432d847adb5e37595eafb2a1b-4" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e0144fd432d847adb5e37595eafb2a1b-4"></a>
<a id="rest_code_e0144fd432d847adb5e37595eafb2a1b-5" name="rest_code_e0144fd432d847adb5e37595eafb2a1b-5" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e0144fd432d847adb5e37595eafb2a1b-5"></a><span class="c1">// Someting inside etl::impl::standard</span>
<a id="rest_code_e0144fd432d847adb5e37595eafb2a1b-6" name="rest_code_e0144fd432d847adb5e37595eafb2a1b-6" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e0144fd432d847adb5e37595eafb2a1b-6"></a>
<a id="rest_code_e0144fd432d847adb5e37595eafb2a1b-7" name="rest_code_e0144fd432d847adb5e37595eafb2a1b-7" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e0144fd432d847adb5e37595eafb2a1b-7"></a><span class="p">}</span><span class="w"> </span><span class="c1">// end of namespace standard</span>
<a id="rest_code_e0144fd432d847adb5e37595eafb2a1b-8" name="rest_code_e0144fd432d847adb5e37595eafb2a1b-8" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e0144fd432d847adb5e37595eafb2a1b-8"></a><span class="p">}</span><span class="w"> </span><span class="c1">// end of namespace impl</span>
<a id="rest_code_e0144fd432d847adb5e37595eafb2a1b-9" name="rest_code_e0144fd432d847adb5e37595eafb2a1b-9" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_e0144fd432d847adb5e37595eafb2a1b-9"></a><span class="p">}</span><span class="w"> </span><span class="c1">// end of namespace etl</span>
</pre></div>
<p>In C++17, you can do:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_f5f3c6f21d904857989211ee97cdf535-1" name="rest_code_f5f3c6f21d904857989211ee97cdf535-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_f5f3c6f21d904857989211ee97cdf535-1"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">etl</span><span class="o">::</span><span class="nn">impl</span><span class="o">::</span><span class="nn">standard</span><span class="w"> </span><span class="p">{</span>
<a id="rest_code_f5f3c6f21d904857989211ee97cdf535-2" name="rest_code_f5f3c6f21d904857989211ee97cdf535-2" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_f5f3c6f21d904857989211ee97cdf535-2"></a>
<a id="rest_code_f5f3c6f21d904857989211ee97cdf535-3" name="rest_code_f5f3c6f21d904857989211ee97cdf535-3" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_f5f3c6f21d904857989211ee97cdf535-3"></a><span class="c1">// Someting inside etl::impl::standard</span>
<a id="rest_code_f5f3c6f21d904857989211ee97cdf535-4" name="rest_code_f5f3c6f21d904857989211ee97cdf535-4" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_f5f3c6f21d904857989211ee97cdf535-4"></a>
<a id="rest_code_f5f3c6f21d904857989211ee97cdf535-5" name="rest_code_f5f3c6f21d904857989211ee97cdf535-5" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_f5f3c6f21d904857989211ee97cdf535-5"></a><span class="p">}</span><span class="w"> </span><span class="c1">// end of namespace etl::impl::standard</span>
</pre></div>
<p>I think it's pretty neat :)</p>
<p>Another very small change is the ability to use the typename keyword in place of
the class keyword when declaring template template parameters. Before, you had
to declare:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_75f6e7dfdcd54b28856f4ed75dc5cf7b-1" name="rest_code_75f6e7dfdcd54b28856f4ed75dc5cf7b-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_75f6e7dfdcd54b28856f4ed75dc5cf7b-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="o">&gt;</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">X</span><span class="o">&gt;</span>
</pre></div>
<p>now you can also use:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_9be74ff4130d4f10b22d0727ce7080d5-1" name="rest_code_9be74ff4130d4f10b22d0727ce7080d5-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_9be74ff4130d4f10b22d0727ce7080d5-1"></a><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="o">&gt;</span><span class="w"> </span><span class="k">typename</span><span class="w"> </span><span class="nc">X</span><span class="o">&gt;</span>
</pre></div>
<p>It's just some syntactic sugar, but I think it's quite nice.</p>
<p>The last improvement that I want to talk about is one that probably very few
know about but it's pretty neat. Since C++11, you can use the <code>alignas(X)</code>
specifier for types and objects to specify on how many bytes you want to align
these. This is pretty nice if you want to align on the stack. However, this
won't always work for dynamic memory allocation. Imagine this struct:</p>
<div class="code"><pre class="code cpp"><a id="rest_code_a37a9e6ebd374e1e8f7b9bfb43c3e06a-1" name="rest_code_a37a9e6ebd374e1e8f7b9bfb43c3e06a-1" href="posts/2018/02/c%2B%2B17-migration-of-expression-templates-library-etl.html#rest_code_a37a9e6ebd374e1e8f7b9bfb43c3e06a-1"></a><span class="k">struct</span><span class="w"> </span><span class="nc">alignas</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="w">  </span><span class="n">test_struct</span><span class="w">  </span><span class="p">{</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="n">data</span><span class="p">;</span><span class="w"> </span><span class="p">};</span>
</pre></div>
<p>If you declare an object of this type on the stack, you have the guarantee that
it will be aligned on 128 bytes. However, if you use <code>new</code> to allocate it
on the heap, you don't have such guarantee. Indeed, the problem is that 128 is
greater than the maximum default alignment. This is called an over-aligned type.
In such cases, the result will be aligned on the max alignment of your system.
Since C++17, <code>new</code> supports aligned dynamic memory allocation of
over-aligned types. Therefore, you can use a simple <code>alignas</code> to allocate
dynamic over-aligned types :) I need this in ETL for matrices that need to be
aligned for vectorized code. Before, I was using a larger array with some
padding in order to find an aligned element inside, but that is not very nice,
now the code is much better.</p>
</section><section id="compilation-time"><h2>Compilation Time</h2>
<p>I've done a few tests to see how much impact these news features have on
compilation time. Here, I'm doing benchmark on compiling the entire test suite
in different compilation mode, I enabled most compilation options (all GPU and
BLAS options in order to make sure almost all of the library is compiled).</p>
<p>Since I'm a bit short on time before going to vacation, I've only gathered the
results with g++. Here are the results with G++ 7.2.0</p>
<table><tbody>
<tr>
<td></td>
<td><p>debug</p></td>
<td><p>release</p></td>
<td><p>release_debug</p></td>
</tr>
<tr>
<td><p>C++14</p></td>
<td><p>862s</p></td>
<td><p>1961s</p></td>
<td><p>1718s</p></td>
</tr>
<tr>
<td><p>C++17</p></td>
<td><p>892s</p></td>
<td><p>2018s</p></td>
<td><p>1745s</p></td>
</tr>
<tr>
<td><p>Difference</p></td>
<td><p>+3.4%</p></td>
<td><p>+2.9%</p></td>
<td><p>+1.5%</p></td>
</tr>
</tbody></table>
<p>Overall, I'm a bit disappointed by these results, it's around 3% slower to
compile the C++17 version than the C++14 version. I was thinking that this would
a least be as fast to compile as before. It seems that currently with G++ 7.2,
<code>if constexpr</code> are slower to compile than the equivalent SFINAE functions.
I didn't do individual benchmarks of all the features I've migrated, therefore,
it may not be coming from <code>if constexpr</code>, but since it's the greatest
change by far, it's the more likely candidate. Once I'll have a little more
time, after my vacations, I'll try to see if that is also the case with clang.</p>
<p>Keep in mind that we are compiling the test suite here. The ETL test suite is
using the manual selection mode of the library in order to be able to test all
the possible implementations of each operation. This makes a considerable
difference in performance. I expect better compilation time when this is used in
automatic selection mode (the default mode). In the default mode, a lot more
code can be disabled with <code>if constexpr</code>. I will test this next with the
DLL library which I will also migrate to C++17.</p>
</section><section id="conclusion-2"><h2>Conclusion</h2>
<p>This concludes this report on the migration of my ETL library from C++14 to
C++17. Overall, I'm really satisfied with the improvement of the code, it's much
better. I'm a bit disappointed by the slight increase  (around 3%) in
compilation time, but it's not dramatic either. I'm still hoping that once it's
used in DLL, I will see a decrease in compilation, but we'll see that when I'll
be done with the migration of DLL to C++17 which may take some time since I'll
have two weeks vacation in China starting Friday.</p>
<p>The new version is available only through the <em>master</em> branch. It will be
released as the 1.3 version probably when I integrate some new features, but in
itself will not be released as new version. You can take a look in the
<a class="reference external" href="https://github.com/wichtounet/etl">Github etl repository</a> if you are interested.</p>
</section>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2018/01/budgetwarrior-10-web-interface-and-asset-tracking.html" class="u-url">budgetwarrior 1.0: Web interface and asset tracking!</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baptiste Wicht
            </span></p>
            <p class="dateline">
            <a href="posts/2018/01/budgetwarrior-10-web-interface-and-asset-tracking.html" rel="bookmark">
            <time class="published dt-published" datetime="2018-01-26T12:52:31+01:00" itemprop="datePublished" title="2018-01-26 12:52">2018-01-26 12:52</time></a>
            </p>
                <p class="commentline">
    
    <a href="posts/2018/01/budgetwarrior-10-web-interface-and-asset-tracking.html#disqus_thread" data-disqus-identifier="cache/posts/2018/01/budgetwarrior-10-web-interface-and-asset-tracking.html">Comments</a>


        </p>
</div>
    </header><div class="p-summary entry-summary">
    <p>I'm happy to announce the release of budgetwarrior 1.0. This is a major change
over the previous version.</p>
<section id="web-interface"><h2>Web Interface</h2>
<p>Until now, budgetwarrior could only be used in command line. This is fine for
me, but not for every body. Since I wanted to share my budget with my
girlfriend, I needed something less nerdy ;)</p>
<p>Therefore, I added support for <em>a web interface for budgetwarrior</em>. Every feature
of the console application is now available in the web version. Moreover, since
the web version offers <em>slightly better</em> graphical capabilities, I added a few
more graphs and somewhat more information at some places. I'm not nearly an
expert in web interface, but I think I managed to get something not too bad
together. There are still some things to improve that I'll go through in the
future but so far the web interface is pretty satisfying and it is <strong>mobile friendly</strong>!</p>
<p>The web server is coded in C++ (who would have guessed...) and is embedded in
the application, you need to use the command <strong>server</strong> to use it:</p>
<pre class="literal-block">budget server</pre>
<p>and the server will be launched (by default at localhost:8080). You can
configure the port with <code>server_port=X</code> in the configuration file and the
listen address with <code>server_listen=X</code>. You can access your server at
<a class="reference external" href="http://localhost:8080">http://localhost:8080</a>.</p>
<p>Here is what this will display:</p>
<img alt="Web interface index" src="images/budgetwarrior_web_index.png"><p>Note: All the data is randomized</p>
<p>The main page shows your assets, the current net worth, your monthly cash-flow
and the state of your objectives.</p>
<p>The menu will give you access to all the features of the application. You can
add expenses and earnings, see reports, manage your assets and your objectives
and so on. Basically, you can do everything you did in the application, but you
have access to more visualization tools than you would on the console. For
instance, you can access your fortune over time:</p>
<img alt="Web interface fortune graph" src="images/budgetwarrior_web_fortune.png"><p>or see how your portfolio does in terms of currency:</p>
<img alt="Web interface portofolio currency breakdown" src="images/budgetwarrior_web_portfolio_currency.png"><p>Normally, unless I forgot something (in which case, I'll fix it), everything
should be doable from the web interface. This is simply easier people that are
not as nerdy as me for console ;)</p>
<p>The management is still the same, the server will write to the same file the
base application uses. Therefore, you cannot use the server and the command line
application on the same machine at the same time. Nevertheless, if the server is
not running, you can still use the command line application. This could be
useful if you want to use the web visualization while still using the command
line tool for managing the budget.</p>
<p>The default user and password is admin:1234, but you of course change it using
web_password and web_user in the configuration. You can also disable the
security if you are sure of yourself by setting <code>server_secure=true</code> in
the configuration. The server currently does not support</p>
<p>Currently, it does not protect against concurrent modifications of the same
data. It is very unlikely to happen with only a few people using the
applications, but I plan to improve that in the future.</p>
</section><section id="server-mode"><h2>Server mode</h2>
<p>Although it's not possible to use both the server and the command line
application at the same time, it's possible to use the command line application
in server mode. In this case, instead of reading and writing the data from the
hard disk, the application will send requests to the server to read and write
the data it needs. With this, you can use both the server and the command line
application at the same time!</p>
<p>While running, the server exposes a simple API that can be used to get
all the information about the budget data and that can also be used to add new
expenses, earnings and so on directly to the server data. The API is also
protected by authentication.</p>
<p>Currently, the server does not support HTTPS. However, you can run it behind
a proxy such as nginx which is running in HTTPS. This is what I'm doing. The
server mode supports SSL from the client to the server, you just have to set
<code>server_sll=true</code> in the configuration.</p>
<p>This is the mode I'm currently using and will continue using. With this, I can
quickly do some modifications using the command line and if I want to see
advanced visualization, I just have to open my browser and everything is
updated. Moreover, in the future, other people involved with my budget will be
able to access the web interface. This also solves the synchronization problem
in a much better way than before.</p>
<p>Just as it was the case with the server, this is not made to be used in parallel
by different users. This should be perfectly fine for a small household.</p>
</section><section id="assets-tracking"><h2>Assets Tracking</h2>
<p>Already a few months ago, I've added <cite>the feature to track assets &lt;https://baptiste-wicht.com/posts/2017/10/budgetwarrior-track-assets-portfolio-savings-rates-auto-completion.html&gt; `_ into budgetwarrior. You can define the list of the assets you possess. The tool will then help you track the value of your assets. You can set your desired distribution of bonds, cash and stocks and the tool will help you see if you need to rebalance your assets. This will let you compute your net worth, with :code:`budget asset value</cite>:</p>
<img alt="View of your assets" src="images/budgetwarrior_asset_values.png"><p>Moreover, you can also set a few of your assets as your portfolio assets. These
assets have a desired distribution and are handled different. These are the
assets you directly manage yourself, your investment portfolio. You can then
track their value and see if they need rebalancing. For instance, here is
a randomized rebalancing of your portfolio, with <code>budget asset rebalance</code>:</p>
<img alt="View of the needed rebalance" src="images/budgetwarrior_rebalance.png"><p>All these features are now also available on the web version as well.</p>
</section><section id="better-console-usability"><h2>Better console usability</h2>
<p>A few months ago, I added some <a class="reference external" href="https://baptiste-wicht.com/posts/2017/10/budgetwarrior-track-assets-portfolio-savings-rates-auto-completion.html">quality-of-life improvements to the console appplication</a>. You can now cycle through the list of possible values for accounts for instance in the console! This is down with the UP and DOWN keys. Now, I also added auto-completion with TAB key. You can write Ins&lt;TAB&gt; and it will complete to Insurances if you have an Insurances account in your budget. This makes it much faster to enter new expenses or to update asset values.</p>
<section id="installation"><h3>Installation</h3>
<p>If you are on Gentoo, you can install it using layman:</p>
<pre class="literal-block">layman -a wichtounet
emerge -a budgetwarrior</pre>
<p>If you are on Arch Linux, you can use this <cite>AUR repository
&lt;https://github.com/StreakyCobra/aur&gt;</cite> (wait a few day for the new version to be
updated)_</p>
<p>For other systems, you'll have to install from sources:</p>
<pre class="literal-block">git clone --recursive git://github.com/wichtounet/budgetwarrior.git
cd budgetwarrior
git checkout 1.0
make
sudo make install</pre>
</section><section id="conclusion"><h3>Conclusion</h3>
<p>Overall, even though I'm not a fan of web development, it was quite fun to add
all these features to budgetwarrior and made it much better I think. This is
a very significant change to the project since it almost doubled in number of
source lines of code, but I think it's a change that was needed.</p>
<p>I think these changes really make budgetwarrior more useful to a wider group of
people and I'm pretty to have finally come around and implemented them. I still
have a few things I plan to improve in the near future. First, I want to make
the website a bit faster, there are many scripts and stylesheets that are being
loaded and make the site a bit bloated. I'll also enable gzip compression of the
website to speed up things. I will also ensure that the server can handle
requests concurrently without any problem of the data (should be simple since we
don't need high performance). I may also add a new module to budgetwarrior to
track your progress towards retirement if this is something you are interested
in, but I haven't decided in what form exactly. Finally, I will also try to
optimize the requests that are being done between the server and the client when
run in server mode. Indeed, it currently downloads almost all the data from the
server which is far from optimal.</p>
<p>If you are interested by the sources, you can download them on Github:
<a class="reference external" href="https://github.com/wichtounet/budgetwarrior">budgetwarrior</a>.</p>
<p>If you have a suggestion or you found a bug, please post an issue on Github.</p>
<p>If you have any comment, don't hesitate to contact me, either by letting a
comment on this post or by email.</p>
</section></section>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/2018/01/my-thesis-is-available-deep-learning-feature-extraction-for-image-processing.html" class="u-url">My thesis is available: Deep Learning Feature Extraction for Image Processing</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                Baptiste Wicht
            </span></p>
            <p class="dateline">
            <a href="posts/2018/01/my-thesis-is-available-deep-learning-feature-extraction-for-image-processing.html" rel="bookmark">
            <time class="published dt-published" datetime="2018-01-15T15:11:57+01:00" itemprop="datePublished" title="2018-01-15 15:11">2018-01-15 15:11</time></a>
            </p>
                <p class="commentline">
    
    <a href="posts/2018/01/my-thesis-is-available-deep-learning-feature-extraction-for-image-processing.html#disqus_thread" data-disqus-identifier="cache/posts/2018/01/my-thesis-is-available-deep-learning-feature-extraction-for-image-processing.html">Comments</a>


        </p>
</div>
    </header><div class="p-summary entry-summary">
    <p>I'm happy to say that I've finally put my thesis online and updated
my <a class="reference external" href="https://baptiste-wicht.com/stories/publications.html">Publications</a> page.</p>
<p>I should have done that earlier but it slipped my mind, so there it is!</p>
<p>My thesis (Deep Learning Feature Extraction for Image Processing) is now
available to download.  Here is the abstract of the thesis:</p>
<p>In this thesis, we propose to use methodologies that automatically learn how to
extract relevant features from images. We are especially interested in
evaluating how these features compare against handcrafted features. More
precisely, we are interested in the unsupervised training that is used for the
Restricted Boltzmann Machine (RBM) and Convolutional RBM (CRBM) models. These
models relaunched the Deep Learning interest of the last decade. During the time
of this thesis, the auto-encoders approach, especially Convolutional
Auto-Encoders (CAE) have been used more and more. Therefore, one objective of
this thesis is also to compare the CRBM approach with the CAE approach.</p>
<p>The scope of this work is defined by several machine learning tasks. The first
one, handwritten digit recognition, is analysed to see how much the unsupervised
pretraining technique introduced with the Deep Belief Network (DBN) model
improves the training of neural networks. The second, detection and recognition
of Sudoku in images, is evaluating the efficiency of DBN and Convolutional DBN
(CDBN) models for classification of images of poor quality. Finally, features
are learned fully unsupervised from images for a keyword spotting task and are
compared against well-known handcrafted features. Moreover, the thesis was also
oriented around a software engineering axis. Indeed, a complete machine learning
framework was developed during this thesis to explore possible optimizations and
possible algorithms in order to train the tested models as fast as possible.</p>
<p>If you are interested, you can:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://www.researchgate.net/publication/322505397_Deep_Learning_feature_Extraction_for_Image_Processing">Read it on ResearchGate</a></p></li>
<li><p><a class="reference external" href="https://baptiste-wicht.com/publication_store/phd_thesis.pdf">Directly download the PDF</a></p></li>
</ul>
<p>I hope this will interest a few of you! As always, if you have any question,
don't hesitate to let me a comment ;)</p>
<p>As for the current projects, I'm still currently working on the next version of
budgetwarrior, but I don't have any expected release date. It will depend on
much time I'm able to put to the project.</p>
    </div>
    </article>
</div>

        <nav class="postindexpager"><ul class="pager">
<li class="next">
                <a href="index-33.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2023         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         - License: 
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="assets/img/cc.png"></a>
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element) {
            return element.getElementsByTagName('img')[0].alt;
    }});
    </script>
</body>
</html>