<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Tutorials and short posts about programming, C++, Java, Assembly, Operating Systems Development, Compilers, ...">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Blog blog("Baptiste Wicht"); (old posts, page 30) | Blog blog("Baptiste Wicht");</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="http://baptiste-wicht.com/index-30.html">
<link rel="prev" href="index.html" type="text/html">
<link rel="next" href="index-29.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2175227-7']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script><link href="favicon.ico" rel="icon" type="image/x-icon">
<link rel="publisher" href="https://plus.google.com/+BaptisteWicht">
</head>
<body>

<!-- Menubar -->

<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<div class="container-fluid">
<!-- This keeps the margins nice -->
    <div class="row">
        <div class="col-sm-3 col-lg-2">
            <nav class="navbar navbar-inverse navbar-fixed-side"><div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="http://baptiste-wicht.com/">
                        <span id="blog-title">Blog blog("Baptiste Wicht");</span>
                    </a>
                </div>
<!-- /.navbar-header -->

                <div class="collapse navbar-collapse navbar-ex1-collapse">
                    <ul class="nav navbar-nav">
<li>
<a href="stories/about.html">About</a>
                </li>
<li>
<a href="stories/publications.html">Publications</a>
                </li>
<li>
<a href="stories/projects.html">Projects</a>
                </li>
<li>
<a href="categories/index.html">Tags</a>
                </li>
<li>
<a href="archive.html">Archives</a>
                </li>
<li>
<a href="http://feeds.feedburner.com/BaptisteWicht">RSS</a>


                            </li>
<li class="navbar-content">
                                <h3>Tags</h3>
                            </li>
                            <li class="navbar-empty">
                                <div id="tag_cloud_left_container" style="line-height: 18px !important;"></div>
                            </li>
                            <li class="navbar-block">


                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow @wichtounet on Twitter" href="https://twitter.com/wichtounet">
                                <img src="assets/img/twitter.png" alt="Follow @wichtounet on Twitter"></a>
                        </li>

                        <li class="wicht-navbar-right">
                            <a target="_blank" title="Follow +BaptisteWicht on Google+" href="https://plus.google.com/+BaptisteWicht">
                                <img src="assets/img/google_plus.png" alt="Follow +BaptisteWicht on Google+"></a>
                        </li>


                    </ul>
</div>
<!-- /.navbar-collapse -->
            </nav>
</div> <!-- col -->
        <div class="col-sm-9 col-lg-10">
            <div id="content"></div>
            
        <article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2017/02/publication-cpu-performance-optimizations-rbm-crbm.html" class="u-url">Publication: CPU Performance Optimizations for RBM and CRBM</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2017-02-07T17:33:33+01:00">2017-02-07 17:33</time></small>
</h1>
        <hr>
<div class="p-summary">
        <div>
<p>Recently, we have published a paper about performance optimizations that may
interest you.</p>
<p>The paper is <a class="reference external" href="https://www.researchgate.net/publication/307908790_On_CPU_Performance_Optimization_of_Restricted_Boltzmann_Machine_and_Convolutional_RBM">On CPU Performance Optimizations for Restricted Boltzmann Machine and Convolutional RBM</a>, published in the Proceedings of the Artificial Neural Networks and Pattern Recognition workshop (ANNPR-2016). I've presented this paper in Germany, at Ulm.</p>
<p>Although most of the performance research going on is focused on GPU, there are
still of research laboratories that are only equipped with CPU and it remains
important to be as fast as possible on CPU. Moreover, this is something
I really like.</p>
<p>For this publication, I have tried to make my Restricted Boltzmann Machine (RBM)
and Convolutional RBM (CRBM) implementations in my DLL library as fast as
possible.</p>
<p>The first part of the article is about Restricted Boltzmann Machine (RBM) which
are a form of dense Artificial Neural Network (ANN). Their training is very
similar to that of the ANN with Gradient Descent. Four different network
configurations are being tested.</p>
<p>First, mini-batch training is shown to be much faster than online training, even
when online training is performed in parallel. Once mini-batch training is used,
BLAS operations are used in order to get as much performance as possible on the
different operations, mainly the Matrix Matrix Multiplication with the use of
the GEMM operation from the Intel Math Kernel Library (MKL). Moreover, the
parallel version of the MKL is also used to get even more performance. When all
these optimizations are performed, speedups of 11 to 30 are obtained compared to
the online training, depending on the network configurations. This final version
is able  to perform one epoch of Contrastive Divergence in 4 to 15 seconds
depending on the network, for 60000 images.</p>
<p>The second part of the article is about Convolutional Restricted Boltzmann
Machine (CRBM). This is almost the equivalent of a Convolutional Neural Network
(CNN). Again four different networks are evaluated.</p>
<p>The main problem with CRBM is that there are no standard implementations of the
convolution operation that is really fast. Therefore, it is not possible to
simply use a BLAS library to make the computation as fast as possible. The first
optimization that was tried is to vectorize the convolutions. With this, the
speedups have been between 1.1 and 1.9 times faster. I'm not really satisfied
with these results since in fact per convolution the speedups are much better.
Moreover, I have since been able to obtain better speedups but the deadline was
too short to include them in this paper. I'll try to talk about these
improvements in more details on this blog. What is more interesting to to
parallellize the different convolutions since they are mostly independent. This
can bring a speedup of the amount of cores available on the machine. Since
convolutions are extremely memory hungry, virtual cores with Hyper Threading
generally does not help. An interesting optimization is to use a Matrix
Multiplication to compute several valid convolutions at once.  This can give an
additional speedup between 1.6 and 2.2 compared to the vectorized version. While
it is possible to use the FFT to reduce the full convolution as well, in our
experiment the images were not big enough for this to be interesting. The final
speedups are about 10 times faster with these optimizations.</p>
<p>We have obtained pretty good and I'm happy we have been published. However, I'm
not very satisfied with these results since I've been able to get even faster
since this and when compared with other frameworks, DLL is actually quite
competitive. I'll try to publish something new in the future.</p>
<p>If you want more information, you can have a look at the paper. If you want to
look at the code, you can have a look at my projects:</p>
<ul class="simple">
<li>
<a class="reference external" href="https://github.com/wichtounet/etl">Expression Templates Library (ETL)</a>: For
the Matrix Multiplication and Convolutions</li>
<li>
<a class="reference external" href="https://github.com/wichtounet/dll">Deep Learning Library (DLL)</a>: For the RBM
and CRBM implementations</li>
</ul>
<p>Don't hesitate to ask any questions if you want more information :)</p>
</div>
        </div>
            
        
    <a href="posts/2017/02/publication-cpu-performance-optimizations-rbm-crbm.html#disqus_thread" data-disqus-identifier="cache/posts/2017/02/publication-cpu-performance-optimizations-rbm-crbm.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2017/01/publications-sudoku-recognition-with-deep-belief-network.html" class="u-url">Publications - Sudoku Recognition with Deep Belief Network</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2017-01-20T08:56:46+01:00">2017-01-20 08:56</time></small>
</h1>
        <hr>
<div class="p-summary">
        <div>
<p>I recently realized that I never talked about my publications on this website...
I thought it was time to start. I'll start to write a few posts about my earlier
publications and then I'll try to write something for the new ones not too late.</p>
<p>For the story, I'm currently a PHD student at the University of Fribourg, in
Switzerland. My PHD is about the use of Deep Learning technologies to
automatically extract features from images. I have developed my Deep Learning
Library (DLL) project for this thesis. We have published a few articles on the
various projects that we tackled during the thesis. I'll try to go in order.</p>
<p>At the beginning of the thesis, I used Restricted Boltzmann Machine and Deep
Belief Network to perform digit recognition on images of Sudoku taken with
a phone camera. We published two papers on this subject.</p>
<ul class="simple">
<li>
<a class="reference external" href="https://www.researchgate.net/publication/282303748_Camera-based_Sudoku_recognition_with_deep_belief_network">Camera-based Sudoku Recognition with Deep Belief Network</a>, in the Proceedings of the International Conference on Soft Computing and Pattern Recognition (SOCPAR-2014)</li>
<li>
<a class="reference external" href="https://www.researchgate.net/publication/307545305_Mixed_handwritten_and_printed_digit_recognition_in_Sudoku_with_Convolutional_Deep_Belief_Network">Mixed Handwritten and printed digit recognition in Sudoku With Convolutional Deep Belief Network</a>, in the Proceedings of the International Conference on Document Analysis and Recognition (ICDAR-2015)</li>
</ul>
<p>The Sudoku grid and digits are detected using standard image processing
techniques:</p>
<ol class="arabic simple">
<li>The image is first converted to grayscale, then a median blur is applied to
remove noise and the image is binarized using Adapteive Thresholding</li>
<li>The edges are detected using the Canny algorithm. From these, the lines are
detected using a Progressive Probabilistic Hough Transform</li>
<li>Using a connected component analysis, the segments of lines are clustered
together to detect the Sudoku Grid</li>
<li>The cells are then detected inside the grid using the inner lines and contour
detection is used to isolate the digits.</li>
</ol>
<p>Here is one of the original images from our dataset:</p>
<img alt="Original image from our dataset" class="align-center" src="images/image124.jpg"><p>Here are the detected characters from the previous image:</p>
<img alt="Detected digits from our application" class="align-center" src="images/image124_char.jpg"><p>Once all the digits have been found they are passed to a Deep Belief Network for
recognition. A Deep Belief Network is composed of several Restricted Boltzmann
Machines (RBM) that are stacked. The network is pretrained, by training each
RBM, in turn, with Contrastive Divergence. This algorithm basically trains each
RBM as an auto-encoder and learns a good feature representation of the inputs.
Once all the layers have been trained, the network can then be trained as
a regular neural network with Stochastic Gradient Descent.</p>
<p>In the second paper, the images of Sudoku are containing both computer printed
and handwritten digits (the grid is already filled). The other difference is
that the second system used a Convolutional DBN instead of DBN. The difference
being that each layer is a Convolutional RBM. Such a model will learn a set of
small filters that will be applied to each position of the image.</p>
<p>On the second version of the dataset, we have been able to achieve 99.14% of
recognition of the digits or 92.5% of fully-recognized grid  with the
Convolutional Network.</p>
<p>You can find the <a class="reference external" href="https://github.com/wichtounet/sudoku_recognizer">C++ implementation on Github</a>.</p>
<p>If you want to have a look, I've updated the
<a class="reference external" href="http://baptiste-wicht.com/stories/publications.html">list of my publications</a>
on this website.</p>
<p>If you want more details on this project, don't hesitate to ask here or on
Github, or read the paper :)
The next post about my publications will probably be about CPU performances!</p>
</div>
        </div>
            
        
    <a href="posts/2017/01/publications-sudoku-recognition-with-deep-belief-network.html#disqus_thread" data-disqus-identifier="cache/posts/2017/01/publications-sudoku-recognition-with-deep-belief-network.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2017/01/add-milight-smart-lights-to-domoticz-home-automation-system.html" class="u-url">Add Milight smart lights to my Domoticz home automation system</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2017-01-15T22:00:25+01:00">2017-01-15 22:00</time></small>
</h1>
        <hr>
<div class="p-summary">
        <div>
<p>Recently, <a class="reference external" href="http://baptiste-wicht.com/posts/2017/01/new-home-automation-system-with-domoticz.html#">I switched from my hand crafted home automation system to Domoticz</a>.
This allows me to easily integrate new smart devices and remote controllable
peripherals without much effort. I plan to relate my effort in having fun
controlling my home :)</p>
<p>I'm now able to control lights in two rooms with Domoticz. The most well-known
smart bulbs are the Philips Hue. However, they are stupidly expensive. There are
a lot of alternatives. I've ordered some Milight light bulbs and controller to
test with Domoticz. I didn't order a lot of them because I wanted to make sure
they would work with my system.
Milight system is working over Wifi. There are several components to a Milight
system:</p>
<ul class="simple">
<li>The LED Light Bulbs with Red/Green/Blue/White channels</li>
<li>The Wifi Controller that is able to control 4 zones</li>
<li>An RGBW Controller for LED strip</li>
</ul>
<p>The first two are necessary for any installation, the third is to control an
RGBW LED strip. This list is not exhaustive, it's only the components that
I have used. It is important to note that a single Wifi controller can only
control 4 zones. There are also remotes, but I have not bought one since I plan
to use them only from Domoticz and maybe smartphone.</p>
<p>The installation of the controller is relatively easy. You need to download the
Milight 2.0 application on the Android Play Store (or the equivalent for IOS).
Then, you can power on the Wifi Controller. It'll create a new Wifi on which you
can then connect on your phone. Then, you can use the application on your phone
to configure the device and make it connect to your home wireless network. Once,
this is done, you can connect your phone back to your home network. You can then
use the Milight application to configure your device. I highly recommend to set
a static IP address to the controller. The way I did it is simply to set a fixed
IP address on my DHCP server based on the MAC address of the MAC controller but
you can simply do the configuration in the application or in the web interface
of the controller (the user and password combination is admin:admin).</p>
<p>Here is the look of the controller (next to my RFLink):</p>
<img alt="Milight wifi controller" class="align-center" src="images/system.jpg"><p>(My phone is starting to die, hence the very bad quality of images)</p>
<p>You can then install your LED light bulbs. For, open first the remote on your
Android Milight application. Then plug the light bulb without power first. Then
power on the light and press once on one of the I buttons on one of the zones on
the remote. This will link the LED to the selected zone on the controller. You
can then control the light from your phone. Remember, only four zones and
therefore four lights per controller.</p>
<p>The installation for a LED strip is not much complicated. You need to plug the
4 wires (or 5 wires if your have an actual RGBW LED) into the corresponding
inputs on the controller. Then, you power it and you can link it to a zone like
a normal light bulb!</p>
<img alt="LEDS in my Living Room controlled by Milight" class="align-center" src="images/leds.jpg"><p>It works really well and directly without problems.</p>
<p>The last step is of course to configure your controller in Domoticz. It is
really easy to do. You need to add a new hardware of each of the Milight
controller. It is listed under the name "Limitless/AppLamp/Mi Light with
LAN/WiFi interface". You then can set the IP address and the port by default is
8899. Once you did configure the hardware, you'll see new devices appear in the
Devices list. There will one device for each zone and one device to control all
four zones at once. You can add the device you already configured as switches.
From the Switches interface you can turn the lamp on and off and you can</p>
<img alt="Domoticz Light Bulbs control" class="align-center" src="images/domoticz_rgbw.png"><p>You can then put them on your floor plan or control them from your rules.</p>
<p>So far, I'm pretty satisfied with this Milight system. The Android application
is of poor quality but aside from this is pretty good and the price is very
fair. I'm also really satisfied with the Domoticz support. The only that is sad
is that the Domoticz Android application does not support RGBW control of the
lamps, only on and off, but that is already cool.</p>
<p>Now that all of this is working well, I've ordered a few more light bulbs to
cover all my rooms and a few LED controller to control (and install first) the
other LEDS that I have in mind.</p>
<p>On another note, I've also added a new outside temperature sensor outside my
apartment. It is a very cheap Chinese sensor, bought on Ebay, based on the
XT200 system that is working very well with RFLink.</p>
<p>The next step in my system is probably to integrate Voice Control, but I don't
know exactly which way I'll go. I ordered a simple microphone that I intend to
plug on my spare Raspberry Pi, but I don't know if the range will be enough to
cover a room. Ideally, I would like to use an Amazon Dot, but they are not
available in Switzerland. I'll probably write more on the subject once I've
found an adequate solution. Another idea I've is to integrate support for ZWave
via OpenZWave and then add a few more cool sensors that I haven't found on an
cheaper system.</p>
<p>I hope this is interesting and don't hesitate if you have any question about my
home automation project. You can expect a few more posts about this as soon as
In improve it :)</p>
</div>
        </div>
            
        
    <a href="posts/2017/01/add-milight-smart-lights-to-domoticz-home-automation-system.html#disqus_thread" data-disqus-identifier="cache/posts/2017/01/add-milight-smart-lights-to-my-domoticz-home-automation-system.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2017/01/vivaldi-vimium-finally-no-more-firefox.html" class="u-url">Vivaldi + Vimium = Finally no more Firefox!</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2017-01-14T20:55:26+01:00">2017-01-14 20:55</time></small>
</h1>
        <hr>
<div class="p-summary">
        <div>
<p>I've been using the Pentadactyl Firefox extension for a long time. This
extensions "vimifies" Firefox and it does a very good job of it. This is
probably the best extension I have ever seen on any browser. This post is really
not against Pentadactyl, this is a great addon and it still works great.</p>
<p>However, I have been more and more dissatisfied of Mozilla Firefox over the
years. Indeed, the browser is becoming slower and slower all the time and I'm
experiencing more and more issues on Gentoo with it. But the biggest problem
I've with Firefox right now is the philosophy of the developers that is really
crappy. Currently, there is only one thing that is good in Firefox compared to
the other browsers, its extensions. Basically, an extension in Firefox can do
almost anything. Pentadactyl is able to transform most of the interface and get
rid of all of the useless parts of the interface. It is currently impossible to
do so in other browsers. These powerful addons are using the XUL/XPCOM
programming interface to do so. Pentadactyl is the only reason I've kept to
Firefox so long. But Firefox has announced, already more than a year ago, that
it will deprecate its XUL/XPCOM interface in favour of webextensions. This means
that a lot of very good addons will not be able to work anymore once the
deprecation has been completed. Several writers of popular Firefox have
announced that they will not even try to port their addons and some addons will
simply not be possible anymore. This is the case for Pentadactyl which is on the
line for when the deprecation occurs. The data for deprecated has already been
delayed but is likely to come anyway.</p>
<p>For several months, I've been looking at several possible replacements for my
current Pentadactyl browser. I've tried qutebrowser, but it is really too
limited in terms of features so far. I've also tried again Chromium which is
a great browser but unfortunately, there are very few possibilities for addons
to modify the interface. Vimium is a great addon for Chromium which is basically
the very much more lightweight alternative to Pentadactyl. It has much less
features, but most of the missing features are simply things that cannot be done
in Chromium.</p>
<p>Only recently did I test Vivaldi. Vivaldi is a free multi-platform browser,
based on Chromium and supporting Chromium extensions. The major difference with
Chrome is how the UI is customizable, due to the use of a dynamic UI, stylable
with CSS. With the customizability of Vivaldi plus the great shortcuts and
vim-like behaviour of vimium, I really feel like I found a new Pentadactyl with
the advantage of not having to bear Firefox!</p>
<p>Here is how it is looking with the follow URLs feature from vimium:</p>
<img alt="View of my Vivaldi browser" class="align-center" src="images/vivaldi.png"><p>Note: The gray bar on the left is the console to the left and the top kind of
bar is awesome wm, they are not part of the browser.</p>
<p>I'm using the dark theme with native windows. I've disabled the address bar,
moved the tab bar to the bottom and completely hidden the side panel. All that
remained was the title bar and the scroll bar.</p>
<p>To get rid of the title bar, you can use CSS. First, you have to only display
the Vivaldi button in the settings page. Then, you can use this custom CSS:</p>
<pre class="code CSS"><a name="rest_code_83f99370b00845d78faf7ed147a6ac4c-1"></a><span class="nt">button</span><span class="p">.</span><span class="nc">vivaldi</span> <span class="p">{</span>
<a name="rest_code_83f99370b00845d78faf7ed147a6ac4c-2"></a>    <span class="k">display</span><span class="p">:</span> <span class="kc">none</span> <span class="cp">!important</span><span class="p">;</span>
<a name="rest_code_83f99370b00845d78faf7ed147a6ac4c-3"></a><span class="p">}</span>
<a name="rest_code_83f99370b00845d78faf7ed147a6ac4c-4"></a>
<a name="rest_code_83f99370b00845d78faf7ed147a6ac4c-5"></a><span class="p">#</span><span class="nn">header</span> <span class="p">{</span>
<a name="rest_code_83f99370b00845d78faf7ed147a6ac4c-6"></a>    <span class="k">min-height</span><span class="p">:</span> <span class="mi">0</span> <span class="cp">!important</span><span class="p">;</span>
<a name="rest_code_83f99370b00845d78faf7ed147a6ac4c-7"></a>    <span class="k">z-index</span><span class="p">:</span> <span class="kc">auto</span> <span class="cp">!important</span><span class="p">;</span>
<a name="rest_code_83f99370b00845d78faf7ed147a6ac4c-8"></a><span class="p">}</span>
<a name="rest_code_83f99370b00845d78faf7ed147a6ac4c-9"></a>
<a name="rest_code_83f99370b00845d78faf7ed147a6ac4c-10"></a><span class="p">.</span><span class="nc">button-toolbar</span><span class="p">.</span><span class="nc">home</span> <span class="p">{</span> <span class="k">display</span><span class="p">:</span> <span class="kc">none</span> <span class="p">}</span>
</pre>
<p>to hide the title completely! To get rid of the scroll bar, you need to use the
Stylish extension and use this custom CSS:</p>
<pre class="code CSS"><a name="rest_code_81423ee7e2fc4f1db806c07daf2da4dc-1"></a><span class="p">::</span><span class="nd">-webkit-scrollbar</span><span class="p">{</span><span class="k">display</span><span class="p">:</span><span class="kc">none</span> <span class="cp">!important</span><span class="p">;</span> <span class="k">width</span><span class="p">:</span><span class="mi">0</span><span class="kt">px</span><span class="p">;}</span>
<a name="rest_code_81423ee7e2fc4f1db806c07daf2da4dc-2"></a><span class="p">::</span><span class="nd">-webkit-scrollbar-button</span><span class="o">,</span><span class="p">::</span><span class="nd">-webkit-scrollbar-track</span><span class="p">{</span><span class="k">display</span><span class="p">:</span><span class="kc">none</span> <span class="cp">!important</span><span class="p">;}</span>
<a name="rest_code_81423ee7e2fc4f1db806c07daf2da4dc-3"></a><span class="p">::</span><span class="nd">-webkit-scrollbar-thumb</span><span class="p">{</span><span class="k">display</span><span class="p">:</span> <span class="kc">none</span> <span class="cp">!important</span><span class="p">;}</span>
<a name="rest_code_81423ee7e2fc4f1db806c07daf2da4dc-4"></a><span class="p">::</span><span class="nd">-webkit-scrollbar-track</span><span class="p">{</span><span class="k">display</span><span class="p">:</span> <span class="kc">none</span> <span class="cp">!important</span><span class="p">;}</span>
</pre>
<p>And then, no more scroll bar :)</p>
<p>If you want to have full HTML5 video support, you need to install extra codecs.
On Gentoo, I've uploaded a ebuild on my overlay (wichtounet on layman) with the
name vivaldi-ffmpeg-codecs and everything should be working fine :)</p>
<p>Vimium is clearly inferior to Pentadactyl in that for instance it only works in
web page, not in system page and you still have to use the browser for a few
things, but it does not seem too bar so far. Moreover, I wasn't using all the
features of Pentadactyl. I haven't been used this browser for a long time, so
maybe there are things that I will miss from Pentadactyl, but I won't certainly
miss Firefox!</p>
</div>
        </div>
            
        
    <a href="posts/2017/01/vivaldi-vimium-finally-no-more-firefox.html#disqus_thread" data-disqus-identifier="cache/posts/2017/01/vivaldi-+-vimium-finally-no-more-firefox.html">Comments</a>


        </article><article class="postbox h-entry post-text"><h1 class="p-name">
<a href="posts/2017/01/new-home-automation-system-with-domoticz.html" class="u-url">New home automation system with Domoticz</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2017-01-08T16:08:42+01:00">2017-01-08 16:08</time></small>
</h1>
        <hr>
<div class="p-summary">
        <div>
<p>As you may remember, I started going into Home Automation last year with a <a class="reference external" href="http://baptiste-wicht.com/posts/2016/08/asgard-home-automation-project.html">C++ project, Asgard</a>.</p>
<p>Unfortunately, I haven't add the time to improve this project further and make
it really useful and I have so many C++ projects already, so I decided to switch
to using an existing project.</p>
<div class="section" id="choice">
<h2>Choice</h2>
<p>I needed a system that was at least able to handle everything my existing system
does:</p>
<ol class="arabic simple">
<li>Control my RF-433 Temperature Sensors (Oregon Temperature Sensors)</li>
<li>Control my RF-433 Remote Button</li>
<li>Control my smart power outlets</li>
<li>Ping and wake-on-lan my different computers</li>
<li>Be installable on a Raspberry Pi</li>
<li>Control Skadi/Kodi Home Cinema</li>
</ol>
<p>Of course, it also had to be open source and in a language that I can write
without agonizing pain (no Ruby, no JavaScript, ideally no Python (I hate a lot
of languages...)).</p>
<p>It's impressive the number of home automation projects that exist today. It's
really a hot topic, more than I though. After a few hours of research, I've
finally settled on Domoticz. It seemed that it could handle all my home
automation devices that I already had. Domoticz is an open source home
automation system. It's written mainly in C++, which is an advantage for me
since I'll be able to work inside it if necessary. It has a quite modern HTML5
interface. It has a lot of support for hardware and a lot of bridges for other
controllers as well. One of the reason I chose it is also the floor-planner
feature that looks really cool.</p>
</div>
<div class="section" id="installation">
<h2>Installation</h2>
<p>First of all, I cleaned the hardware of my Raspberry Pi. I got rid of my
breadboard and the components on it. Then, I put the Raspberry Pi on a nicer box
that I had laying around. One problem with Domoticz is that it does not support
directly RF433 devices, but need a controller in the middle. At first,
I believed I could simply connect them through GPIO and lets Domoticz do the
rest, but it's not possible. I ordered the different pieces for a RFLink
controller at nodo-shops. It is running on a Arduino Mega and is connected to
the Pi. The very big advantage is that they handle a lot of protocols directly,
so you only have to read the serial port to get information on RF-433 events.</p>
<p>Here is how the current system look:</p>
<img alt="Asgard automation system hardware" class="align-center" src="images/home_automation_hardware.jpg"><p>The black box is the Arduino Mega with RFLink software while the Transparent is
simply the Raspberry on which Domoticz is installed.</p>
<p>As for the installation of Domoticz, it's really simple. They also have images of
Raspberry Pi directly, but since my Raspberry was already installed with
Raspbian, I installed Domoticz on it directly. A simple matter of curl and bash:</p>
<pre class="code bash"><a name="rest_code_bf613a94f4324f7bb162cd195d646d56-1"></a>sudo curl -L install.domoticz.com <span class="p">|</span> sudo bash
</pre>
<p>After a few questions, your installation should be complete. You can browse your
Domoticz installation at the IP of your Pi and at the given port.</p>
</div>
<div class="section" id="home-automation-with-domoticz">
<h2>Home Automation with Domoticz</h2>
<p>There are several concepts in Domoticz that are important. At first, it seemed
a bit weird to me, but in the end it works really well and you get used to it
pretty fast.</p>
<p>The first concept is the hardware. It is not necessary hardware directly, but
rather a driver to some piece of information of switches than a real hardware in
my opinion. For instance, the RFLink Gateway is considered hardware as well as
the Forecast weather API. Here is all the hardware I've configured:</p>
<img alt="Domoticz Hardware Configuration" class="align-center" src="images/domoticz_hardware.png"><p>I've got some sensors from the motherboard, the Kodi interaction, the driver to
ping the different computers, the Forecast weather with Dark Sky and Weather
Underground, the RFLink communication, the wake-on-lan and some dummies virtual
switches.</p>
<p>On its own, an hardware is useless, but it can create devices that will be used
for home automation. A device is sub device of a particular driver. In some
cases, the devices will be created automatically. For instance, RF Link can
create devices as soon as they are detected. For wake-on-lan, you have to
configure MAC Addresses and they will be added as devices. And so on...</p>
<p>There are a lot of types of devices, also called switches. Some devices can do
some actions, for instance the wake-on-lan devices, while others are information
based such as ping or temperature sensors detected from the RFLink. For
instance, here are my temperature sensors:</p>
<img alt="Domoticz Temperature Sensors" class="align-center" src="images/domoticz_temperature.png"><p>As for my hardware I already had, I haven't add too many issues with them. The
Oregon Temperature Sensors worked out of the box without any issues as well my
old RF433 Ninja Block temperature sensor. The smart power outlets have been
pretty easy to use as well. The most problem I've add was with the remote
buttons. It seems to many that it should be the easiest, but RFLink has a lot of
problem with them, they are detected several times and are highly unreliable.
Interestingly you can also change the icon of most device to a large variety of
existing devices so that they would look more realistic.</p>
<p>Another feature I find pretty cool is the floor plan. You can create plans for
each floor of your house and then create rooms inside and finally attach devices
to each room and place inside the plan. Unfortunately, to draw the plan, you'll
have to use an external tool. I've used floorplanner for this, but you may use
any plan you have as long as you have an image.</p>
<p>Here is my floor plan with the devices (the scale is terribly off :P) :</p>
<img alt="Domoticz Floor Plan" class="align-center" src="images/domoticz_floorplan.png"><p>With that you can directly see the status of each of your sensors in each room.
Moreover, you can also activate some devices directly from the floor plan as
well :)</p>
<p>Normally, my Somfy blinds are supposed to work with the RFLink controller.
I have managed to control my blinds but only when the RFLink was within 50
centimeters of the Blinds, which is clearly not acceptable. I don't know from
where the problem comes. It may come from my Blinds controller inside the wall
or may come from bad antenna of the RFLink or from a bug in RFLink, so from now
I cannot control my blinds.</p>
<p>I have several D-Link cameras at home. You can also add cameras to Domoticz, but
don't expect a lot of support on this side. It's pretty poor indeed. The only
useful you can do in Domoticz with Cameras is to take a screenshot from them.
You cannot control the Camera or even have a decent video stream and cannot do
motion detection directly. I hope that the Camera support will improve in the
future. One thing that would be good is to add a view of the cameras in the
floor plan, but it is not possible currently.</p>
<p>What I did is to use Zoneminder to manage the cameras and send alert to Domoticz
when motion is detect with the REST API of Domoticz. Unfortunately that means
two systems to manage the Cameras. Zoneminder is a very good piece of software,
but one of the ugliest I've ever seen (even I can do a better web interface...)
and quite obscure to configure. But the numbers of cameras it can handle and the
capabilities to control the camera is very very powerful.</p>
</div>
<div class="section" id="events-and-actions">
<h2>Events and actions</h2>
<p>No home automation system would be complete without an events and rules system.
In Domoticz, you have several ways to create rules.</p>
<p>The first solution is to create group. A group is simply a set of switches that
are all activated together. This is pretty limited, but can be useful. The
second solution is a scene. A scene is activated by a device and can set several
switches to on or off after the activation. The problem with this is that you
have to listen for an action as activation, you cannot use an existing device or
a rule with a value. For me, these two possibilities are way too limited and
I don't really a reason to use them.</p>
<p>The best solution is to script an handler. For that, there are two ways, either
you define visually your script with blocky, for instance:</p>
<img alt="Domoticz Blockly Rule" class="align-center" src="images/domoticz_blockly.png"><p>This seemed so cool that I wanted to do all my rules with that. Unfortunately,
it is really limited. The main limitation is that you cannot nest if blocks. In
fact the interface lets you do, but it doesn't work afterwards. The other
limitation is that it has no notion of time. For instance, it's very hard to
create an action if a computer is shutdown for more than 60 seconds. You can do
it, but you end up creating virtual devices which are turned off after some
delay and it gets really complicated really soon...</p>
<p>In the end, I used Lua script directly. These scripts have the information about
the last values of each device and the last updated time as well. It's much
easier with that to create powerful rules especially when you want a notion of
time. There are plenty of examples on the Domoticz forum about very powerful
rules that you can create. Unfortunately, there are some limitations. For
instance, you cannot send several actions to the same device in the same script
Moreover, you also have to decode the values of the sensors yourself. For
instance, for a temperature and humidity sensor, you'll have to parse the values
and extract the one you need by hand.</p>
<p>So far, I haven't created many rules, only four. The first rule is that with the
push of one remote button I can power on my smart socket and turn on one of my
computers in my office. Then, if both the computers on this smart sockets have
been off for more than 60 seconds, the power is shut off on the smart socket.
And I have done almost the same for my media center and TV in my living room.</p>
<p>In the future, I'll probably only use the Lua scripting capability. In my
opinion, it's better to have all the scripts in the same language for
maintainability reasons. Once my futures devices arrive, I'll have a few more
rules to code.</p>
</div>
<div class="section" id="conclusion">
<h2>Conclusion</h2>
<p>To wrap up, I'd say that I'm pretty satisfied with my new home automation system
with Domoticz. It's not a perfect tool, but it has a lot of features and is
working quite well in general. I would recommend you to try it if you want
a good home automation system, fully featured and relatively easy to use.</p>
<p>I've several more things planned for this system. I plan to test a real motion
sensor rather than rely only on the cameras which are focused on the doors and
windows. I also plan to add an outdoor temperature sensor. And more
interestingly, I'm going to try to integrate smart bulbs from Milight to be able
to control my lights from the system. These are the shot term projects that
I want to do, but I have many more ideas!</p>
<p>I'm also sure that there are some features from Domoticz that I have overlooked
or not discovered.</p>
<p>I'll probably write more posts on Home Automation on the coming months.</p>
<p>For more information on Domoticz, you can consult
<a class="reference external" href="http://domoticz.com/">the official Domoticz website</a>.</p>
</div>
</div>
        </div>
            
        
    <a href="posts/2017/01/new-home-automation-system-with-domoticz.html#disqus_thread" data-disqus-identifier="cache/posts/2017/01/new-home-automation-system-with-domoticz.html">Comments</a>


        </article><nav class="postindexpager"><ul class="pager">
<li class="previous">
                <a href="index.html" rel="prev">Newer posts</a>
            </li>
            <li class="next">
                <a href="index-29.html" rel="next">Older posts</a>
            </li>
        </ul></nav><script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="https://"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>
</div> <!-- col -->
    </div>
<!-- row  -->
</div>
<!-- container-fluid -->

<!-- End of Menubar -->

<!-- Footer -->

<footer>
    Contents © 2017         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         - License: 
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="padding-left:5px;border-width:0" src="assets/img/cc.png"></a>
        <ul class="footer_inline_ul"></ul></footer><!-- Late loading stuff  --><script src="assets/js/all-nocdn.js"></script><script type="text/javascript">
      $(document).ready(function() {
        $.getJSON("/assets/js/tx3_tag_cloud.json", function(data){
            var items = [];
            $.each(data, function(key, val){
                var count = val[0];
                var url = val[1];
                var posts = val[2];

                if(count > 9){
                    items.push("<li data-weight='" + count + "'><a href='" + url + "'>" + key + "</a></li>");
                }
            });

            $("<ul/>", {
                "id": "tag_cloud_left",
                html: items.join("")
            }).appendTo("#tag_cloud_left_container");

            $("#tag_cloud_left").tx3TagCloud({
                multiplier: 0.8 // default multiplier is "1"
            });
        });
      });
    </script><!-- Google platform JS -->
</body>
</html>
