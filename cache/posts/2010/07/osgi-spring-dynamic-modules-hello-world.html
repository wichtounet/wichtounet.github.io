<p>In this post, we'll take <a target="_blank" href="http://www.baptiste-wicht.com/2010/07/osgi-hello-world-services/">the first implementation we made using <strong>OSGi</strong></a> and use <strong>Spring Dynamic Modules</strong> to improve the application. </p>
<p>Spring Dynamic Modules (Spring Dm) makes the development of <strong>OSGi-based applications</strong> a lot more easier. With that, the deployment of services is a lot easier. You can inject services like any other Spring beans. </p>
<p>So let's start with Spring dm. </p>
<!-- TEASER_END -->

<p>First of all, you need to download <a target="_blank" href="http://www.springsource.com/download/community/?project=Spring%20Dynamic%20Modules&amp;version=1.2.1">the Spring Dm Distribution</a>. For this article, I used the distributions with dependencies and I will only use this libraries : </p>
<pre>com.springsource.net.sf.cglib-2.1.3.jar
com.springsource.org.aopalliance-1.0.0.jar
log4j.osgi-1.2.15-SNAPSHOT.jar
com.springsource.slf4j.api-1.5.0.jar
com.springsource.slf4j.log4j-1.5.0.jar
com.springsource.slf4j.org.apache.commons.logging-1.5.0.jar
org.springframework.aop-2.5.6.SEC01.jar
org.springframework.beans-2.5.6.SEC01.jar
org.springframework.context-2.5.6.SEC01.jar
org.springframework.core-2.5.6.SEC01.jar
spring-osgi-core-1.2.1.jar
spring-osgi-extender-1.2.1.jar
spring-osgi-io-1.2.1.jar </pre>

<p>Of course, you can replace the Spring 2.5.6 libraries with the Spring 3.0 libraries. But for this article, Spring 2.5.6 will be enough. </p>
<p>So, start with the service bundle. If we recall, this bundle exported a single service : </p>
<pre class="code literal-block"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">bw</span><span class="o">.</span><span class="na">osgi</span><span class="o">.</span><span class="na">provider</span><span class="o">.</span><span class="na">able</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">HelloWorldService</span> <span class="o">{</span>
    <span class="kt">void</span> <span class="nf">hello</span><span class="o">();</span>
<span class="o">}</span>
</pre>


<pre class="code literal-block"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">bw</span><span class="o">.</span><span class="na">osgi</span><span class="o">.</span><span class="na">provider</span><span class="o">.</span><span class="na">impl</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.bw.osgi.provider.able.HelloWorldService</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorldServiceImpl</span> <span class="kd">implements</span> <span class="n">HelloWorldService</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">hello</span><span class="o">(){</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Hello World !&quot;</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<p>There is no changes to do here. Now, we can see the activator : </p>
<pre class="code literal-block"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">bw</span><span class="o">.</span><span class="na">osgi</span><span class="o">.</span><span class="na">provider</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.osgi.framework.BundleActivator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.framework.BundleContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.framework.ServiceRegistration</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.bw.osgi.provider.able.HelloWorldService</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.bw.osgi.provider.impl.HelloWorldServiceImpl</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProviderActivator</span> <span class="kd">implements</span> <span class="n">BundleActivator</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">ServiceRegistration</span> <span class="n">registration</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">(</span><span class="n">BundleContext</span> <span class="n">bundleContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">registration</span> <span class="o">=</span> <span class="n">bundleContext</span><span class="o">.</span><span class="na">registerService</span><span class="o">(</span>
                <span class="n">HelloWorldService</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span>
                <span class="k">new</span> <span class="nf">HelloWorldServiceImpl</span><span class="o">(),</span>
                <span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">(</span><span class="n">BundleContext</span> <span class="n">bundleContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">registration</span><span class="o">.</span><span class="na">unregister</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<p>So, here, we'll make simple. Let's delete this class, this is not useful anymore with Spring Dm. </p>
<p>We'll let Spring Dm export the bundle for us. We'll create a Spring context for this bundle. We just have to create a file provider-context.xml in the folder <em>META-INF/spring</em>. This is a simple context in XML file but we use a new namespace to register service, "<em>http://www.springframework.org/schema/osgi</em>". So let's start : </p>
<pre class="code literal-block"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>

<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="na">xmlns:osgi=</span><span class="s">&quot;http://www.springframework.org/schema/osgi&quot;</span>
       <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="s">            http://www.springframework.org/schema/beans</span>
<span class="s">            http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span class="s">            http://www.springframework.org/schema/osgi</span>
<span class="s">            http://www.springframework.org/schema/osgi/spring-osgi.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;helloWorldService&quot;</span> <span class="na">class=</span><span class="s">&quot;com.bw.osgi.provider.impl.HelloWorldServiceImpl&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;osgi:service</span> <span class="na">ref=</span><span class="s">&quot;helloWorldService&quot;</span> <span class="na">interface=</span><span class="s">&quot;com.bw.osgi.provider.able.HelloWorldService&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre>


<p>The only thing specific to OSGi is the <em>osgi:service</em> declaration. This line indicates that we register the <em>helloWorldService</em> as an OSGi service using the interface <em>HelloWorldService</em> as the name of the service. </p>
<p>If you put the context file in the <em>META-INF/spring</em> folder, it will be automatically detected by the Spring Extender and an application context will be created. </p>
<p>We can now go to the consumer bundle. In the first phase, we created that consumer : </p>
<pre class="code literal-block"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">bw</span><span class="o">.</span><span class="na">osgi</span><span class="o">.</span><span class="na">consumer</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.swing.Timer</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.event.ActionEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.event.ActionListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.bw.osgi.provider.able.HelloWorldService</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorldConsumer</span> <span class="kd">implements</span> <span class="n">ActionListener</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">HelloWorldService</span> <span class="n">service</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Timer</span> <span class="n">timer</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">HelloWorldConsumer</span><span class="o">(</span><span class="n">HelloWorldService</span> <span class="n">service</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>

        <span class="k">this</span><span class="o">.</span><span class="na">service</span> <span class="o">=</span> <span class="n">service</span><span class="o">;</span>

        <span class="n">timer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Timer</span><span class="o">(</span><span class="mi">1000</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">startTimer</span><span class="o">(){</span>
        <span class="n">timer</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stopTimer</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">timer</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">actionPerformed</span><span class="o">(</span><span class="n">ActionEvent</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">service</span><span class="o">.</span><span class="na">hello</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<p>At this time, there is no changes to do here. Instead of the injection with constructor we could have used an @Resource annotation, but this doesn't work in Spring 2.5.6 and Spring Dm (but works well with Spring 3.0). </p>
<p>And now the activator : </p>
<pre class="code literal-block"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">bw</span><span class="o">.</span><span class="na">osgi</span><span class="o">.</span><span class="na">consumer</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.osgi.framework.BundleActivator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.framework.BundleContext</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.osgi.framework.ServiceReference</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.bw.osgi.provider.able.HelloWorldService</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">HelloWorldActivator</span> <span class="kd">implements</span> <span class="n">BundleActivator</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">HelloWorldConsumer</span> <span class="n">consumer</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">start</span><span class="o">(</span><span class="n">BundleContext</span> <span class="n">bundleContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">ServiceReference</span> <span class="n">reference</span> <span class="o">=</span> <span class="n">bundleContext</span><span class="o">.</span><span class="na">getServiceReference</span><span class="o">(</span><span class="n">HelloWorldService</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>

        <span class="n">consumer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HelloWorldConsumer</span><span class="o">((</span><span class="n">HelloWorldService</span><span class="o">)</span> <span class="n">bundleContext</span><span class="o">.</span><span class="na">getService</span><span class="o">(</span><span class="n">reference</span><span class="o">));</span>
        <span class="n">consumer</span><span class="o">.</span><span class="na">startTimer</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">stop</span><span class="o">(</span><span class="n">BundleContext</span> <span class="n">bundleContext</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
        <span class="n">consumer</span><span class="o">.</span><span class="na">stopTimer</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<p>The injection is not necessary anymore. We can keep the start of the timer here, but once again, we can use the features of the framework to start and stop the timer. So let's delete the activator and create an application context to create the consumer and start it automatically and put in the  <em>META-INF/spring</em> folder : </p>
<pre class="code literal-block"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>

<span class="nt">&lt;beans</span> <span class="na">xmlns=</span><span class="s">&quot;http://www.springframework.org/schema/beans&quot;</span>
       <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
       <span class="na">xmlns:osgi=</span><span class="s">&quot;http://www.springframework.org/schema/osgi&quot;</span>
       <span class="na">xmlns:context=</span><span class="s">&quot;http://www.springframework.org/schema/context&quot;</span>
       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;</span>
<span class="s">            http://www.springframework.org/schema/beans</span>
<span class="s">            http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span>
<span class="s">            http://www.springframework.org/schema/osgi</span>
<span class="s">            http://www.springframework.org/schema/osgi/spring-osgi.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;bean</span> <span class="na">id=</span><span class="s">&quot;consumer&quot;</span> <span class="na">class=</span><span class="s">&quot;com.bw.osgi.consumer.HelloWorldConsumer&quot;</span> <span class="na">init-method=</span><span class="s">&quot;startTimer&quot;</span> <span class="na">destroy-method=</span><span class="s">&quot;stopTimer&quot;</span>
          <span class="na">lazy-init=</span><span class="s">&quot;false&quot;</span> <span class="nt">&gt;</span>
        <span class="nt">&lt;constructor-arg</span> <span class="na">ref=</span><span class="s">&quot;eventService&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/bean&gt;</span>

    <span class="nt">&lt;osgi:reference</span> <span class="na">id=</span><span class="s">&quot;eventService&quot;</span> <span class="na">interface=</span><span class="s">&quot;com.bw.osgi.provider.able.HelloWorldService&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/beans&gt;</span>
</pre>


<p>We used the init-method and destroy-method attributes to start and stop the time with the framework and we use the constructor-arg to inject to reference to the service. The reference to the service is obtained using osgi:reference field and using the interface as a key to the service. </p>
<p>That's all we have to do with this bundle. A lot more simple than the first version isn't it ? And more than the simplification, you can see that the sources aren't depending of either OSGi or Spring Framework, this is plain Java and this is a great advantage. </p>
<p>The Maven POMs are the same than in the first phase except that we can cut the dependency to osgi. </p>
<p>The provider : </p>
<pre class="code literal-block"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>

<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
         <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>OSGiDmHelloWorldProvider<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>OSGiDmHelloWorldProvider<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>bundle<span class="nt">&lt;/packaging&gt;</span>

    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>2.0.2<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;source&gt;</span>1.6<span class="nt">&lt;/source&gt;</span>
                    <span class="nt">&lt;target&gt;</span>1.6<span class="nt">&lt;/target&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>

            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.felix<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-bundle-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;extensions&gt;</span>true<span class="nt">&lt;/extensions&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;instructions&gt;</span>
                        <span class="nt">&lt;Bundle-SymbolicName&gt;</span>OSGiDmHelloWorldProvider<span class="nt">&lt;/Bundle-SymbolicName&gt;</span>
                        <span class="nt">&lt;Export-Package&gt;</span>com.bw.osgi.provider.able<span class="nt">&lt;/Export-Package&gt;</span>
                        <span class="nt">&lt;Bundle-Vendor&gt;</span>Baptiste Wicht<span class="nt">&lt;/Bundle-Vendor&gt;</span>
                    <span class="nt">&lt;/instructions&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span> 
<span class="nt">&lt;/project&gt;</span>
</pre>


<p>The consumer : </p>
<pre class="code literal-block"><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>

<span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span>
         <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
         <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>OSGiDmHelloWorldConsumer<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>OSGiDmHelloWorldConsumer<span class="nt">&lt;/artifactId&gt;</span>
    <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
    <span class="nt">&lt;packaging&gt;</span>bundle<span class="nt">&lt;/packaging&gt;</span>

    <span class="nt">&lt;dependencies&gt;</span>
        <span class="nt">&lt;dependency&gt;</span>
            <span class="nt">&lt;groupId&gt;</span>OSGiDmHelloWorldProvider<span class="nt">&lt;/groupId&gt;</span>
            <span class="nt">&lt;artifactId&gt;</span>OSGiDmHelloWorldProvider<span class="nt">&lt;/artifactId&gt;</span>
            <span class="nt">&lt;version&gt;</span>1.0<span class="nt">&lt;/version&gt;</span>
        <span class="nt">&lt;/dependency&gt;</span>
    <span class="nt">&lt;/dependencies&gt;</span>

    <span class="nt">&lt;build&gt;</span>
        <span class="nt">&lt;plugins&gt;</span>
            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;version&gt;</span>2.0.2<span class="nt">&lt;/version&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;source&gt;</span>1.6<span class="nt">&lt;/source&gt;</span>
                    <span class="nt">&lt;target&gt;</span>1.6<span class="nt">&lt;/target&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>

            <span class="nt">&lt;plugin&gt;</span>
                <span class="nt">&lt;groupId&gt;</span>org.apache.felix<span class="nt">&lt;/groupId&gt;</span>
                <span class="nt">&lt;artifactId&gt;</span>maven-bundle-plugin<span class="nt">&lt;/artifactId&gt;</span>
                <span class="nt">&lt;extensions&gt;</span>true<span class="nt">&lt;/extensions&gt;</span>
                <span class="nt">&lt;configuration&gt;</span>
                    <span class="nt">&lt;instructions&gt;</span>
                        <span class="nt">&lt;Bundle-SymbolicName&gt;</span>OSGiDmHelloWorldConsumer<span class="nt">&lt;/Bundle-SymbolicName&gt;</span>
                        <span class="nt">&lt;Bundle-Vendor&gt;</span>Baptiste Wicht<span class="nt">&lt;/Bundle-Vendor&gt;</span>
                    <span class="nt">&lt;/instructions&gt;</span>
                <span class="nt">&lt;/configuration&gt;</span>
            <span class="nt">&lt;/plugin&gt;</span>
        <span class="nt">&lt;/plugins&gt;</span>
    <span class="nt">&lt;/build&gt;</span>
<span class="nt">&lt;/project&gt;</span>
</pre>


<p>And we can build the two bundles using maven install. So let's test our stuff in Felix : </p>
<pre>wichtounet@Linux-Desktop:~/Desktop/osgi/felix$ java -jar bin/felix.jar 
_______________
Welcome to Apache Felix Gogo
g! install file:../com.springsource.slf4j.org.apache.commons.logging-1.5.0.jar
Bundle ID: 5
g! install file:../com.springsource.slf4j.log4j-1.5.0.jar
Bundle ID: 6
g! install file:../com.springsource.slf4j.api-1.5.0.jar
Bundle ID: 7
g! install file:../log4j.osgi-1.2.15-SNAPSHOT.jar
Bundle ID: 8
g! install file:../com.springsource.net.sf.cglib-2.1.3.jar
Bundle ID: 9
g! install file:../com.springsource.org.aopalliance-1.0.0.jar
Bundle ID: 10
g! install file:../org.springframework.core-2.5.6.SEC01.jar
Bundle ID: 11
g! install file:../org.springframework.context-2.5.6.SEC01.jar
Bundle ID: 12
g! install file:../org.springframework.beans-2.5.6.SEC01.jar
Bundle ID: 13
g! install file:../org.springframework.aop-2.5.6.SEC01.jar
Bundle ID: 14
g! install file:../spring-osgi-extender-1.2.1.jar
Bundle ID: 15
g! install file:../spring-osgi-core-1.2.1.jar
Bundle ID: 16
g! install file:../spring-osgi-io-1.2.1.jar
Bundle ID: 17
g! start 5 7 8 9 10 11 12 13 14 15 16 17
log4j:WARN No appenders could be found for logger (org.springframework.osgi.extender.internal.activator.ContextLoaderListener).
log4j:WARN Please initialize the log4j system properly.
g! install file:../OSGiDmHelloWorldProvider-1.0.jar
Bundle ID: 18
g! install file:../OSGiDmHelloWorldConsumer-1.0.jar
Bundle ID: 19
g! start 18
g! start 19
g! Hello World !
Hello World !
Hello World !
Hello World !
Hello World !
Hello World !
Hello World !
Hello World !
stop 19
g! </pre>

<p>As you can see, it works perfectly !</p>
<p>In conclusion, Spring Dm really makes easier the development with OSGi.  With Spring Dm you can also start bundles. It also allows you to make web bundles and to use easily the services of the OSGi compendium. </p>
<p>Here are the sources of the two projects : </p>
<ul>
<li><a href="/wp-content/uploads/2010/07/OSGiDmHelloWorldProvider.tar1.gz">OSGiDmHelloWorldProvider Sources</a></li>
<li><a href="/wp-content/uploads/2010/07/OSGiDmHelloWorldConsumer.tar1.gz">OSGiDmHelloWorldConsumer Sources</a></li>
</ul>

<p>Here are directly the two buildeds Jars : </p>
<ul>
<li><a href="/wp-content/uploads/2010/07/OSGiDmHelloWorldProvider-1.0.jar">OSGiDmHelloWorldProvider-1.0.jar</a></li>
<li><a href="/wp-content/uploads/2010/07/OSGiDmHelloWorldConsumer-1.0.jar">OSGiDmHelloWorldConsumer-1.0.jar</a></li>
</ul>

<p>And here are the complete folder including Felix and Spring Dm : <a href="/wp-content/uploads/2010/07/osgi-hello-world.tar.gz">osgi-hello-world.tar.gz</a></p>