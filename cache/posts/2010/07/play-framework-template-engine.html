<p>In the previous post about <strong>Play Framework</strong>, we seen <a title="Getting started with Play Framework" href="http://www.baptiste-wicht.com/2010/07/getting-started-play-framework/" target="_blank">how to install Play and create a first simple application</a>. In this post, we'll see how to customize the views and use the template engine of the framework to easily create web pages.</p>
<p>Play has its own template engine to generate HTML web pages. The template engine use Groovy as expression language. You will use Groovy language to create all the dynamic parts of the web pages. But there is no need to learn completely Grooxy, it's really close to Java and if you know already knows Java, there is no problem to use Groovy in your templates. All the templates are located in the app/views folder in your application. All the dynamic part of the web page is resolved during the execution of the template and the result is a part of the HTTP Response.</p>
<!-- TEASER_END -->

<p>So first of all, we'll create a little application for our needs :</p>
<pre>wichtounet@wichtounet-laptop:~/dev/play$ /usr/share/play/play new views

~        _            _ 
~  _ __ | | __ _ _  _| |
~ | '_ \| |/ _' | || |_|
~ |  __/|_|\____|\__ (_)
~ |_|            |__/   

~ play! 1.0.3, http://www.playframework.org
~ The new application will be created in /home/wichtounet/dev/play/views
~ What is the application name? Views
~ OK, the application is created.
~ Start it with : play run views
~ Have fun!
~</pre>

<p>So we start to inspect what has been created by Play. If you go in app/views, you will see this structure :</p>
<ul>
    <li>Application : This folder is to store the templates of the Application controller</li>
    <li>errors : This folder contains the templates for the HTTP Error pages (404, 500, ...)</li>
    <li>main.html : This is the main template</li>
</ul>

<p>If you open Application/index.html, you obtain this kind of code :</p>
<pre class="code literal-block">#{extends &#39;main.html&#39; /}
#{set title:&#39;Home&#39; /}
#{welcome /}
</pre>


<p>The first line indicate that we extend an other template (main.html). The next line use a Play tag (set), to set the title of the page. A set tag has a brother, the get tag who get the value setted by the set tag. The last line use the welcome tag who print the content of the welcome page. </p>
<p>Now, let's see the main.html template : </p>
<pre class="code literal-block"><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>#{get &#39;title&#39; /}<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">http-equiv=</span><span class="s">&quot;Content-Type&quot;</span> <span class="na">content=</span><span class="s">&quot;text/html; charset=utf-8&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;stylesheet&quot;</span> <span class="na">type=</span><span class="s">&quot;text/css&quot;</span> <span class="na">media=</span><span class="s">&quot;screen&quot;</span> <span class="na">href=</span><span class="s">&quot;@{&#39;/public/stylesheets/main.css&#39;}&quot;</span><span class="nt">&gt;</span>
        #{get &#39;moreStyles&#39; /}
        <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">&quot;shortcut icon&quot;</span> <span class="na">type=</span><span class="s">&quot;image/png&quot;</span> <span class="na">href=</span><span class="s">&quot;@{&#39;/public/images/favicon.png&#39;}&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">&quot;@{&#39;/public/javascripts/jquery-1.4.2.min.js&#39;}&quot;</span> <span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">charset=</span><span class="s">&quot;utf-8&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
        #{get &#39;moreScripts&#39; /}
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        #{doLayout /}
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre>


<p>There is some interesting things here : </p>
<ul>
<li>#{get 'title' /} : return the value of the variable title (not a Java variable, only a HTML variable)</li>
<li>@{'/public/stylesheets/main.css'} : resolve the resource to its URL</li>
<li>#{doLayout /} : Indicate where the sub templates (template who extends main.html) will be rendered</li>
</ul>

<h3>Pass variables to the view</h3>

<p>So let's go further. The first important thing is to know how to pass variables to the view from the controller. With Play Framework, this is really simple. just add the variables you need to the render() method of the controller. By example, to pass a String to the view : </p>
<pre class="code literal-block"><span class="kn">package</span> <span class="n">controllers</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">play.mvc.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Application</span> <span class="kd">extends</span> <span class="n">Controller</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">index</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">hello</span> <span class="o">=</span> <span class="s">&quot;Hello World from Controller !&quot;</span><span class="o">;</span>

        <span class="n">render</span><span class="o">(</span><span class="n">hello</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<p>The variable hello is now accessible from the view on the name "hello". To get it, you have to use ${variable_name} simply to display it : </p>
<pre class="code literal-block">#{extends &#39;main.html&#39; /}
#{set title:&#39;Home&#39; /}
Hello from the view
<span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
${hello}
</pre>


<p>Easy, no ? </p>
<p>Let's try adding a simple class to our model : </p>
<pre class="code literal-block"><span class="kn">package</span> <span class="n">models</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">title</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">Book</span><span class="o">(</span><span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">();</span>

        <span class="k">this</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="n">title</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getTitle</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">title</span><span class="o">;</span>
    <span class="o">}</span>
</pre>


<p>And pass it to the view : </p>
<pre class="code literal-block">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">index</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;Hello Play !&quot;</span><span class="o">);</span>

        <span class="n">render</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
    <span class="o">}</span>
</pre>


<p>And then get it from the view : </p>
<pre class="code literal-block">#{extends &#39;main.html&#39; /}
#{set title:&#39;Home&#39; /}
Hello from the view
<span class="nt">&lt;br</span> <span class="nt">/&gt;</span>
I&#39;ve a book for you &quot;${book.title}&quot;. 
</pre>


<p>The property is getted using the JavaBeans convention, so you have to create a getTitle() method to get the title of the book. </p>
<p>All the dynamic content is directly escaped by the template engine to avoid XSS security exploits. If you really want to not escape something, you have to use the raw() method available on all the strings. By example, for our title : </p>
<pre class="code literal-block">${book.title.raw()}
</pre>


<p>But this is not a really good practice, and must be used only when it's necessary. </p>
<p>You can add comments to your templates if you want : </p>
<pre class="code literal-block">*{Will not be evaluated by the template engine}*
</pre>


<h3>Iterate over a list</h3>

<p>An important thing to do in template and that comes really soon is the iterate over a collection. By example, we can pass a list of books to the view from the controller : </p>
<pre class="code literal-block">    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">index</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;(</span><span class="mi">3</span><span class="o">);</span>

        <span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;Hello Play !&quot;</span><span class="o">));</span>
        <span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;Hello Template !&quot;</span><span class="o">));</span>
        <span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;Hello Engine !&quot;</span><span class="o">));</span>

        <span class="n">render</span><span class="o">(</span><span class="n">books</span><span class="o">);</span>
    <span class="o">}</span>
</pre>


<p>And then, you can iterate over the list using the <em>list</em> tag : </p>
<pre class="code literal-block">#{extends &#39;main.html&#39; /}
#{set title:&#39;Home&#39; /}
I&#39;ve some books for your :
<span class="nt">&lt;ul&gt;</span>
    #{list items:books, as:&#39;book&#39;}
        <span class="nt">&lt;li&gt;</span>${book.title}<span class="nt">&lt;/li&gt;</span>
    #{/list}
<span class="nt">&lt;/ul&gt;</span>
</pre>


<p>And that will display a single little list in our web page. Not to complicated :)</p>
<h3>Using scripts</h3>

<p>If you have to make complicated things, you can using scripts in Groovy. In scripts, you can declare variables and use all the other variables. By example, you can make the title upper case in a script : </p>
<pre class="code literal-block">#{extends &#39;main.html&#39; /}
#{set title:&#39;Home&#39; /}
I&#39;ve some books for your :
<span class="nt">&lt;ul&gt;</span>
    #{list items:books, as:&#39;book&#39;}
        %{
           bookTitle = book.title.toUpperCase();
        }%
        <span class="nt">&lt;li&gt;</span>${bookTitle}<span class="nt">&lt;/li&gt;</span>
    #{/list}
<span class="nt">&lt;/ul&gt;</span>
</pre>


<p>But you can also do iterations, conditions and a lot of other things. But keep in mind that the templates are not the good place to make complicated things, for that you have the controller and the models. The template must be as simple as possible. </p>
<h3>Define tags</h3>

<p>There is lot of tags in Play Framework, but you can create your own tags. For that, you just have to create a folder tags in your views folder. By example, if you create booklist.html in views/tags and add the following code : </p>
<pre class="code literal-block"><span class="nt">&lt;ul&gt;</span>
    #{list items:_items, as:&#39;book&#39;}
        %{
            bookTitle = book.title.toUpperCase();
        }%
        <span class="nt">&lt;li&gt;</span>${bookTitle}<span class="nt">&lt;/li&gt;</span>
    #{/list}
<span class="nt">&lt;/ul&gt;</span>
</pre>


<p>The arguments are obtained using '_' following by the name of the arguments (_items in our example). </p>
<p>You can refactor the template index.html using the new tag : </p>
<pre class="code literal-block">#{extends &#39;main.html&#39; /}
#{set title:&#39;Home&#39; /}
I&#39;ve some books for your :
#{booklist items:books /}
</pre>


<p>You give arguments like in any other tag. This can help you to make cleaner templates and to avoid to copy/paste some codes. </p>
<p>So we've now covered the basis of the template engine of Play Framework. With all that we've seen, we can start to create simple Play Applications. </p>
<p>A really good resources for Play Developer is the <a target="_blank" href="http://download.playframework.org/miscellaneous/play-cheat-sheet.pdf">Play Cheat Sheet</a>. You can also consult the <a target="_blank" href="http://www.playframework.org/documentation/1.0.3/home">official documentation</a> for more complete informations.</p>