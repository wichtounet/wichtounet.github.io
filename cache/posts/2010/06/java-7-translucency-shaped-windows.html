<p>Java 7 introduces very interesting features for desktop windows :</p>
<ul>
    <li><strong>Transclucency for windows</strong> : Make a full window translucent with a specified alpha level</li>
    <li><strong>Per pixel translucency</strong> : Make a part of the window translucent.</li>
    <li><strong>Shaped windows</strong> : You can now create windows with a certain shape, like circle, ovale, triangle, ...</li>
</ul>

<p>We'll see all this features in that post. All the examples are tested in Windows Seven 64 bits, because the transclucency isn't supported in Ubuntu 10.04 at the time I write the article.</p>
<!-- TEASER_END -->

<p>First of all, you can now set the opacity of the window with the setOpacity(float opacity) of the Window class. With that, the entire window is made translucent. There is some limitations with that new method. An opacity less than 1.0 isn't supported if the window use full-screen mode or if the simple translucency isn't supported. You can test if the window transclucency is supported with the isWindowTranslucencySupported() method added to the GraphicsDevice class :</p>
<pre class="code literal-block"><span class="n">GraphicsEnvironment</span> <span class="n">ge</span> <span class="o">=</span> <span class="n">GraphicsEnvironment</span><span class="o">.</span><span class="na">getLocalGraphicsEnvironment</span><span class="o">();</span>
<span class="k">if</span> <span class="o">(</span><span class="n">ge</span><span class="o">.</span><span class="na">getDefaultScreenDevice</span><span class="o">().</span><span class="na">isWindowTranslucencySupported</span><span class="o">(</span><span class="n">GraphicsDevice</span><span class="o">.</span><span class="na">WindowTranslucency</span><span class="o">.</span><span class="na">TRANSLUCENT</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Window translucency isn&#39;t supported on your system. &quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre>


<p>We know enough to write a first translucent window :</p>
<pre class="code literal-block"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">wicht</span><span class="o">.</span><span class="na">java7</span><span class="o">.</span><span class="na">swing</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.swing.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.swing.event.ChangeEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.swing.event.ChangeListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.*</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TranslucentWindow</span> <span class="kd">extends</span> <span class="n">JFrame</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">TranslucentWindow</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="s">&quot;Simple Translucency Demo&quot;</span><span class="o">);</span>

        <span class="n">setSize</span><span class="o">(</span><span class="mi">300</span><span class="o">,</span> <span class="mi">200</span><span class="o">);</span>

        <span class="n">setDefaultCloseOperation</span><span class="o">(</span><span class="n">EXIT_ON_CLOSE</span><span class="o">);</span>

        <span class="n">getRootPane</span><span class="o">().</span><span class="na">setDoubleBuffered</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
        <span class="n">setOpacity</span><span class="o">(</span><span class="mf">0.5f</span><span class="o">);</span>

        <span class="n">setLocationRelativeTo</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="n">setVisible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SwingUtilities</span><span class="o">.</span><span class="na">invokeLater</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">(){</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">GraphicsEnvironment</span> <span class="n">ge</span> <span class="o">=</span> <span class="n">GraphicsEnvironment</span><span class="o">.</span><span class="na">getLocalGraphicsEnvironment</span><span class="o">();</span>

                <span class="k">if</span> <span class="o">(</span><span class="n">ge</span><span class="o">.</span><span class="na">getDefaultScreenDevice</span><span class="o">().</span><span class="na">isWindowTranslucencySupported</span><span class="o">(</span><span class="n">GraphicsDevice</span><span class="o">.</span><span class="na">WindowTranslucency</span><span class="o">.</span><span class="na">TRANSLUCENT</span><span class="o">))</span> <span class="o">{</span>
                    <span class="k">new</span> <span class="nf">TranslucentWindow</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<p>Note : We disable double buffering to remove artifacts that come when double buffer a translucent window.</p>
<p>That produce this result on my computer :</p>
<p><a href="/wp-content/uploads/2010/05/TranslucentWindow.png"><img class="size-full wp-image-610" title="Java 7 Translucent Window" src="/wp-content/uploads/2010/05/TranslucentWindow.png" alt="Java 7 Translucent Window" width="300" height="200"></a></p>
<p>So, it's really simple to make a window translucent. But there is more you can do. You can also make only a set of pixel translucent using their background color. Like the translucent window, there is some limitations, the window must not be in full-screen and the system must support the per pixel translucency. You can test it the same way as the first time :</p>
<pre class="code literal-block"><span class="n">GraphicsEnvironment</span> <span class="n">ge</span> <span class="o">=</span> <span class="n">GraphicsEnvironment</span><span class="o">.</span><span class="na">getLocalGraphicsEnvironment</span><span class="o">();</span>

<span class="k">if</span> <span class="o">(</span><span class="n">ge</span><span class="o">.</span><span class="na">getDefaultScreenDevice</span><span class="o">().</span><span class="na">isWindowTranslucencySupported</span><span class="o">(</span><span class="n">GraphicsDevice</span><span class="o">.</span><span class="na">WindowTranslucency</span><span class="o">.</span><span class="na">PERPIXEL_TRANSLUCENT</span><span class="o">))</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Window translucency isn&#39;t supported on your system. &quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre>


<p>A simple making a grid of 16 panels more and more translucent :</p>
<pre class="code literal-block"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">wicht</span><span class="o">.</span><span class="na">java7</span><span class="o">.</span><span class="na">swing</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.swing.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.event.ActionEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.event.ActionListener</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">GriddedTranslucentWindow</span> <span class="kd">extends</span> <span class="n">JFrame</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">GriddedTranslucentWindow</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="s">&quot;Java 7 Per Pixel Translucency&quot;</span><span class="o">);</span>

        <span class="n">setSize</span><span class="o">(</span><span class="mi">300</span><span class="o">,</span> <span class="mi">320</span><span class="o">);</span>

        <span class="n">getContentPane</span><span class="o">().</span><span class="na">setLayout</span><span class="o">(</span><span class="k">new</span> <span class="n">GridLayout</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">));</span>

        <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">amp</span><span class="o">;</span><span class="n">lt</span><span class="o">;</span> <span class="mi">16</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
            <span class="n">add</span><span class="o">(</span><span class="k">new</span> <span class="n">AlphaPanel</span><span class="o">(</span><span class="mi">255</span> <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">12</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="n">setBackground</span><span class="o">(</span><span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">));</span>

        <span class="n">setLocationRelativeTo</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="n">setVisible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SwingUtilities</span><span class="o">.</span><span class="na">invokeLater</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">(){</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">GraphicsEnvironment</span> <span class="n">ge</span> <span class="o">=</span> <span class="n">GraphicsEnvironment</span><span class="o">.</span><span class="na">getLocalGraphicsEnvironment</span><span class="o">();</span>

                <span class="k">if</span> <span class="o">(</span><span class="n">ge</span><span class="o">.</span><span class="na">getDefaultScreenDevice</span><span class="o">().</span><span class="na">isWindowTranslucencySupported</span><span class="o">(</span><span class="n">GraphicsDevice</span><span class="o">.</span><span class="na">WindowTranslucency</span><span class="o">.</span><span class="na">PERPIXEL_TRANSLUCENT</span><span class="o">))</span> <span class="o">{</span>
                    <span class="k">new</span> <span class="nf">GriddedTranslucentWindow</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">class</span> <span class="nc">AlphaPanel</span> <span class="kd">extends</span> <span class="n">JPanel</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="nf">AlphaPanel</span><span class="o">(</span><span class="kt">int</span> <span class="n">alpha</span><span class="o">)</span> <span class="o">{</span>
            <span class="kd">super</span><span class="o">();</span>

            <span class="n">setBackground</span><span class="o">(</span><span class="k">new</span> <span class="n">Color</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">255</span><span class="o">,</span> <span class="n">alpha</span><span class="o">));</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<p>That give me this kind of result :</p>
<p><a href="/wp-content/uploads/2010/05/PerPixelTranslucency1.png"><img class="size-full wp-image-612" title="Java 7 : Per Pixel Translucency" src="/wp-content/uploads/2010/05/PerPixelTranslucency1.png" alt="Java 7 : Per Pixel Translucency" width="284" height="279"></a></p>
<p>The example is very simple of course, but you can imagine doing a lot of things using that feature.</p>
<p>And now a crazy new feature : shaped windows !</p>
<p>Java 7 allows you to create Window of whatever shape you want. You can create circle, triangle, elliptic windows or more complex shape, a smiley by example. To do that, you have now access to the setShape(Shape shape)  method in the Window class. Like the other two, full screen mode is not allowed and the per pixel transparency must be supported by your computer :</p>
<pre class="code literal-block"><span class="n">GraphicsEnvironment</span> <span class="n">ge</span> <span class="o">=</span> <span class="n">GraphicsEnvironment</span><span class="o">.</span><span class="na">getLocalGraphicsEnvironment</span><span class="o">();</span>

<span class="k">if</span> <span class="o">(</span><span class="n">ge</span><span class="o">.</span><span class="na">getDefaultScreenDevice</span><span class="o">().</span><span class="na">isWindowTranslucencySupported</span><span class="o">(</span><span class="n">GraphicsDevice</span><span class="o">.</span><span class="na">WindowTranslucency</span><span class="o">.</span><span class="na">PERPIXEL_TRANSPARENT</span> <span class="o">))</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Window translucency isn&#39;t supported on your system. &quot;</span><span class="o">)</span>
<span class="o">}</span>
</pre>


<p>Here is a little example combining a triangle and a circle :</p>
<pre class="code literal-block"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">wicht</span><span class="o">.</span><span class="na">java7</span><span class="o">.</span><span class="na">swing</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.swing.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.geom.Ellipse2D</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.awt.geom.GeneralPath</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ShapedWindow</span> <span class="kd">extends</span> <span class="n">JFrame</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nf">ShapedWindow</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="s">&quot;Shaped Window&quot;</span><span class="o">);</span>

        <span class="n">setUndecorated</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

        <span class="n">setSize</span><span class="o">(</span><span class="k">new</span> <span class="n">Dimension</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span> <span class="mi">300</span><span class="o">));</span>

        <span class="n">Polygon</span> <span class="n">polygon</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Polygon</span><span class="o">();</span>
        <span class="n">polygon</span><span class="o">.</span><span class="na">addPoint</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">200</span><span class="o">);</span>
        <span class="n">polygon</span><span class="o">.</span><span class="na">addPoint</span><span class="o">(</span><span class="mi">100</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
        <span class="n">polygon</span><span class="o">.</span><span class="na">addPoint</span><span class="o">(</span><span class="mi">200</span><span class="o">,</span> <span class="mi">200</span><span class="o">);</span>

        <span class="n">Ellipse2D</span><span class="o">.</span><span class="na">Double</span> <span class="n">theCircle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Ellipse2D</span><span class="o">.</span><span class="na">Double</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">*</span><span class="mi">200</span><span class="o">,</span> <span class="mf">1.0</span><span class="o">*</span><span class="mi">200</span><span class="o">);</span>

        <span class="n">GeneralPath</span> <span class="n">path</span> <span class="o">=</span> <span class="k">new</span> <span class="n">GeneralPath</span><span class="o">();</span>
        <span class="n">path</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">polygon</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
        <span class="n">path</span><span class="o">.</span><span class="na">append</span><span class="o">(</span><span class="n">theCircle</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>

        <span class="n">setShape</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>

        <span class="n">getContentPane</span><span class="o">().</span><span class="na">setLayout</span><span class="o">(</span><span class="k">new</span> <span class="n">BoxLayout</span><span class="o">(</span><span class="n">getContentPane</span><span class="o">(),</span> <span class="n">BoxLayout</span><span class="o">.</span><span class="na">X_AXIS</span><span class="o">));</span>

        <span class="n">add</span><span class="o">(</span><span class="n">Box</span><span class="o">.</span><span class="na">createHorizontalGlue</span><span class="o">());</span>
        <span class="n">JLabel</span> <span class="n">label</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JLabel</span><span class="o">(</span><span class="s">&quot;Shaped window&quot;</span><span class="o">);</span>
        <span class="n">label</span><span class="o">.</span><span class="na">setForeground</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">white</span><span class="o">);</span>
        <span class="n">add</span><span class="o">(</span><span class="n">label</span><span class="o">);</span>
        <span class="n">add</span><span class="o">(</span><span class="n">Box</span><span class="o">.</span><span class="na">createHorizontalGlue</span><span class="o">());</span>

        <span class="n">getContentPane</span><span class="o">().</span><span class="na">setBackground</span><span class="o">(</span><span class="n">Color</span><span class="o">.</span><span class="na">blue</span><span class="o">);</span>

        <span class="n">setLocationRelativeTo</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
        <span class="n">setVisible</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">SwingUtilities</span><span class="o">.</span><span class="na">invokeLater</span><span class="o">(</span><span class="k">new</span> <span class="n">Runnable</span><span class="o">(){</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                <span class="n">GraphicsEnvironment</span> <span class="n">ge</span> <span class="o">=</span> <span class="n">GraphicsEnvironment</span><span class="o">.</span><span class="na">getLocalGraphicsEnvironment</span><span class="o">();</span>

                <span class="k">if</span> <span class="o">(</span><span class="n">ge</span><span class="o">.</span><span class="na">getDefaultScreenDevice</span><span class="o">().</span><span class="na">isWindowTranslucencySupported</span><span class="o">(</span><span class="n">GraphicsDevice</span><span class="o">.</span><span class="na">WindowTranslucency</span><span class="o">.</span><span class="na">PERPIXEL_TRANSPARENT</span><span class="o">))</span> <span class="o">{</span>
                    <span class="k">new</span> <span class="nf">TranslucentShapedWindow</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}</span>
        <span class="o">});</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>


<p>This produce that sort of window :</p>
<p><a href="/wp-content/uploads/2010/06/ShapedWindow.png"><img class="size-full wp-image-615" title="Java 7 : Shaped Windows" src="/wp-content/uploads/2010/06/ShapedWindow.png" alt="Java 7 : Shaped Windows" width="231" height="322"></a></p>
<p>And of course you can combine translucency and shaped windows adding setOpacity(0.5f) to your frame. For that the Per Pixel Translucency and the Per Pixel Transparency must be supported. That give us this kind of window :</p>
<p><a href="/wp-content/uploads/2010/06/TranslucentShapedWindow.png"><img class="size-full wp-image-616" title="Java 7 : Translucent Shaped Window" src="/wp-content/uploads/2010/06/TranslucentShapedWindow.png" alt="Java 7 : Translucent Shaped Window" width="200" height="300"></a></p>
<p>Here we are. We've now covered the new translucency features of Java 7. I think it's really interesting and make Java Desktop Applications more competitive. But I think there is still work to do in Swing before doing that kind of fun stuff.</body></html></p>