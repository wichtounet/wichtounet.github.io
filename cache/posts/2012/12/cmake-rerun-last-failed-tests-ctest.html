<p>Some time ago, we saw <a href="http://www.baptiste-wicht.com/2012/10/run-boost-test-parallel-cmake/" title="Run your Boost Tests in parallel with CMake">how to use CMake to run Boost Tests in paralel</a>, now it is time for another tip. </p>
<p>A feature that I think is lacking in CMake/CTest is a way to launch only the last failed tests. As it is not possible to do that directly, I posted <a href="http://stackoverflow.com/q/13547175/802362" title="How to rerun the failed tests with ctest?">the question on StackOverflow</a> and got a great answer from <a href="http://stackoverflow.com/users/424459/fraser" title="Fraser">Fraser</a>. I wanted to share its answer. </p>
<p>CTest has -I option to select a list of tests to run. The idea here is to convert the log of CTest in format readable by CTest. What I think is great in its answer is that the solution is a CMake script: </p>
<pre class="code literal-block"><span class="nb">set</span><span class="p">(</span><span class="s">FailedFileName</span> <span class="s">FailedTests.log</span><span class="p">)</span>
<span class="nb">if</span><span class="p">(</span><span class="s">EXISTS</span> <span class="s2">&quot;Testing/Temporary/LastTestsFailed.log&quot;</span><span class="p">)</span>
  <span class="nb">file</span><span class="p">(</span><span class="s">STRINGS</span> <span class="s2">&quot;Testing/Temporary/LastTestsFailed.log&quot;</span> <span class="s">FailedTests</span><span class="p">)</span>
  <span class="nb">string</span><span class="p">(</span><span class="s">REGEX</span> <span class="s">REPLACE</span> <span class="s2">&quot;([0-9]+):[^;]*&quot;</span> <span class="s2">&quot;\\1&quot;</span> <span class="s">FailedTests</span> <span class="s2">&quot;${FailedTests}&quot;</span><span class="p">)</span>
  <span class="nb">list</span><span class="p">(</span><span class="s">SORT</span> <span class="s">FailedTests</span><span class="p">)</span>
  <span class="nb">list</span><span class="p">(</span><span class="s">GET</span> <span class="s">FailedTests</span> <span class="s">0</span> <span class="s">FirstTest</span><span class="p">)</span>
  <span class="nb">set</span><span class="p">(</span><span class="s">FailedTests</span> <span class="s2">&quot;${FirstTest};${FirstTest};;${FailedTests};&quot;</span><span class="p">)</span>
  <span class="nb">string</span><span class="p">(</span><span class="s">REPLACE</span> <span class="s2">&quot;;&quot;</span> <span class="s2">&quot;,&quot;</span> <span class="s">FailedTests</span> <span class="s2">&quot;${FailedTests}&quot;</span><span class="p">)</span>
  <span class="nb">file</span><span class="p">(</span><span class="s">WRITE</span> <span class="o">${</span><span class="nv">FailedFileName</span><span class="o">}</span> <span class="o">${</span><span class="nv">FailedTests</span><span class="o">}</span><span class="p">)</span>
<span class="nb">else</span><span class="p">()</span>
  <span class="nb">file</span><span class="p">(</span><span class="s">WRITE</span> <span class="o">${</span><span class="nv">FailedFileName</span><span class="o">}</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="nb">endif</span><span class="p">()</span>
</pre>


<p>This test just transforms one file into another. </p>
<p>You can then run the last failing tests using: </p>
<pre>cmake -P <the script>
ctest -I FailedTests.log</pre>

<p>Very easy, isn't it ? </p>
<p>There is a limitation to this solution. It won't work when CTest is running in dashboard mode, but it wouldn't take too long to adapt it for that. </p>
<p>Hope you found that tip useful.</p>