<!DOCTYPE html><html lang="en">
<head>
    <link href="favicon.ico" rel="icon" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Website about vtechnologies Java, Spring, OSGi, Hardware,...">
    <meta name="author" content="Baptiste Wicht">
    <title>@Blog("Baptiste Wicht") (old posts, page 16) | @Blog("Baptiste Wicht")</title>
    
            <link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
      <link rel="canonical" href="http://wichtounet.github.io/index-16.html">
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
            <link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">

    
    
    <link rel="stylesheet" type="text/css" href="assets/css/tipuesearch.css">
    
</head>
<body>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container-fluid"><!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://wichtounet.github.io/">@Blog("Baptiste Wicht")</a>
        </div><!-- /.navbar-header -->
        <div class="collapse navbar-collapse navbar-ex1-collapse">
            <ul class="nav navbar-nav">
                
                <li><a href="stories/about.html">About</a>
                </li><li><a href="stories/publications.html">Publications</a>
                </li><li><a href="stories/donate.html">Donate</a>
                </li><li><a href="stories/contact.html">Contact</a>
                </li><li><a href="stories/faq.html">FAQ</a>
                </li><li><a href="stories/legal.html">Legal</a>
                </li><li><a href="archive.html">Archives</a>
                </li><li><a href="categories/index.html">Tags</a>
                </li><li><a href="rss.xml">RSS</a>

            </li></ul>

            <span class="navbar-form pull-left">
                <form action="stories/search.html">
                    <div style="float: left;"><input type="text" name="q" id="tipue_search_input"></div>
                    <div style="float: left; margin-left: 13px;"><input type="button" id="tipue_search_button" onclick="this.form.submit();"></div>
                </form>
            </span>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>

<!-- End of Menubar -->

<div class="body-container">

    <!-- Sidebar -->

    <div class="left-sidebar">
            <div class="left-sidebar-widget">
                <h3>Welcome to my blog</h3>
                <div class="left-sidebar-widget-content">
                    <!-- <p>
                        I'm writing about C++, Linux, Gentoo, Home Servers, etc...
                    </p> -->
                    <div class="g-person" data-width="275" data-href="//plus.google.com/u/0/103113673902796202116" data-theme="dark" data-layout="landscape" data-rel="author"></div>
                </div>
            </div>

            <div class="left-sidebar-widget">
                <h3>Tags</h3>
                <div class="left-sidebar-widget-content">
                    <div id="tags_container">
                        <canvas width="275" height="250" id="tags_canvas">
                            <p>Anything in here will be replaced on browsers that support the canvas element</p>
                        </canvas>
                    </div>
                </div>
            </div>

        
        <div class="left-sidebar-widget">
            <h3>Recent comments</h3>
            <div class="left-sidebar-widget-content">
                <div id="recentcomments" class="dsq-widget">
                    <script type="text/javascript" src="http://blogwichtounet.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=0&amp;avatar_size=28&amp;excerpt_length=50"></script> 
                </div>
            </div>
        </div>

        <div class="left-sidebar-widget">
            <h3>Popular posts</h3>
            <div class="left-sidebar-widget-content">
                <div id="popularthreads" class="dsq-widget">
                    <script type="text/javascript" src="http://blogwichtounet.disqus.com/popular_threads_widget.js?num_items=5&amp;days_back=90"></script>
                </div>
            </div>
        </div>
        
        <div class="left-sidebar-widget">
            <h3>Blogroll</h3>
            <div class="left-sidebar-widget-content">
                <ul>
                    <li><a target="_blank" href="http://www.asjava.com/">AsJava.com : Java Tutorial</a></li>
                    <li><a target="_blank" href="http://www.mkyong.com/">Mkyong : Java Tutorials</a></li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Content -->

    <div class="container">
            <div class="body-content">

            <div class="row">
                
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2011/11/dynamic-memory-allocation-intel-assembly-linux.html" class="u-url">Dynamic memory allocation in Intel Assembly on Linux</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2011-11-29T09:16:26+00:00">2011-11-29 09:16</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>For the version 0.6.0 of the EDDI Compiler, I have written a simple dynamic memory allocation function in assembly. I did that to avoid using malloc in my assembly code. As this is not an easy subject, this article will explain the main parts of writing this function.</p>
<p>As the EDDI Compiler creates program for Linux platform, this article will focus on writing a little memory allocator for Linux in Intel Assembly.</p>
<p>In this article I will follow the <em>AT&amp;T notation</em>.</p>
<h4>Specifications</h4>

<p>The function works like malloc but is simpler. The specifications are the following ones:</p>
<ul>
    <li>We call the function with one argument: the dynamic memory size we need</li>
    <li>The function returns the start address of the allocated memory in the <strong>%eax</strong> register</li>
    <li>There is no need to deallocate the allocated memory</li>
    <li>The size that we ask will generally small and always less than 16384 octets</li>
    <li>Having some gaps in the memory is not a problem for now</li>
</ul>

<p>So as you can see there are several limitations to this memory allocator. These limitations are the one I had for EDDI, so I'll follow them in this article.</p>
<h4>Dynamic memory allocation</h4>

<p>In Linux, there are two ways for performing dynamic memory allocation:</p>
<ul>
    <li><strong>brk</strong>: Increment the size of the data segment after the end of the program. This memory is directly after the program and is always contiguous. It's the easiest way for allocating memory. This technique is not perfect for large blocks of data.</li>
    <li><strong>mmap</strong>: Creates a new memory mapping in the virtual address space. The kernel gives you memory in virtually every place of the memory.</li>
</ul>

<p>In our case, as we need only small blocks, we will use <strong>brk</strong> to dynamically allocate memory.</p>
<p>We can call these procedures using system calls. In assembly, you can use system calls with interruptions (0x80).</p>
<h4>Implementation</h4>

<p>We need two variables for this function. One to keep track of the remaining size and another one to keep track of the current address of the allocated memory.</p>
<div class="code"><pre><span class="na">.data</span>
<span class="na">.size</span> <span class="no">VIeddi_remaining</span><span class="p">,</span> <span class="mi">4</span>

<span class="nl">VIeddi_remaining:</span>
<span class="na">.long</span> <span class="mi">0</span>
<span class="na">.size</span> <span class="no">VIeddi_current</span><span class="p">,</span> <span class="mi">4</span>

<span class="nl">VIeddi_current:</span>
<span class="na">.long</span> <span class="mi">0</span>
</pre></div>


<p>Both variables are initialized to 0.</p>
<p>And here is the function I've developed :</p>
<div class="code"><pre><span class="nl">eddi_alloc:</span>
<span class="nf">pushl</span> <span class="nv">%ebp</span>
<span class="nf">movl</span> <span class="nv">%esp</span><span class="p">,</span> <span class="nv">%ebp</span>
<span class="nf">movl</span> <span class="mi">8</span><span class="p">(</span><span class="nv">%ebp</span><span class="p">),</span> <span class="nv">%ecx</span>
<span class="nf">movl</span> <span class="no">VIeddi_remaining</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">cmpl</span> <span class="nv">%ebx</span><span class="p">,</span> <span class="nv">%ecx</span>
<span class="nf">jle</span> <span class="no">alloc_normal</span>
<span class="nf">movl</span> <span class="no">$45</span><span class="p">,</span> <span class="nv">%eax</span>
<span class="nf">xorl</span> <span class="nv">%ebx</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">int</span>  <span class="no">$0x80</span>
<span class="nf">movl</span> <span class="nv">%eax</span><span class="p">,</span> <span class="nv">%esi</span>
<span class="nf">movl</span> <span class="nv">%eax</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">addl</span> <span class="no">$16384</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">movl</span> <span class="no">$45</span><span class="p">,</span> <span class="nv">%eax</span>
<span class="nf">int</span>  <span class="no">$0x80</span>
<span class="nf">movl</span> <span class="nv">%esi</span><span class="p">,</span> <span class="nv">%eax</span>
<span class="nf">movl</span> <span class="no">$16384</span><span class="p">,</span> <span class="no">VIeddi_remaining</span>
<span class="nf">movl</span> <span class="nv">%esi</span><span class="p">,</span> <span class="no">VIeddi_current</span>

<span class="nl">alloc_normal:</span>
<span class="nf">movl</span> <span class="no">VIeddi_current</span><span class="p">,</span> <span class="nv">%eax</span>
<span class="nf">movl</span> <span class="no">VIeddi_current</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">addl</span> <span class="nv">%ecx</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">movl</span> <span class="nv">%ebx</span><span class="p">,</span> <span class="no">VIeddi_current</span>
<span class="nf">movl</span> <span class="no">VIeddi_remaining</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">subl</span> <span class="nv">%ecx</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">movl</span> <span class="nv">%ebx</span><span class="p">,</span> <span class="no">VIeddi_remaining</span>
<span class="nf">leave</span>
<span class="nf">ret</span>
</pre></div>


<p>I will describe now each part of the alloc function.</p>
<div class="code"><pre><span class="nf">movl</span> <span class="mi">8</span><span class="p">(</span><span class="nv">%ebp</span><span class="p">),</span> <span class="nv">%ecx</span>
<span class="nf">movl</span> <span class="no">VIeddi_remaining</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">cmpl</span> <span class="nv">%ebx</span><span class="p">,</span> <span class="nv">%ecx</span>
<span class="nf">jle</span> <span class="no">alloc_normal</span>
</pre></div>


<p>In this part we test if there is enough remaining size for the dynamic memory allocation request. It's equivalent to <em>if(remaining &gt;= size)</em>. If there is enough size, we jump to the normal allocation part :</p>
<div class="code"><pre><span class="nl">alloc_normal:</span>
<span class="nf">movl</span> <span class="no">VIeddi_current</span><span class="p">,</span> <span class="nv">%eax</span>
<span class="nf">movl</span> <span class="no">VIeddi_current</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">addl</span> <span class="nv">%ecx</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">movl</span> <span class="nv">%ebx</span><span class="p">,</span> <span class="no">VIeddi_current</span>
<span class="nf">movl</span> <span class="no">VIeddi_remaining</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">subl</span> <span class="nv">%ecx</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">movl</span> <span class="nv">%ebx</span><span class="p">,</span> <span class="no">VIeddi_remaining</span>
</pre></div>


<p>First, we move the current address of memory into the <strong>%eax</strong> register for the return value. Then we add the size of the new allocated block to the current address. Finally we remove the size of the new allocated block from the remaining size. After that, we can leave the function.</p>
<p>The most interesting part is what we do when we have to allocate more memory :</p>
<div class="code"><pre><span class="nf">movl</span> <span class="no">$45</span><span class="p">,</span> <span class="nv">%eax</span>
<span class="nf">xorl</span> <span class="nv">%ebx</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">int</span>  <span class="no">$0x80</span>
<span class="nf">movl</span> <span class="nv">%eax</span><span class="p">,</span> <span class="nv">%esi</span>
<span class="nf">movl</span> <span class="nv">%eax</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">addl</span> <span class="no">$16384</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">movl</span> <span class="no">$45</span><span class="p">,</span> <span class="nv">%eax</span>
<span class="nf">int</span>  <span class="no">$0x80</span>
<span class="nf">movl</span> <span class="no">$16384</span><span class="p">,</span> <span class="no">VIeddi_remaining</span>
<span class="nf">movl</span> <span class="nv">%esi</span><span class="p">,</span> <span class="no">VIeddi_current</span>
</pre></div>


<p>We start by doing an interruption to execute a system call. The <strong>45</strong> in the <strong>%eax</strong> register indicates a <strong>sys_brk</strong> call. The 0 in the <strong>%ebx</strong> register, indicates that we want the current position of brk space. We save this current position into the <strong>%esi</strong> register. Then we add 16384 bits (4K octets) to this address. We call again the <strong>sys_brk</strong> routine to set the address of the brk space to the calculated address. This is the way to dynamically allocates 4K of memory. Finally, we add 4K to the remaining size in octets and we put the current address (before the add) as the current address.</p>
<h4>Possible improvements</h4>

<p>We should make some optimization if this function has to be invoked frequently. The first interruption (call to sys_brk) has only to be done once. The very first time we need to get the start address. Then, we can use the current address as the base address when we do the new allocation.</p>
<p>Another improvement is to avoid having gaps between the used blocks. For that, we can avoid setting the current address directly to the newly allocated address but just add 4K to the remaining size. The blocks will overlap 2 allocated blocks.</p>
<p>We could also check that the value returned by the <strong>sys_brk</strong> is valid. On error, the procedure can return -1.</p>
<h4>Conclusion</h4>

<p>In this post, we developed a basic dynamic memory allocation function in Intel assembly on the Linux platform. I hope that this information can helps some of you.</p>
<p>Don't hesitate if you have a question or a comment on my implementation.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2011/11/dynamic-memory-allocation-intel-assembly-linux.html#disqus_thread" data-disqus-identifier="cache/posts/2011/11/dynamic-memory-allocation-intel-assembly-linux.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2011/11/eddi-compiler-0-6-1.html" class="u-url">EDDI Compiler 0.6.1 : Function return types</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2011-11-28T08:45:54+00:00">2011-11-28 08:45</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>I just released a new version of the EDDI Compiler : eddic 0.6.1</p>
<p>This is a minor update with only one change on the language: the functions can now return something. The return values are returned in registers (<strong>%eax</strong> for int and <strong>%eax:%ebx</strong> for strings). At this time, it is not possible to return an array from a function.</p>
<p>The other changes of this version are on the code base side. All the headers have been cleaned. There are less useless imports and the code is cleaner. Moreover, I also have rewritten the Readme in order to include more useful information in it. The parsing phase should be a little faster now and the assembly has been improved by using the POP instruction. The phases of checking have also been reordered. In the future, it's possible that several phases will be merged together for performance purposes, but for now, it's quite fast on my sample even the 2MB stress file.</p>
<p>You can now generate the Doxygen generation using make doc. The target is generated with CMake. At this time, the documentation is almost empty, but I will work on it on the next releases.</p>
<p>The next version will be a major release. I don't know what will be the changes for the language itself, but the compiler will use a new intermediate representation. It will use Three-Address-Code representation. This representation is simple and can be easily optimized. This will make easier the transformation from the AST to the assembly. At this time, the code of the intermediate compiler is very hard to maintain and contains a lot of logic. The switch to a new, simpler, intermediate representation will simplify the intermediate compiler.</p>
<p>You can find the EDDI compiler sources on the Github repository : <a title="EDDI Compiler Repository" href="http://github.com/wichtounet/eddic">https://github.com/wichtounet/eddic</a>.</p>
<p>The exact version I refer to is the v0.6.1 available in the github tags or directly as the release branch.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2011/11/eddi-compiler-0-6-1.html#disqus_thread" data-disqus-identifier="cache/posts/2011/11/eddi-compiler-0-6-1.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2011/11/linux-mint-12-lisa-released.html" class="u-url">Linux Mint 12 (Lisa) released!</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2011-11-26T07:08:45+00:00">2011-11-26 07:08</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>Linux Mint 12 has just been released!</p>
<p>This new version includes a Gnome 3 using a specific extension MGSE (Mint Gnome Sheel Extensions) and a Gnome 2 UI (MATE). You will find also a lot of other improvements. </p>
<p>From several months, Linux Mint is the most used Linux distribution. </p>
<p>For more informations, you can read <a href="http://blog.linuxmint.com/?p=1889" title="Linux Mint 12 “Lisa” released!" target="_blank">the official announcement</a></p></div>
        </div>
            
        
    <p>
        <a href="posts/2011/11/linux-mint-12-lisa-released.html#disqus_thread" data-disqus-identifier="cache/posts/2011/11/linux-mint-12-lisa-released.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2011/11/print-strings-integers-intel-assembly.html" class="u-url">How to print strings and integers in Intel Assembly on Linux ?</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2011-11-23T09:11:59+00:00">2011-11-23 09:11</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>In this post, we'll learn how to print strings and integers to the console on Linux using Intel Assembly. In this post, I'll use the AT&amp;T notation, because it's the notation used in EDDI. </p>
<p>In EDDI, I have to print strings and numbers to the console, as this is not an easy exercise, I wanted to share my experience here. </p>
<p>On Linux, the only way to print something on the console is to use a system call. For that, we have to use the 0x08 interrupt code. </p>
<h4>Declare strings</h4>

<p>First, we'll see how to declare strings in an Intel Assembly file. You can use the <strong>.string</strong> instruction to achieve that : </p>
<div class="code"><pre><span class="nl">StringToPrint:</span>
<span class="na">.string</span> <span class="s">"Hello"</span>
</pre></div>


<h4>Print strings</h4>

<p>Then, to print, we will call the <em>sys_write</em> system call : </p>
<div class="code"><pre><span class="nf">movl</span> <span class="no">$4</span><span class="p">,</span> <span class="nv">%eax</span>
<span class="nf">movl</span> <span class="no">$1</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">movl</span> <span class="no">$StringToPrint</span><span class="p">,</span> <span class="nv">%ecx</span>
<span class="nf">movl</span> <span class="no">$5</span><span class="p">,</span> <span class="nv">%edx</span>
<span class="nf">int</span> <span class="no">$0x80</span>
</pre></div>


<p>The value in <strong>%eax</strong> (4) indicates the system call we need (<em>sys_write</em>). The 1 in <strong>%ebx</strong> indicates that we want to write in the console. Finally the two last parameters indicates the string to print and the size of the string. In Intel assembly, the <strong>int</strong> instruction launch an interrupt and the 0x80 in the interrupt table is set to the system call in the Linux Kernel. </p>
<p>As you can see, this code does use 4 registers and does not save any of them. Ideally, you will save the registers before and restore them. It depends on when you use this routine. </p>
<h4>Print integers</h4>

<p>Writing an integer is a bit more complicated. If you have the integer in the string, there is no problem, but if you have only a long on your assembly, you'll have to convert the int into a string to print it. We will convert the integer char after char and use the stack as storage for our string. Then every char will be printed to the console using the same system as before. </p>
<p>So let's say we have our number in the <strong>%eax</strong> register : </p>
<div class="code"><pre><span class="nf">movl</span> <span class="no">$9234</span><span class="p">,</span> <span class="nv">%eax</span>
</pre></div>


<p>So let's take a look at the code : </p>
<div class="code"><pre><span class="nf">xorl</span> <span class="nv">%esi</span><span class="p">,</span> <span class="nv">%esi</span>

<span class="nl">loop:</span>
<span class="nf">movl</span> <span class="no">$0</span><span class="p">,</span> <span class="nv">%edx</span>
<span class="nf">movl</span> <span class="no">$10</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">divl</span> <span class="nv">%ebx</span>
<span class="nf">addl</span> <span class="no">$48</span><span class="p">,</span> <span class="nv">%edx</span>
<span class="nf">pushl</span> <span class="nv">%edx</span>
<span class="nf">incl</span> <span class="nv">%esi</span>
<span class="nf">cmpl</span> <span class="no">$0</span><span class="p">,</span> <span class="nv">%eax</span>
<span class="nf">jz</span>   <span class="no">next</span>
<span class="nf">jmp</span> <span class="no">loop</span>

<span class="nl">next:</span>
<span class="nf">cmpl</span> <span class="no">$0</span><span class="p">,</span> <span class="nv">%esi</span>
<span class="nf">jz</span>   <span class="no">exit</span>
<span class="nf">decl</span> <span class="nv">%esi</span>
<span class="nf">movl</span> <span class="no">$4</span><span class="p">,</span> <span class="nv">%eax</span>
<span class="nf">movl</span> <span class="nv">%esp</span><span class="p">,</span> <span class="nv">%ecx</span>
<span class="nf">movl</span> <span class="no">$1</span><span class="p">,</span> <span class="nv">%ebx</span>
<span class="nf">movl</span> <span class="no">$1</span><span class="p">,</span> <span class="nv">%edx</span>
<span class="nf">int</span>  <span class="no">$0x80</span>
<span class="nf">addl</span> <span class="no">$4</span><span class="p">,</span> <span class="nv">%esp</span>
<span class="nf">jmp</span>  <span class="no">next</span>

<span class="nl">exit:</span>
</pre></div>


<p>The first part of the code consists in dividing the value by 10 until we reach zero. The remainder of the division is pushed onto the stack. For example, for our number, after this part, we'll have 4-3-2-9 on the stack. The order is reversed, which is logic because we stack the remainders from the right. During this phase, we count the number of elements using the <strong>%esi</strong> register. </p>
<p>Once this is done, we print each characters one by one starting with the last that has been pushed. Here we decrement the counter for each char and we use the <strong>sys_write</strong> call with <strong>%esp</strong> as the address of the string of one character. After each character, we incremetn the <strong>%esp</strong> to cancel the push that we used. </p>
<p>We have to do this in two phases in order to get the characters in the good order and not in reverse order. </p>
<h4>Handle negative numbers</h4>

<p>As you may have noticed, we do not manage negative numbers in our code. They will be printed, but it will be positive number. Indeed, in Intel Assembly (and in processors in general), negative numbers are handled with two's complement. Handling negative numbers in our code is not a big deal. We can add this code at the beginning : </p>
<div class="code"><pre><span class="nf">cmpl</span> <span class="no">$0</span><span class="p">,</span> <span class="nv">%eax</span>
<span class="nf">jge</span> <span class="no">loop</span>
<span class="nf">neg</span> <span class="nv">%eax</span>
<span class="nf">pushl</span> <span class="nv">%eax</span>
<span class="err">;</span> <span class="nf">Print</span> <span class="err">"</span><span class="p">-</span><span class="err">"</span> 
<span class="no">popl</span> <span class="nv">%eax</span>
</pre></div>


<p>First of all, we check if the number is smaller than 0, if it's not the case, we directly jump to the code we used before. If it's smaller, we negate the number and print a - before printing the real number. We have to save the <strong>%eax</strong> register before printing the - character because <strong>%eax</strong> is used for printing. </p>
<p>You'll now have a complete procedure to print an integer on the console in assembly. </p>
<p>I hope that this could be of some help for somebody.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2011/11/print-strings-integers-intel-assembly.html#disqus_thread" data-disqus-identifier="cache/posts/2011/11/print-strings-integers-intel-assembly.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2011/11/eddi-compiler-0-6-0-arrays.html" class="u-url">EDDI Compiler 0.6.0 : Arrays</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2011-11-21T09:07:20+00:00">2011-11-21 09:07</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>This new version of the EDDI Compiler was faster to finalize than the previous.</p>
<p>The main feature of this release is the use of arrays. You can now use arrays in the EDDI code. You can declare global or local arrays and pass them as parameters to the function. In the assembly, there is certainly still some optimization to perform, but the code works well for now. A new loop is also available the foreach loop for arrays. The loop iterates through each element of the array. </p>
<p>I also performed some new improvements in the compiler speed. </p>
<p>The local and global variables now have default values (0 for int and the empty string for strings). So you can omit the value in the declaration. </p>
<p>I removed the dependency to the C library with replacing malloc with a little memory allocation function I wrote myself. This function is very simple and only use sys_brk to allocate memory directly after the program. You cannot release the memory for now, but that was the same before. </p>
<p>The compiler is now able to warn you if you declare something and you don't use it (parameter, variable, function). Moreover, if you enable the optimization, the functions and variables that are not used will not be compiled. </p>
<p>I made a little fix to the print_integer function to handle negative numbers. Before that, they were printed but in two's complement, now they are printed in the negative form (-344 for example). </p>
<p>I don't know exactly yet what will be included in the next release of the EDDI Compiler. Probably this will be minor release with the inclusion of function return types, but I'm not sure yet. In the future, I also want to add some kind of structure to the program. </p>
<p>You can find the compiler sources on the Github repository : <a title="EDDI Compiler Repository" href="http://github.com/wichtounet/eddic">https://github.com/wichtounet/eddic</a>. </p>
<p>The exact version I refer to is the v0.6 available in the github tags or directly as the release branch.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2011/11/eddi-compiler-0-6-0-arrays.html#disqus_thread" data-disqus-identifier="cache/posts/2011/11/eddi-compiler-0-6-0-arrays.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2011/11/new-theme-site.html" class="u-url">New Wordpress theme for the site</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2011-11-18T01:56:17+00:00">2011-11-18 01:56</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>After a long time with the old F2 theme, I decided to choose a more modern design. I chose the WP Plus design which is based on the Google Plus Design. </p>
<p>I think that this design is more practical and cleaner for the users and more comfortable. </p>
<p>Moreover, I also took some time to change some of my addons. I replaced All In One SEO with Wordpress SEO plugin from Joost de Valk. I think that this plugin is better than the first one, but more of that, it also replaced one addon generating the XML sitemap and helped me adding a breadcrumb to the site. </p>
<p>I hope that these changes will improve the user experience on my website. </p>
<p>If you encounter any kind of problems with the new design, don't hesitate to let a comment or to contact me.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2011/11/new-theme-site.html#disqus_thread" data-disqus-identifier="cache/posts/2011/11/new-theme-site.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2011/11/boost-1-48-0-has-been-released.html" class="u-url">Boost 1.48.0 has been released</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2011-11-15T10:48:59+00:00">2011-11-15 10:48</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>A new version of Boost is available : <a href="http://www.boost.org/users/history/version_1_48_0.html" title="Boost 1.48.0 Details">Boost 1.48.0</a></p>
<p>This release includes three new libraries : Locale, Container and Move. </p>
<p>A lot of bug have been fixed and there are also some changes in the existing libraries.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2011/11/boost-1-48-0-has-been-released.html#disqus_thread" data-disqus-identifier="cache/posts/2011/11/boost-1-48-0-has-been-released.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2011/11/boost-intrusive_ptr.html" class="u-url">Boost intrusive_ptr : faster shared pointer</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2011-11-14T08:40:41+00:00">2011-11-14 08:40</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>This post will present the Boost intrusive_ptr and its usage in C++ programming. </p>
<p>Recently, I took some time to optimize the parsing performances of the EDDI Compiler. The parsing phase creates a lot of nodes to fill the Abstract Syntax Tree. </p>
<p>One of the way I found was to replace some shared_ptr by some intrusive_ptr of the Boost library. </p>
<p>It's a faster alternative of shared_ptr. Like its name indicates, it's intrusive. The reference counter is included directely in the managed class, in the contrary of the shared_ptr where the reference counter has to be dynamically allocated to live aside the object. This leads to some performances improvement. Considering memory, the footprint of an intrusive_ptr is the same as the footprint of a raw pointer. This is not the case for the shared_ptr that have a pointer to the object, a pointer to the counter and the counter itself. </p>
<p>For example, if you have a class X:</p>
<div class="code"><pre><span class="k">class</span> <span class="nc">X</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">age</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>


<p>And you use it in your code using a shared_ptr : </p>
<div class="code"><pre><span class="kt">void</span> <span class="nf">test</span><span class="p">(){</span>
    <span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span> <span class="n">x</span><span class="p">(</span><span class="k">new</span> <span class="n">X</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>and you want to use an intrusive_ptr, you have first to add a reference counter inside the X class : </p>
<div class="code"><pre><span class="k">class</span> <span class="nc">X</span> <span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">name</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">age</span><span class="p">;</span>

    <span class="kt">long</span> <span class="n">references</span><span class="p">;</span>
    <span class="n">X</span><span class="p">()</span> <span class="o">:</span> <span class="n">references</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">};</span>
</pre></div>


<p>And you have to indicate to the intrusive_ptr where the reference counter can be found for this class : </p>
<div class="code"><pre><span class="kr">inline</span> <span class="kt">void</span> <span class="nf">intrusive_ptr_add_ref</span><span class="p">(</span><span class="n">X</span><span class="o">*</span> <span class="n">x</span><span class="p">){</span>
    <span class="o">++</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">references</span><span class="p">;</span>
<span class="p">}</span>

<span class="kr">inline</span> <span class="kt">void</span> <span class="nf">intrusive_ptr_release</span><span class="p">(</span><span class="n">X</span><span class="o">*</span> <span class="n">x</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">--</span><span class="n">x</span><span class="o">-&gt;</span><span class="n">references</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> 
        <span class="k">delete</span> <span class="n">x</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>And finally you can use the intrusive_ptr to replace your shared_ptr : </p>
<div class="code"><pre><span class="kt">void</span> <span class="nf">test</span><span class="p">(){</span>
    <span class="n">boost</span><span class="o">::</span><span class="n">intrusive_ptr</span><span class="o">&lt;</span><span class="n">X</span><span class="o">&gt;</span> <span class="n">x</span><span class="p">(</span><span class="k">new</span> <span class="n">X</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">x</span><span class="o">-&gt;</span><span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>The smart pointer itself can be used exactly the same way as a shared_ptr. If you have several classes that are managed using an intrusive_ptr, you can use a function template to tell Boost that all the reference counter are at the same place : </p>
<div class="code"><pre><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="n">intrusive_ptr_add_ref</span><span class="p">(</span><span class="n">T</span><span class="o">*</span> <span class="n">expr</span><span class="p">){</span>
    <span class="o">++</span><span class="n">expr</span><span class="o">-&gt;</span><span class="n">references</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="kr">inline</span> <span class="kt">void</span> <span class="n">intrusive_ptr_release</span><span class="p">(</span><span class="n">T</span><span class="o">*</span> <span class="n">expr</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="o">--</span><span class="n">expr</span><span class="o">-&gt;</span><span class="n">references</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">delete</span> <span class="n">expr</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>


<p>As you can see, the pointer is very intrusive and needs some boilerplate code added to your application, but it can leads to some interesting improvements for classes very often dynamically allocated. </p>
<p>There is another advantage in using intrusive_ptr. As the reference counter is stored into the object itself, you can create several intrusive_ptr to the same object without any problem. This is not the case when you use a shared_ptr. Indeed, if you create two shared_ptr to the same dynamically allocated object, they will both have a different references counter and at the end, you will end up with an object being deleted twice. </p>
<p>Of course, there are not only advantages. First of all, you have to declare a field in every classes that you want to manage using an intrusive_ptr and you have to declare functions to manage the reference. Then there are some disadvantages when using this pointer type compared to a shared_ptr : </p>
<ul>
    <li>It's impossible to create a weak_ptr from a intrusive_ptr</li>
    <li>Code redundancy, you have to copy the reference counter in every class that you want to use an intrusive_ptr with</li>
    <li>You have to provide a function for every types that has to be used with intrusive_ptr (only two functions if you use the template versions of the two functions)</li>
</ul>

<p>To conclude, the boost::intrusive_ptr can be a good replacement of std::shared_ptr in a performance critical application, but if you have no performances problem, do not use it because it makes your code less clear. If you are concerned by performances when using std::shared_ptr, consider also using std::make_shared to create your pointers, so that the reference counter and the object itself will be allocated at the same place and at the same time, resulting in better performances. Another case where it's interesting to use an intrusive_ptr is when dealing with libraries using a lot of raw pointers, because you can create several intrusive_ptr to the same raw pointer without any problem.</p>
<p>For more information, you can consult <a href="http://www.boost.org/doc/libs/1_47_0/libs/smart_ptr/intrusive_ptr.html" title="Boost intrusive_ptr official documentation">the official documentation</a>.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2011/11/boost-intrusive_ptr.html#disqus_thread" data-disqus-identifier="cache/posts/2011/11/boost-intrusive_ptr.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2011/11/eddic-0-5-1-better-assembly-generation-and-faster-parsing.html" class="u-url">eddic 0.5.1 : Better assembly generation and faster parsing</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2011-11-10T04:33:32+00:00">2011-11-10 04:33</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>I'm very pleased to release the version 0.5.1 of the EDDI Compiler.</p>
<p>It makes now a long time since the last version of eddic, but I started again working frequently on it. This version doesn't add any new feature to the language, but there are a lot of improvements in the compiler itself. </p>
<p>First of all, the generated assembly has been improved a lot. I use now a intermediate representation of assembly and then the compiler is able to make more optimizations in its choice. This optimization is especially visible for integer computations. Before this, all the computations used stack operations and then we use almost only registers when it's possible. It's still not perfect, but it uses way less instructions. Moreover, this can enable me to write a 64 assembly code instead of 32 and provide both versions in the compiler. </p>
<p>Another improvement is the speed of the parser. I now use Boost Spirit to parse the source file and construct an Abstract Syntax Tree. This parsing is very fast now (with some optimizations). Moreover, it will be easier to add new constructs later. </p>
<p>I also improved the general performances at some places. I also use Boost Program Options to parse the command line options. </p>
<p>In the next version (0.6.0), I will introduce arrays of int and strings and the foreach construct for array. I will also remove the dependency to malloc writing a memory allocation manager in assembly. I will also introduce warnings in the compiler. </p>
<p>You can find the compiler sources on the Github repository : <a title="EDDI COmpiler Repository" href="http://github.com/wichtounet/eddic">https://github.com/wichtounet/eddic</a>. </p>
<p>The compiler now needs Boost 1.47.0 to build. </p>
<p>The exact version I refer to is the v0.5.1 available in the github tags or directly as the release branch.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2011/11/eddic-0-5-1-better-assembly-generation-and-faster-parsing.html#disqus_thread" data-disqus-identifier="cache/posts/2011/11/eddic-0-5-1-better-assembly-generation-and-faster-parsing.html">Comments</a>


        </p></article>
        <article class="postbox h-entry post-text">
        <h1 class="p-name"><a href="posts/2011/10/effective-stl-book-review.html" class="u-url">Effective STL Book Review</a>
        <br><small>  
             Posted: <time class="published dt-published" datetime="2011-10-31T08:39:16+00:00">2011-10-31 08:39</time>
        </small></h1>
        <hr>
        <div class="e-content">
        <div><p>I finished reading the last Effective C++ volume : Effective STL, Scott Meyers.</p>
<p>Again, this book follows the same model as the two others, providing several rules aiming at making you a better (more effective) STL programmer. All the items of this book are centered on the usage of the Standard Template Library (STL).</p>
<p>The first chapters (Containers) gives you several advices for using STL Containers. The main point of this chapter is about how to choose carefully a container for a specific use case. It also contains several advices on how to use them well regarding to performances and thread safety.</p>
<p>In the next chapter (<em>vector</em> and <em>string</em>), the author focuses on two specific containers : vector and string. There are some specificities on these two containers that can improve the efficiency of the program.</p>
<p>The third chapter (Associative Containers) is about the associative containers of the STL : set, map, multimap and multiset. It also contains some important informations about which methods to use for each usage in order to preserve the efficiency of each container. It will also explain you the very important difference between equality and equivalence.</p>
<p>The next one (Iterators) explains which iterators to use and how to convert iterators of one type to another.</p>
<p>The chapter five (Algorithms) describes the most important algorithms of the STL. There are tons of algorithms in the STL and using them can save you from writing a lot of boilerplate code. For example, you will learn the different sorting algorithms and for_each. I found that this chapter was especially interesting.</p>
<p>The sixth chapter (Functors) explains you how to create functors and predicates for using with STL classes. It also treats of the special functions to convert functions to functors.</p>
<p>The last chapter (Programming with the STL) gives you advices on how to use the STL to make easier the programming of concrete programs. It will teach you what functions to use, what headers to include and how to decipher STL-related errors.</p>
<p>I found that this book was really good, as good as the first one. The advices are very useful and easy to understand. Using this advices enabled me to improve my code and the efficiency of it. I will recommend this book to every C++ developers using the STL.</p></div>
        </div>
            
        
    <p>
        <a href="posts/2011/10/effective-stl-book-review.html#disqus_thread" data-disqus-identifier="cache/posts/2011/10/effective-stl-book-review.html">Comments</a>


        </p></article>
    
        <div>
        <ul class="pager">
            <li class="previous">
                <a href="index-17.html" rel="prev">← Newer posts</a>
            </li>
            <li class="next">
                <a href="index-15.html" rel="next">Older posts →</a>
            </li>
        </ul>
        </div>

    
        
       <script>var disqus_shortname="blogwichtounet";(function(){var a=document.createElement("script");a.async=true;a.src="//"+disqus_shortname+".disqus.com/count.js";(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(a)}());</script>


	


            </div>
        </div>
    </div>
</div>

<!-- Footer -->

<footer>
    Contents © 2014         <a href="mailto:baptistewicht@gmail.com">Baptiste Wicht</a> - Powered by         <a href="http://getnikola.com" rel="nofollow">Nikola</a>         
<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/4.0/88x31.png"></a>
        <ul class="footer_inline_ul">
            
        </ul>
</footer>


            <script src="assets/js/all-nocdn.js" type="text/javascript"></script>


<!-- Late loading stuff  -->

    <script type="text/javascript">
      $(document).ready(function() {
        jQuery.getJSON('/assets/js/tag_cloud_data.json', function(data) {
            var items = [];

            $.each(data, function(key, val) {
                items.push('<li><a href="' + val[1] +'" '+'data-weight="'+val[0]+'"'+'>' + key + '</a></li>');
            });

            $('<div/>', {
                'id': 'tags',
                html: '<ul>' + items.join('') + '</ul>'
            }).appendTo('body');

            if(!$('#tags_canvas').tagcanvas({
                textColour: '#FFFFFF',
                outlineColour: '#ff00ff',
                reverse: true,
                depth: 0.8,
                maxSpeed: 0.05,
                weight: true,
                weightFrom: "data-weight",
                weightSizeMin: 8,
                weightSizeMax: 24
            },'tags')) {
                //something went wrong, hide the canvas container
                $('#tags_container').hide();
            }});
        });
    </script>

<!-- Google platform JS -->
    
<script type="text/javascript" src="https://apis.google.com/js/platform.js"></script>


    
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5327566b264df4ee"></script>
<script type="text/javascript">
  addthis.layers({
    'theme' : 'dark',
    'share' : {
      'position' : 'right',
      //'services' : 'google_plusone,facebook_like,tweet',
      'services' : 'google_plusone_share,facebook,twitter'
    }, 
    'follow' : {
      'services' : [
        {'service': 'twitter', 'id': 'wichtounet'},
        {'service': 'google_follow', 'id': '+BaptisteWicht'}
      ]
    }   
  });
</script>



<!-- Tipue Search -->

<script type="text/javascript" src="assets/js/tipuesearch_set.js"></script>
<script type="text/javascript" src="assets/js/tipuesearch.js"></script>
<script type="text/javascript">
    $(document).ready(function() {
        $('#tipue_search_input').tipuesearch({
        'mode': 'json',
        'contentLocation': '/assets/js/tipuesearch_content.json',
        'showUrl': false
        });
        });
</script>

<script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script>






</body>
</html>